

--- SCRIPT 0 ---


        function onLongPress(element, callback, callbackCancel) {
            let timer;

            element.addEventListener('touchstart', (e) => {
                e.preventDefault();
                timer = setTimeout(() => {
                    timer = null;
                    callback();
                }, 200);
            });

            function cancel() {
                clearTimeout(timer);
                callbackCancel();
            }

            element.addEventListener('touchend', cancel);
            // element.addEventListener('touchmove', cancel);
        }
    

--- SCRIPT 1 ---


        function gtag() {
            dataLayer.push(arguments);
        }
    

--- SCRIPT 2 ---


        ! function(f, b, e, v, n, t, s) {
            if (f.fbq) return;
            n = f.fbq = function() {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n;
            n.push = n;
            n.loaded = !0;
            n.version = '2.0';
            n.queue = [];
            t = b.createElement(e);
            t.async = !0;
            t.src = v;
            s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '285848113537225');
    

--- SCRIPT 4 ---


document.addEventListener("DOMContentLoaded", function(event) {
    try {
        const  inputPhonei18nID = `inputPhonei18n` + Math.floor(Math.random() * (99999 - 10000 + 1)) + 10000;
        $('.inscricao_campanha_whatsapp_footer').addClass(' text-dark');

        const label = ``;

        const initialNumber = "";

        const initialCountry = "BR";

        $('.inscricao_campanha_whatsapp_footer').html(`
            ${label.length > 0 ? `
            <div>
                <label class="" for="${inputPhonei18nID}">
                    ${label}
                    <span class="text-danger">*</span>                </label>
            </div>
            ` : ''}
            <div class="d-flex">
            <input
                type="tel"
                class="form-control w-100 inputPhonei18n-raw"
                id="${inputPhonei18nID}"
                placeholder="Seu WhatsApp"
                name="whatsapp"
                value=""
                style=""
                required            >
            <input
                type="hidden"
                class="inputPhonei18n-e164"
                id="${inputPhonei18nID}_e164"
                value="${initialNumber}"
                name="whatsapp_e164"
            >
            <input
                type="hidden"
                class="inputPhonei18n-ddi"
                id="${inputPhonei18nID}_ddi"
                name="whatsapp_ddi"
            >
            <input
                type="hidden"
                class="inputPhonei18n-country"
                id="${inputPhonei18nID}_country"
                value="${initialCountry}"
                name="whatsapp_country"
            >
            <input
                type="hidden"
                class="inputPhonei18n-update"
                id="${inputPhonei18nID}_update"
            >
            </div>
        `);

        const inputPhonei18nEl = document.querySelector(`#${inputPhonei18nID}`);

        const inputPhonei18n = window.intlTelInput(inputPhonei18nEl, {
            // utilsScript: "",
            nationalMode: true,
            formatOnDisplay: true,
            separateDialCode: true,
            initialCountry: initialCountry.length > 0 ? initialCountry : 'BR',
            preferredCountries: ['BR', 'US'],
            customPlaceholder: function(selectedCountryPlaceholder, selectedCountryData) {
                return `${selectedCountryPlaceholder}`.replace(/[0-9]/g, "0");
            },
        });

        const formatinputPhonei18n = (phoneNumber) => {
            if (phoneNumber === undefined) {
                phoneNumber = inputPhonei18n.getNumber();
            }
            inputPhonei18n.setNumber(phoneNumber);
            updateAuxInputs();
        };

        const updateAuxInputs = () => {
            $(`#${inputPhonei18nID}_e164`).val(inputPhonei18n.getNumber());
            var countryData = inputPhonei18n.getSelectedCountryData();
            $(`#${inputPhonei18nID}_ddi`).val(countryData.dialCode || '');
            $(`#${inputPhonei18nID}_country`).val(countryData.iso2 || '');
        };

        inputPhonei18nEl.addEventListener('change', () => { formatinputPhonei18n() });
        inputPhonei18nEl.addEventListener('keyup', () => { formatinputPhonei18n() });

        if (initialNumber.length > 0) {
            inputPhonei18n.promise.then(() => {
                formatinputPhonei18n(initialNumber);
            });
        }

        $(`#${inputPhonei18nID}`).bind('input', function() {
            if(! inputPhonei18n.isValidNumber() && $(this).val().length > 0) {
                this.setCustomValidity('Número de telefone inválido');
            } else {
                this.setCustomValidity('');
            }
        });

        $(`.inscricao_campanha_whatsapp_footer .inputPhonei18n-update`).on('change', function() {
            formatinputPhonei18n($(this).val());
        });
    } catch (error) {
        // console.error(error);
    }
    
});


--- SCRIPT 5 ---


function enviarInscricaoCampanhasFooter() {
    const nomeObrigatorio = true;
    const whatsappObrigatorio = true;
    const emailObrigatorio = true;

    if (nomeObrigatorio && $('#formInscricaoCampanhasFooter-nome').val().trim() == '') {
        showNotification('Ops', 'Você esqueceu de preencher o nome.', 'warning');
        return;
    }

    const whatsapp = new window.inputPhonei18n('.inscricao_campanha_whatsapp');
    if (whatsapp.exists()) {
        if (whatsappObrigatorio && whatsapp.getE164Number() == '') {
            showNotification('Ops', 'Você esqueceu de preencher o WhatsApp.', 'warning');
            return;
        }
    }

    if (emailObrigatorio && $('#formInscricaoCampanhasFooter-email').val().trim() == '') {
        showNotification('Ops', 'Você esqueceu de preencher o e-mail.', 'warning');
        return;
    }

    enviarFormulario('#formInscricaoCampanhasFooter', () => {
        facilZapEventos.inscricao();
        $('#formInscricaoCampanhasFooter').html(`
            <div class="mb-0">
                <i class="fa fa-check-circle text-success"></i> 
                Obrigado por se inscrever!<br>
                Em breve você receberá nossas novidades e promoções.
            </div>
        `);
    });
}


--- SCRIPT 14 ---




--- SCRIPT 15 ---




--- SCRIPT 38 ---


	$.extend( $.validator.messages, {

// Core
required: "Este campo &eacute; obrigat&oacute;rio.",
remote: "Por favor, corrija este campo.",
email: "Por favor, forne&ccedil;a um endere&ccedil;o de email v&aacute;lido.",
url: "Por favor, forne&ccedil;a uma URL v&aacute;lida.",
date: "Por favor, forne&ccedil;a uma data v&aacute;lida.",
dateISO: "Por favor, forne&ccedil;a uma data v&aacute;lida (ISO).",
number: "Por favor, forne&ccedil;a um n&uacute;mero v&aacute;lido.",
digits: "Por favor, forne&ccedil;a somente d&iacute;gitos.",
creditcard: "Por favor, forne&ccedil;a um cart&atilde;o de cr&eacute;dito v&aacute;lido.",
equalTo: "Por favor, forne&ccedil;a o mesmo valor novamente.",
maxlength: $.validator.format( "Por favor, forne&ccedil;a n&atilde;o mais que {0} caracteres." ),
minlength: $.validator.format( "Por favor, forne&ccedil;a ao menos {0} caracteres." ),
rangelength: $.validator.format( "Por favor, forne&ccedil;a um valor entre {0} e {1} caracteres de comprimento." ),
range: $.validator.format( "Por favor, forne&ccedil;a um valor entre {0} e {1}." ),
max: $.validator.format( "Por favor, forne&ccedil;a um valor menor ou igual a {0}." ),
min: $.validator.format( "Por favor, forne&ccedil;a um valor maior ou igual a {0}." ),
step: $.validator.format( "Por favor, forne&ccedil;a um valor m&uacute;ltiplo de {0}." ),

// Metodos Adicionais
maxWords: $.validator.format( "Por favor, forne&ccedil;a com {0} palavras ou menos." ),
minWords: $.validator.format( "Por favor, forne&ccedil;a pelo menos {0} palavras." ),
rangeWords: $.validator.format( "Por favor, forne&ccedil;a entre {0} e {1} palavras." ),
accept: "Por favor, forne&ccedil;a um tipo v&aacute;lido.",
alphanumeric: "Por favor, forne&ccedil;a somente com letras, n&uacute;meros e sublinhados.",
bankaccountNL: "Por favor, forne&ccedil;a com um n&uacute;mero de conta banc&aacute;ria v&aacute;lida.",
bankorgiroaccountNL: "Por favor, forne&ccedil;a um banco v&aacute;lido ou n&uacute;mero de conta.",
bic: "Por favor, forne&ccedil;a um c&oacute;digo BIC v&aacute;lido.",
cifES: "Por favor, forne&ccedil;a um c&oacute;digo CIF v&aacute;lido.",
creditcardtypes: "Por favor, forne&ccedil;a um n&uacute;mero de cart&atilde;o de cr&eacute;dito v&aacute;lido.",
currency: "Por favor, forne&ccedil;a uma moeda v&aacute;lida.",
dateFA: "Por favor, forne&ccedil;a uma data correta.",
dateITA: "Por favor, forne&ccedil;a uma data correta.",
dateNL: "Por favor, forne&ccedil;a uma data correta.",
extension: "Por favor, forne&ccedil;a um valor com uma extens&atilde;o v&aacute;lida.",
giroaccountNL: "Por favor, forne&ccedil;a um n&uacute;mero de conta corrente v&aacute;lido.",
iban: "Por favor, forne&ccedil;a um c&oacute;digo IBAN v&aacute;lido.",
integer: "Por favor, forne&ccedil;a um n&uacute;mero n&atilde;o decimal.",
ipv4: "Por favor, forne&ccedil;a um IPv4 v&aacute;lido.",
ipv6: "Por favor, forne&ccedil;a um IPv6 v&aacute;lido.",
lettersonly: "Por favor, forne&ccedil;a apenas com letras.",
letterswithbasicpunc: "Por favor, forne&ccedil;a apenas letras ou pontua&ccedil;ões.",
mobileNL: "Por favor, fornece&ccedil;a um n&uacute;mero v&aacute;lido de telefone.",
mobileUK: "Por favor, fornece&ccedil;a um n&uacute;mero v&aacute;lido de telefone.",
nieES: "Por favor, forne&ccedil;a um NIE v&aacute;lido.",
nifES: "Por favor, forne&ccedil;a um NIF v&aacute;lido.",
nowhitespace: "Por favor, n&atilde;o utilize espa&ccedil;os em branco.",
pattern: "O formato fornecido &eacute; inv&aacute;lido.",
phoneNL: "Por favor, forne&ccedil;a um n&uacute;mero de telefone v&aacute;lido.",
phoneUK: "Por favor, forne&ccedil;a um n&uacute;mero de telefone v&aacute;lido.",
phoneUS: "Por favor, forne&ccedil;a um n&uacute;mero de telefone v&aacute;lido.",
phonesUK: "Por favor, forne&ccedil;a um n&uacute;mero de telefone v&aacute;lido.",
postalCodeCA: "Por favor, forne&ccedil;a um n&uacute;mero de c&oacute;digo postal v&aacute;lido.",
postalcodeIT: "Por favor, forne&ccedil;a um n&uacute;mero de c&oacute;digo postal v&aacute;lido.",
postalcodeNL: "Por favor, forne&ccedil;a um n&uacute;mero de c&oacute;digo postal v&aacute;lido.",
postcodeUK: "Por favor, forne&ccedil;a um n&uacute;mero de c&oacute;digo postal v&aacute;lido.",
postalcodeBR: "Por favor, forne&ccedil;a um CEP v&aacute;lido.",
require_from_group: $.validator.format( "Por favor, forne&ccedil;a pelo menos {0} destes campos." ),
skip_or_fill_minimum: $.validator.format( "Por favor, optar entre ignorar esses campos ou preencher pelo menos {0} deles." ),
stateUS: "Por favor, forne&ccedil;a um estado v&aacute;lido.",
strippedminlength: $.validator.format( "Por favor, forne&ccedil;a pelo menos {0} caracteres." ),
time: "Por favor, forne&ccedil;a um hor&aacute;rio v&aacute;lido, no intervado de 00:00 a 23:59.",
time12h: "Por favor, forne&ccedil;a um hor&aacute;rio v&aacute;lido, no intervado de 01:00 a 12:59 am/pm.",
url2: "Por favor, forne&ccedil;a uma URL v&aacute;lida.",
vinUS: "O n&uacute;mero de identifica&ccedil;&atilde;o de ve&iacute;culo informado (VIN) &eacute; inv&aacute;lido.",
zipcodeUS: "Por favor, forne&ccedil;a um c&oacute;digo postal americano v&aacute;lido.",
ziprange: "O c&oacute;digo postal deve estar entre 902xx-xxxx e 905xx-xxxx.",
cpfBR: "Por favor, forne&ccedil;a um CPF v&aacute;lido.",
nisBR: "Por favor, forne&ccedil;a um NIS/PIS v&aacute;lido.",
cnhBR: "Por favor, forne&ccedil;a um CNH v&aacute;lido.",
cnpjBR: "Por favor, forne&ccedil;a um CNPJ v&aacute;lido."
} );


--- SCRIPT 40 ---


	var corPrincipalCookieConsent = "\x23c99695";

window.cookieconsent.initialise({
"palette": {
"popup": {
  "background": corPrincipalCookieConsent
},
"button": {
  "background": "#00000085"
}
},
"theme": "classic",
"position": "center",
"content": {
"message": "Este site usa cookies para garantir que voc&ecirc; obtenha uma melhor experi&ecirc;ncia de uso.",
"dismiss": "Compreendo!",
"link": "Leia mais",
"href": " "
}
});


--- SCRIPT 46 ---


$.fn.dataTable.ext.errMode = 'none';

class APIDataTable {
    constructor(seletorTabela, endpointURL, apiToken) {
        this.baseUri = 'https://api.facilzap.app.br/';
        this.lojaId = '3016';
        this.seletorTabela = seletorTabela;
        this.wrapperTabela = `${this.seletorTabela}_wrapper`.replace('.', '#');
        this.endpointURL = endpointURL;
        this.apiToken = apiToken;
        this.filtrosPadroes = {};
        this.filtros = {};
        this.ordem = undefined;
        this.dadosExtrasRequisicao = {};
        this.colunas = [];
        this.camposBusca = [];
        this.menuQuantidadeRegistros = [15, 25, 50];
        this.dataTable = undefined;
        this.dadosMap = new Map();
    }

    obterDadosItem(id) {
        return this.dadosMap.get(id);
    }

    setarOrdem(ordem) {
        this.ordem = ordem;
    }

    resetarOrdem() {
        this.ordem = undefined;
    }

    setarFiltrosPadroes(filtrosPadroes) {
        this.filtrosPadroes = filtrosPadroes;
    }

    setarFiltros(filtros, recarregar = true) {
        this.filtros = filtros;

        if (this.dataTable !== undefined && recarregar) {
            this.recarregar(true);
        }
    }

    setarFiltro(chave, valor, recarregar = false) {
        this.filtros[chave] = valor;

        if (this.dataTable !== undefined && recarregar) {
            this.recarregar(true);
        }
    }

    obterFiltros()
    {
        var filtrosFormatados = {};

        Object.entries(this.filtrosPadroes).forEach(([chaveFiltro, dadosFiltro]) => {
            if (this.filtros[chaveFiltro]) {
                filtrosFormatados[chaveFiltro] = this.filtros[chaveFiltro];
            } else if (dadosFiltro.valorPadrao){
                filtrosFormatados[chaveFiltro] = dadosFiltro.valorPadrao;
            }
        });

        return filtrosFormatados;
    }

    obterBusca()
    {
        return {
            'column': $(`${this.wrapperTabela} .datatable_tipo_busca`).val(),
            'value': this.dataTable.search()
        };
    }

    resetarFiltros(recarregar = true) {
        this.filtros = {};

        if (this.dataTable !== undefined && recarregar) {
            this.recarregar(true);
        }
    }

    setarColunas(colunas) {
        this.colunas = colunas;
    }

    setarCamposBusca(camposBusca) {
        this.camposBusca = camposBusca;
    }

    setarDadosExtrasRequisicao(dadosExtrasRequisicao) {
        this.dadosExtrasRequisicao = dadosExtrasRequisicao;
    }

    setarMenuQuantidadeRegistros(menuQuantidadeRegistros) {
        this.menuQuantidadeRegistros = menuQuantidadeRegistros;
    }

    setarCallbackCarregamento(callback) {
        $(this.seletorTabela).on('processing.dt', (e, settings, processing) => {
            if (! processing) {
                callback();
            }
        });
    }

    iniciar() {
        this.dataTable = $(this.seletorTabela).DataTable({
            processing: true,
            serverSide: true,
            responsive: true,
            paging: true,
            pageLength: this.menuQuantidadeRegistros ? this.menuQuantidadeRegistros[0] : 15,
            ordering: false,
            ajax: {
                url: this.baseUri + this.endpointURL,
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + this.apiToken
                },
                data: (function (d) {
                    delete d.columns;
                    d.loja_id = this.lojaId;
                    d.filtros = this.obterFiltros();
                    d.search['column'] = $(`${this.wrapperTabela} .datatable_tipo_busca`).val();

                    if (this.ordem) {
                        d.ordem = this.ordem;
                    }

                    Object.entries(this.dadosExtrasRequisicao).forEach(([key, value]) => {
                        d[key] = value;
                    });
                }).bind(this),
                error: function (xhr, error, code) {
                    showNotification('Ops!', 'Houve um erro ao carregar os dados da página. Recarrega a página e tente novamente. Caso o erro persista, entre em contato com o suporte.', 'error');
                }
            },
            columns: this.colunas,
            search: {
                return: true
            },
            language: {
                "sEmptyTable": "Nenhum registro encontrado",
                "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
                "sInfoFiltered": "(Filtrados de _MAX_ registros)",
                "sInfoPostFix": "",
                "sInfoThousands": ".",
                "sLengthMenu": "_MENU_ resultados por página",
                "sLoadingRecords": "Carregando...",
                "sProcessing": "Processando...",
                "sZeroRecords": "Nenhum registro encontrado",
                "sSearch": "Pesquisar",
                "oPaginate": {
                    "sNext": "Próximo",
                    "sPrevious": "Anterior",
                    "sFirst": "Primeiro",
                    "sLast": "Último"
                },
                "oAria": {
                    "sSortAscending": ": Ordenar colunas de forma ascendente",
                    "sSortDescending": ": Ordenar colunas de forma descendente"
                },
                processing: '<p class="text-center font-weight-bold f-16" style="margin-bottom: -45px;margin-top: 40px;">Processando...</p><img src="https://assets.facilzap.app.br/images/loading2.webp">',
                search: "",
            },
            lengthMenu: this.menuQuantidadeRegistros,
        });

        // $(this.seletorTabela).on('processing.dt', (e, settings, processing) => {
        //     if (processing) {
        //         $('.dataTables_processing').hide();
        //         showLoadingOverlay(this.seletorTabela);
        //     } else {
        //         closeLoadingOverlay(this.seletorTabela);
        //     }
        // });

        $(this.seletorTabela).on( 'init.dt', (e, settings) => {
            var api = new $.fn.dataTable.Api( settings );
            var filter_input = $('#'+settings.nTableWrapper.id+' .dataTables_filter input').unbind();

            filter_input.attr('placeholder', 'Buscar...');
            filter_input.addClass('ml-0');
            filter_input.css('max-width', '50vw');

            $('#'+settings.nTableWrapper.id).prepend(`<div class="exibicao_filtros"></div>`);
            this.atualizarExibicaoFiltros();

            $('#'+settings.nTableWrapper.id+' .dataTables_length').parent().removeClass('col-md-6').addClass('col-lg-4 col-xl-6 text-center text-lg-left');
            $('#'+settings.nTableWrapper.id+' .dataTables_filter').parent().removeClass('col-md-6').addClass('col-lg-8 col-xl-6');

            if (this.menuQuantidadeRegistros.length == 1) {
                $('#'+settings.nTableWrapper.id+' .dataTables_length').hide();
            }

            $('#'+settings.nTableWrapper.id+' .dataTables_filter').addClass('input-group mb-0 mx-auto mr-lg-0');
            $('#'+settings.nTableWrapper.id+' .dataTables_filter').css('max-width', '600px');

            if (this.camposBusca.length) {
                var btnBusca = $('<button type="button" class="btn btn-success" style="padding: 8px 15px;"><i class="fa fa-search m-0"></i></button>').click(function() {
                    api.search(filter_input.val()).draw();
                });
                var btnLimpar = $('<button type="button" class="btn btn-danger btn-limpar-busca" style="padding: 8px 15px;display:none"><i class="fa fa-times m-0"></i></button>').click(function() {
                    filter_input.val('');
                    btnBusca.click();
                });

                $(document).keypress(function (event) {
                    if (event.which == 13) {
                        btnBusca.click();
                    }
                });

                var inputGroupPrepend = $('<div class="input-group-prepend pos-relative" style="flex-grow: 1;max-width:250px"></div>');
                var selectTiposBusca = $(`<select class="form-control w-100 px-1 datatable_tipo_busca"></select>`);

                this.camposBusca.forEach(campoBusca => {
                    selectTiposBusca.append($(`<option value='${campoBusca.id}'>${campoBusca.nome}</option>`));
                });

                selectTiposBusca.on('change', () => {
                    filter_input.attr('placeholder', 'Buscar por ' + selectTiposBusca.children(':selected').text() + '...');
                });

                inputGroupPrepend.append($(`<label class="pos-absolute" style="top: 0;left: 3px;z-index: 10;font-size: 9px;color: #747474;">Buscar por:</label>`));
                inputGroupPrepend.append(selectTiposBusca);

                var inputGroupAppend = $('<div class="input-group-append d-flex"></div>');
                inputGroupAppend.append(btnBusca, btnLimpar);

                filter_input.detach().appendTo('#'+settings.nTableWrapper.id+' .dataTables_filter');
                $('#'+settings.nTableWrapper.id+' .dataTables_filter').prepend(inputGroupPrepend);
                $('#'+settings.nTableWrapper.id+' .dataTables_filter').append(inputGroupAppend);
                selectTiposBusca.change();
            } else {
                filter_input.hide();
            }
        });

        this.dataTable.on( 'draw', (e, settings) => {
            if ($(window).width() <= 600) {
                setTimeout(() => {
                    $( ".dtr-control" ).each(function() {
                        $( this ).click();
                    });
                }, 1000);
            }
            this.atualizarExibicaoFiltros();
        });

        $(this.seletorTabela).on( 'search.dt', () => {
            if (this.dataTable.search() !== '') {
                $('.dataTables_filter .btn-limpar-busca').show();
            } else {
                $('.dataTables_filter .btn-limpar-busca').hide();
            }
        });

        $(this.seletorTabela).on('xhr.dt', (e, settings, json, xhr) => {
            if (json?.data) {
                json.data.forEach(item => {
                    if (item.id) {
                        this.dadosMap.set(item.id, item);
                    }
                });
            }
        });
    }

    buscar(termo, tipoBusca) {
        if (tipoBusca !== undefined) {
            $(`${this.wrapperTabela} .datatable_tipo_busca`).val(tipoBusca);
        }
        this.dataTable.search(termo);
        this.recarregar(true);
    }

    recarregar(resetPaging) {
        if (resetPaging === undefined) {
            resetPaging = false;
        }
        this.dataTable.ajax.reload(null, resetPaging);
    }

    obterExibicaoFiltros() {
        try {
            const filtros = this.obterFiltros();

            if (Object.keys(filtros).length === 0) {
                return '';
            }

            var totalFiltrosExibicao = 0;
    
            var exibicaoFiltros = '<div class="mb-1 py-2"><span class="f-12 font-weight-bold">Filtros ativos:<span>';
    
            exibicaoFiltros += Object.entries(filtros).map(([chaveFiltro, valorFiltro]) => {
                const nomeFiltro = this.filtrosPadroes[chaveFiltro].nome;
                const exibirFiltro = this.filtrosPadroes[chaveFiltro].exibir || false;

                if (! exibirFiltro) {
                    return '';
                }

                const formatacaoExibicao = this.filtrosPadroes[chaveFiltro].formatacaoExibicao || undefined;

                if (formatacaoExibicao) {
                    valorFiltro = formatacaoExibicao(valorFiltro);
                }

                totalFiltrosExibicao++;

                return `<span class="label label-filtro ml-1">${nomeFiltro}: ${valorFiltro}</span>`;
            }).join('');
    
            exibicaoFiltros += '</div>';

            if (totalFiltrosExibicao === 0) {
                return '';
            }
    
            return exibicaoFiltros;
        } catch (error) {
            return '';
        }
    }

    atualizarExibicaoFiltros() {
        $(`${this.wrapperTabela} .exibicao_filtros`).html(this.obterExibicaoFiltros());
    }
}


--- SCRIPT 47 ---


const PEDIDOS_STATUS = JSON.parse('{"cancelado":{"id":"cancelado","nome":"Cancelado","status_id":"0"},"realizado":{"id":"realizado","nome":"Realizado","status_id":"1"},"aguardando_pagamento":{"id":"aguardando_pagamento","nome":"Aguardando Pagamento","status_id":"1_0"},"pago":{"id":"pago","nome":"Pago","status_id":"1_1"},"em_separacao":{"id":"em_separacao","nome":"Em Separa\u00e7\u00e3o","status_id":"1_2"},"separado":{"id":"separado","nome":"Separado","status_id":"1_3"},"despachado":{"id":"despachado","nome":"Despachado","status_id":"1_4"},"entregue":{"id":"entregue","nome":"Entregue","status_id":"1_5"}}');

const PEDIDOS_STATUS_LABELS = {
    '0': '<span class="label bg-danger">Cancelado</span>',
    '1': '<span class="label bg-dark">Realizado</span>',
    '1_0': '<span class="label bg-dark" title="Aguardando Pagamento">Ag. Pagamento</span>',
    '1_1': '<span class="label bg-info">Pago</span>',
    '1_2': '<span class="label bg-orange">Em Separação</span>',
    '1_3': '<span class="label bg-purple">Separado</span>',
    '1_4': '<span class="label bg-primary">Despachado</span>',
    '1_5':'<span class="label bg-success-dark">Entregue</span>',
};

function formataStatusPedido(statusPedido)
{
    if (! statusPedido) {
        status = 'realizado';
        proxStatus = 'em_separacao';
    } else if (statusPedido["entrega"] && statusPedido["entrega"]["status"]=="1") {
        status = 'entregue';
        proxStatus = undefined;
    } else if (statusPedido["envio"] && statusPedido["envio"]["status"]=="1") {
        status = 'despachado';
        proxStatus = 'entregue';
    } else if (statusPedido["separado"] && statusPedido["separado"]["status"]=="1") {
        status = 'separado';
        proxStatus = 'despachado';
    } else if (statusPedido["em_separacao"] && statusPedido["em_separacao"]["status"]=="1") {
        status = 'em_separacao';
        proxStatus = 'separado';
    } else {
        status = 'realizado';
        proxStatus = 'em_separacao';
    }

    return {
        'status_key': PEDIDOS_STATUS[status]['id'],
        'status_id': PEDIDOS_STATUS[status]['status_id'],
        'status_nome': PEDIDOS_STATUS[status]['nome'],
        'status_label': PEDIDOS_STATUS_LABELS[PEDIDOS_STATUS[status]['status_id']],
        'prox_status_key': proxStatus ? PEDIDOS_STATUS[proxStatus]['id'] : undefined,
        'prox_status_nome': proxStatus ? PEDIDOS_STATUS[proxStatus]['nome'] : undefined,
    };
}

function mudarStatusPedido(status, pedido_id, funcaoCallback) {
    showLoading('Mudando status do pedido...');
    $.get( 'https://calientelingerie.com.br/painel/mudar_status_pedido/'+pedido_id+'/'+status+'/pedidos', { ajax: "ajax" }, function( data ) {
        closeLoading();
        data2 = data.trim();
        if (data2=="ok") {
            showNotification2("Status do pedido alterado com sucesso!", "success");

            if (funcaoCallback !== undefined) {
				funcaoCallback(data2);
  			}
        }else{
            showNotification("Erro", data2, "error");
        }
    });
}

function mudarStatusPedidoVendedor(status, pedido_id, funcaoCallback) {
    showLoading('Mudando status do pedido...');
    $.get( 'https://calientelingerie.com.br/vendedor/mudar_status_pedido/'+pedido_id+'/'+status+'/pedidos', { ajax: "ajax" }, function( data ) {
        closeLoading();
        data2 = data.trim();
        if (data2=="ok") {
            showNotification2("Status do pedido alterado com sucesso!", "success");

            if (funcaoCallback !== undefined) {
				funcaoCallback(data2);
  			}
        }else{
            showNotification("Erro", data2, "error");
        }
    });
}


--- SCRIPT 48 ---


class FacilZapAPI {
    constructor(apiToken) {
        this.baseUri = 'https://api.facilzap.app.br/';
        this.lojaId = '3016';
        this.metodo = 'GET';
        this.parametros = {};
        this.endpointURL = undefined;
        this.apiToken = apiToken;
        this.dados = {};
        this.tipoConteudo = 'multipart/form-data'; // Padrão para FormData
        this.retorno = undefined;
        this.status = undefined;
        this.seletorOverlay = undefined;
        this.callbackErro = () => {};
        this.exibirMensagemErro = true;
        this.requisicoesRecentes = {};
        this.tempoLimite = 3000; // 3 segundos
    }

    setarEndpoint(endpointURL) {
        this.endpointURL = endpointURL;
    }

    setarMetodo(metodo) {
        this.metodo = metodo;
    }

    setarDados(dados) {
        var dadosFormulario = new FormData();
        Object.keys(dados).forEach(key => {
            if (Array.isArray(dados[key])) {
                dados[key].forEach((item, index) => {
                    dadosFormulario.append(key + '[' + index + ']', item);
                });
                return;
            }
            
            dadosFormulario.append(key, dados[key]);
        });

        this.dados = dadosFormulario;
        this.tipoConteudo = 'multipart/form-data';
    }

    setarJson(dadosJson) {
        this.dados = JSON.stringify(dadosJson);
        this.tipoConteudo = 'application/json';
    }

    setarSeletorOverlay(seletorOverlay) {
        this.seletorOverlay = seletorOverlay;
    }

    setarFormulario(seletorFormulario) {
        var dadosFormulario = new FormData($(seletorFormulario)[0]);

        $( seletorFormulario + " input[type='text']" ).each(function () {
            var name = $(this).attr('name');
            var val = $(this).val();
            if ($(this).inputmask("hasMaskedValue")) {
                dadosFormulario.set(name, $(this).inputmask('unmaskedvalue'));
            }
        });

        this.dados = dadosFormulario;
        this.tipoConteudo = 'multipart/form-data';
    }

    adicionarDados(chave, valor) {
        this.dados.append(chave, valor);
    }

    setarParametros(parametros) {
        this.parametros = parametros;
    }

    setarCallbackErro(callbackErro) {
        this.callbackErro = callbackErro;
    }

    setarExibirMensagemErro(exibirMensagemErro) {
        this.exibirMensagemErro = exibirMensagemErro;
    }

    obterExibirMensagemErro() {
        return this.exibirMensagemErro;
    }

    obterRetorno() {
        return this.retorno;
    }

    obterStatus() {
        return this.status;
    }

    async enviar() {
        if (! this.validarRequisicao()) {
            return false;
        }

        if (this.seletorOverlay) {
            showLoadingOverlay(this.seletorOverlay);
        }

        this.retorno = undefined;
        this.sucesso = undefined;
        this.parametros['loja_id'] = this.lojaId;

        return $.ajax({
            url: this.baseUri + this.endpointURL + '?' + $.param(this.parametros),
            type: this.metodo,
            data: this.dados,
            enctype: this.tipoConteudo,
            processData: false,
            cache : false,
            contentType: this.tipoConteudo === 'application/json' ? this.tipoConteudo : false,
            headers: {
                'Accept': 'application/json',
                'Authorization': 'Bearer ' + this.apiToken
            },
            success: (retorno) => {
                if (this.seletorOverlay) {
                    closeLoadingOverlay(this.seletorOverlay);
                }

                this.status = 'sucesso';
                this.retorno = retorno;

                this.resetar();
            },
            error: (data) => {
                if (this.seletorOverlay) {
                    closeLoadingOverlay(this.seletorOverlay);
                }

                this.status = 'erro';   
                if (this.exibirMensagemErro && data.responseJSON && data.responseJSON.message) {
                    showNotification("Ops!", data.responseJSON.message, "error");
                }             
                this.callbackErro(data.responseJSON);

                this.resetar();
            }
        });
    }

    validarRequisicao() {
        const metodo = this.metodo.toUpperCase();

        if (metodo != 'POST' && metodo != 'PATCH') {
            return true;
        }
        
        const hashRequisicao = this.criarHashUnico(this.metodo, this.endpointURL, this.dados);

        if (this.requisicoesRecentes[hashRequisicao]) {
            console.warn("Requisição duplicada ignorada");
            return false; // Ignora a requisição
        }

        // Registra a requisição recente
        this.requisicoesRecentes[hashRequisicao] = true;

        console.log("Requisição registrada:", hashRequisicao);

        // Remove a requisição da lista após o tempo limite
        setTimeout(() => {
            delete this.requisicoesRecentes[hashRequisicao];
        }, this.tempoLimite);

        return true;
    }

    criarHashUnico(metodo, endpointURL, dados) {
        const dadosString = metodo + endpointURL + JSON.stringify(dados);
    
        const base64 = btoa(unescape(encodeURIComponent(dadosString)));
    
        return base64.substring(0, 50);
    }

    resetar() {
        this.callbackErro = () => {};
        this.seletorOverlay = undefined;
        this.metodo = 'GET';
        this.endpointURL = undefined;
        this.dados = {};
        this.tipoConteudo = 'multipart/form-data'; // Volta ao padrão
        this.parametros = {};
    }
}


--- SCRIPT 49 ---


class BuscaCEP {
    constructor(seletorLogradouro, seletorBairro, seletorCidade, seletorEstado) {
        this.seletorLogradouro = seletorLogradouro;
        this.seletorBairro = seletorBairro;
        this.seletorCidade = seletorCidade;
        this.seletorEstado = seletorEstado;
        this.retorno = false;
    }

    bloquearFormulario() {
        $(this.seletorLogradouro).prop('readonly', true);
        $(this.seletorBairro).prop('readonly', true);
        $(this.seletorCidade).prop('readonly', true);
        $(this.seletorEstado).prop('readonly', true);
    }

    desbloquearFormulario() {
        $(this.seletorLogradouro).prop('readonly', false);
        $(this.seletorBairro).prop('readonly', false);
        $(this.seletorCidade).prop('readonly', false);
        $(this.seletorEstado).prop('readonly', false);
    }

    limparFormulario() {
        $(this.seletorLogradouro).val('');
        $(this.seletorBairro).val('');
        $(this.seletorCidade).val('');
        $(this.seletorEstado).val('');
    }

    preencherFormulario(dados, somenteCompletar) {
        this.retorno = dados;

        if (somenteCompletar === true) {
            if ($(this.seletorLogradouro).val() == '') {
                $(this.seletorLogradouro).val(dados.logradouro || '');
            }
            if ($(this.seletorBairro).val() == '') {
                $(this.seletorBairro).val(dados.bairro || '');
            }
            if ($(this.seletorCidade).val() == '') {
                $(this.seletorCidade).val(dados.localidade || '');
            }
            if ($(this.seletorEstado).val() == '') {
                $(this.seletorEstado).val(dados.uf || '');
            }
            return;
        }

        $(this.seletorLogradouro).val(dados.logradouro || '');
        $(this.seletorBairro).val(dados.bairro || '');
        $(this.seletorCidade).val(dados.localidade || '');
        $(this.seletorEstado).val(dados.uf || '');
    }

    verificarExistenciaCampos() {
        if ($(this.seletorLogradouro).length === 0 && $(this.seletorBairro).length === 0 &&
            $(this.seletorCidade).length === 0 && $(this.seletorEstado).length === 0) {
            return false;
        }

        return true;
    }

    async buscar(cep, somenteCompletar = false) {
        if (! this.verificarExistenciaCampos()) {
            return {
                uf: '',
                localidade: '',
                bairro: '',
                logradouro: ''
            };
        }
        
        cep = cep.replace(/\D/g, '');
        if (cep == "") {
            if (! somenteCompletar) this.limparFormulario();
            return false;
        }

        var validaCep = /^[0-9]{8}$/;
        if (! validaCep.test(cep)) {
            if (! somenteCompletar) this.limparFormulario();
            showNotification2("Formato de CEP inválido.", "error");
            return false;
        }

        if (! somenteCompletar) this.limparFormulario();
        this.bloquearFormulario();
        
        try {
            await $.getJSON("https://api.facilzap.app.br/bureau_interno/cep/" + cep + "", (dados) => {
                this.desbloquearFormulario();

                if ("erro" in dados) {
                    showNotification2("CEP não encontrado. Por favor, preencha os dados do endereço manualmente.", "error");
                    return false;
                }

                const dadosFormatados = {
                    cep: dados.cep,
                    uf: dados.uf,
                    localidade: dados.localidade,
                    bairro: dados.bairro,
                    logradouro: dados.logradouro,
                    ibge: dados.ibge,
                };
                
                this.preencherFormulario(dadosFormatados, somenteCompletar);
            });
        } catch (error) {
            this.desbloquearFormulario();
            showNotification2("CEP não encontrado. Por favor, preencha os dados do endereço manualmente.", "error");
            return false;
        }

        return this.retorno;
    }
}


--- SCRIPT 50 ---


class APIPagination {
    constructor(seletorContainer, endpointURL, apiToken, callbackFormatacao) {
        this.apiToken = apiToken;
        this.facilzapAPI = new FacilZapAPI(apiToken);
        this.baseUri = 'https://api.facilzap.app.br/';
        this.seletorContainer = seletorContainer;
        this.endpointURL = endpointURL;
        this.filtrosPadroes = {};
        this.filtros = {};
        this.dadosExtrasRequisicao = {};
        this.camposBusca = [];
        this.menuQuantidadeRegistros = [15, 25, 50];
        this.callbackFormatacao = callbackFormatacao;
        this.callbackListagem;
        this.paginaAtual = 1;
        this.registrosPorPagina = 15;
        this.exibirPaginacao = true;
        this.totalRegistros = null;
        this.classesAdicionaisListagem = '';
        this.avisoSemRegistros = `
            <div class="alert alert-secondary text-center mx-auto my-2" role="alert">
            <i class="fa fa-info-circle" aria-hidden="true"></i> Nenhum registro encontrado.
            </div>
        `;
        this.avisoSemRegistrosFiltros = `
            <div class="alert alert-secondary text-center mx-auto my-2" role="alert">
            <i class="fa fa-info-circle" aria-hidden="true"></i> Nenhum registro encontrado para os filtros aplicados.
            </div>
        `;
        this.dadosMap = new Map();
    }

    setarCallbackListagem(callback) {
        this.callbackListagem = callback;
    }

    setarExibirPaginacao(exibirPaginacao) {
        this.exibirPaginacao = exibirPaginacao;
    }

    setarRegistrosPorPagina(registrosPorPagina) {
        this.registrosPorPagina = registrosPorPagina;
    }

    setarAvisoSemRegistros(avisoSemRegistros) {
        this.avisoSemRegistros = avisoSemRegistros;
    }

    setarAvisoSemRegistrosFiltros(avisoSemRegistrosFiltros) {
        this.avisoSemRegistrosFiltros = avisoSemRegistrosFiltros;
    }

    setarClassesAdicionaisListagem(classesAdicionaisListagem) {
        this.classesAdicionaisListagem = classesAdicionaisListagem;
    }

    setarFiltrosPadroes(filtrosPadroes) {
        this.filtrosPadroes = filtrosPadroes;
    }

    setarFiltros(filtros, recarregar = true) {
        this.filtros = filtros;

        if (recarregar) {
            this.recarregar(true);
        }
    }

    setarFiltro(chave, valor, recarregar = false) {
        this.filtros[chave] = valor;

        if (recarregar) {
            this.recarregar(true);
        }
    }

    obterFiltros()
    {
        var filtrosFormatados = {};

        Object.entries(this.filtrosPadroes).forEach(([chaveFiltro, dadosFiltro]) => {
            if (this.filtros[chaveFiltro]) {
                filtrosFormatados[chaveFiltro] = this.filtros[chaveFiltro];
            } else if (dadosFiltro.valorPadrao){
                filtrosFormatados[chaveFiltro] = dadosFiltro.valorPadrao;
            }
        });

        return filtrosFormatados;
    }

    obterBusca()
    {
        return {
            'column': $(`${this.seletorContainer} #pagination_tipo_busca`).val(),
            'value': $(`${this.seletorContainer} #pagination_busca`).val(),
        };
    }

    obterDadosItem(id) {
        return this.dadosMap.get(id);
    }

    possuiFiltros() {
        if ($(`${this.seletorContainer} #pagination_busca`).length && $(`${this.seletorContainer} #pagination_busca`).val() != '') {
            return true;
        }

        if (Object.keys(this.obterFiltros()).length > 0) {
            return true;
        }

        return false;
    }

    resetarFiltros(recarregar = true) {
        this.filtros = {};

        if (recarregar) {
            this.recarregar(true);
        }
    }

    setarCamposBusca(camposBusca) {
        this.camposBusca = camposBusca;
    }

    setarDadosExtrasRequisicao(dadosExtrasRequisicao) {
        this.dadosExtrasRequisicao = dadosExtrasRequisicao;
    }

    setarMenuQuantidadeRegistros(menuQuantidadeRegistros) {
        this.menuQuantidadeRegistros = menuQuantidadeRegistros;
    }

    setarCallbackCarregamento(callback) {
        $(this.seletorContainer).on('finishedLoading', () => {
            callback();
        });
    }

    setarCallbackFormatacao(callback) {
        this.callbackFormatacao = callback;
    }

    iniciar() {
        $(this.seletorContainer).html(`
            <div class='ferramentas mt-0 row'></div>
            <div class='listagem ${this.classesAdicionaisListagem} mt-3'></div>
            <div class='paginacao mt-3'></div>
        `);

        $(`${this.seletorContainer} .paginacao`).on('click', '.page-link', (e) => {
            e.preventDefault();

            var pagina = $(e.currentTarget).data('pagina');

            if (pagina == this.paginaAtual) {
                return;
            }

            this.paginaAtual = pagina;

            this.recarregar();
        });

        this.iniciarMenuQuantidadeRegistros();

        this.iniciarBusca();

        this.listar();
    }

    buscar(termo, tipoBusca) {
        if (tipoBusca !== undefined) {
            $(`${this.seletorContainer} #pagination_tipo_busca`).val(tipoBusca);
        }

        $(`${this.seletorContainer} #pagination_busca`).val(termo);

        if (termo == '') {
            $(`${this.seletorContainer} .btn-limpar-busca`).hide();
        } else {
            $(`${this.seletorContainer} .btn-limpar-busca`).show();
        }

        this.recarregar(true);
    }

    recarregar(resetarPagina) {
        if (resetarPagina === true) {
            this.paginaAtual = 1;
        }

        this.listar();
    }

    listar() {
        this.facilzapAPI.setarEndpoint(this.endpointURL);
        var parametros = {
            'length': this.registrosPorPagina,
            'start': (this.paginaAtual - 1) * this.registrosPorPagina,
            'filtros': this.obterFiltros(),
            'search': this.obterBusca(),
        }
        this.facilzapAPI.setarParametros(parametros);
        this.facilzapAPI.setarSeletorOverlay(this.seletorContainer);

        this.facilzapAPI.setarCallbackErro(fn => {
        });

        this.facilzapAPI.enviar().then(() => {
            if (this.facilzapAPI.obterStatus() != 'erro') {
                var retorno = this.facilzapAPI.obterRetorno();

                if (retorno.data.length == 0) {
                    var mensagemSemRegistros = this.possuiFiltros() ? this.avisoSemRegistrosFiltros : this.avisoSemRegistros;
                    $(`${this.seletorContainer} .listagem`).html(mensagemSemRegistros);
                    $(`${this.seletorContainer} .paginacao`).html('');
                    return;
                }

                $(`${this.seletorContainer} .listagem`).html('');

                var html = retorno.data.map((item) => {
                    if (item.id) {
                        this.dadosMap.set(item.id, item);
                    }

                    return this.callbackFormatacao(item);
                }).join('');

                $(`${this.seletorContainer} .listagem`).html(html);

                this.totalRegistros = retorno.recordsTotal;

                this.recarregarPaginacao();
            }

            if (this.callbackListagem) {
                this.callbackListagem();
            }
        });
    }

    recarregarPaginacao() {
        if (this.totalRegistros == 0) {
            var quantidadePaginas = 1;
        } else {
            var quantidadePaginas = Math.ceil(this.totalRegistros / this.registrosPorPagina);
        }

        var paginacaoPaginasHtml = '';
        var primeiraPaginaLista = 1;

        if (quantidadePaginas > 7) {
            primeiraPaginaLista = this.paginaAtual - 3;
            if (primeiraPaginaLista < 1) {
                primeiraPaginaLista = 1;
            }
        }

        var ultimaPaginaLista = primeiraPaginaLista + 6;

        for(var i = primeiraPaginaLista; i <= ultimaPaginaLista; i++) {
            if (i > quantidadePaginas) {
                break;
            }

            var classeAtivo = '';
            if (i == this.paginaAtual) {
                classeAtivo = 'active';
            }

            paginacaoPaginasHtml += `
                <li class="page-item ${classeAtivo}">
                    <a class="page-link" href="#" data-pagina="${i}">${i}</a>
                </li>
            `;
        }

        var paginacaoHtml = `
            <nav>
                <ul class="pagination d-flex justify-content-center">
                    <li class="page-item ${this.paginaAtual == 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" tabindex="-1" data-pagina="${this.paginaAtual - 1}">Anterior</a>
                    </li>
                    ${paginacaoPaginasHtml}
                    <li class="page-item ${this.paginaAtual == quantidadePaginas ? 'disabled' : ''}">
                        <a class="page-link" href="#" data-pagina="${this.paginaAtual + 1}">Próximo</a>
                    </li>
                </ul>
            </nav>
        `;

        if (this.exibirPaginacao) {
            $(`${this.seletorContainer} .paginacao`).html(paginacaoHtml);
        }
    }

    iniciarMenuQuantidadeRegistros() {
        if (! this.menuQuantidadeRegistros || this.menuQuantidadeRegistros.length == 0) {
            return;
        }
        
        var optionHtml = this.menuQuantidadeRegistros.map((item) => {
            var selected = '';
            if (item == this.registrosPorPagina) {
                selected = 'selected';
            }

            return `<option value="${item}" ${selected}>${item}</option>`;
        }).join('');

        var html = `
        <div class="col-sm-12 col-lg-4 col-xl-6 text-center text-lg-left">
        <label><select class="form-control form-control-sm d-inline-block" id="pagination_quantidade" style="width: 55px;">${optionHtml}</select> resultados por página</label>
        </div>
        `;

        $(`${this.seletorContainer} .ferramentas`).append(html);

        var seletor_quantidade = $(`${this.seletorContainer} #pagination_quantidade`);

        seletor_quantidade.on('change', () => {
            this.registrosPorPagina = seletor_quantidade.val();
            this.recarregar(true);
        });
    }

    iniciarBusca() {
        if (! this.camposBusca || this.camposBusca.length == 0) {
            return;
        }

        var optionHtml = this.camposBusca.map((item) => {
            return `<option value="${item.id}">${item.nome}</option>`;
        }).join('');

        var html = `
        <div class="input-group mb-0 mx-auto mr-lg-0" style="max-width: 600px;">
            <div class="input-group-prepend pos-relative" style="flex-grow: 1;max-width:250px">
                <label class="pos-absolute" style="top: 0;left: 3px;z-index: 10;font-size: 9px;color: #747474;">Buscar por:</label>
                <select id="pagination_tipo_busca" class="form-control w-100 px-1" style="height: 37px;">
                    ${optionHtml}
                </select>
            </div>
            <input type="search" id="pagination_busca" class="form-control form-control-sm ml-0" placeholder="Buscar por..." style="max-width: 50vw;height: 37px;">
            <div class="input-group-append">
                <button type="button" class="btn btn-success btn-buscar" style="padding: 8px 15px;"><i class="fa fa-search m-0"></i></button>
                <button type="button" class="btn btn-danger btn-limpar-busca" style="padding: 8px 15px;display:none"><i class="fa fa-times m-0"></i></button>
            </div>
        </div>
        `;

        $(`${this.seletorContainer} .ferramentas`).append(html);

        var select_tipo_busca = $(`${this.seletorContainer} #pagination_tipo_busca`);
        var input_busca = $(`${this.seletorContainer} #pagination_busca`);
        var btn_busca = $(`${this.seletorContainer} .btn-buscar`);
        var btn_limpar_busca = $(`${this.seletorContainer} .btn-limpar-busca`);

        select_tipo_busca.on('change', () => {
            input_busca.attr('placeholder', 'Buscar por ' + select_tipo_busca.children(':selected').text() + '...');
        });

        btn_busca.on('click', () => {
            if (input_busca.val() == '') {
                $(`${this.seletorContainer} .btn-limpar-busca`).hide();
            } else {
                $(`${this.seletorContainer} .btn-limpar-busca`).show();
            }

            this.recarregar(true);
        });

        btn_limpar_busca.on('click', () => {
            this.buscar('');
        });
    }

}


--- SCRIPT 51 ---


function debounce(func, wait, immediate) {
	var timeout;
	return function() {
		var context = this, args = arguments;
		var later = function() {
			timeout = null;
			if (!immediate) func.apply(context, args);
		};
		var callNow = immediate && !timeout;
		clearTimeout(timeout);
		timeout = setTimeout(later, wait);
		if (callNow) func.apply(context, args);
	};
};

function throttle(fn, wait) {
  var time = Date.now();
  return function() {
    if ((time + wait - Date.now()) < 0) {
      fn();
      time = Date.now();
    }
  }
}

function forceCloseModal(el) {
	console.log("teste");
	// $(el).modal("hide");
	$(el).removeClass("show").delay(400).hide();
	$('.modal-backdrop').removeClass("show").delay(400).remove();
	$('body').removeClass("modal-open");
}

$(".cc-link").on("click",function(e){
	e.preventDefault();
	loadPageToModal('https://calientelingerie.com.br/termos_de_uso', 'Termos de Uso', 'modal-lg modal-dialog-scrollable');
});

$('body').on('click', '.ajax_link_open', function(e) {
	e.preventDefault();
	
	var link = $(this).attr("href");
	var notificacao = $(this).data("notificacao-texto")
	if (notificacao != "" && notificacao != undefined) {
		showNotification2(notificacao, "info");
	}
	e.preventDefault();
	$.get( link, { ajax: "ajax" }, function( data ) {
		$('body').append(data);
	});
});

function sendAction(link, appendData) {
	return $.get( link, { ajax: "ajax" }, function( data ) {
		if (appendData) {
			$('body').append(data);
		} else {
			return data;
		}
	});
}

  function loadPageToModal(link, title, classe_adicional, mensagem_carregando, modalId, keepModalsOpen, callback) {
  		if (classe_adicional == undefined) {
  			classe_adicional = " ";
  		}
  		if (modalId == undefined) {
			modalId = "colorboxModal";
  		}
  		if (keepModalsOpen == undefined) {
			keepModalsOpen = false;
  		}

		if (! keepModalsOpen) {
			$(".modal").modal('hide');
		}

		$("#"+modalId+" .modal-dialog").removeClass("fade").removeClass("modalAnimate").removeClass("modal_view_produto").removeClass("modal-lg").removeClass("modal-sm").removeClass("modal-xl").removeClass("modal-dialog-scrollable").removeClass("modal-dialog-centered").addClass(classe_adicional);

  		$("#"+modalId+" .modal-title").html(title);
  		$("#"+modalId+" .modal-body").html("");

		if (mensagem_carregando != undefined) {
			$("#"+modalId+" .modal-body").html("<h5 class='text-center py-3'><i class='fa fa-spinner fa-pulse fa-fw'></i> "+mensagem_carregando+"</h5>");
			$("#"+modalId+"").modal('show');
  		}

  		return jQuery.get( link, { ajax: "ajax" }, function( data ) {
			$("#"+modalId+" .modal-body").fadeOut('fast').promise().done(() => {
				$("#"+modalId+" .modal-body").html(data);
				$("#"+modalId+" .modal-body").fadeIn('fast');
				if (mensagem_carregando == undefined) {
					$("#"+modalId+"").modal('show');
				}
				$("#"+modalId+" .modal-body [data-inputmask]").inputmask();
			  	$("#"+modalId+" .modal-body [data-toggle=\"tooltip\"]").tooltip();

				if (callback != undefined) {
					callback();
				}
			});
  		}).fail(function() {
			setTimeout(function () {
			  $("#"+modalId+"").modal('hide');
			  showNotification("Ops!", "Alguma coisa deu errado! Tente novamente mais tarde.", "warning");
			}, 1000);
		});
  }

  function loadPageToPopover(link, elemento, titulo, posicao, mensagem_carregando, css_adicional, opcoes_adicionais) {
		if (posicao == undefined) {
			posicao = "right";
  		}
		if (css_adicional == undefined) {
			css_adicional = "";
  		}
		if (opcoes_adicionais == undefined || Object.keys(opcoes_adicionais).length === 0) {
			opcoes_adicionais = {};
  		}

		$('.popover').popover('dispose');

		$(elemento).popover({
			content: "<i class='fa fa-spinner fa-pulse fa-fw'></i> " + mensagem_carregando,
			html: true,
			placement: posicao,
			title: titulo,
			trigger: 'manual',
			... opcoes_adicionais,
		});

		if (mensagem_carregando != undefined) {
			$(elemento).popover('show');
  		}

		var popoverTemplate = `
			<div class="popover" role="tooltip" style="${css_adicional}">
				<div class="arrow"></div>
				<h3 class="popover-header"></h3>
				<button type="button" class="close" aria-label="Close" style="position: absolute;top: -2px;right: 12px;" onclick="$('.popover').popover('dispose');">
					<span class="d-block f-26">&times;</span>
				</button>
				<div class="popover-body"></div>
			</div>`;

  		jQuery.get( link, { ajax: "ajax" }, function( data ) {
			$(elemento).popover('dispose');
			$(elemento).popover({
				content: data,
				html: true,
				placement: posicao,
				title: titulo,
				trigger: 'manual',
				template: popoverTemplate,
				... opcoes_adicionais,
			});
			$(elemento).popover('show');
  		});
  }
  
  function loadContentToPopover(content, elemento, titulo, posicao, css_adicional) {
	if (posicao == undefined) {
			posicao = "right";
  		}
		if (css_adicional == undefined) {
			css_adicional = "";
  		}

		$('.popover').popover('dispose');

		var popoverTemplate = `
			<div class="popover" role="tooltip" style="${css_adicional}">
				<div class="arrow"></div>
				<h3 class="popover-header"></h3>
				<button type="button" class="close" aria-label="Close" style="position: absolute;top: -2px;right: 12px;" onclick="$('.popover').popover('dispose');">
					<span class="d-block f-26">&times;</span>
				</button>
				<div class="popover-body"></div>
			</div>`;
			
		$(elemento).popover({
			content: content,
			html: true,
			placement: posicao,
			title: titulo,
			trigger: 'manual',
			template: popoverTemplate
		});

		$(elemento).popover('show');
  }

  $('body').on('click', function (e) {
    if ($(e.target).data('toggle') !== 'popover'
        && $(e.target).parents('.popover.show').length === 0) {
        $('.popover').popover('hide');
    }
});
  function loadContentToModal(content, title, classe_adicional, modalId, keepModalsOpen) {
  		if (classe_adicional == undefined) {
  			classe_adicional = " ";
  		}

  		if (modalId == undefined) {
			modalId = "colorboxModal";
  		}
  		if (keepModalsOpen == undefined) {
			keepModalsOpen = false;
  		}

		if (! keepModalsOpen) {
			$(".modal").modal('hide');
		}

  		$("#"+modalId+" .modal-dialog").removeClass("fade").removeClass("modal-lg").removeClass("modal-sm").removeClass("modal-xl").removeClass("modal-dialog-scrollable").removeClass("modal-visualizar").addClass(classe_adicional);

  		$("#"+modalId+" .modal-title").html("");
  		$("#"+modalId+" .modal-body").html("");
  		$("#"+modalId+" .modal-body").html(content);
  		$("#"+modalId+" .modal-title").html(title);
  		$("#"+modalId+"").modal('show');
  	}
  function loadImageToModal(content, title, classe_adicional) {
  		if (classe_adicional == undefined) {
  			classe_adicional = " ";
  		}

  		$('#imageZoomModal').modal('hide');
  		// showPageLoading(1);

  		$("#imageZoomModal .modal-dialog").removeClass("fade").removeClass("modal-lg").removeClass("modal-sm").removeClass("modal-xl").removeClass("modal-dialog-scrollable").addClass(classe_adicional);

  		$("#imageZoomModal .modal-title").html("");
  		$("#imageZoomModal .modal-body").html("");
  		$("#imageZoomModal .modal-body").html("<div class='w-100' style='background-image:url("+content+");background-position:center center;background-size:contain;background-repeat: no-repeat;height: 70vh;'></div>");
  		$("#imageZoomModal .modal-title").html(title);
  		$("#imageZoomModal").modal('show');
  	}

	function showFixedNotification(titulo, content, type) {
		const Toast = Swal.mixin({
		  toast: true,
		  position: 'bottom',
		  showConfirmButton: false,
		  showCloseButton: true,
		  timer: undefined
		});

	  Toast.fire({
			icon: type,
			title: " "+titulo,
			html: content
		  });
	}

  function showNotification2(content, type) {
  	  const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000
      });

  	Toast.fire({
          icon: type,
          title: " "+content
        });
  }

  function showLoading(titulo, content, type) {
	let iconConfig = {};
	if (type) {
		if (['info', 'success', 'warning', 'error'].includes(type)) {
			iconConfig = {
				icon: type,
			};
		} else {
			iconConfig = {
				icon: 'info',
				iconHtml: type,
				customClass: {
					icon: 'border-0'
				}
			};
		}
	} else {
		iconConfig = {
			icon: 'info',
			iconHtml: '<i class="fa fa-spinner fa-pulse fa-fw text-primary f-70"></i>',
			customClass: {
				icon: 'border-0'
			}
		};
	}
	

    Swal.fire({
		title: titulo,
		... iconConfig,
		html: content,
		showCloseButton: false,
		showCancelButton: false,
		showConfirmButton: false,
		allowOutsideClick: false,
		allowEscapeKey: false,
		allowEnterKey: false,
	})
  }

  function closeLoading() {
    Swal.close();
  }

  function showLoadingCursor() {
	$('body').addClass('waiting');
  }

  function hideLoadingCursor() {
	$('body').removeClass('waiting');
  }

  function showLoadingOverlay(elemento, background, imageColor, zIndex) {

	  if (background === undefined) {
    		background = "rgba(0, 191, 165, 0.5)";
    	}
		if (imageColor === undefined) {
	  		imageColor = "#fff";
	  	}
		  if (zIndex === undefined) {
			zIndex = 2147483647;
	  	}

	  $(elemento).LoadingOverlay("show", {
  	    background  : background,
  		imageColor  : imageColor,
		zIndex      : zIndex
  	});

  }

  function closeLoadingOverlay(elemento) {
    $(elemento).LoadingOverlay("hide", true);
  }

  function showNotification(titulo, content, type) {
    Swal.fire({
 title: titulo,
 icon: type,
 html: content,
 showCloseButton: true,
 showCancelButton: false,
})
  }
   function showNotificationAction(titulo, conteudo, type, btn_sim, funcao) {
  	if (btn_sim === undefined) {
  		btn_sim = "OK";
  	}

  	Swal.fire({
    title: titulo,
    html: conteudo,
    icon: type,
    showCancelButton: false,
 	showCloseButton: false,
    confirmButtonColor: '#3699FF',
    confirmButtonText: btn_sim,
  }).then((result) => {
    if (result.value) {
  	  if (funcao !== undefined) {
  		funcao();
  	  }
    }
  })
  }
  function showConfirmation(titulo, conteudo, funcao, btn_sim, btn_nao) {
  	if (btn_sim === undefined) {
  		btn_sim = "Sim";
  	}
  	if (btn_nao === undefined) {
  		btn_nao = "Não";
  	}

  	Swal.fire({
    title: titulo,
    html: conteudo,
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#3699FF',
    cancelButtonColor: '#F64E60',
    confirmButtonText: btn_sim,
    cancelButtonText: btn_nao
  }).then((result) => {
    if (result.value) {
  	  if (funcao !== undefined) {
  		funcao();
  	  }
    }
  })
  }

  function showConfirmation2(titulo, conteudo, funcao, btn_sim, btn_nao, funcao2) {
  	if (btn_sim === undefined) {
  		btn_sim = "Sim";
  	}
  	if (btn_nao === undefined) {
  		btn_nao = "Não";
  	}

  	Swal.fire({
    title: titulo,
    html: conteudo,
    icon: 'info',
    showCancelButton: true,
    confirmButtonColor: '#3699FF',
    cancelButtonColor: '#F64E60',
    confirmButtonText: btn_sim,
    cancelButtonText: btn_nao
  }).then((result) => {
    if (result.value) {
  	  if (funcao !== undefined) {
  		funcao();
  	  }
  }else{
	  if (funcao2 !== undefined) {
  		funcao2();
  	  }
  }
  })
  }


  function showNotificationIcon(titulo, conteudo, icone, btn, funcao) {
  	if (btn === undefined) {
		btn = "Continuar";
  	}

  	Swal.fire({
    title: titulo,
    text: conteudo,
	icon: 'info',
    iconHtml: icone,
    showCancelButton: false,
    confirmButtonColor: '#3699FF',
    confirmButtonText: btn,
	customClass: {
		icon: 'border-0'
	}
  }).then((result) => {
    if (funcao !== undefined) {
  		funcao();
  	  }
  })
  }

  function showConfirmationIcon(titulo, conteudo, icone, funcao, btn_sim, btn_nao, funcao2) {
  	if (btn_sim === undefined) {
  		btn_sim = "Sim";
  	}
  	if (btn_nao === undefined) {
  		btn_nao = "Não";
  	}

  	Swal.fire({
    title: titulo,
    text: conteudo,
	icon: 'info',
    iconHtml: icone,
    showCancelButton: true,
    confirmButtonColor: '#3699FF',
    cancelButtonColor: '#F64E60',
    confirmButtonText: btn_sim,
    cancelButtonText: btn_nao,
	customClass: {
		icon: 'border-0'
	}
  }).then((result) => {
    if (result.value) {
  	  if (funcao !== undefined) {
  		funcao();
  	  }
  }else{
	  if (funcao2 !== undefined) {
  		funcao2();
  	  }
  }
  })
  }

  function showConfirmationPedidoWhats(titulo, conteudo, icone, href, btn_sim, btn_nao, href2) {
  	if (btn_sim === undefined) {
  		btn_sim = "Sim";
  	}
  	if (btn_nao === undefined) {
  		btn_nao = "Não";
  	}

  	Swal.fire({
    title: titulo,
    text: conteudo,
	icon: 'info',
    iconHtml: icone,
    showCancelButton: true,
    confirmButtonColor: '#3699FF',
    cancelButtonColor: '#F64E60',
    confirmButtonText: btn_sim,
    cancelButtonText: btn_nao,
	customClass: {
		icon: 'border-0'
	}
  });

  setTimeout(function () {
    $("button.swal2-confirm").replaceWith('<a target="_blank" class="swal2-confirm swal2-styled" style="background-color: #3699FF; border-left-color: #3699FF; border-right-color: #3699FF;" href="' + href + '">'+btn_sim+'</a>');
    $("a.swal2-confirm").click(function () {
		setTimeout(function () {
			swal.close();
			window.location.href=href2;
		}, 1000);
    });


	if (href2 !== undefined) {
		$("button.swal2-cancel").replaceWith('<a class="swal2-confirm swal2-styled" style="background-color: #F64E60; border-left-color: #F64E60; border-right-color: #F64E60;" href="' + href2 + '">'+btn_nao+'</a>');
		$("a.swal2-confirm").click(function () {
		swal.close()
		});
  	}
  }, 400);

  }

  function btnLoading(status, elemento) {
  	if (status == 1) {
  		$(elemento).prepend( ' <span class="spinner-border spinner-border-sm btnLoading-spinner" role="status"></span> ' );
  		$(elemento).prop( "disabled", true );
  	}else{
  		$('.spinner-border', elemento).remove();
  		$(elemento).prop( "disabled", false );
  	}
  }

  function btnLoading2(status, elemento) {
  	if (status == 1) {
  		$(elemento).prepend( ' <span class="spinner-border spinner-border-sm  btnLoading-spinner" role="status"></span> ' );
  	}else{
  		$('.spinner-border', elemento).remove();
  	}
  }

  function enviarFormulario(seletorFormulario, funcaoCallback, tipoNotificacaoSucesso, mensagemCarregando) {
	if (mensagemCarregando == undefined) {
		showLoadingOverlay(seletorFormulario);
	} else {
		showLoading(mensagemCarregando);
	}

	if (tipoNotificacaoSucesso == undefined) {
		tipoNotificacaoSucesso = 1;
	}

	var dadosFormulario = $(seletorFormulario).serializeArray();
	dadosFormulario.push({ name: 'ajax', value: 'ajax' });

	$( seletorFormulario + " input[type='text']" ).each(function() {
		var name = $(this).attr('name');
		var val = $(this).val();
		if ($(this).inputmask("hasMaskedValue")) {
			dadosFormulario.push({ name: name, value: $(this).inputmask('unmaskedvalue') });
		}
	});

  	$.ajax({
  		url: $(seletorFormulario).attr('action'),
  		type: 'POST',
  		data: $.param(dadosFormulario),
  		success: function (data) {
			if (mensagemCarregando == undefined) {
				closeLoadingOverlay(seletorFormulario);
			} else {
				closeLoading();
			}
			if (data.msg) {
				if (tipoNotificacaoSucesso == 1) {
					showNotification("Sucesso", data.msg, "success");
				}
				if (tipoNotificacaoSucesso == 2) {
					showNotification2(data.msg, "success");
				}
			}

  			if (funcaoCallback !== undefined) {
				funcaoCallback(data);
  			}
  		},
		error: function (data) {
			if (mensagemCarregando == undefined) {
				closeLoadingOverlay(seletorFormulario);
			} else {
				closeLoading();
			}
			showNotification("Ops!", data.responseJSON.erro || "Houve um erro ao processar a sua requisição.", "error");
		}
  	});
}

function obterLocalStorage(chave) {
	return localStorage.getItem(chave);
}

function salvarLocalStorage(chave, valor) {
	return localStorage.setItem(chave, valor);
}

function removerLocalStorage(chave) {
	return localStorage.removeItem(chave);
}

function formatCnpjCpf(value) {
  const cnpjCpf = value.replace(/\D/g, '');
  
  if (cnpjCpf.length === 11) {
    return cnpjCpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g, "\$1.\$2.\$3-\$4");
  } 
  
  return cnpjCpf.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g, "\$1.\$2.\$3/\$4-\$5");
}

async function copyContent(text) {
  try {
    await navigator.clipboard.writeText(text);
    /* Resolved - text copied to clipboard successfully */
  } catch (err) {
    console.error('Failed to copy: ', err);
    /* Rejected - text failed to copy to the clipboard */
  }
}

function normalizeClassName(className) {
  return className.normalize('NFD')
	.replaceAll('/', '_')
	.replaceAll('.', '')
	.replace(/[\u0300-\u036f]/g, "")
	.replace(/\s+/g, '_')
	.replace(/("|')/g, '')
	.replace(/&amp;/g, '&')
	.replace(/&#039;/g, '')
	.replace(/&quot;/g, '')
	.replace(/&lt;/g, '')
	.replace(/&gt;/g, '')
	.replaceAll('#', '')
	.replaceAll('(', '')
	.replaceAll(')', '')
	.toLowerCase();
}

function copy(str) {
	copyContent(str);

	showNotification2('Conteúdo copiado!', 'success');
}

function salvarLog(facilzapAPI, level, mensagem, dados) {
	try {
		if (typeof dados === 'object' || Array.isArray(dados)) {
			dados = JSON.stringify(dados);
		}

		var exibirMensagemErro = facilzapAPI.obterExibirMensagemErro();

		facilzapAPI.setarEndpoint(`logs/frontend`);
		facilzapAPI.setarMetodo('POST');
		facilzapAPI.setarExibirMensagemErro(false);
		facilzapAPI.setarDados({
			'level': level,
			'mensagem': mensagem,
			'dados': dados,
			'url': window.location.href,
			'token': '4fa6bebed48251f5c9d1fd9d908da58065dae4203e3bf707ac5e319413e587af'
		});
		
		facilzapAPI.enviar().then(() => {
			facilzapAPI.setarExibirMensagemErro(exibirMensagemErro);
		});
	} catch (error) {
		console.error('Erro ao salvar log: ', error);
	}
}

var listaPaises = [];
listaPaises.push({
	'id': 'BR',
	'text': 'Brasil'
});
listaPaises.push({
	'id': 'AF',
	'text': 'Afeganistão'
});
listaPaises.push({
	'id': 'ZA',
	'text': 'África do Sul'
});
listaPaises.push({
	'id': 'AL',
	'text': 'Albânia'
});
listaPaises.push({
	'id': 'DE',
	'text': 'Alemanha'
});
listaPaises.push({
	'id': 'AD',
	'text': 'Andorra'
});
listaPaises.push({
	'id': 'AO',
	'text': 'Angola'
});
listaPaises.push({
	'id': 'AI',
	'text': 'Anguilla'
});
listaPaises.push({
	'id': 'AQ',
	'text': 'Antártida'
});
listaPaises.push({
	'id': 'AG',
	'text': 'Antígua e Barbuda'
});
listaPaises.push({
	'id': 'SA',
	'text': 'Arábia Saudita'
});
listaPaises.push({
	'id': 'DZ',
	'text': 'Argélia'
});
listaPaises.push({
	'id': 'AR',
	'text': 'Argentina'
});
listaPaises.push({
	'id': 'AM',
	'text': 'Armênia'
});
listaPaises.push({
	'id': 'AW',
	'text': 'Aruba'
});
listaPaises.push({
	'id': 'AU',
	'text': 'Austrália'
});
listaPaises.push({
	'id': 'AT',
	'text': 'Áustria'
});
listaPaises.push({
	'id': 'AZ',
	'text': 'Azerbaijão'
});
listaPaises.push({
	'id': 'BS',
	'text': 'Bahamas'
});
listaPaises.push({
	'id': 'BH',
	'text': 'Bahrein'
});
listaPaises.push({
	'id': 'BD',
	'text': 'Bangladesh'
});
listaPaises.push({
	'id': 'BB',
	'text': 'Barbados'
});
listaPaises.push({
	'id': 'BY',
	'text': 'Belarus'
});
listaPaises.push({
	'id': 'BE',
	'text': 'Bélgica'
});
listaPaises.push({
	'id': 'BZ',
	'text': 'Belize'
});
listaPaises.push({
	'id': 'BJ',
	'text': 'Benin'
});
listaPaises.push({
	'id': 'BM',
	'text': 'Bermudas'
});
listaPaises.push({
	'id': 'BO',
	'text': 'Bolívia'
});
listaPaises.push({
	'id': 'BA',
	'text': 'Bósnia e Herzegovina'
});
listaPaises.push({
	'id': 'BW',
	'text': 'Botsuana'
});
listaPaises.push({
	'id': 'BN',
	'text': 'Brunei'
});
listaPaises.push({
	'id': 'BG',
	'text': 'Bulgária'
});
listaPaises.push({
	'id': 'BF',
	'text': 'Burkina Faso'
});
listaPaises.push({
	'id': 'BI',
	'text': 'Burundi'
});
listaPaises.push({
	'id': 'BT',
	'text': 'Butão'
});
listaPaises.push({
	'id': 'CV',
	'text': 'Cabo Verde'
});
listaPaises.push({
	'id': 'KH',
	'text': 'Camboja'
});
listaPaises.push({
	'id': 'CM',
	'text': 'Camarões'
});
listaPaises.push({
	'id': 'CA',
	'text': 'Canadá'
});
listaPaises.push({
	'id': 'QA',
	'text': 'Catar'
});
listaPaises.push({
	'id': 'KZ',
	'text': 'Cazaquistão'
});
listaPaises.push({
	'id': 'TD',
	'text': 'Chade'
});
listaPaises.push({
	'id': 'CL',
	'text': 'Chile'
});
listaPaises.push({
	'id': 'CN',
	'text': 'China'
});
listaPaises.push({
	'id': 'CY',
	'text': 'Chipre'
});
listaPaises.push({
	'id': 'CX',
	'text': 'Ilha Christmas'
});
listaPaises.push({
	'id': 'SG',
	'text': 'Cingapura'
});
listaPaises.push({
	'id': 'CC',
	'text': 'Ilhas Cocos'
});
listaPaises.push({
	'id': 'CO',
	'text': 'Colômbia'
});
listaPaises.push({
	'id': 'KM',
	'text': 'Comores'
});
listaPaises.push({
	'id': 'CG',
	'text': 'República do Congo'
});
listaPaises.push({
	'id': 'KP',
	'text': 'Coreia do Norte'
});
listaPaises.push({
	'id': 'KR',
	'text': 'Coreia do Sul'
});
listaPaises.push({
	'id': 'CI',
	'text': 'Costa do Marfim'
});
listaPaises.push({
	'id': 'CR',
	'text': 'Costa Rica'
});
listaPaises.push({
	'id': 'HR',
	'text': 'Croácia'
});
listaPaises.push({
	'id': 'CU',
	'text': 'Cuba'
});
listaPaises.push({
	'id': 'CW',
	'text': 'Curaçao'
});
listaPaises.push({
	'id': 'DK',
	'text': 'Dinamarca'
});
listaPaises.push({
	'id': 'DJ',
	'text': 'Djibuti'
});
listaPaises.push({
	'id': 'DM',
	'text': 'Dominica'
});
listaPaises.push({
	'id': 'EG',
	'text': 'Egito'
});
listaPaises.push({
	'id': 'SV',
	'text': 'El Salvador'
});
listaPaises.push({
	'id': 'AE',
	'text': 'Emirados Árabes Unidos'
});
listaPaises.push({
	'id': 'EC',
	'text': 'Equador'
});
listaPaises.push({
	'id': 'ER',
	'text': 'Eritreia'
});
listaPaises.push({
	'id': 'SK',
	'text': 'Eslováquia'
});
listaPaises.push({
	'id': 'SI',
	'text': 'Eslovênia'
});
listaPaises.push({
	'id': 'ES',
	'text': 'Espanha'
});
listaPaises.push({
	'id': 'US',
	'text': 'Estados Unidos'
});
listaPaises.push({
	'id': 'EE',
	'text': 'Estônia'
});
listaPaises.push({
	'id': 'ET',
	'text': 'Etiópia'
});
listaPaises.push({
	'id': 'FJ',
	'text': 'Fiji'
});
listaPaises.push({
	'id': 'PH',
	'text': 'Filipinas'
});
listaPaises.push({
	'id': 'FI',
	'text': 'Finlândia'
});
listaPaises.push({
	'id': 'FR',
	'text': 'França'
});
listaPaises.push({
	'id': 'GA',
	'text': 'Gabão'
});
listaPaises.push({
	'id': 'GM',
	'text': 'Gâmbia'
});
listaPaises.push({
	'id': 'GH',
	'text': 'Gana'
});
listaPaises.push({
	'id': 'GE',
	'text': 'Geórgia'
});
listaPaises.push({
	'id': 'GS',
	'text': 'Geórgia do Sul e Ilhas Sandwich do Sul'
});
listaPaises.push({
	'id': 'GI',
	'text': 'Gibraltar'
});
listaPaises.push({
	'id': 'GD',
	'text': 'Granada'
});
listaPaises.push({
	'id': 'GR',
	'text': 'Grécia'
});
listaPaises.push({
	'id': 'GL',
	'text': 'Groenlândia'
});
listaPaises.push({
	'id': 'GP',
	'text': 'Guadalupe'
});
listaPaises.push({
	'id': 'GU',
	'text': 'Guam'
});
listaPaises.push({
	'id': 'GT',
	'text': 'Guatemala'
});
listaPaises.push({
	'id': 'GG',
	'text': 'Guernsey'
});
listaPaises.push({
	'id': 'GY',
	'text': 'Guiana'
});
listaPaises.push({
	'id': 'GF',
	'text': 'Guiana Francesa'
});
listaPaises.push({
	'id': 'GN',
	'text': 'Guiné'
});
listaPaises.push({
	'id': 'GQ',
	'text': 'Guiné Equatorial'
});
listaPaises.push({
	'id': 'GW',
	'text': 'Guiné-Bissau'
});
listaPaises.push({
	'id': 'HT',
	'text': 'Haiti'
});
listaPaises.push({
	'id': 'HN',
	'text': 'Honduras'
});
listaPaises.push({
	'id': 'HK',
	'text': 'Hong Kong'
});
listaPaises.push({
	'id': 'HU',
	'text': 'Hungria'
});
listaPaises.push({
	'id': 'YE',
	'text': 'Iêmen'
});
listaPaises.push({
	'id': 'BV',
	'text': 'Ilha Bouvet'
});
listaPaises.push({
	'id': 'IM',
	'text': 'Ilha de Man'
});
listaPaises.push({
	'id': 'NF',
	'text': 'Ilha Norfolk'
});
listaPaises.push({
	'id': 'KY',
	'text': 'Ilhas Cayman'
});
listaPaises.push({
	'id': 'CK',
	'text': 'Ilhas Cook'
});
listaPaises.push({
	'id': 'AX',
	'text': 'Ilhas Åland'
});
listaPaises.push({
	'id': 'FO',
	'text': 'Ilhas Faroe'
});
listaPaises.push({
	'id': 'HM',
	'text': 'Ilhas Heard e McDonald'
});
listaPaises.push({
	'id': 'FK',
	'text': 'Ilhas Malvinas'
});
listaPaises.push({
	'id': 'MP',
	'text': 'Ilhas Marianas do Norte'
});
listaPaises.push({
	'id': 'MH',
	'text': 'Ilhas Marshall'
});
listaPaises.push({
	'id': 'UM',
	'text': 'Ilhas Menores Distantes dos Estados Unidos'
});
listaPaises.push({
	'id': 'SB',
	'text': 'Ilhas Salomão'
});
listaPaises.push({
	'id': 'TC',
	'text': 'Ilhas Turks e Caicos'
});
listaPaises.push({
	'id': 'VG',
	'text': 'Ilhas Virgens Britânicas'
});
listaPaises.push({
	'id': 'VI',
	'text': 'Ilhas Virgens dos EUA'
});
listaPaises.push({
	'id': 'IN',
	'text': 'Índia'
});
listaPaises.push({
	'id': 'ID',
	'text': 'Indonésia'
});
listaPaises.push({
	'id': 'IR',
	'text': 'Irã'
});
listaPaises.push({
	'id': 'IQ',
	'text': 'Iraque'
});
listaPaises.push({
	'id': 'IE',
	'text': 'Irlanda'
});
listaPaises.push({
	'id': 'IS',
	'text': 'Islândia'
});
listaPaises.push({
	'id': 'IL',
	'text': 'Israel'
});
listaPaises.push({
	'id': 'IT',
	'text': 'Itália'
});
listaPaises.push({
	'id': 'JM',
	'text': 'Jamaica'
});
listaPaises.push({
	'id': 'JP',
	'text': 'Japão'
});
listaPaises.push({
	'id': 'JE',
	'text': 'Jersey'
});
listaPaises.push({
	'id': 'JO',
	'text': 'Jordânia'
});
listaPaises.push({
	'id': 'KW',
	'text': 'Kuwait'
});
listaPaises.push({
	'id': 'LA',
	'text': 'Laos'
});
listaPaises.push({
	'id': 'LS',
	'text': 'Lesoto'
});
listaPaises.push({
	'id': 'LV',
	'text': 'Letônia'
});
listaPaises.push({
	'id': 'LB',
	'text': 'Líbano'
});
listaPaises.push({
	'id': 'LR',
	'text': 'Libéria'
});
listaPaises.push({
	'id': 'LY',
	'text': 'Líbia'
});
listaPaises.push({
	'id': 'LI',
	'text': 'Liechtenstein'
});
listaPaises.push({
	'id': 'LT',
	'text': 'Lituânia'
});
listaPaises.push({
	'id': 'LU',
	'text': 'Luxemburgo'
});
listaPaises.push({
	'id': 'MO',
	'text': 'Macau'
});
listaPaises.push({
	'id': 'MK',
	'text': 'Macedônia'
});
listaPaises.push({
	'id': 'MG',
	'text': 'Madagascar'
});
listaPaises.push({
	'id': 'MY',
	'text': 'Malásia'
});
listaPaises.push({
	'id': 'MW',
	'text': 'Malawi'
});
listaPaises.push({
	'id': 'MV',
	'text': 'Maldivas'
});
listaPaises.push({
	'id': 'ML',
	'text': 'Mali'
});
listaPaises.push({
	'id': 'MT',
	'text': 'Malta'
});
listaPaises.push({
	'id': 'MA',
	'text': 'Marrocos'
});
listaPaises.push({
	'id': 'MQ',
	'text': 'Martinica'
});
listaPaises.push({
	'id': 'MU',
	'text': 'Maurício'
});
listaPaises.push({
	'id': 'MR',
	'text': 'Mauritânia'
});
listaPaises.push({
	'id': 'YT',
	'text': 'Mayotte'
});
listaPaises.push({
	'id': 'MX',
	'text': 'México'
});
listaPaises.push({
	'id': 'MM',
	'text': 'Mianmar'
});
listaPaises.push({
	'id': 'FM',
	'text': 'Micronésia'
});
listaPaises.push({
	'id': 'MZ',
	'text': 'Moçambique'
});
listaPaises.push({
	'id': 'MD',
	'text': 'Moldávia'
});
listaPaises.push({
	'id': 'MC',
	'text': 'Mônaco'
});
listaPaises.push({
	'id': 'MN',
	'text': 'Mongólia'
});
listaPaises.push({
	'id': 'ME',
	'text': 'Montenegro'
});
listaPaises.push({
	'id': 'MS',
	'text': 'Montserrat'
});
listaPaises.push({
	'id': 'NA',
	'text': 'Namíbia'
});
listaPaises.push({
	'id': 'NR',
	'text': 'Nauru'
});
listaPaises.push({
	'id': 'NP',
	'text': 'Nepal'
});
listaPaises.push({
	'id': 'NI',
	'text': 'Nicarágua'
});
listaPaises.push({
	'id': 'NE',
	'text': 'Níger'
});
listaPaises.push({
	'id': 'NG',
	'text': 'Nigéria'
});
listaPaises.push({
	'id': 'NU',
	'text': 'Niue'
});
listaPaises.push({
	'id': 'NO',
	'text': 'Noruega'
});
listaPaises.push({
	'id': 'NC',
	'text': 'Nova Caledônia'
});
listaPaises.push({
	'id': 'NZ',
	'text': 'Nova Zelândia'
});
listaPaises.push({
	'id': 'OM',
	'text': 'Omã'
});
listaPaises.push({
	'id': 'NL',
	'text': 'Países Baixos'
});
listaPaises.push({
	'id': 'PW',
	'text': 'Palau'
});
listaPaises.push({
	'id': 'PA',
	'text': 'Panamá'
});
listaPaises.push({
	'id': 'PG',
	'text': 'Papua-Nova Guiné'
});
listaPaises.push({
	'id': 'PK',
	'text': 'Paquistão'
});
listaPaises.push({
	'id': 'PY',
	'text': 'Paraguai'
});
listaPaises.push({
	'id': 'PE',
	'text': 'Peru'
});
listaPaises.push({
	'id': 'PN',
	'text': 'Pitcairn'
});
listaPaises.push({
	'id': 'PF',
	'text': 'Polinésia Francesa'
});
listaPaises.push({
	'id': 'PL',
	'text': 'Polônia'
});
listaPaises.push({
	'id': 'PR',
	'text': 'Porto Rico'
});
listaPaises.push({
	'id': 'PT',
	'text': 'Portugal'
});
listaPaises.push({
	'id': 'KE',
	'text': 'Quênia'
});
listaPaises.push({
	'id': 'KG',
	'text': 'Quirguistão'
});
listaPaises.push({
	'id': 'KI',
	'text': 'Quiribati'
});
listaPaises.push({
	'id': 'GB',
	'text': 'Reino Unido'
});
listaPaises.push({
	'id': 'CF',
	'text': 'República Centro-Africana'
});
listaPaises.push({
	'id': 'CZ',
	'text': 'República Tcheca'
});
listaPaises.push({
	'id': 'DO',
	'text': 'República Dominicana'
});
listaPaises.push({
	'id': 'RE',
	'text': 'Reunião'
});
listaPaises.push({
	'id': 'RO',
	'text': 'Romênia'
});
listaPaises.push({
	'id': 'RW',
	'text': 'Ruanda'
});
listaPaises.push({
	'id': 'RU',
	'text': 'Rússia'
});
listaPaises.push({
	'id': 'EH',
	'text': 'Saara Ocidental'
});
listaPaises.push({
	'id': 'WS',
	'text': 'Samoa'
});
listaPaises.push({
	'id': 'AS',
	'text': 'Samoa Americana'
});
listaPaises.push({
	'id': 'PM',
	'text': 'Saint Pierre e Miquelon'
});
listaPaises.push({
	'id': 'KN',
	'text': 'São Cristóvão e Névis'
});
listaPaises.push({
	'id': 'SM',
	'text': 'San Marino'
});
listaPaises.push({
	'id': 'SH',
	'text': 'Santa Helena'
});
listaPaises.push({
	'id': 'LC',
	'text': 'Santa Lúcia'
});
listaPaises.push({
	'id': 'ST',
	'text': 'São Tomé e Príncipe'
});
listaPaises.push({
	'id': 'VC',
	'text': 'São Vicente e Granadinas'
});
listaPaises.push({
	'id': 'SN',
	'text': 'Senegal'
});
listaPaises.push({
	'id': 'SL',
	'text': 'Serra Leoa'
});
listaPaises.push({
	'id': 'RS',
	'text': 'Sérvia'
});
listaPaises.push({
	'id': 'SC',
	'text': 'Seychelles'
});
listaPaises.push({
	'id': 'SY',
	'text': 'Síria'
});
listaPaises.push({
	'id': 'SO',
	'text': 'Somália'
});
listaPaises.push({
	'id': 'LK',
	'text': 'Sri Lanka'
});
listaPaises.push({
	'id': 'SZ',
	'text': 'Suazilândia'
});
listaPaises.push({
	'id': 'SD',
	'text': 'Sudão'
});
listaPaises.push({
	'id': 'SS',
	'text': 'Sudão do Sul'
});
listaPaises.push({
	'id': 'SE',
	'text': 'Suécia'
});
listaPaises.push({
	'id': 'CH',
	'text': 'Suíça'
});
listaPaises.push({
	'id': 'SR',
	'text': 'Suriname'
});
listaPaises.push({
	'id': 'SJ',
	'text': 'Svalbard e Jan Mayen'
});
listaPaises.push({
	'id': 'TJ',
	'text': 'Tadjiquistão'
});
listaPaises.push({
	'id': 'TH',
	'text': 'Tailândia'
});
listaPaises.push({
	'id': 'TW',
	'text': 'Taiwan'
});
listaPaises.push({
	'id': 'TZ',
	'text': 'Tanzânia'
});
listaPaises.push({
	'id': 'IO',
	'text': 'Território Britânico do Oceano Índico'
});
listaPaises.push({
	'id': 'TF',
	'text': 'Territórios Franceses do Sul'
});
listaPaises.push({
	'id': 'PS',
	'text': 'Territórios palestinos'
});
listaPaises.push({
	'id': 'TL',
	'text': 'Timor-Leste'
});
listaPaises.push({
	'id': 'TG',
	'text': 'Togo'
});
listaPaises.push({
	'id': 'TK',
	'text': 'Tokelau'
});
listaPaises.push({
	'id': 'TO',
	'text': 'Tonga'
});
listaPaises.push({
	'id': 'TT',
	'text': 'Trinidad e Tobago'
});
listaPaises.push({
	'id': 'TN',
	'text': 'Tunísia'
});
listaPaises.push({
	'id': 'TM',
	'text': 'Turcomenistão'
});
listaPaises.push({
	'id': 'TR',
	'text': 'Turquia'
});
listaPaises.push({
	'id': 'TV',
	'text': 'Tuvalu'
});
listaPaises.push({
	'id': 'UA',
	'text': 'Ucrânia'
});
listaPaises.push({
	'id': 'UG',
	'text': 'Uganda'
});
listaPaises.push({
	'id': 'UY',
	'text': 'Uruguai'
});
listaPaises.push({
	'id': 'UZ',
	'text': 'Uzbequistão'
});
listaPaises.push({
	'id': 'VU',
	'text': 'Vanuatu'
});
listaPaises.push({
	'id': 'VA',
	'text': 'Vaticano'
});
listaPaises.push({
	'id': 'VE',
	'text': 'Venezuela'
});
listaPaises.push({
	'id': 'VN',
	'text': 'Vietnã'
});
listaPaises.push({
	'id': 'WF',
	'text': 'Wallis e Futuna'
});
listaPaises.push({
	'id': 'ZM',
	'text': 'Zâmbia'
});
listaPaises.push({
	'id': 'ZW',
	'text': 'Zimbábue'
});

const appHeight = () => {
 const doc = document.documentElement
 doc.style.setProperty('--app-height', `${window.innerHeight}px`)
}
window.addEventListener('resize', appHeight)
appHeight()

/*
* Shuffle jQuery array of elements - see Fisher-Yates algorithm
* Agora aceita um parâmetro opcional: priorityClasses (array de classes prioritárias)
*/
jQuery.fn.shuffle = function (priorityClasses) {
    var $elements = this;
    var $priority = $();
    var $rest = $();

    if (Array.isArray(priorityClasses) && priorityClasses.length > 0) {
        $elements.each(function () {
            var el = $(this);
            var isPriority = priorityClasses.some(function (cls) {
                return el.hasClass(cls);
            });
            if (isPriority) {
                $priority = $priority.add(el);
            } else {
                $rest = $rest.add(el);
            }
        });
    } else {
        $rest = $elements;
    }

    var restArr = $rest.toArray();
    for (var i = restArr.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = restArr[i];
        restArr[i] = restArr[j];
        restArr[j] = temp;
    }

    var $parent = $elements.parent();
    $elements.detach();
    $priority.each(function () {
        $parent.append(this);
    });
    $(restArr).each(function () {
        $parent.append(this);
    });

    return this;
};

  $(function () {

	$('body').on('hidden.bs.modal', function () {
		if ($('.modal.show').length > 0) {
			$('body').addClass('modal-open');
		}
	});

	$('[data-toggle="tooltip"]').tooltip();
	
    $('[data-mask]').inputmask();

    	      
	           });



--- SCRIPT 52 ---


class VideoWidget {
    constructor() {
        this.element = document.getElementById('video-widget');
        this.content = document.querySelector('.video-widget--content');
        this.closeButton = document.getElementById('video-widget--close');
        this.isDragging = false;
        this.startCoords = { x: 0, y: 0 };
        this.offset = { x: 0, y: 0 };
        this.DRAG_THRESHOLD = 5;
        
        this.boundHandlePointerMove = this.handlePointerMove.bind(this);
        this.boundHandlePointerUp = this.handlePointerUp.bind(this);
        
        this.init();
    }
    
    init() {
        if (!this.element || !this.content) return;
        
        this.element.style.touchAction = 'none';
        this.setupEventListeners();
        this.loadContent();
    }
    
    setupEventListeners() {
        this.content.addEventListener('pointerdown', this.handlePointerDown.bind(this));
        this.closeButton.addEventListener('click', this.handleClose.bind(this));
    }
    
    handlePointerDown(e) {
        this.isDragging = false;
        this.element.setPointerCapture(e.pointerId);
        
        const rect = this.element.getBoundingClientRect();
        this.offset = {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top
        };
        
        this.startCoords = {
            x: e.clientX,
            y: e.clientY
        };
        
        const currentRight = window.innerWidth - rect.right;
        const currentTop = rect.top;
        
        this.element.style.left = 'auto';
        this.element.style.bottom = 'auto';
        this.element.style.right = `${currentRight}px`;
        this.element.style.top = `${currentTop}px`;
        
        document.addEventListener('pointermove', this.boundHandlePointerMove);
        document.addEventListener('pointerup', this.boundHandlePointerUp);
        document.addEventListener('pointercancel', this.boundHandlePointerUp);
        
        e.stopPropagation();
    }
    
    handlePointerMove(e) {
        const deltaX = Math.abs(e.clientX - this.startCoords.x);
        const deltaY = Math.abs(e.clientY - this.startCoords.y);
        
        if (deltaX > this.DRAG_THRESHOLD || deltaY > this.DRAG_THRESHOLD) {
            this.isDragging = true;
        }
        
        if (this.isDragging) {
            this.updatePosition(e.clientX, e.clientY);
        }
    }
    
    handlePointerUp(e) {
        this.element.releasePointerCapture(e.pointerId);
        document.removeEventListener('pointermove', this.boundHandlePointerMove);
        document.removeEventListener('pointerup', this.boundHandlePointerUp);
        document.removeEventListener('pointercancel', this.boundHandlePointerUp);
        
        if (!this.isDragging) {
            window.location.href = 'https://calientelingerie.com.br/c/calientelingerie/snap/17996842783';
        }
        
        setTimeout(() => {
            this.isDragging = false;
        }, 50);
    }
    
    handleClose(e) {
        e.preventDefault();
        e.stopPropagation();
        this.element.remove();
    }
    
    updatePosition(clientX, clientY) {
        let newRight = window.innerWidth - (clientX - this.offset.x + this.element.offsetWidth);
        let newTop = clientY - this.offset.y;
        
        const bounds = this.calculateBounds();
        
        newRight = Math.max(0, Math.min(newRight, bounds.maxRight));
        newTop = Math.max(0, Math.min(newTop, bounds.maxTop));
        
        this.element.style.right = `${newRight}px`;
        this.element.style.top = `${newTop}px`;
    }
    
    calculateBounds() {
        const widgetSize = window.innerWidth >= 1200 ? 85 : 70;
        const extraSpace = 25;
        const totalWidth = widgetSize + extraSpace;
        const totalHeight = widgetSize + extraSpace;
        
        return {
            maxRight: window.innerWidth - totalWidth,
            maxTop: window.innerHeight - totalHeight
        };
    }
    
    loadContent() {
        const api = new FacilZapAPI('');
        api.setarEndpoint('snaps/obter_previa');
        api.setarParametros({
            catalogo_id: '0'
        });
        api.setarExibirMensagemErro(false);
        api.setarMetodo('GET');
        
        api.enviar().then(() => {
            if (api.obterStatus() !== 'erro') {
                const retorno = api.obterRetorno();
                const arquivosBaseURL = 'https://arquivos.facilzap.app.br';
                const transformBaseURL = 'https://facilzap.app.br/cdn-cgi/image/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp/https://arquivos.facilzap.app.br';
                
                if (retorno) {
                    let content = '';
                    
                    if (retorno.video) {
                        content = `
                            <video playsinline muted autoplay="true" loop disablepictureinpicture
                                poster="${transformBaseURL}/${retorno.thumb_video || retorno.imagens?.[0] || ''}"
                                preload="auto">
                                <source src="${arquivosBaseURL}/${retorno.video}" type="video/mp4">
                            </video>
                        `;
                    } else if (retorno.imagens?.length) {
                        content = `<img src="${transformBaseURL}/${retorno.imagens[0]}" alt="Acessar Snaps" />`;
                    }
                    
                    if (content) {
                        this.content.innerHTML = content;
                        $('#video-widget').fadeIn();
                    }
                }
            }
        });
    }
}

$(function() {
    new VideoWidget();
});


--- SCRIPT 55 ---


var cashbackDisponivel = 0;
var carrinho_ainda_pendente = false;
var itensCarrinho = null;
var requisicoes_timeout = [];
var cupom_tipo_valor = false;
var retornoModalLoginVisitante;
var callbackModalLoginVisitante;

if (typeof fancyTimeFormat !== "function") {
    function fancyTimeFormat(duration) {
        // Hours, minutes and seconds
        var hrs = ~~(duration / 3600);
        var mins = ~~((duration % 3600) / 60);
        var secs = ~~duration % 60;
        // Output like "1:01" or "4:03:59" or "123:03:59"
        var ret = "";
        if (hrs > 0) {
            ret += "" + hrs + ":" + (mins < 10 ? "0" : "");
        }
        ret += "" + mins + ":" + (secs < 10 ? "0" : "");
        ret += "" + secs;
        return ret;
    }
}

function verDetalhesPerfilLoja() {
    $('.box-perfil-loja-resumo').fadeOut('fast');
    $('.box-perfil-loja-ver-mais-btn').fadeOut('fast').promise().done(function() {
        $('.box-perfil-loja-ver-mais').slideDown('fast');
        $('.box-perfil-loja-estatisticas').removeClass('align-items-start').addClass('align-items-center');
    });
}

function verCarrinho() {
    window.location.hash = `carrinho`;
    window.onhashchange = function() {
        if (!location.hash || location.hash != "#carrinho") {
            $("#carrinhoModal").modal('hide');
        }
    }
    $("#carrinhoModal").off('hide.bs.modal').on('hide.bs.modal', function(e) {
        let uri = window.location.href.split("#")[0];
        if (location.hash && document.referrer.includes(location.host) && document.referrer.includes(uri)) {
            window.history.back();
        }
    });
    $("#carrinhoModal").off('hidden.bs.modal').on('hidden.bs.modal', function() {
        history.replaceState('', document.title, window.location.pathname);
    });
    $("#carrinhoModal .modal-body").html(`
	  <p class="alert bg-success text-center mb-0 mx-2 mb-2"><i class="fa fa-spinner fa-pulse fa-fw"></i> Carregando seu carrinho...</p>
	`);
    $("#carrinhoModal").modal('show');
    jQuery.get('https://calientelingerie.com.br/c/calientelingerie/carrinho/17996842783', {
        ajax: "ajax"
    }, function(data) {
        $("#carrinhoModal .modal-body").fadeOut('fast').promise().done(function() {
            $("#carrinhoModal .modal-body").html(data);
            $("#carrinhoModal .modal-body").fadeIn('fast');
        });
        $('#carrinhoModal [data-mask]').inputmask();
    });
}

function zoomImagemCarrinho(img) {
    $('#imageZoomModal').one('shown.bs.modal', function() {
        $("#carrinhoModal").modal("hide");
    });
    $('#imageZoomModal').one('hidden.bs.modal', function() {
        $("#carrinhoModal").modal("show");
    });
    loadImageToModal(img, 'Imagem do Produto', 'modal-lg');
}

var ajaxManager = {
    requests: [],
    addReq: function(opt) {
        this.requests.push(opt);
        if (this.requests.length == 1) {
            this.run();
        }
    },
    removeReq: function(opt) {
        if ($.inArray(opt, requests) > -1)
            this.requests.splice($.inArray(opt, requests), 1);
    },
    run: function() {
        carrinhoPendente();
        // original complete callback
        oricomplete = this.requests[0].complete;
        // override complete callback
        var ajxmgr = this;
        ajxmgr.requests[0].complete = function() {
            if (typeof oricomplete === 'function')
                oricomplete();
            ajxmgr.requests.shift();
            if (ajxmgr.requests.length > 0) {
                ajxmgr.run();
            } else {
                totalCarrinho();
            }
        };
        $.ajax(this.requests[0]);
    },
    stop: function() {
        this.requests = [];
    },
}

function rastreioIniciarCheckout() {
    valor = $("#total_carrinho").text().split("R$");
    valor2 = parseFloat(valor[1]);

    facilZapEventos.iniciarCheckout(valor2, itensCarrinho);
}

function rastreioSelecionarFormaEntrega() {
    var el = $('input[name=forma_entrega]:checked').parent();
    var nomeFormaEntrega = $('.descricao-entrega', el).text();
    var valorFrete = $('input[name=forma_entrega]:checked').attr("data-valor_frete");
    }

function rastreioSelecionarFormaPagamento() {
    var el = $('input[name=forma_pagamento]:checked').parent();
    if ($('.descricao-pagamento', el).length) {
        var nomeFormaPagamento = $('.descricao-pagamento', el).text();
    } else if ($('img', el).length) {
        var nomeFormaPagamento = $('img', el).attr("alt");
    }
    valor = $("#total_carrinho").text().split("R$");
    valor2 = parseFloat(valor[1]);
    }

function carrinhoPendente() {
    if (carrinho_ainda_pendente !== false) {
        return;
    }

    carrinho_ainda_pendente = true;

    showLoadingOverlay('.totalizadores-modal-carrinho', 'rgba(255, 255, 255, 0.5)', 'var(--cor-detalhes-gerais)');
    $(".btn-enviar-pedido-go").removeClass("pulse-button").addClass("disabled");
    $("#total_carrinho_itens").fadeOut(200, function() {
        $("#total_carrinho_itens").html('<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>');
        $("#total_carrinho_itens").fadeIn(200);
    });
    $("#total_carrinho").fadeOut(200, function() {
        $("#total_carrinho").html('<i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>');
        $("#total_carrinho").fadeIn(200);
    });
}

function totalCarrinho() {
    carrinho_ainda_pendente = false;
    closeLoadingOverlay('.totalizadores-modal-carrinho');
    $(".btn-enviar-pedido-go").removeClass("pulse-button").addClass("disabled");
    $.post("https://calientelingerie.com.br/c/calientelingerie/17996842783", {
            acao: "total_carrinho"
        })
        .done((data) => {
            data3 = $.parseJSON(data);

            if (typeof configsLoja !== "undefined") {
                Object.keys(configsLoja.carrinho).forEach(key => delete configsLoja.carrinho[key]);
                Object.assign(configsLoja.carrinho, data3.carrinho || {});
            }

            itensCarrinho = data3.lista_itens;
            quantidade_pecas = Number(data3.itens);
            total = Number(data3.valor);
            desconto_pedido = Number(data3.desconto_pedido);
            desconto_produtos = Number(data3.desconto_produtos);
            subtotal = total + desconto_produtos;

            cupom_tipo_valor = data3.cupom?.tipo_valor || false;
            cupom_valor = data3.cupom?.valor || 0;

            if (typeof calcularTotal === "function") {
                calcularTotal();
            }
                        $("#total_carrinho").fadeOut(200, function() {
                if (data3.desconto_pedido > 0) {
                    valor = Number(data3.valor) - Number(data3.desconto_pedido);
                } else {
                    valor = data3.valor;
                }
                valor = new Intl.NumberFormat('pt-BR', {
                    style: 'decimal',
                    currency: 'BRL',
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                    useGrouping: false
                }).format(valor);
                $("#total_carrinho").html("R$" + valor);
                $("#total_carrinho").fadeIn(200);
            });
                        $("#total_carrinho_itens").fadeOut(200, function() {
                $("#total_carrinho_itens").html(data3.itens);
                $("#total_carrinho_itens").fadeIn(200);
            });
            $(".btn-enviar-pedido-go").removeClass("disabled").addClass("pulse-button");
            if (Number(data3.itens) > 0) {
                $(".btn-simular-frete").fadeIn();
            } else {
                $(".btn-simular-frete").fadeOut();
            }
        })
        .fail(function() {
            $(".btn-enviar-pedido-go").removeClass("disabled").addClass("pulse-button");
            showNotification("Erro", "Tivemos um problema ao obter os dados do seu carrinho.<br/>Atualize a página e tente novamente!", "error");
        });
}

function removerProduto(pid, vid) {
    showConfirmation("Remover do Carrinho", "Você tem certeza que deseja remover este produto do carrinho?", function() {
        $(".produto_div_" + pid + "_" + vid).fadeTo(400, 0.35);
        // rastreioRemoverDoCarrinho(pid);
        ajaxManager.addReq({
            type: 'POST',
            url: 'https://calientelingerie.com.br/c/calientelingerie/17996842783',
            data: {
                acao: "remover_produto",
                pid: pid,
                vid: vid
            },
            success: function(data) {
                data2 = data.trim();
                if (data2 != "ok") {
                    $(".produto_div_" + pid + "_" + vid).fadeIn();
                    showNotification("Erro", "Tivemos um problema ao remover o produto do seu carrinho.<br/>Atualize a página e tente novamente!", "error");
                } else {
                    $(".produto_div_" + pid + "_" + vid).fadeOut();
                }
            },
            error: function(data) {
                $(".produto_div_" + pid + "_" + vid).fadeIn();
                showNotification("Erro", "Tivemos um problema ao remover o produto do seu carrinho.<br/>Atualize a página e tente novamente!", "error");
            }
        });
    });
}

function obterSubtotalCarrinho() {
    return Number($("#total_carrinho").text().replace("R$", "").replace(",", "."));
}

function modalAnimation(el, animation) {
    $('.modal-dialog', el).attr('class', 'modal-dialog  ' + animation + ' animate__animated');
};

function termoPlataforma() {
    }

function setarHashRetorno(elemento) {
    if (! location.hash) {
        return;
    }
    let hash = location.hash.replace("#", "");
    let href = elemento.attr('href');
    let querySeparator = href.includes("?") ? '&' : '?';

    elemento.attr('href', href + querySeparator + 'hashRetorno=' + hash);
}

function inicializarVariaveis() {
    if (typeof total === 'undefined') {
        total = 0;
    }
    if (typeof desconto_pedido === 'undefined') {
        desconto_pedido = 0;
    }
    if (typeof desconto_produtos === 'undefined') {
        desconto_produtos = 0;
    }
}

function calcularTotal() {
    inicializarVariaveis();

    if (cashbackDisponivel && cashbackDisponivel > 0) {
        $('.row-cashback').show();
        $('.slot-cashback_disponivel').text("R$" + new Intl.NumberFormat('pt-BR', {
            style: 'decimal',
            currency: 'BRL',
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
            useGrouping: false
        }).format(cashbackDisponivel));
    } else {
        $('.row-cashback').hide();
    }

    valor_frete = $('input[name=forma_entrega]:checked').data("valor_frete");
    valor_frete2 = $('input[name=forma_entrega]:checked').data("valor_frete");

    if (valor_frete == undefined) {
        valor_frete = 0;
    }

    totalPedido = Number(total) + Number(valor_frete);
    desconto_total = Number(desconto_pedido) + Number(desconto_produtos);

    baseDesconto = Number(total) - Number(desconto_pedido);

    taxa_total = 0;

    cupom_desconto = 0;

    if (cupom_tipo_valor != false && cupom_valor > 0) {
        if (cupom_tipo_valor == 'porcentagem') {
            cupom_desconto = (baseDesconto * (Number(cupom_valor) / 100));
        }else{
            cupom_desconto = Number(cupom_valor);
        }

        totalPedido = totalPedido - cupom_desconto;

        baseDesconto = baseDesconto - cupom_desconto;

        desconto_total = desconto_total + cupom_desconto;
    }

    if (cupom_desconto > 0) {
        var cupomDescontoValorFormatado = new Intl.NumberFormat('pt-BR', {
            style: 'decimal',
            currency: 'BRL',
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
            useGrouping: false
        }).format(cupom_desconto);

        $('#cupom-aplicado-valor').html(' (- R$' + cupomDescontoValorFormatado + ')');
        $('#cupom-aplicado-div').show();
    } else {
        $('#cupom-aplicado-div').hide();
    }

    if ($('#utilizar_cashback').length) {
        if ($('#utilizar_cashback').is(':checked')) {
            cashback = Number(cashbackDisponivel);

            totalPedido = totalPedido - cashback;

            baseDesconto = baseDesconto - cashback;

            desconto_total = desconto_total + cashback;
        }
    }

    const maxMultiplosPagamentos = 2;
    let multiplosPagamentosConfig = new Map();
    let baseDescontoMultiplosPagamentos = baseDesconto / maxMultiplosPagamentos;
    
    var multiplosPagamentos = false;
    if (typeof multiplosPagamentosHabilitado === 'function') {
        if (multiplosPagamentosHabilitado()) {
            multiplosPagamentos = true;
        }
    }

    exibir_taxa = false;

    let totalPedidoSemFrete = totalPedido - Number(valor_frete) - Number(desconto_pedido);
    let totalPedidoMultiplosPagamentos = totalPedidoSemFrete / maxMultiplosPagamentos;

    if (multiplosPagamentos) {
        for(let i = 1; i <= maxMultiplosPagamentos; i++) {
            let baseMultiplosPagamentos = totalPedidoMultiplosPagamentos;
            
            if (i == 1) {
                baseMultiplosPagamentos += Number(valor_frete);
            }

            $(`#forma_pagamento_${i}_valor`).text("R$" + new Intl.NumberFormat('pt-BR', {
                style: 'decimal',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
                useGrouping: false
            }).format(baseMultiplosPagamentos));

            let elPagamento = $(`#forma_pagamento_${i}`);

            if (! elPagamento.val()) {
                continue;
            }

            let configPagamento = {
                exibir_taxa: elPagamento.data("exibir-taxa"),
                tipo_reajuste: elPagamento.data("tipo-reajuste"),
                valor_reajuste: elPagamento.data("valor-reajuste")
            };

            multiplosPagamentosConfig.set(i, configPagamento);

            if (configPagamento.exibir_taxa == 1) {
                exibir_taxa = 1;
            }

            if (configPagamento.exibir_taxa != undefined && configPagamento.valor_reajuste != undefined) {
                if (configPagamento.tipo_reajuste == "desconto") {
                    let valor_desconto = baseDescontoMultiplosPagamentos * (Number(configPagamento.valor_reajuste) / 100);
                    totalPedido = totalPedido - valor_desconto;
                    desconto_total = desconto_total + valor_desconto;

                    $(`#forma_pagamento_${i}_valor`).text("R$" + new Intl.NumberFormat('pt-BR', {
                        style: 'decimal',
                        currency: 'BRL',
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                        useGrouping: false
                    }).format(baseMultiplosPagamentos - valor_desconto));
                }
            }
        }
    } else {
        exibir_taxa = $('input[name=forma_pagamento]:checked').data("exibir-taxa");
        tipo_reajuste = $('input[name=forma_pagamento]:checked').data("tipo-reajuste");
        valor_reajuste = $('input[name=forma_pagamento]:checked').data("valor-reajuste");
    
        if (tipo_reajuste != undefined && valor_reajuste != undefined) {
            if (tipo_reajuste == "desconto") {
    
                let valor_desconto = baseDesconto * (Number(valor_reajuste) / 100);
    
                totalPedido = totalPedido - valor_desconto;
    
                desconto_total = desconto_total + valor_desconto;
            }
        }
    }

    totalPedido = Number(totalPedido) - Number(desconto_pedido);

    if ($('#utilizar_cashback').length) {
        cashback = Number(cashbackDisponivel);

        var totalPedidoSemCashback = totalPedido;

        if ($('#utilizar_cashback').is(':checked')) {
            totalPedidoSemCashback = totalPedido + cashback;
        }

        if (totalPedidoSemCashback < cashback) {
            $('.form-group-utilizar-cashback').hide();
            $('.form-group-aviso-cashback').show();
            if ($('#utilizar_cashback').is(':checked')) {
                $('#utilizar_cashback').click();

                return;
            }
        } else {
            $('.form-group-utilizar-cashback').show();
            $('.form-group-aviso-cashback').hide();
        }
    }

    if (multiplosPagamentos) {
        for(let i = 1; i <= maxMultiplosPagamentos; i++) {
            let baseTaxaMultiplosPagamentos = totalPedidoMultiplosPagamentos;
            
            if (i == 1) {
                baseTaxaMultiplosPagamentos += Number(valor_frete);
            }

            if (! multiplosPagamentosConfig.has(i)) {
                continue;
            }

            let configPagamento = multiplosPagamentosConfig.get(i);

            if (configPagamento.tipo_reajuste != undefined && configPagamento.valor_reajuste != undefined) {
                if (configPagamento.tipo_reajuste == "acrescimo_pecas") {
        
                    taxa_total = (Number(quantidade_pecas) / maxMultiplosPagamentos) * Number(configPagamento.valor_reajuste);
        
                    totalPedido = totalPedido + taxa_total;

                    $(`#forma_pagamento_${i}_valor`).text("R$" + new Intl.NumberFormat('pt-BR', {
                        style: 'decimal',
                        currency: 'BRL',
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                        useGrouping: false
                    }).format(baseTaxaMultiplosPagamentos + taxa_total));

                } else if (configPagamento.tipo_reajuste == "acrescimo_porcentagem") {

                    taxa_total = baseTaxaMultiplosPagamentos * (Number(configPagamento.valor_reajuste) / 100);
        
                    totalPedido = totalPedido + taxa_total;

                    $(`#forma_pagamento_${i}_valor`).text("R$" + new Intl.NumberFormat('pt-BR', {
                        style: 'decimal',
                        currency: 'BRL',
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2,
                        useGrouping: false
                    }).format(baseTaxaMultiplosPagamentos + taxa_total));
                }
            }
            
        }
    } else {
        if (tipo_reajuste != undefined && valor_reajuste != undefined) {
            if (tipo_reajuste == "acrescimo_pecas") {
    
                taxa_total = Number(quantidade_pecas) * Number(valor_reajuste);
    
                totalPedido = totalPedido + taxa_total;
    
            } else if (tipo_reajuste == "acrescimo_porcentagem") {
    
                taxa_total = totalPedido * (Number(valor_reajuste) / 100);
    
                totalPedido = totalPedido + taxa_total;
    
            }
        }
    }


    if (desconto_total > 0) {
        $(".desconto_div").slideDown();
    } else {
        $(".desconto_div").slideUp();
    }

    if (taxa_total > 0 && exibir_taxa == 1) {
        $(".taxa_div").slideDown();
    } else {
        $(".taxa_div").slideUp();
    }

    if (valor_frete2 != undefined) {
        $(".slot-frete-valor").text("R$" + new Intl.NumberFormat('pt-BR', {
            style: 'decimal',
            currency: 'BRL',
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
            useGrouping: false
        }).format(valor_frete));
    } else {
        $(".slot-frete-valor").text("a calcular");
    }

    $(".slot-qtd-itens").text(quantidade_pecas);

    $(".slot-subtotal-valor").text("R$" + new Intl.NumberFormat('pt-BR', {
        style: 'decimal',
        currency: 'BRL',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
        useGrouping: false
    }).format(subtotal));

    $(".slot-subtotal-valor").data('valor', subtotal);

    $(".slot-total-valor").text("R$" + new Intl.NumberFormat('pt-BR', {
        style: 'decimal',
        currency: 'BRL',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
        useGrouping: false
    }).format(totalPedido));

    $(".slot-desconto-valor").text("R$" + new Intl.NumberFormat('pt-BR', {
        style: 'decimal',
        currency: 'BRL',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
        useGrouping: false
    }).format(desconto_total));

    $(".slot-taxa-valor").text("R$" + new Intl.NumberFormat('pt-BR', {
        style: 'decimal',
        currency: 'BRL',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
        useGrouping: false
    }).format(taxa_total));

    if (typeof atualizarProgressoFreteGratis === 'function') {
        atualizarProgressoFreteGratis();
    }

    if (typeof atualizarCondicoesPagamento === 'function') {
        atualizarCondicoesPagamento();
    }
}

function abrirModalLoginVisitante(retorno, callback) {
    let loginVisitanteNome = localStorage.getItem('login_visitante_nome');
    let loginVisitanteWhatsApp = localStorage.getItem('login_visitante_whatsapp');

    if (loginVisitanteNome) {
        $("#visitante_nome").val(loginVisitanteNome);
    }

    if (loginVisitanteWhatsApp) {
        const inputVisitanteWhatsapp = new window.inputPhonei18n('.visitante_whatsapp');
        inputVisitanteWhatsapp.setNumber(loginVisitanteWhatsApp);
    }

    retornoModalLoginVisitante = retorno;
    callbackModalLoginVisitante = callback;
    $('#visitanteLoginModal').modal('show');
}

$(document).on('click', '.link-categoria', function(event) {
    if (window.FZCatalogoAppInstance) {
        let idCategoria = $(this).data('categoria-id');

        if (! idCategoria && idCategoria !== 0) {
            return;
        }

        let nomeCategoria = $(this).data('categoria-nome');

        event?.preventDefault();

        if (idCategoria == 0) {
            $('#carrossel-categorias-app').show();
            $('#selos_div_slider').show();
            $('.secoes_catalogo_container').show();
            $('.banners-catalogo').show();
        } else {
            $('#carrossel-categorias-app').hide();
            $('#selos_div_slider').hide();
            $('.secoes_catalogo_container').hide();
            $('.banners-catalogo').hide();
        }

        if (typeof fecharSubmenuCategoria === 'function') {
            fecharSubmenuCategoria();
        }

        if (typeof fecharMenuMobile === 'function') {
            fecharMenuMobile();
        }

        window.FZCatalogoAppInstance.trocarCategoria(idCategoria, nomeCategoria);

        let href = $(this).attr('href');
        window.history.pushState({}, '', href);
    }
});

$(function() {
    $("body").on("show.bs.modal", ".modalAnimate", function(e) {
        var anim = $(this).attr('data-animation-in');
        modalAnimation($(this), anim);
    });
    $("body").on("hide.bs.modal", ".modalAnimate", function(e) {
        var anim = $(this).attr('data-animation-out');
        modalAnimation($(this), anim);
    });
    $("body").on("hidden.bs.modal", ".modal", function(e) {
        if ($('iframe', this).length) {
            $('iframe', this).attr("src", $('iframe', this).attr("src"));
        }
    });
        if (location.hash) {
        if (location.hash.includes("stories")) {
            lojaStories.abrirStories(3016);
        } else if (location.hash == '#carrinho') {
            verCarrinho();
        }
    }
        
        var audio_finalizar_pedido = document.getElementById("audio-finalizar-pedido");
    audio_finalizar_pedido.src = 'https://assets.facilzap.app.br/finalizar2.wav';
    audio_finalizar_pedido.volume = 0.4;
    $("body").on("click", ".btn-enviar-pedido-go", function() {
        audio_finalizar_pedido.play();
    });
    
    $("body").on("change", ".qtds_input", function() {
        multiplicador = Number($(this).data("multiplicador"));
        if (multiplicador < 1 || isNaN(multiplicador)) {
            multiplicador = 1;
        }
        min = Number($(this).attr("min"));
        max = Number($(this).attr("max"));
        max2 = Number($(this).data("max2"));
        if (isNaN(min)) {
            min = 0;
        }
        if (isNaN(max)) {
            max = 0;
        }
        var val = Number($(this).val());
        if (min > 0 && val < min && val > 0) {
            val = min;
            val += (val % multiplicador);
            $(this).val(val);
        }
        if ((max > max2 && max2 > 0) || max == 0) {
            max_definido = max2;
        } else {
            max_definido = max;
        }
        if (max_definido > 0 && val > max_definido) {
            val = max_definido;
            val -= (val % multiplicador);
            $(this).val(val);
            showNotification("Quantidade Máxima Atingida", `O máximo que você pode adicionar ao carrinho deste produto ${max_definido == 1 ? `é ${max_definido} unidade`: `são ${max_definido} unidades`}.`, "info");
        } else if (val % multiplicador !== 0) {
            val += (val % multiplicador);
            $(this).val(val);
        }
        var pid = $(this).data("pid");
        var vid = $(this).data("vid");
        carrinhoPendente();
        if (typeof requisicoes_timeout[pid + "_" + vid] !== 'undefined') {
            clearTimeout(requisicoes_timeout[pid + "_" + vid]);
        }
        requisicoes_timeout[pid + "_" + vid] = setTimeout(function() {
            // rastreioAdicionarAoCarrinho(pid);
            ajaxManager.addReq({
                type: 'POST',
                url: 'https://calientelingerie.com.br/c/calientelingerie/17996842783',
                data: {
                    acao: "atualizar_carrinho",
                    pid: pid,
                    vid: vid,
                    qtd: val
                },
                success: function(data) {
                    data2 = data.trim();
                    if (data2 != "ok") {
                        showNotification("Erro", "Tivemos um problema ao atualizar seu carrinho.<br/>Atualize a página e tente novamente!", "error");
                    }
                },
                error: function(data) {
                    showNotification("Erro", "Tivemos um problema ao atualizar seu carrinho.<br/>Atualize a página e tente novamente!", "error");
                }
            });
        }, 1000);
    });
    $("body").on("click", ".btn-qtd-menos", function() {
        multiplicador = Number($(this).data("multiplicador"));
        if (multiplicador < 1 || isNaN(multiplicador)) {
            multiplicador = 1;
        }
        min = Number($(this).data("min"));
        val = Number($(".qtd_" + $(this).data("info")).val());
        new_val = (val - multiplicador);
        new_val += (new_val % multiplicador);
        if (new_val >= min) {
            val = new_val;
        } else {
            val = 0;
        }
        $(".qtd_" + $(this).data("info")).val(val);
        $(".qtd_" + $(this).data("info")).change();
    });
    $("body").on("click", ".btn-qtd-mais", function() {
        multiplicador = Number($(this).data("multiplicador"));
        if (multiplicador < 1 || isNaN(multiplicador)) {
            multiplicador = 1;
        }
        max = Number($(this).data("max"));
        max2 = Number($(this).data("max2"));
        min = Number($(this).data("min"));
        if (isNaN(min)) {
            min = 0;
        }
        if (isNaN(max)) {
            max = 0;
        }
        val = Number($(".qtd_" + $(this).data("info")).val());
        if ((max > max2 && max2 > 0) || max == 0) {
            max_definido = max2;
        } else {
            max_definido = max;
        }
        new_val = (val + multiplicador);
        new_val += (new_val % multiplicador);
        if (new_val > max_definido && max_definido > 0) {
            showNotification("Quantidade Máxima Atingida", `O máximo que você pode adicionar ao carrinho deste produto ${max_definido == 1 ? `é ${max_definido} unidade`: `são ${max_definido} unidades`}.`, "info");
        }
        if (max_definido == 0 || new_val <= max_definido) {
            val = new_val;
        }
        if (min > 0 && val < min) {
            val = min;
            val += (val % multiplicador);
        }
        $(".qtd_" + $(this).data("info")).val(val);
        $(".qtd_" + $(this).data("info")).change();
    });

    carrinhoPendente();
    totalCarrinho();
});


--- SCRIPT 56 ---



function setCookie(c_name, value, exdays) {
    var exdate = new Date();
    exdate.setDate(exdate.getDate() + exdays);
    var c_value = escape(value) + ((exdays == null) ? "" : "; expires=" + exdate.toUTCString());
    document.cookie = c_name + "=" + c_value + "; path=/";
}

function getCookie(c_name) {
    var i, x, y, ARRcookies = document.cookie.split(";");
    for (i = 0; i < ARRcookies.length; i++) {
        x = ARRcookies[i].substr(0, ARRcookies[i].indexOf("="));
        y = ARRcookies[i].substr(ARRcookies[i].indexOf("=") + 1);
        x = x.replace(/^\s+|\s+$/g, "");
        if (x == c_name) {
            return unescape(y);
        }
    }
}


$(function() {
        
        $('#bannersCatalogo').lightSlider({
        item: 1,
        slideMargin: 0,
        loop: true,
        pager: false,
        controls: true,
        auto: true,
        pauseOnHover: true,
        pause: 5000,
        prevHtml: '<i class="fa fa-chevron-left"></i>',
        nextHtml: '<i class="fa fa-chevron-right"></i>',
        responsive: [
            {
                breakpoint: 800,
                settings: {
                    controls: false,
                    pager: true,
                }
            },
        ],
        onSliderLoad: function(el) {
            $('.bannersCatalogo').removeClass('carregando');
            setTimeout(() => {
                const activeImage = el.find("li.active img");
                if (! activeImage.attr('src')) {
                    activeImage.attr('src', activeImage.data('src'));
                }
                ajustarAlturaBannersCatalogo();
            }, 1000);
        },
        onAfterSlide: function(el) {
            const activeImage = el.find("li.active img");
            if (! activeImage.attr('src')) {
                activeImage.attr('src', activeImage.data('src'));
            }
            ajustarAlturaBannersCatalogo();
        },
    });

    function ajustarAlturaBannersCatalogo() {
        const activeImage = $('#bannersCatalogo li.active img');
        if (activeImage.outerHeight() == 0) {
            setTimeout(ajustarAlturaBannersCatalogo, 100);
            return;
        }

        $('#bannersCatalogo').css('height', activeImage.outerHeight() + 'px');
    }
    
        var selosSwiper = new Swiper('#selos_div_slider', {
        slidesPerView: 4,
        spaceBetween: 10,
        centerInsufficientSlides: true,
        autoplay: {
            delay: 4000,
            disableOnInteraction: true,
        },
        navigation: {
            nextEl: '#selos_div_slider .swiper-button-next',
            prevEl: '#selos_div_slider .swiper-button-prev',
        },
        pagination: {
            el: '#selos_div_slider .swiper-pagination',
            clickable: true,
        },
        loop: false,
        watchSlidesProgress: true,
        on: {
            init: function() {
                $('#selos_div_slider').removeClass('carregando');
            }
        },
        breakpoints: {
            320: {
                slidesPerView: 1,
                spaceBetween: 5,
            },
            680: {
                slidesPerView: 2,
                spaceBetween: 5,
                navigation: false,
            },
            968: {
                slidesPerView: 3,
                spaceBetween: 10,
            },
            1300: {
                slidesPerView: 4,
                spaceBetween: 10,
            },
        }
    });
    
        var tableSelecionarVariacoes = $('#tableSelecionarVariacoes').DataTable({
        "lengthChange": false,
        "paging": false,
        "ordering": false,
        "info" : false,
        language: {
            url: 'https://assets.facilzap.app.br/datatables_pt_br.json'
        },
        "initComplete": function(settings, json) {
            setTimeout(function(){
                $('#tableSelecionarVariacoes_wrapper .row:first-child .col-sm-12:first-child').remove();
                $('#tableSelecionarVariacoes').css('width','100%');
            },400);
        }
    });

    $(".btn-filtrar-catalogo").click(function(){
        if (tableSelecionarVariacoes.search() != '') {
            tableSelecionarVariacoes.search('').draw();
        }
    });
    });

function aplicarFiltroVariacoes() {
    var variacoes = [];
    $('.variacoes_selecionadas').each(function() {
        if ($(this).is(':checked')) {
            variacoes.push($(this).val());
        }
    });

    var url = new URL(window.location.href);
    url.searchParams.set('variacoes', variacoes.join(','));
    window.location = url.href;
}

function limparFiltroVariacoes() {
    var url = new URL(window.location.href);
    url.searchParams.delete('variacoes');
    window.location = url.href;
}


--- SCRIPT 60 ---


    const baseUrlLoja = `https://calientelingerie.com.br/`;
    const baseUrlCatalogo = `https://calientelingerie.com.br/c/calientelingerie/{PATH}/17996842783`;

    const configsLoja = Vue.reactive({
        carrinho: {},
        baseUrl: baseUrlLoja,
        vendedorFoto: 'https://arquivos.facilzap.app.br/perfil/1736424863_3cf91cb5c4d8d52813b6.jpeg.webp',
        vendedorNome: 'Gleici',
        catalogoId: 'padrao',
        clienteLogado: false,
        visitanteLogado: false,
        nomeLoja: "Caliente Lingerie ",
        linkWhatsApp: 'https://calientelingerie.com.br/redireciona/whatsapp/?link=phone%3D5517996842783%26text%3DOl%C3%A1%2C+Gleici%21+',
        layoutProdutos: "grid_novo",
        tamanhoGridMobile: 2,
        tamanhoGridPc: 4,
        precosRestritos: false,
        ocultarDestaque: false,
        permitirCadastro: false,
        somenteOrcamentos: false,
        ativarSimuladorParcelas: true,
        mostrarQuantidadeVenda: false,
        textoBotaoAcaoProdutos: "Comprar",
        habilitarCurtidas: true,
        habilitarPerguntas: true,
        permitirCompartilharProduto: true,
        habilitarAviseMeQuandoChegar: false,
        gridFormatoImagem: "original",
        campanhaPromocionalAtivaNoMomento: false,
        campanhaPromocionalTagProdutosAtivada: false,
        campanhaPromocionalTagProdutosTexto: null,
        campanhaPromocionalTagProdutosCorFundo: null,
        campanhaPromocionalTagProdutosCorTexto: null,
        campanhaPromocionalCronometroAtivo: false,
        campanhaPromocionalNome: "Campanha",
        campanhaPromocionalCronogramaInicio: "",
        campanhaPromocionalCronogramaTermino: "",
        campanhaPromocionalCronometroImagem: "https:\/\/assets.facilzap.app.br\/blackfriday_fz_web.png",
        sessaoLancamentosAtiva: false,
        sessaoMaisVendidosAtiva: false,
        sessaoPromocoesAtiva: false,
        modoExibicaoProdutos: "modal",
        exibirProdutosRelacionadosTelaProduto: true,
        exibirComentariosTelaProduto: true,
        habilitarSimuladorFreteProduto: true,
        permitirBaixarMidiaCatalogo: true,
        mostrarCodigoReferenciaProduto: true,
        exibirSkuVariacoes: true,
        mostrarQuantidadeEstoque: false,
        freteGratisAtivado: false,
        freteGratisValorMinimo: 400.00,
        freteGratisDescricao: "",
        freteGratisCondicao: "valor_pedido",
        faixasCepGratis: null,
        freteFixoAtivado: false,
        freteFixoValor: 0.00,
        freteFixoValorMinimo: 0.00,
        freteFixoDescricao: "",
        faixasCepFreteFixo: null,
        calculoFreteAutomaticoAtivado: true,
        formasEntrega: {"11991":{"id":"11991","loja":"3016","nome":"Retirar na Loja","descricao":"Ap\u00f3s realizar o pedido, favor confirmar que retirar\u00e1 na loja f\u00edsica. ","frete_fixo":"0.00","campo_extra":"0","campo_extra_obrigatorio":"0","nome_campo_extra":"","tipo_valor":"manual","tabela_valores":[],"localidades_disponiveis":[],"valor_minimo_desconto":null,"nfe_modalidade_frete":"0","status":"1","created_at":"2022-07-05 17:34:14","updated_at":"2023-08-21 16:46:50","deleted_at":null,"localidades_disponiveis_classes":""}},
        formasEntregaAtivas: ["correios","11991"],
        modulosCalculoFrete: ["fretefacil","correios","total_express","jadlog","melhorenvio","frenet","enviamais","braspress","kangu","clube_envios","frete_rapido","superfrete","conectenvios","manda_bem","flex_envios","dyzon","mandar","raio"],
        permitirEntregaInternacional: true,
        cepClienteLogado: "",
        apiBaseUri: 'https://api.facilzap.app.br/',
        urlCatalogo: 'https://calientelingerie.com.br/c/calientelingerie/17996842783',
        sonsCatalogo: true,
        audioClickUrl: 'https://assets.facilzap.app.br/click.wav',
        audioFinalizarUrl: 'https://assets.facilzap.app.br/finalizar2.wav',
        audioVolume: 0.4,
        maxVariacoesMostrar: 4,
        filtrosCatalogo: [],
        exibirTituloCategoria: false,
        mostrarMenuCategorias: true,
        exibirVariacoesPagina: "direto",
    });

    const clienteCadastradoLogado = false;
    const clienteVisitanteLogado = false;

    const lojaPalette = PrimeVue.palette('#c99695');

    const lojaPreset = PrimeVue.definePreset(PrimeVue.Themes.FacilZap, {
        semantic: {
            primary: lojaPalette
        }
    });

    PrimeVue.usePreset(lojaPreset);

    function obterURLImageTransform(params, url) {
        if (!url) return '';

        if (!url.includes('://facilzap.app.br') && !url.includes('://facilzap.com.br')) {
            return url;
        }

        params = encodeURIComponent(params);

        return `https://facilzap.app.br/cdn-cgi/image/${params}/${url}`;
    }


--- SCRIPT 61 ---


    const urlCarregarProdutos = `https://calientelingerie.com.br/c/calientelingerie/carregar_produtos/{PAGE}/{CATEGORY}/17996842783`;


--- SCRIPT 62 ---


if (typeof FZComponents === 'undefined') {
    var FZComponents = {};
}

FZComponents.TituloSecao = {
    props: {
        'titulo': {
            type: String,
            default: ''
        },
        'alinhamento': {
            type: String,
            default: 'center', // center, left, right
            validator: (value) => ['center', 'left', 'right'].includes(value)
        },
        'tamanho': {
            type: String,
            default: 'h3', // h1, h2, h3, h4, h5, h6
            validator: (value) => ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].includes(value)
        },
        'cor': {
            type: String,
            default: '' // Deixa vazio para usar cor padrão
        },
        'margem-inferior': {
            type: String,
            default: 'mb-3' // mb-1, mb-2, mb-3, mb-4, mb-5
        },
        'icone': {
            type: String,
            default: '' // Classe do ícone (ex: 'fa fa-star')
        },
        'class': {
            type: String,
            default: '' // Classes adicionais
        }
    },
    computed: {
        classesTexto() {
            const classes = ['font-weight-bold', this.margemInferior];
            
            if (this.alinhamento === 'center') classes.push('text-center');
            else if (this.alinhamento === 'left') classes.push('text-left');
            else if (this.alinhamento === 'right') classes.push('text-right');

            if (this.class) {
                classes.push(this.class);
            }
            
            return classes.join(' ');
        },
        estiloTitulo() {
            if (this.cor) {
                return { color: this.cor };
            }
            return {};
        }
    },
    template: `
    <div v-if="titulo" :class="classesTexto">
        <component 
            :is="tamanho" 
            :style="estiloTitulo"
            class="titulo-secao-inicio">
            <i v-if="icone" :class="icone" class="mr-2"></i>
            {{ titulo }}
        </component>
    </div>
    `,
}


--- SCRIPT 63 ---


if (typeof FZComponents === "undefined") {
    var FZComponents = {};
}

/**
 * FZComponents.SelectPais
 * Componente de seleção de país com bandeiras
 */
FZComponents.SelectPais = {
    components: {
        'p-select': PrimeVue.Select
    },
    props: {
        modelValue: {
            type: String,
            default: 'BR'
        },
        selectType: {
            type: String,
            default: 'full', // 'full' ou 'reduced'
            validator: (value) => ['full', 'reduced'].includes(value)
        },
        placeholder: {
            type: String,
            default: 'Selecione um país'
        },
        disabled: {
            type: Boolean,
            default: false
        }
    },
    emits: ['update:modelValue'],
    data() {
        return {
            paises: typeof listaPaises !== 'undefined' ? listaPaises : [
                { id: 'BR', text: 'Brasil' },
                { id: 'US', text: 'Estados Unidos' },
                { id: 'AR', text: 'Argentina' },
                { id: 'PY', text: 'Paraguai' },
                { id: 'UY', text: 'Uruguai' },
                { id: 'CL', text: 'Chile' },
                { id: 'BO', text: 'Bolívia' },
                { id: 'PE', text: 'Peru' },
                { id: 'CO', text: 'Colômbia' },
                { id: 'VE', text: 'Venezuela' },
                { id: 'EC', text: 'Equador' },
                { id: 'GY', text: 'Guiana' },
                { id: 'SR', text: 'Suriname' },
                { id: 'GF', text: 'Guiana Francesa' },
                { id: 'PT', text: 'Portugal' },
                { id: 'ES', text: 'Espanha' },
                { id: 'FR', text: 'França' },
                { id: 'IT', text: 'Itália' },
                { id: 'DE', text: 'Alemanha' },
                { id: 'GB', text: 'Reino Unido' },
                { id: 'CN', text: 'China' },
                { id: 'JP', text: 'Japão' },
                { id: 'MX', text: 'México' },
                { id: 'CA', text: 'Canadá' }
            ]
        };
    },
    computed: {
        paisSelecionado: {
            get() {
                return this.modelValue;
            },
            set(value) {
                this.$emit('update:modelValue', value);
            }
        },
        paisesOptions() {
            return this.paises.map(pais => ({
                value: pais.id,
                label: pais.text,
                code: pais.id
            }));
        }
    },
    methods: {
        paisTemplate(option) {
            if (!option || !option.code) return '';
            
            const flagClass = `fi fi-${option.code.toLowerCase()}`;
            
            if (this.selectType === 'reduced') {
                return `<span class="fz-select-pais__opcao"><span class="${flagClass}"></span> ${option.code.toUpperCase()}</span>`;
            }
            
            return `<span class="fz-select-pais__opcao"><span class="${flagClass}"></span> ${option.label}</span>`;
        }
    },
    template: `
    <p-select
        v-model="paisSelecionado"
        :options="paisesOptions"
        option-value="value"
        option-label="label"
        :placeholder="placeholder"
        :disabled="disabled"
        class="fz-select-pais"
        :class="{'fz-select-pais--reduced': selectType === 'reduced'}"
        filter
    >
        <template #value="slotProps">
            <div v-if="slotProps.value" class="fz-select-pais__valor">
                <span :class="'fi fi-' + slotProps.value.toLowerCase()"></span>
                <span v-if="selectType === 'reduced'">{{ slotProps.value.toUpperCase() }}</span>
                <span v-else>{{ paisesOptions.find(p => p.value === slotProps.value)?.label }}</span>
            </div>
            <span v-else>{{ placeholder }}</span>
        </template>
        <template #option="slotProps">
            <div class="fz-select-pais__opcao">
                <span :class="'fi fi-' + slotProps.option.code.toLowerCase()"></span>
                <span>{{ slotProps.option.label }}</span>
            </div>
        </template>
    </p-select>
    `
};


--- SCRIPT 64 ---


if (typeof FZComponents === "undefined") {
    var FZComponents = {};
}

/**
 * FZComponents.InputPhone
 * Componente de input de telefone internacional com validação
 * Retorna: { raw, e164, ddi, country, valid }
 */
FZComponents.InputPhone = {
    components: {
        'p-inputtext': PrimeVue.InputText
    },
    props: {
        modelValue: {
            type: Object,
            default: () => ({
                raw: '',
                e164: '',
                ddi: '',
                country: '',
                valid: false
            })
        },
        placeholder: {
            type: String,
            default: '(00) 00000-0000'
        },
        disabled: {
            type: Boolean,
            default: false
        },
        required: {
            type: Boolean,
            default: false
        },
        initialCountry: {
            type: String,
            default: 'BR'
        },
        preferredCountries: {
            type: Array,
            default: () => ['BR', 'US']
        },
        size: {
            type: String,
            default: 'normal',
            validator: (value) => ['small', 'normal', 'large'].includes(value)
        }
    },
    emits: ['update:modelValue'],
    data() {
        return {
            phoneInstance: null,
            inputId: 'inputPhone-' + Math.random().toString(36).substr(2, 9),
            internalValue: '',
            isValid: false
        };
    },
    computed: {
        phoneValue: {
            get() {
                return this.internalValue;
            },
            set(value) {
                this.internalValue = value;
                this.updatePhoneData();
            }
        },
        currentCountry() {
            return this.modelValue.country || this.initialCountry;
        }
    },
    mounted() {
        this.initializeIntlTelInput();
    },
    beforeUnmount() {
        if (this.phoneInstance) {
            this.phoneInstance.destroy();
        }
    },
    watch: {
        'modelValue.e164': {
            handler(newE164) {
                if (newE164 && this.phoneInstance) {
                    // Evita loop infinito checando se o valor já é o mesmo
                    const currentE164 = this.phoneInstance.getNumber();
                    if (currentE164 !== newE164) {
                        this.phoneInstance.promise.then(() => {
                            this.phoneInstance.setNumber(newE164);
                            this.internalValue = this.phoneInstance.getNumber(window.intlTelInputUtils.numberFormat.NATIONAL);
                        });
                    }
                }
            }
        }
    },
    methods: {
        initializeIntlTelInput() {
            // PrimeVue InputText: o $el é diretamente o elemento input
            const inputElement = this.$refs.phoneInput.$el;
            
            if (!inputElement) {
                console.error('Elemento de input não encontrado');
                return;
            }

            if (!window.intlTelInput) {
                console.error('intlTelInput não está disponível');
                return;
            }

            this.phoneInstance = window.intlTelInput(inputElement, {
                nationalMode: true,
                formatOnDisplay: true,
                separateDialCode: true,
                initialCountry: this.currentCountry.length > 0 ? this.currentCountry : 'BR',
                preferredCountries: this.preferredCountries,
                customPlaceholder: (selectedCountryPlaceholder, selectedCountryData) => {
                    return selectedCountryPlaceholder.replace(/[0-9]/g, "0");
                }
            });

            // Adicionar event listeners
            inputElement.addEventListener('change', () => this.formatAndUpdate());
            inputElement.addEventListener('keyup', () => this.formatAndUpdate());
            inputElement.addEventListener('input', () => this.validatePhone());

            // Se houver valor inicial, definir
            if (this.modelValue.e164) {
                this.phoneInstance.promise.then(() => {
                    this.phoneInstance.setNumber(this.modelValue.e164);
                    this.internalValue = this.phoneInstance.getNumber(window.intlTelInputUtils.numberFormat.NATIONAL);
                    this.updatePhoneData();
                });
            }
        },

        formatAndUpdate() {
            if (!this.phoneInstance) return;

            const phoneNumber = this.phoneInstance.getNumber();
            this.phoneInstance.setNumber(phoneNumber);
            this.updatePhoneData();
        },

        updatePhoneData() {
            if (!this.phoneInstance) return;

            const countryData = this.phoneInstance.getSelectedCountryData();
            const e164Number = this.phoneInstance.getNumber();
            const isValid = this.phoneInstance.isValidNumber();

            this.isValid = isValid;

            const phoneData = {
                raw: this.internalValue,
                e164: e164Number || '',
                ddi: countryData.dialCode || '',
                country: countryData.iso2 ? countryData.iso2.toUpperCase() : '',
                valid: isValid
            };

            this.$emit('update:modelValue', phoneData);
        },

        validatePhone() {
            const inputElement = this.$refs.phoneInput.$el;
            if (!inputElement || !this.phoneInstance) return;

            const isValid = this.phoneInstance.isValidNumber();
            const hasValue = this.internalValue && this.internalValue.length > 0;

            if (!isValid && hasValue) {
                inputElement.setCustomValidity('Número de telefone inválido');
            } else {
                inputElement.setCustomValidity('');
            }

            this.isValid = isValid;
        }
    },
    template: `
    <div class="fz-input-phone">
        <p-inputtext
            ref="phoneInput"
            v-model="phoneValue"
            type="tel"
            :placeholder="placeholder"
            :disabled="disabled"
            :required="required"
            :size="size"
            :invalid="!isValid && internalValue.length > 0"
            class="w-100"
        ></p-inputtext>
    </div>
    `
};


--- SCRIPT 65 ---


if (typeof FZComponents === "undefined") {
    var FZComponents = {};
}

// ============================================================================
// GLOBAL SIMULADOR FRETE STATE STORE
// ============================================================================

const SimuladorFreteStore = Vue.reactive({
    dialogOpen: false,
    carregando: false,
    cepAtual: '',
    paisAtual: 'BR',
    elegivelFreteGratis: false,
    entregaBrasil: true,
    produtoId: null,
    quantidade: 0,
    precoTotal: 0,
    resultados: {
        modulosTransportadoras: {},
        formasEntregaManuais: [],
        uf: null,
        cidade: null
    }
});

// ============================================================================
// HELPER MIXIN
// ============================================================================

const SimuladorFreteMixin = {
    inject: ['configsLoja'],
    data() {
        return {
            simuladorStore: SimuladorFreteStore
        };
    },
    methods: {
        formatarPreco(valor) {
            if (!valor) return '0,00';
            const num = parseFloat(valor);
            if (isNaN(num)) return '0,00';
            return num.toFixed(2).replace('.', ',');
        },
        normalizeClassName(str) {
            if (!str) return '';
            return str.toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9]/g, '_');
        },
        validarFaixasCep(cep, faixasCep) {
            if (
                typeof faixasCep === 'object' &&
                faixasCep !== null &&
                !Array.isArray(faixasCep)
            ) {
                let cepNaFaixa = false;
                Object.values(faixasCep).forEach(faixa => {
                    const inicio = Number(faixa.inicio.replace(/\D/g, ''));
                    const termino = Number(faixa.termino.replace(/\D/g, ''));
                    const cepNum = Number(cep);
                    if (cepNum >= inicio && cepNum <= termino) {
                        cepNaFaixa = true;
                    }
                });
                return cepNaFaixa;
            }
            return true;
        },
        obterCEPLocalStorage() {
            const cepSessao = localStorage.getItem("cliente_cep");
            if (cepSessao) return cepSessao;
            return this.configsLoja.cepClienteLogado || '';
        },
        salvarCEPLocalStorage(cep) {
            localStorage.setItem("cliente_cep", cep);
        }
    }
};

// ============================================================================
// FORMULÁRIO DE SIMULAÇÃO
// ============================================================================

/**
 * FZComponents.SimuladorFreteFormulario
 * Formulário para entrada de CEP e país
 */
FZComponents.SimuladorFreteFormulario = {
    components: {
        'p-inputgroup': PrimeVue.InputGroup,
        'p-inputmask': PrimeVue.InputMask,
        'p-inputtext': PrimeVue.InputText,
        'p-inputgroupaddon': PrimeVue.InputGroupAddon,
        'p-button': PrimeVue.Button,
        'fz-select-pais': FZComponents.SelectPais
    },
    mixins: [SimuladorFreteMixin],
    props: {
        produtoId: {
            type: [String, Number],
            default: null
        },
    },
    data() {
        return {
            cep: '',
            pais: 'BR'
        };
    },
    computed: {
        cepMask() {
            return this.pais === 'BR' ? '99999-999' : null;
        },
        cepPlaceholder() {
            return this.pais === 'BR' ? '00000-000' : 'Código Postal';
        }
    },
    mounted() {
        this.cep = this.obterCEPLocalStorage();
    },
    methods: {
        simular() {
            const cepLimpo = this.cep.replace(/\D/g, '');
            
            if (this.pais === 'BR' && cepLimpo.length < 8) {
                if (typeof showNotification === 'function') {
                    showNotification('Atenção', 'Por favor, informe um CEP válido.', 'warning');
                }
                return;
            }
            
            if (!this.cep) {
                if (typeof showNotification === 'function') {
                    showNotification('Atenção', 'Por favor, informe o código postal.', 'warning');
                }
                return;
            }
            
            // Chamar função global que abre o dialog
            if (typeof window.abrirSimuladorFrete === 'function') {
                window.abrirSimuladorFrete(
                    cepLimpo,
                    this.pais,
                    this.produtoId,
                    0, // quantidade - será definida pelo contexto
                    0  // precoTotal - será definida pelo contexto
                );
            } else {
                // Fallback: emitir evento para componente pai
                this.$emit('simular', {
                    cep: cepLimpo,
                    pais: this.pais,
                    produtoId: this.produtoId
                });
            }
        }
    },
    template: `
    <div class="fz-simulador-frete-formulario">
        <div class="fz-simulador-frete-formulario__campos d-flex gap-1 align-items-center justify-content-center">
            <div v-if="configsLoja.permitirEntregaInternacional" class="fz-simulador-frete-formulario__pais">
                <fz-select-pais 
                    v-model="pais"
                    select-type="reduced"
                ></fz-select-pais>
            </div>
            
            <div class="fz-simulador-frete-formulario__cep-grupo">
                <p-inputgroup>
                    <p-inputmask
                        v-if="pais === 'BR'"
                        v-model="cep"
                        :mask="cepMask"
                        :placeholder="cepPlaceholder"
                        class="fz-simulador-frete-formulario__cep-input"
                        size="small"
                        @keydown.enter="simular"
                    ></p-inputmask>
                    <p-inputtext
                        v-else
                        v-model="cep"
                        :placeholder="cepPlaceholder"
                        class="fz-simulador-frete-formulario__cep-input"
                        size="small"
                        @keydown.enter="simular"
                    ></p-inputtext>
                    <p-inputgroupaddon>
                        <p-button 
                            icon="ti-truck"
                            label="Calcular"
                            size="small"
                            severity="primary"
                            @click="simular"
                            :disabled="!cep"
                        ></p-button>
                    </p-inputgroupaddon>
                </p-inputgroup>
            </div>
        </div>
    </div>
    `
};

// ============================================================================
// DIALOG DE RESULTADOS
// ============================================================================

FZComponents.SimuladorFreteDialog = {
    components: {
        'p-dialog': PrimeVue.Dialog,
        'p-message': PrimeVue.Message
    },
    mixins: [SimuladorFreteMixin],
    props: {
        produtoId: {
            type: [String, Number],
            default: null
        }
    },
    data() {
        return {
            quantidade: 0,
            precoTotal: 0
        };
    },
    watch: {
        'simuladorStore.dialogOpen'(newValue) {
            if (newValue) {
                if (this.simuladorStore.quantidade <= 0) {
                    this.simuladorStore.dialogOpen = false;

                    showNotification('Ops!', 'Informe a quantidade desejada do produto.', 'warning');
                    return false;
                }

                this.quantidade = this.simuladorStore.quantidade;
                this.precoTotal = this.simuladorStore.precoTotal;

                this.iniciarSimulacao();
            }
        }
    },
    computed: {
        visible: {
            get() {
                return this.simuladorStore.dialogOpen;
            },
            set(value) {
                this.simuladorStore.dialogOpen = value;
            }
        },
        exibirFreteGratis() {
            if (!this.configsLoja.freteGratisAtivado || !this.simuladorStore.entregaBrasil) {
                return false;
            }
            
            const cep = this.simuladorStore.cepAtual;
            if (!this.validarFaixasCep(cep, this.configsLoja.faixasCepGratis)) {
                return false;
            }
            
            let valorCondicao = this.precoTotal;
            if (this.configsLoja.freteGratisCondicao === 'qtd_itens') {
                valorCondicao = this.quantidade;
            }
            
            return valorCondicao >= this.configsLoja.freteGratisValorMinimo;
        },
        exibirFreteFixo() {
            if (!this.configsLoja.freteFixoAtivado || !this.simuladorStore.entregaBrasil) {
                return false;
            }
            
            const cep = this.simuladorStore.cepAtual;
            if (!this.validarFaixasCep(cep, this.configsLoja.faixasCepFreteFixo)) {
                return false;
            }
            
            return this.precoTotal >= this.configsLoja.freteFixoValorMinimo;
        },
        formasEntregaFiltradas() {
            const uf = this.simuladorStore.resultados.uf;
            const cidade = this.simuladorStore.resultados.cidade;

            if (!uf || !cidade) {
                return this.simuladorStore.resultados.formasEntregaManuais || [];
            }
            
            const ufNorm = this.normalizeClassName(uf);
            const cidadeNorm = this.normalizeClassName(cidade);
            
            return (this.simuladorStore.resultados.formasEntregaManuais || []).filter(forma => {
                if (!forma.localidades_disponiveis_classes) return true;
                
                const classes = forma.localidades_disponiveis_classes.split(' ');
                return classes.some(cls => 
                    cls === `localidade_disponivel_${ufNorm}` ||
                    cls === `localidade_disponivel_${ufNorm}_${cidadeNorm}`
                );
            });
        },
        modulosOrdenados() {
            const modulos = this.simuladorStore.resultados.modulosTransportadoras || {};
            const ordem = ['fretefacil', ...Object.keys(modulos).filter(m => m !== 'fretefacil')];
            
            return ordem.filter(modulo => modulos[modulo]).map(modulo => ({
                nome: modulo,
                html: modulos[modulo]
            }));
        }
    },
    methods: {
        async iniciarSimulacao() {
            const cep = this.simuladorStore.cepAtual;
            const pais = this.simuladorStore.paisAtual;
            const produtoId = this.simuladorStore.produtoId;
            
            this.simuladorStore.carregando = true;
            
            await this.validarCEP(cep);
            
            if (this.configsLoja.calculoFreteAutomaticoAtivado) {
                await this.calcularFreteAutomatico(cep, pais, produtoId, this.quantidade);
            }
            
            this.simuladorStore.carregando = false;
        },
        async simular({ cep, pais, produtoId, quantidade, precoTotal }) {
            this.quantidade = quantidade || 0;
            this.precoTotal = precoTotal || 0;
            
            cep = cep.replace(/\D/g, '');
            
            const entregaBrasil = pais === 'BR' || pais === '' || !pais;
            
            this.simuladorStore.quantidade = this.quantidade;
            this.simuladorStore.precoTotal = this.precoTotal;
            this.simuladorStore.cepAtual = cep;
            this.simuladorStore.paisAtual = pais || 'BR';
            this.simuladorStore.entregaBrasil = entregaBrasil;
            this.simuladorStore.carregando = true;
            
            this.salvarCEPLocalStorage(cep);
            localStorage.setItem("entrega_brasil", entregaBrasil);
            
            // Verificar elegibilidade frete grátis
            this.simuladorStore.elegivelFreteGratis = false;
            if (this.configsLoja.freteGratisAtivado && entregaBrasil && 
                this.validarFaixasCep(cep, this.configsLoja.faixasCepGratis)) {
                this.simuladorStore.elegivelFreteGratis = true;
            }
            localStorage.setItem("frete_gratis_elegivel", this.simuladorStore.elegivelFreteGratis);
            
            if (typeof atualizarProgressoFreteGratis === 'function') {
                atualizarProgressoFreteGratis();
            }
            
            await this.validarCEP(cep);
            
            if (this.configsLoja.calculoFreteAutomaticoAtivado) {
                await this.calcularFreteAutomatico(cep, pais, produtoId, quantidade);
            }
            
            this.simuladorStore.dialogOpen = true;
            this.simuladorStore.carregando = false;
        },
        async validarCEP(cep) {
            const validacep = /^[0-9]{8}$/;
            
            if (!validacep.test(cep)) {
                this.simuladorStore.resultados.uf = null;
                this.simuladorStore.resultados.cidade = null;
                return;
            }
            
            try {
                const response = await fetch(`${this.configsLoja.apiBaseUri}bureau_interno/cep/${cep}`);
                const dados = await response.json();
                
                if (!dados.erro) {
                    this.simuladorStore.resultados.uf = dados.uf;
                    this.simuladorStore.resultados.cidade = dados.localidade;
                } else {
                    this.simuladorStore.resultados.uf = null;
                    this.simuladorStore.resultados.cidade = null;
                }
            } catch (error) {
                console.error('Erro ao validar CEP:', error);
                this.simuladorStore.resultados.uf = null;
                this.simuladorStore.resultados.cidade = null;
            }
        },
        async calcularFreteAutomatico(cep, pais, produtoId, quantidade) {
            try {
                const dados = {
                    acao: produtoId ? 'calculo_frete_produto' : 'calculo_frete',
                    cep: cep,
                    pais: pais || 'BR',
                    cliente_cpf_cnpj: ''
                };
                
                if (produtoId) {
                    dados.produto_id = produtoId;
                    dados.qtd = quantidade || 0;

                    if (dados.qtd == 0) {
                        showNotification('Ops!', 'Informe a quantidade desejada do produto.', 'warning');
                        return false;
                    }
                }
                
                const response = await fetch(this.configsLoja.urlCatalogo, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(dados)
                });
                
                const data = await response.json();
                
                if (data.sucesso == "1") {
                    this.simuladorStore.resultados.modulosTransportadoras = {};
                    
                    // Processar módulos de transportadoras
                    this.configsLoja.modulosCalculoFrete.forEach(modulo => {
                        if (data[modulo]) {
                            this.simuladorStore.resultados.modulosTransportadoras[modulo] = data[modulo];
                        }
                    });
                }
            } catch (error) {
                console.error('Erro ao calcular frete:', error);
            }
        },
        fecharDialog() {
            this.simuladorStore.dialogOpen = false;
        }
    },
    template: `
    <p-dialog
        v-model:visible="visible"
        modal
        header="Calcular Frete"
        :style="{ width: '90vw', maxWidth: '700px' }"
        class="fz-simulador-frete-dialog"
        data-fz-simulador-frete-dialog
        :pt="{content: 'px-2'}"
    >
        <div class="fz-simulador-frete-dialog__conteudo py-1">
            <p-message severity="info" size="small" :closable="false" class="mb-3">
                <i class="fa fa-info-circle"></i> Você poderá selecionar a forma de entrega desejada ao finalizar o pedido.
            </p-message>


            <div v-if="simuladorStore.carregando" class="text-center py-4">
                <i class="fa fa-spinner fa-pulse fa-3x"></i>
                <p class="mt-2">Verificando opções de entrega disponíveis para seu CEP....</p>
            </div>
            
            <div v-if="!simuladorStore.carregando" class="fz-simulador-frete-dialog__transportadoras form-radio">
                <!-- Frete Grátis -->
                <div v-if="exibirFreteGratis" class="radio radiofill radio-success radio-form-entrega mb-2">
                    <label class="mb-0">
                        <input type="radio" class="ignore-validation" disabled>
                        <i class="helper"></i>
                        <span class="descricao-entrega">Frete Grátis</span>
                        <p class="text-muted f-12 mb-0 pl-2 d-inline-block" v-html="configsLoja.freteGratisDescricao"></p>
                        <p class="text-dark font-weight-bold f-16 mb-0 f-right valor-entrega text-success">R$ 0,00</p>
                    </label>
                </div>
                
                <!-- Frete Fixo -->
                <div v-if="exibirFreteFixo" class="radio radiofill radio-info radio-form-entrega mb-2">
                    <label class="mb-0">
                        <input type="radio" class="ignore-validation" disabled>
                        <i class="helper"></i>
                        <span class="descricao-entrega">Frete Fixo</span>
                        <p class="text-muted f-12 mb-0 pl-2 d-inline-block" v-html="configsLoja.freteFixoDescricao"></p>
                        <p class="text-dark font-weight-bold f-16 mb-0 f-right valor-entrega">R$ {{ formatarPreco(configsLoja.freteFixoValor) }}</p>
                    </label>
                </div>

            </div>
                
            <!-- Módulos de Transportadoras -->
            <div v-if="!simuladorStore.carregando && modulosOrdenados.length > 0" class="fz-simulador-frete-dialog__transportadoras">
                <div v-for="modulo in modulosOrdenados" :key="modulo.nome">
                    <div v-html="modulo.html"></div>
                </div>
            </div>
                
            <div v-if="!simuladorStore.carregando" class="fz-simulador-frete-dialog__transportadoras form-radio">
                <!-- Formas de Entrega Manuais -->
                <template v-if="formasEntregaFiltradas.length > 0">
                    <div class="fz-simulador-frete-dialog__transportadoras-titulo mt-3 mb-3">
                        <h6 class="mb-1">Outras Formas de Entrega</h6>
                    </div>
                    <div v-for="forma in formasEntregaFiltradas" :key="forma.id" class="radio radiofill radio-primary radio-form-entrega mb-2">
                        <label class="mb-0">
                            <input type="radio" class="ignore-validation" disabled>
                            <i class="helper"></i>
                            <span class="descricao-entrega">{{ forma.nome }}</span>
                            <p class="text-muted f-12 mb-0 pl-2 d-inline-block" v-html="forma.descricao"></p>
                            <p v-if="forma.frete_fixo && forma.frete_fixo > 0" class="text-dark font-weight-bold f-16 mb-0 f-right valor-entrega">R$ {{ formatarPreco(forma.frete_fixo) }}</p>
                        </label>
                    </div>
                </template>
            </div>
        </div>
    </p-dialog>
    `
};

window.abrirSimuladorFrete = function(cep, pais, produtoId, quantidade, precoTotal) {
    if (typeof SimuladorFreteStore !== 'undefined') {
        const cepLimpo = cep.replace(/\D/g, '');
        
        const entregaBrasil = pais === 'BR' || pais === '' || !pais;
        
        SimuladorFreteStore.cepAtual = cepLimpo;
        SimuladorFreteStore.paisAtual = pais || 'BR';
        SimuladorFreteStore.entregaBrasil = entregaBrasil;
        SimuladorFreteStore.produtoId = produtoId;
        SimuladorFreteStore.quantidade = 0;
        SimuladorFreteStore.precoTotal = 0;
        
        if (typeof configsLoja !== 'undefined' && configsLoja.formasEntrega) {
            SimuladorFreteStore.resultados.formasEntregaManuais = Array.isArray(configsLoja.formasEntrega) 
                ? configsLoja.formasEntrega 
                : Object.values(configsLoja.formasEntrega);
        }

        if (produtoId !== undefined) {
            const quantidades = ProdutoConteudoStore.quantidadesSelecionadas[produtoId] || {};
            let totalQtd = 0;
            
            Object.values(quantidades).forEach(qtd => {
                totalQtd += Number(qtd) || 0;
            });

            precoProduto = ProdutoConteudoStore.dadosCompletos?.preco;
            precoTotalSimulacao = precoProduto * totalQtd;
            
            SimuladorFreteStore.quantidade = totalQtd;
            SimuladorFreteStore.precoTotal = precoTotalSimulacao;
        } else {
            SimuladorFreteStore.precoTotal = obterSubtotalCarrinho();
        }
        
        localStorage.setItem("cliente_cep", cepLimpo);
        localStorage.setItem("entrega_brasil", entregaBrasil);
        
        SimuladorFreteStore.elegivelFreteGratis = false;
        localStorage.setItem("frete_gratis_elegivel", false);
        
        if (typeof atualizarProgressoFreteGratis === 'function') {
            atualizarProgressoFreteGratis();
        }
        
        SimuladorFreteStore.dialogOpen = true;
    }
};


--- SCRIPT 66 ---


if (typeof FZComponents === "undefined") {
    var FZComponents = {};
}

const SimuladorParcelasStore = Vue.reactive({
    visible: false,
    produto: null
});

FZComponents.DialogSimuladorParcelas = {
    components: {
        'p-dialog': PrimeVue.Dialog,
        'p-message': PrimeVue.Message,
        'p-tabview': PrimeVue.TabView,
        'p-tabpanel': PrimeVue.TabPanel,
        'p-datatable': PrimeVue.DataTable,
        'p-column': PrimeVue.Column
    },
    inject: ['configsLoja'],
    data() {
        return {
            store: SimuladorParcelasStore
        };
    },
    computed: {
        visible: {
            get() {
                return this.store.visible;
            },
            set(value) {
                this.store.visible = value;
                if (!value) {
                    // Limpar produto ao fechar
                    setTimeout(() => {
                        this.store.produto = null;
                    }, 300);
                }
            }
        },
        produto() {
            return this.store.produto;
        },
        simulacao() {
            return this.produto?.simulacao_parcelas;
        },
        temSimulacao() {
            return this.simulacao && this.simulacao.exibir_simulador;
        },
        formasPagamento() {
            if (!this.simulacao?.formas_pagamento) return [];
            
            return Object.entries(this.simulacao.formas_pagamento).map(([id, forma]) => ({
                id,
                nome: forma.info?.nome || id,
                icone: forma.info?.icone || null,
                dados: forma
            }));
        }
    },
    methods: {
        formatarPreco(valor) {
            if (!valor) return '0,00';
            const num = parseFloat(valor);
            if (isNaN(num)) return '0,00';
            return num.toFixed(2).replace('.', ',');
        },
        obterURLAssets(arquivo) {
            return `https://assets.facilzap.app.br/${arquivo}`;
        },
        temMetodo(forma, metodo) {
            return forma.dados[metodo] !== undefined;
        },
        fecharDialog() {
            this.visible = false;
        }
    },
    template: `
    <p-dialog
        v-model:visible="visible"
        modal
        :draggable="false"
        :dismissableMask="true"
        header="Simulação de Parcelas"
        :base-z-index="20000"
        :style="{ width: '90vw', maxWidth: '700px' }"
        class="fz-dialog-simulador-parcelas"
        :pt="{header: 'pb-2', content: 'pt-0'}"
    >
        <div v-if="!temSimulacao" class="fz-dialog-simulador-parcelas__sem-dados p-4 text-center">
            <p-message severity="info" :closable="false">
                Não há informações de parcelamento disponíveis para este produto.
            </p-message>
        </div>
        
        <div v-if="temSimulacao"  class="fz-dialog-simulador-parcelas__aviso px-3 mb-1">
            <p-message size="small" severity="warn" icon="pi pi-exclamation-triangle" :closable="false">
               Os valores abaixo são uma simulação das condições de pagamento ofertadas pela loja, 
                podendo haver variação no momento da finalização do pedido devido ao valor total da compra e o valor do frete.
            </p-message>
        </div>
        
        <div v-if="temSimulacao" class="fz-dialog-simulador-parcelas__conteudo">
            <p-tabview v-if="formasPagamento.length > 0" scrollable>
                <p-tabpanel v-for="forma in formasPagamento" :key="forma.id">
                    <template #header>
                        <div class="d-flex align-items-center gap-2">
                            <img 
                                v-if="forma.icone" 
                                :src="obterURLAssets(forma.icone)" 
                                loading="lazy"
                                style="max-height: 20px;"
                                :alt="forma.nome"
                            />
                            <span v-else>{{ forma.nome }}</span>
                        </div>
                    </template>
                    
                    <!-- Conteúdo da aba PIX (standalone) -->
                    <div v-if="forma.id === 'pix'" class="fz-dialog-simulador-parcelas__pix">
                        <p class="fz-dialog-simulador-parcelas__pix-valor f-16 mb-2">
                            <img 
                                :src="obterURLAssets('logo-pix-64.png')" 
                                loading="lazy" 
                                style="width:34px" 
                                alt="PIX" 
                            />
                            <s v-if="forma.dados.desconto > 0">
                                R$ {{ formatarPreco(forma.dados.preco) }}
                            </s>
                            <b>R$ {{ formatarPreco(forma.dados.preco_final) }}</b> no <b>PIX</b>
                            <span v-if="forma.dados.desconto > 0">
                                com <b>{{ formatarPreco(forma.dados.desconto_porcentagem) }}%</b> de desconto
                            </span>
                        </p>
                    </div>
                    
                    <!-- Conteúdo de outras formas de pagamento -->
                    <div v-else class="fz-dialog-simulador-parcelas__forma">
                        <!-- Cartão de Crédito -->
                        <div v-if="temMetodo(forma, 'cartao_credito')" class="fz-dialog-simulador-parcelas__cartao mb-4">
                            <p class="font-weight-bold f-16 mb-2">
                                <img 
                                    :src="obterURLAssets('logo-cartao-64.png')" 
                                    loading="lazy" 
                                    style="width:34px" 
                                    alt="Cartão de Crédito" 
                                /> 
                                Cartão de Crédito
                            </p>
                            
                            <p-datatable 
                                :value="forma.dados.cartao_credito.parcelas"
                                striped
                                size="small"
                                class="fz-dialog-simulador-parcelas__tabela"
                            >
                                <p-column field="parcela" header="Parcelas">
                                    <template #body="slotProps">
                                        <b>{{ slotProps.data.parcela }}x</b> de 
                                        <b>R$ {{ formatarPreco(slotProps.data.valor_parcela) }}</b>
                                    </template>
                                </p-column>
                                <p-column field="total" header="Total" class="text-right">
                                    <template #body="slotProps">
                                        R$ {{ formatarPreco(slotProps.data.total) }}
                                    </template>
                                </p-column>
                            </p-datatable>
                        </div>
                        
                        <!-- Forma Manual -->
                        <div v-if="temMetodo(forma, 'manual')" class="fz-dialog-simulador-parcelas__manual mb-4">
                            <p-datatable 
                                :value="forma.dados.manual.parcelas"
                                striped
                                size="small"
                                class="fz-dialog-simulador-parcelas__tabela"
                            >
                                <p-column field="parcela" header="Parcelas">
                                    <template #body="slotProps">
                                        <b>{{ slotProps.data.parcela }}x</b> de 
                                        <b>R$ {{ formatarPreco(slotProps.data.valor_parcela) }}</b>
                                    </template>
                                </p-column>
                                <p-column field="total" header="Total" class="text-right">
                                    <template #body="slotProps">
                                        R$ {{ formatarPreco(slotProps.data.total) }}
                                    </template>
                                </p-column>
                            </p-datatable>
                        </div>
                        
                        <!-- PIX (dentro de outra forma) -->
                        <div v-if="temMetodo(forma, 'pix')" class="fz-dialog-simulador-parcelas__pix-opcional mb-4">
                            <p class="f-16 mb-0">
                                <img 
                                    :src="obterURLAssets('logo-pix-64.png')" 
                                    loading="lazy" 
                                    style="width:34px" 
                                    alt="PIX" 
                                />
                                <b>R$ {{ formatarPreco(forma.dados.pix.preco_final) }}</b> no <b>PIX</b>
                            </p>
                        </div>
                        
                        <!-- Boleto -->
                        <div v-if="temMetodo(forma, 'boleto')" class="fz-dialog-simulador-parcelas__boleto mb-4">
                            <p class="f-16 mb-0">
                                <img 
                                    :src="obterURLAssets('logo-boleto-48.png')" 
                                    loading="lazy" 
                                    style="width:34px" 
                                    alt="Boleto" 
                                />
                                <b>R$ {{ formatarPreco(forma.dados.boleto.preco_final) }}</b> no <b>Boleto</b>
                            </p>
                        </div>
                    </div>
                </p-tabpanel>
            </p-tabview>
        </div>
    </p-dialog>
    `
};


--- SCRIPT 67 ---


if (typeof FZComponents === "undefined") {
    var FZComponents = {};
}

// ============================================================================
// GLOBAL STATE STORES
// ============================================================================

const ProdutoConteudoStore = Vue.reactive({
    produtoId: null,
    produtoInicial: null,
    dadosCompletos: null,
    carregando: false,
    erro: null,
    cacheProdutos: {},
    quantidadesSelecionadas: {},
    validacaoAtiva: false,
    pendente: false,
    tempoAberto: null,
    estatisticaEnviada: false,
    estatisticasEnviadas: new Set(),
    dialogRegrasPrecos: {
        visible: false,
        regrasCategoria: [],
        regrasProduto: []
    },
    dialogVideoExterno: {
        visible: false,
        videoId: null,
        service: null
    }
});

const ProdutoDialogDrawerStore = Vue.reactive({
    isOpen: false,
    ordemProdutos: [],
    indiceProdutoAtual: -1
});

// ============================================================================
// AUDIO MANAGER
// ============================================================================

const AudioManager = {
    audioClick: null,
    audioFinalizar: null,
    initialized: false,
    
    init(config) {
        if (this.initialized || !config.sonsCatalogo) return;
        
        this.audioClick = new Audio(config.audioClickUrl);
        this.audioClick.volume = config.audioVolume;
        
        this.audioFinalizar = new Audio(config.audioFinalizarUrl);
        this.audioFinalizar.volume = config.audioVolume;
        
        this.initialized = true;    
    },
    
    playClick() {
        if (this.audioClick) {
            this.audioClick.currentTime = 0;
            this.audioClick.play().catch(() => {});
        }
    },
    
    playFinalizar() {
        if (this.audioFinalizar) {
            this.audioFinalizar.currentTime = 0;
            this.audioFinalizar.play().catch(() => {});
        }
    }
};

// ============================================================================
// CARRINHO MANAGER
// ============================================================================

const CarrinhoManager = {
    timeouts: {},
    debounceDelay: 1000,
    
    atualizarQuantidade(produtoId, variacaoId, quantidade, produtoNome, produtoPreco, config) {
        const chave = `${produtoId}_${variacaoId}`;
        
        if (this.timeouts[chave]) {
            clearTimeout(this.timeouts[chave]);
        }
        
        this.timeouts[chave] = setTimeout(() => {
            this.enviarAtualizacao(produtoId, variacaoId, quantidade, produtoNome, produtoPreco, config);
        }, this.debounceDelay);
    },
    
    async enviarAtualizacao(produtoId, variacaoId, quantidade, produtoNome, produtoPreco, config) {
        const quantidadeAnterior = (config.carrinho && config.carrinho[produtoId] && config.carrinho[produtoId][variacaoId]) 
            ? config.carrinho[produtoId][variacaoId] 
            : 0;

        if (quantidadeAnterior == quantidade) {
            return;
        }

        try {
            if (quantidadeAnterior > quantidade && typeof facilZapEventos !== 'undefined' && facilZapEventos.adicionarAoCarrinho) {
                facilZapEventos.removerDoCarrinho(produtoId, produtoNome, produtoPreco);
            }

            if (quantidadeAnterior < quantidade && typeof facilZapEventos !== 'undefined' && facilZapEventos.adicionarAoCarrinho) {
                facilZapEventos.adicionarAoCarrinho(produtoId, produtoNome, produtoPreco);
            }

            if (typeof carrinhoPendente === 'function') {
                carrinhoPendente();
            }
            
            const formData = new FormData();
            formData.append('acao', 'atualizar_carrinho');
            formData.append('pid', produtoId);
            formData.append('vid', variacaoId);
            formData.append('qtd', quantidade);
            
            const response = await fetch(config.urlCatalogo, {
                method: 'POST',
                body: formData
            });
            
            const data = await response.text();
            const resultado = data.trim();
            
            if (resultado !== 'ok') {
                this.mostrarErro();
            } else {
                if (!config.carrinho) {
                    config.carrinho = {};
                }
                if (!config.carrinho[produtoId]) {
                    config.carrinho[produtoId] = {};
                }
                config.carrinho[produtoId][variacaoId] = quantidade;
                
                if (typeof totalCarrinho === 'function') {
                    totalCarrinho();
                }
            }
        } catch (error) {
            console.error('Erro ao atualizar carrinho:', error);
            this.mostrarErro();
        }
    },
    
    mostrarErro() {
        if (typeof showNotification === 'function') {
            showNotification(
                'Erro',
                'Tivemos um problema ao atualizar seu carrinho.<br/>Atualize a página e tente novamente!',
                'error'
            );
        }
    },
    
    validarQuantidade(valor, min, max, max2, multiplicador) {
        let val = Number(valor) || 0;
        
        multiplicador = Number(multiplicador);
        if (multiplicador < 1 || isNaN(multiplicador)) {
            multiplicador = 1;
        }
        
        min = Number(min) || 0;
        max = Number(max) || 0;
        max2 = Number(max2) || 0;
        
        // Arredondar para o múltiplo mais próximo
        if (multiplicador > 1 && val % multiplicador !== 0) {
            val = Math.round(val / multiplicador) * multiplicador;
        }
        
        // Validar mínimo
        if (min > 0 && val < min && val > 0) {
            val = min;
            // Garantir que o mínimo seja múltiplo do multiplicador
            if (multiplicador > 1 && val % multiplicador !== 0) {
                val = Math.ceil(val / multiplicador) * multiplicador;
            }
        }
        
        // Determinar máximo
        let maxDefinido = 0;
        if ((max > max2 && max2 > 0) || max == 0) {
            maxDefinido = max2;
        } else {
            maxDefinido = max;
        }
        
        // Validar máximo
        if (maxDefinido > 0 && val > maxDefinido) {
            val = maxDefinido;
            // Arredondar para baixo para o múltiplo mais próximo
            if (multiplicador > 1 && val % multiplicador !== 0) {
                val = Math.floor(val / multiplicador) * multiplicador;
            }
            
            return {
                valor: val,
                atingiuMaximo: true,
                maxDefinido: maxDefinido
            };
        }
        
        return {
            valor: val,
            atingiuMaximo: false,
            maxDefinido: maxDefinido
        };
    },
    
    notificarMaximo(maxDefinido) {
        if (typeof showNotification === 'function') {
            const mensagem = maxDefinido == 1 
                ? `é ${maxDefinido} unidade` 
                : `são ${maxDefinido} unidades`;
                
            showNotification(
                'Quantidade Máxima Atingida',
                `O máximo que você pode adicionar ao carrinho deste produto ${mensagem}.`,
                'info'
            );
        }
    }
};

// ============================================================================
// HELPER MIXINS
// ============================================================================

ProdutoConteudoMixin = {
    inject: ['configsLoja', 'baseUrlCatalogo'],
    computed: {
        conteudoStore() {
            return ProdutoConteudoStore;
        },
        dialogDrawerStore() {
            return ProdutoDialogDrawerStore;
        },
        linkProduto() {
            const produto = this.produto || this.conteudoStore.dadosCompletos || this.conteudoStore.produtoInicial;
            return produto ? this.obterLinkCatalogo('produto/' + produto.id) : '';
        }
    },
    methods: {
        irParaImagem(slidePos, produtoId, videoAtivo = 0) {
            const carrouselId = `carousel_produto_${produtoId}`;
            let adjustedPos = slidePos;
            
            // Se há vídeo ativo, ajusta a posição
            if (videoAtivo == 1) {
                const videoSlide = document.querySelector(`#${carrouselId} .swiper-slide-video`);
                if (videoSlide) {
                    adjustedPos++;
                }
            }
            
            // Navegar apenas no carousel do modal (ProdutoModalCarousel)
            const carouselElement = document.getElementById(carrouselId);
            if (carouselElement && carouselElement.swiper) {
                carouselElement.swiper.slideTo(adjustedPos);
            }
        },
        formatarPreco(valor) {
            if (!valor && valor !== 0) return "0,00";
            const numero = parseFloat(valor);
            if (isNaN(numero)) return "0,00";
            return numero.toFixed(2).replace(".", ",").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        },
        isEmpty(obj) {
            if (!obj) return true;
            if (Array.isArray(obj)) return obj.length === 0;
            return Object.keys(obj).length === 0;
        },
        obterLinkCatalogo(path) {
            return this.baseUrlCatalogo.replace('{PATH}', path);
        },
        obterURLArquivos(imagem) {
            if (/^(http|https):\/\//i.test(imagem)) {
                return imagem;
            }

            return `https://arquivos.facilzap.app.br/${imagem}`;
        },
        handleImageError(event) {
            event.target.src = `https://assets.facilzap.app.br/sem_foto.png`;
        },
        processarRegrasPrecos(produto, variacaoId = null) {
            const regrasCategoria = [];
            const regrasProduto = [];
            const dataAtual = Math.floor(Date.now() / 1000);

            if (produto.regras_desconto) {
                const regrasArray = Array.isArray(produto.regras_desconto) 
                    ? produto.regras_desconto 
                    : Object.values(produto.regras_desconto);
                
                regrasArray.forEach(regra => {
                    if (regra.itens_minimo && regra.itens_maximo && regra.valor_desconto) {
                        let textoDesconto = '';
                        if (regra.tipo_desconto === 'fixo') {
                            textoDesconto = `R$${this.formatarPreco(regra.valor_desconto)} de desconto`;
                        } else if (regra.tipo_desconto === 'por_peca') {
                            textoDesconto = `R$${this.formatarPreco(regra.valor_desconto)} de desconto por item`;
                        } else {
                            textoDesconto = `${regra.valor_desconto}% de desconto`;
                        }
                        regrasCategoria.push({
                            itensMinimo: regra.itens_minimo,
                            itensMaximo: regra.itens_maximo,
                            textoDesconto: textoDesconto
                        });
                    }
                });
            }

            if (produto.precos_produto && produto.precos_produto.regras_precos) {
                const chaveVariacao = variacaoId || 0;
                const regras = produto.precos_produto.regras_precos[chaveVariacao];

                const regrasArray = Array.isArray(regras) 
                    ? regras 
                    : Object.values(regras || {});
                
                if (regrasArray && Array.isArray(regrasArray)) {
                    regrasArray.forEach(regra => {
                        let regraAtiva = true;
                        
                        if (regra.data_inicio) {
                            const [dia, mes, ano] = regra.data_inicio.split('/');
                            const dataInicio = new Date(ano, mes - 1, dia, 0, 0, 0).getTime() / 1000;
                            if (dataAtual < dataInicio) {
                                regraAtiva = false;
                            }
                        }
                        
                        if (regra.data_termino) {
                            const [dia, mes, ano] = regra.data_termino.split('/');
                            const dataTermino = new Date(ano, mes - 1, dia, 23, 59, 59).getTime() / 1000;
                            if (dataAtual > dataTermino) {
                                regraAtiva = false;
                            }
                        }
                        
                        if (regraAtiva) {
                            let textoDesconto = '';
                            if (regra.tipo_desconto === 'fixo') {
                                textoDesconto = `R$${this.formatarPreco(regra.valor_desconto)} de desconto`;
                            } else if (regra.tipo_desconto === 'por_peca') {
                                textoDesconto = `R$${this.formatarPreco(regra.valor_desconto)} de desconto por item`;
                            } else {
                                textoDesconto = `${regra.valor_desconto}% de desconto`;
                            }
                            regrasProduto.push({
                                itensMinimo: regra.itens_minimo,
                                itensMaximo: regra.itens_maximo,
                                textoDesconto: textoDesconto
                            });
                        }
                    });
                }
            }

            return { regrasCategoria, regrasProduto };
        },
        abrirDialogRegrasPrecos(produto, variacaoId = null) {
            const { regrasCategoria, regrasProduto } = this.processarRegrasPrecos(produto, variacaoId);
            
            if (regrasCategoria.length === 0 && regrasProduto.length === 0) {
                console.warn('Nenhuma regra de preço encontrada');
                return;
            }
            
            this.conteudoStore.dialogRegrasPrecos.regrasCategoria = regrasCategoria;
            this.conteudoStore.dialogRegrasPrecos.regrasProduto = regrasProduto;
            this.conteudoStore.dialogRegrasPrecos.visible = true;
        },
        abrirDialogSimuladorParcelas(produto) {
            SimuladorParcelasStore.produto = produto || this.produto;
            SimuladorParcelasStore.visible = true;
        },
        abrirDialogSimuladorFrete(cep, pais, produtoId, quantidade, precoTotal) {
            if (typeof window.abrirSimuladorFrete === 'function') {
                window.abrirSimuladorFrete(cep, pais, produtoId, quantidade, precoTotal);
            } else {
                console.error('Função global abrirSimuladorFrete não encontrada');
            }
        },
        abrirDialogVideoExterno(produto) {
            if (!produto?.video_externo?.id || !produto?.video_externo?.service) {
                console.warn('Vídeo externo não disponível para este produto');
                return;
            }
            
            this.conteudoStore.dialogVideoExterno.videoId = produto.video_externo.id;
            this.conteudoStore.dialogVideoExterno.service = produto.video_externo.service;
            this.conteudoStore.dialogVideoExterno.visible = true;
        }
    }
};


ProdutoBaseMixin = {
    inject: {
        baseUrlCatalogo: {
            from: 'baseUrlCatalogo',
            default: ''
        },
        configsLoja: {
            from: 'configsLoja',
            default: () => ({})
        }
    },
    computed: {
        catalogoUrl() {
            return this.baseUrlCatalogo;
        },
        classe() {
            return this.class;
        },
        textoBotaoAcao() {
            let texto = this.textoBotaoAcaoProdutos || "Comprar";
            if (this.produto.texto_botao_acao && this.produto.texto_botao_acao !== "config") {
                texto = this.produto.texto_botao_acao;
            }
            return texto;
        },
        linkProduto() {
            return this.obterLinkCatalogo("produto/" + this.produto.id);
        },
        linkLogin() {
            return this.obterLinkCatalogo("login");
        },
        produtoIndisponivelEstoque() {
            return (this.produto.total_estoque <= 0 || this.produto.grade_quebrada) && 
                   this.produto.controlar_estoque == "1" && 
                   this.habilitarAviseMeQuandoChegar == "1";
        }
    },
    methods: {
        formatarPreco(valor) {
            if (typeof valor === "string") {
                valor = parseFloat(valor);
            }
            if (typeof valor === "number") {
                return valor.toFixed(2).replace(".", ",");
            }
            return "0,00";
        },
        isEmpty(obj) {
            if (!obj) return true;
            if (Array.isArray(obj)) return obj.length === 0;
            if (typeof obj === "object") return Object.keys(obj).length === 0;
            return false;
        },
        abrirProduto(event) {
            if (event && (event.ctrlKey || event.metaKey || event.which === 2)) {
                return true;
            }
            
            if (event) event.preventDefault();
            
            const modoExibicao = typeof configsLoja !== 'undefined' ? configsLoja.modoExibicaoProdutos : 'modal';
            
            if (modoExibicao !== 'modal') {
                window.location.href = this.linkProduto;
                return;
            }
            
            if (typeof abrirModalProdutoVue === "function") {
                abrirModalProdutoVue(this.produto);
                return;
            }
            
            window.location.href = this.linkProduto;
        },
        async curtirProduto() {
            if (!this.configsLoja?.clienteLogado && !this.configsLoja?.visitanteLogado) {
                if (typeof abrirModalLoginVisitante === 'function') {
                    abrirModalLoginVisitante();
                }
                return;
            }

            try {
                const formData = new FormData();
                formData.append('acao', 'curtir_produto');
                formData.append('produto_id', this.produto.id);

                const response = await fetch(this.configsLoja.urlCatalogo, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.sucesso == "1") {
                    // Curtiu o produto
                    this.produto.curtido = true;
                    this.produto.total_curtidas = data.total_curtidas || 0;

                    // Dispara evento de analytics
                    if (typeof facilZapEventos !== 'undefined' && facilZapEventos.curtirProduto) {
                        facilZapEventos.curtirProduto(this.produto.id);
                    }
                } else if (data.sucesso == "2") {
                    // Descurtiu o produto
                    this.produto.curtido = false;
                    this.produto.total_curtidas = data.total_curtidas || 0;
                } else {
                    // Erro
                    if (typeof showNotification2 === 'function' && data.erro) {
                        showNotification2(data.erro, 'error');
                    }
                }
            } catch (error) {
                console.error('Erro ao curtir produto:', error);
                if (typeof showNotification2 === 'function') {
                    showNotification2('Erro ao curtir produto', 'error');
                }
            }
        },
        perguntasProduto(event) {
            if (event) event.preventDefault();
            
            const dentroDoModal = typeof ProdutoDialogDrawerStore !== 'undefined' && ProdutoDialogDrawerStore.isOpen;
            
            if (dentroDoModal) {
                this.$nextTick(() => {
                    const comentariosSection = document.querySelector('.fz-produto-conteudo__comentarios');
                    if (comentariosSection) {
                        comentariosSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            } else {
                this.abrirProduto(event);
                
                setTimeout(() => {
                    const comentariosSection = document.querySelector('.fz-produto-conteudo__comentarios');
                    if (comentariosSection) {
                        comentariosSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 500);
            }
        },
        obterLinkCatalogo(path) {
            if (this.catalogoUrl && typeof this.catalogoUrl === "string") {
                return this.catalogoUrl.replace("{PATH}", path);
            }
            return path;
        },
        abrirModalSimulador() {
            if (typeof SimuladorParcelasStore !== 'undefined') {
                SimuladorParcelasStore.produto = this.produto;
                SimuladorParcelasStore.visible = true;
                return;
            }
            
            console.error('Simulador de parcelas não disponível.');
        },
        obterURLArquivos(imagem) {
            return `https://arquivos.facilzap.app.br/${imagem}`;
        },
        obterURLThumb(imagem) {
            return `https://facilzap.app.br/cdn-cgi/image/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp/https://arquivos.facilzap.app.br/${imagem}`;
        },
        handleImageError(event) {
            event.target.src = `https://assets.facilzap.app.br/sem_foto.png`;
        }
    }
};

// ============================================================================
// SUB-COMPONENTS
// ============================================================================


FZComponents.SimuladorParcelasMelhorDesconto = {
    components: {},
    mixins: [ProdutoBaseMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        simulacao: {
            type: Object,
            default: null
        },
        abrirModal: {
            type: Boolean,
            default: false
        },
        alinhamento: {
            type: String,
            default: "centro"
        }
    },
    template: `
    <div v-if="exibirSimulacao" class="fz-simulador-parcelas-desconto" :class="classAlinhamento" :style="abrirModal ? 'cursor:pointer' : ''" @click="abrirModal ? abrirModalSimulador() : null">
        ou
        <strong class="fz-simulador-parcelas-desconto__valor">R$ {{ formatarPreco(simulacao.melhor_desconto.valor) }}</strong> no 
        <img src="https://assets.facilzap.app.br/logo-pix-64.png" loading="lazy" class="fz-simulador-parcelas-desconto__icone-pix align-middle" style="width:18px;height:18px;" height="18" width="18" alt="Pix" />
        <b>PIX</b><br/>
        com 
        <span class="fz-simulador-parcelas-desconto__badge badge bg-success preco_promo_badge">{{ Math.floor(simulacao.melhor_desconto.desconto) }}% de desconto</span>
    </div>
    `,
    computed: {
        exibirSimulacao() {
            return this.simulacao && this.simulacao.exibir_simulador && this.simulacao.melhor_desconto && this.simulacao.melhor_desconto.desconto;
        },
        classAlinhamento() {
            const alinhamentos = {
                "centro": "text-center",
                "esquerda": "text-left",
                "direita": "text-right"
            };
            return alinhamentos[this.alinhamento] || "text-center";
        }
    }
};

FZComponents.SimuladorParcelasMelhorParcelamento = {
    components: {},
    mixins: [ProdutoBaseMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        simulacao: {
            type: Object,
            default: null
        },
        abrirModal: {
            type: Boolean,
            default: false
        },
        alinhamento: {
            type: String,
            default: "centro"
        }
    },
    template: `
    <div v-if="exibirSimulacao" class="fz-simulador-parcelas-parcelamento">
        <!-- Ícones dos métodos de pagamento -->
        <div class="fz-simulador-parcelas-parcelamento__icones mb-1 d-flex align-items-center" 
             :class="classAlinhamentoIcones"
             :style="abrirModal ? 'cursor:pointer' : ''"
             @click="abrirModal ? abrirModalSimulador() : null">
            <img v-if="metodosAceitosFormatados.includes('pix')" 
                 src="https://assets.facilzap.app.br/logo-pix-64.png" 
                 loading="lazy" 
                 class="fz-simulador-parcelas-parcelamento__icone"
                 style="width:22px;height:22px;" 
                 height="22" 
                 width="22" 
                 alt="Pix" />
            <img v-if="metodosAceitosFormatados.includes('cartao_credito')" 
                 src="https://assets.facilzap.app.br/logo-cartao-64.png" 
                 loading="lazy" 
                 class="fz-simulador-parcelas-parcelamento__icone"
                 style="width:28px;height:19px;" 
                 width="28" 
                 height="19" 
                 alt="Cartão de Crédito" />
            <img v-if="metodosAceitosFormatados.includes('boleto')" 
                 src="https://assets.facilzap.app.br/logo-boleto-48.png" 
                 loading="lazy" 
                 class="fz-simulador-parcelas-parcelamento__icone"
                 style="width:30px;height:18px;" 
                 width="30" 
                 height="18" 
                 alt="Boleto" />
            <i v-if="metodosAceitosFormatados.includes('outros') && metodosAceitosFormatados.length > 1" 
               class="fz-simulador-parcelas-parcelamento__icone-mais ti-plus f-16 text-success"></i>
        </div>

        <!-- Informações de parcelamento -->
        <div class="fz-simulador-parcelas-parcelamento__info" :class="classAlinhamentoIcones" :style="abrirModal ? 'cursor:pointer' : ''" @click="abrirModal ? abrirModalSimulador() : null">
            <strong>{{ simulacao.melhor_parcelamento.parcela }}x</strong> de 
            <strong>R$ {{ formatarPreco(simulacao.melhor_parcelamento.valor_parcela) }}</strong> 
            <strong v-if="simulacao.melhor_parcelamento.tipo_juros == 'sem_juros'">sem juros</strong>
            <template v-if="simulacao.melhor_parcelamento.id == 'cartao_credito'">
                no <strong>Cartão</strong>
            </template>
            <template v-else-if="simulacao.melhor_parcelamento.id == 'boleto'">
                no <strong>Boleto</strong>
            </template>
        </div>
    </div>
    `,
    computed: {
        exibirSimulacao() {
            return this.simulacao && this.simulacao.exibir_simulador && this.simulacao.melhor_parcelamento && this.simulacao.melhor_parcelamento.parcela;
        },
        classAlinhamentoIcones() {
            const alinhamentos = {
                "centro": "justify-content-center text-center",
                "esquerda": "justify-content-left text-left",
                "direita": "justify-content-end text-right",
                "modal": "justify-content-end justify-content-left"
            };
            return alinhamentos[this.alinhamento] || "justify-content-center";
        },
        metodosAceitosFormatados() {
            if (this.simulacao && this.simulacao.metodos_aceitos) {
                if (Array.isArray(this.simulacao.metodos_aceitos)) {
                    return this.simulacao.metodos_aceitos;
                }

                return Object.values(this.simulacao.metodos_aceitos);
            }

            return [];
        }
    }
};

FZComponents.ProdutoPreco = {
    components: {
        'fz-simulador-parcelas-melhor-desconto': FZComponents.SimuladorParcelasMelhorDesconto
    },
    mixins: [ProdutoBaseMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        somenteOrcamentos: {
            type: Boolean,
            default: false
        },
        precosRestritos: {
            type: Boolean,
            default: false
        },
        paginaLive: {
            type: Boolean,
            default: false
        },
        ativarSimuladorParcelas: {
            type: Boolean,
            default: false
        },
        alinhamento: {
            type: String,
            default: "centro",
            validator: (value) => ['centro', 'esquerda', 'direita', 'modal'].includes(value)
        }
    },
    computed: {
        isAlinhamentoModal() {
            return this.alinhamento === 'modal';
        },
        classContainer() {
            if (this.isAlinhamentoModal) {
                return 'fz-produto-preco--modal d-flex justify-content-between align-items-center';
            }
            return '';
        }
    },
    template: `
    <div v-if="!somenteOrcamentos && !precosRestritos" class="fz-produto-preco" :class="classContainer">
        <!-- Container de preços -->
        <div :class="isAlinhamentoModal ? 'fz-produto-preco__valores' : ''">
            <!-- Grade -->
            <template v-if="produto.grade && !isEmpty(produto.grade)">
                <p v-if="produto.preco_grade_desconto > 0" class="fz-produto-preco__antigo mb-0 preco_promo_antigo">
                    R$ {{ formatarPreco(produto.preco_grade_original) }}
                    <span class="fz-produto-preco__badge badge bg-success text-white ml-1 preco_promo_badge">
                        <i class="ti-arrow-down"></i> {{ produto.preco_grade_desconto }}%
                    </span>
                </p>
                <p class="fz-produto-preco__apartir mb-0 preco_produto_apartir">
                    R$ {{ formatarPreco(produto.preco_grade) }}
                </p>
                <p class="fz-produto-preco__apartir-texto mb-0 preco_produto_apartir_texto">
                    {{ produto.qtd_grade }} itens por grade
                </p>
            </template>
            
            <!-- Preço a partir de -->
            <template v-else-if="produto.precos_produto && produto.precos_produto.preco_a_partir && produto.precos_produto.preco_a_partir.ativado">
                <p class="fz-produto-preco__apartir-texto mb-0 preco_produto_apartir_texto">
                    a partir de
                    <span v-if="produto.precos_produto.preco_a_partir.promocional_desconto > 0" class="fz-produto-preco__badge badge bg-success text-white ml-1 preco_promo_badge">
                        <i class="ti-arrow-down"></i> {{ produto.precos_produto.preco_a_partir.promocional_desconto }}%
                    </span>
                </p>
                <p class="fz-produto-preco__apartir mb-0 preco_produto_apartir">
                    R$ {{ formatarPreco(produto.precos_produto.preco_a_partir.preco) }}
                </p>
            </template>
            
            <!-- Preço promocional -->
            <template v-else-if="produto.precos_produto && produto.precos_produto.promocional !== false && produto.precos_produto.promocional !== null">
                <p class="fz-produto-preco__antigo mb-0 preco_promo_antigo">
                    R$ {{ formatarPreco(produto.precos_produto.padrao) }}
                    <span v-if="produto.precos_produto.promocional_desconto > 0" class="fz-produto-preco__badge badge bg-success text-white ml-1 preco_promo_badge">
                        <i class="ti-arrow-down"></i> {{ produto.precos_produto.promocional_desconto }}%
                    </span>
                </p>
                <p class="fz-produto-preco__promocional mb-0 preco_promo">
                    R$ {{ formatarPreco(produto.precos_produto.promocional) }}
                </p>
            </template>
            
            <!-- Preço normal -->
            <template v-else>
                <p class="fz-produto-preco__normal mb-0 preco_normal">
                    R$ {{ formatarPreco(produto.precos_produto ? produto.precos_produto.padrao : 0) }}
                </p>
            </template>
        </div>

        <!-- Simulador de Parcelas - Melhor Desconto -->
        <fz-simulador-parcelas-melhor-desconto
            v-if="!paginaLive && !somenteOrcamentos && ativarSimuladorParcelas && !produto.venda_externa"
            :produto="produto"
            :simulacao="produto.simulacao_parcelas"
            :abrir-modal="false"
            :alinhamento="alinhamento"
            :class="isAlinhamentoModal ? 'fz-produto-preco__simulador' : 'px-1 pt-1 pb-1'"
        >
        </fz-simulador-parcelas-melhor-desconto>
    </div>
    `
};


FZComponents.ProdutoAcoes = {
    components: {
        'p-button': PrimeVue.Button
    },
    mixins: [ProdutoBaseMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        habilitarCurtidas: {
            type: Boolean,
            default: false
        },
        habilitarPerguntas: {
            type: Boolean,
            default: false
        },
        permitirCompartilharProduto: {
            type: Boolean,
            default: false
        },
        habilitarWhatsApp: {
            type: Boolean,
            default: false
        },
        linkWhatsApp: {
            type: String,
            default: null
        },
        size: {
            type: String,
            default: null
        }
    },
    mounted() {
        if (this.permitirCompartilharProduto) {
            this.$nextTick(() => {
                if (typeof a2a !== 'undefined') {
                    a2a.init('page', {
                        target: '.a2a_dd'
                    });
                }
            });
        }
    },
    template: `
    <div 
        v-if="habilitarCurtidas || habilitarPerguntas || permitirCompartilharProduto || habilitarWhatsApp"
        class="fz-produto-acoes d-flex justify-content-around align-items-center"
        style="flex-grow: 1;"
    >
        <!-- Curtir -->
        <p-button
            v-if="habilitarCurtidas" 
            :class="['fz-produto-acoes__curtir', 'curtir_produto_' + produto.id]"
            @click="curtirProduto"
            :icon="produto.curtido ? 'pi pi-heart-fill' : 'pi pi-heart'"
            :badge="produto.total_curtidas > 0 ? String(produto.total_curtidas) : null"
            :severity="produto.curtido ? 'danger' : 'primary'"
            variant="text"
            rounded
            :size="size"
            aria-label="Curtir produto">
        </p-button>

        <!-- Perguntas -->
        <p-button
            v-if="habilitarPerguntas" 
            class="fz-produto-acoes__perguntas"
            @click="perguntasProduto"
            icon="pi pi-comment"
            :badge="produto.total_perguntas > 0 ? String(produto.total_perguntas) : null"
            variant="text"
            rounded
            :size="size"
            aria-label="Perguntas sobre o produto">
        </p-button>

        <!-- Compartilhar -->
        <p-button
            v-if="permitirCompartilharProduto" 
            class="fz-produto-acoes__compartilhar a2a_dd"
            icon="pi pi-share-alt"
            variant="text"
            rounded
            aria-label="Compartilhar"
            :data-a2a-url="linkProduto"
            :data-a2a-title="produto.nome"
            :size="size"
            data-href="https://www.addtoany.com/share">
        </p-button>

        <!-- WhatsApp -->
        <p-button
            v-if="habilitarWhatsApp && linkWhatsApp" 
            class="fz-produto-acoes__whatsapp"
            icon="pi pi-whatsapp"
            variant="text"
            rounded
            severity="success"
            as="a"
            :href="linkWhatsApp"
            target="_blank"
            :size="size"
            aria-label="Falar no WhatsApp">
        </p-button>
    </div>
    `
};

FZComponents.ProdutoBotaoCompra = {
    components: {
        'p-button': PrimeVue.Button
    },
    mixins: [ProdutoBaseMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        textoBotao: {
            type: String,
            required: true
        },
        precosRestritos: {
            type: Boolean,
            default: false
        },
        paginaLive: {
            type: Boolean,
            default: false
        },
        habilitarAviseMeQuandoChegar: {
            type: Boolean,
            default: false
        },
    },
    methods: {
        handleClick(event) {
            this.$emit('click', event);
        }
    },
    template: `
    <div class="fz-produto-botao-compra">
        <!-- Venda externa -->
        <template v-if="produto.venda_externa">
            <p-button
                class="fz-produto-botao-compra__btn fz-produto-botao-compra__btn--externo w-100"
                :size="paginaLive ? 'small' : undefined"
                as="a"
                :href="produto.link_externo"
                target="_blank"
                severity="primary"
                :label="textoBotao"
                icon="pi pi-external-link"
                :aria-label="textoBotao"></p-button>
        </template>
        
        <!-- Preços restritos -->
        <template v-else-if="precosRestritos">
            <p-button
                class="fz-produto-botao-compra__btn fz-produto-botao-compra__btn--restrito w-100"
                :size="paginaLive ? 'small' : undefined"
                as="a"
                :href="linkLogin"
                severity="primary"
                :label="'Ver Preços'"
                icon="pi pi-lock"
                aria-label="Ver Preços">
            </p-button>
        </template>
        
        <!-- Produto indisponível - Avise-me -->
        <template v-else-if="produtoIndisponivelEstoque">
            <p-button
                class="fz-produto-botao-compra__btn fz-produto-botao-compra__btn--avise-me w-100"
                :size="paginaLive ? 'small' : undefined"
                as="a"
                :href="linkProduto"
                @click.prevent="handleClick"
                severity="primary"
                :label="'Avise-me'"
                icon="pi pi-bell">
            </p-button>
        </template>
        
        <!-- Ação padrão - Comprar -->
        <template v-else>
            <p-button
                class="fz-produto-botao-compra__btn fz-produto-botao-compra__btn--comprar w-100"
                :size="paginaLive ? 'small' : undefined"
                as="a"
                :href="linkProduto"
                @click.prevent="handleClick"
                severity="primary"
                :label="textoBotao"
                icon="pi pi-shopping-cart"
                aria-label="textoBotao">
            </p-button>
        </template>
    </div>
    `
};

FZComponents.VariacaoQuantidade = {
    components: {
        'p-inputnumber': PrimeVue.InputNumber
    },
    props: {
        modelValue: {
            type: Number,
            default: 0
        },
        min: {
            type: Number,
            default: 1
        },
        max: {
            type: Number,
            default: 999999
        },
        step: {
            type: Number,
            default: 1
        },
        disabled: {
            type: Boolean,
            default: false
        }
    },
    emits: ['update:modelValue'],
    data() {
        return {
            valorAnterior: 0
        };
    },
    computed: {
        quantidade: {
            get() {
                return this.modelValue;
            },
            set(value) {
                let novoValor = parseInt(value) || 0;
                novoValor = Math.max(this.min, Math.min(this.max, novoValor));
                
                if (novoValor !== this.valorAnterior) {
                    AudioManager.playClick();
                    this.valorAnterior = novoValor;
                }
                
                this.$emit('update:modelValue', novoValor);
            }
        }
    },
    mounted() {
        this.valorAnterior = this.modelValue;
    },
    template: `
    <p-inputnumber 
        v-model="quantidade"
        :min="min"
        :max="max"
        :step="step"
        :disabled="disabled"
        size="small"
        show-buttons
        button-layout="horizontal"
        fluid
        input-class="text-center"
        style="max-width: 200px;"
    >
        <template #incrementicon>
            <i class="ti-plus"></i>
        </template>
        <template #decrementicon>
            <i class="ti-minus"></i>
        </template>
    </p-inputnumber>
    `
};

FZComponents.VariacaoSemVariacao = {
    components: {
        'p-divider': PrimeVue.Divider,
        'p-button': PrimeVue.Button,
        'p-tag': PrimeVue.Tag,
        'fz-variacao-quantidade': FZComponents.VariacaoQuantidade
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        catalogoId: {
            type: [String, Number],
            required: true
        },
        carrinho: {
            type: Object,
            default: () => ({})
        },
        exibirSku: {
            type: Boolean,
            default: true
        },
        exibirDescontos: {
            type: Boolean,
            default: true
        }
    },
    data() {
        return {
            quantidade: 0
        };
    },
    computed: {
        qtdMinima() {
            const catalogoId = this.catalogoId;
            return parseInt(this.produto.qtds_minimas?.[catalogoId]?.[0]) || 0;
        },
        qtdMaxima() {
            const catalogoId = this.catalogoId;
            const max = parseInt(this.produto.qtds_maximas?.[catalogoId]?.[0]) || 0;
            const estoque = parseInt(this.produto.estoque?.[0]) || parseInt(this.produto.total_estoque) || 0;
            
            if (this.produto.controlar_estoque == '1' && estoque > 0) {
                if (max > 0) {
                    return Math.min(max, estoque);
                }
                return estoque;
            }
            return max || 999999;
        },
        produtoDisponivel() {
            if (this.produto.controlar_estoque !== "1") return true;
            const estoque = parseInt(this.produto.estoque?.[0]) || parseInt(this.produto.total_estoque) || 0;
            return estoque > 0;
        },
        multiplicador() {
            return parseInt(this.produto.multiplicador?.padrao?.[0]) || 1;
        },
        estoqueAtual() {
            return parseInt(this.produto.estoque?.[0]) || parseInt(this.produto.total_estoque) || 0;
        },
        max2() {
            return this.produto.controlar_estoque == '1' ? this.estoqueAtual : 0;
        },
        temDesconto() {
            if (!this.exibirDescontos) return false;
            
            // Verifica regras de desconto da categoria
            if (!this.isEmpty(this.produto.regras_desconto)) {
                return true;
            }
            
            // Verifica regras de preço do produto
            if (!this.isEmpty(this.produto.precos_produto?.regras_precos?.[0])) {
                const regrasPrecos = this.produto.precos_produto.regras_precos[0];
                const dataAtual = Date.now() / 1000;
                
                for (const regra of Object.values(regrasPrecos)) {
                    let regraAtiva = true;
                    
                    if (regra.data_inicio) {
                        const inicio = new Date(regra.data_inicio.split('/').reverse().join('-')).getTime() / 1000;
                        if (dataAtual < inicio) regraAtiva = false;
                    }
                    
                    if (regra.data_termino) {
                        const termino = new Date(regra.data_termino.split('/').reverse().join('-')).getTime() / 1000 + 86399;
                        if (dataAtual > termino) regraAtiva = false;
                    }
                    
                    if (regraAtiva) return true;
                }
            }
            
            return false;
        },
        mostrarSku() {
            return this.exibirSku && 
                   this.configsLoja.mostrarCodigoReferenciaProduto && 
                   (this.isEmpty(this.produto.disponibilidade) || !this.configsLoja.exibirSkuVariacoes) && 
                   this.produto.sku;
        }
    },
    mounted() {
        const qtdCarrinho = parseInt(this.carrinho[this.produto.id]?.[0]) || 0;
        this.quantidade = qtdCarrinho;
        
        AudioManager.init(this.configsLoja);
    },
    watch: {
        carrinho: {
            handler(newVal) {
                const qtdCarrinho = parseInt(newVal[this.produto.id]?.[0]) || 0;
                if (this.quantidade !== qtdCarrinho) {
                    this.quantidade = qtdCarrinho;
                }
            },
            deep: true
        },
        quantidade(newVal, oldVal) {
            
            this.conteudoStore.quantidadesSelecionadas[this.produto.id] = {
                0: newVal
            };
            
            const resultado = CarrinhoManager.validarQuantidade(
                newVal,
                this.qtdMinima,
                this.qtdMaxima,
                this.max2,
                this.multiplicador
            );
            
            if (resultado.valor !== newVal) {
                this.quantidade = resultado.valor;
                
                if (resultado.atingiuMaximo) {
                    CarrinhoManager.notificarMaximo(resultado.maxDefinido);
                }
                return;
            }
            
            if (newVal !== oldVal && oldVal !== undefined) {
                CarrinhoManager.atualizarQuantidade(
                    this.produto.id,
                    0,
                    newVal,
                    this.produto.nome,
                    this.produto.preco,
                    this.configsLoja
                );
            }
        }
    },
    methods: {
        abrirModalRegrasPrecos() {
            this.abrirDialogRegrasPrecos(this.produto, 0);
        },
        exibirNotificacaoEstoque() {
            if (typeof showNotification === 'function') {
                showNotification('Quantidade disponível em estoque', '', 'info');
            }
        }
    },
    template: `
    <div class="fz-produto-conteudo__variacao-simples">
        <div v-if="!produtoDisponivel" class="fz-produto-conteudo__alerta fz-produto-conteudo__alerta--aviso alert alert-warning">
            <i class="ti-alert"></i> Produto indisponível no momento
        </div>
        <div v-else class="fz-produto-conteudo__variacao-simples-controle bloco-mensagem bloco-variacao w-100" style="box-shadow:0 0 0;border-top:1px solid #eee;margin-bottom: 0;">
            <div class="container-fluid pl-1">
                <div class="row align-items-center">
                    <label class="fz-produto-conteudo__quantidade-label col mb-0 text-center text-sm-left" style="font-weight: 500;">
                        <span class="fz-produto-conteudo__variacao-nome variacao_nome">Quantidade</span>
                        
                        <!-- Badge de Estoque -->
                        <p-tag 
                            v-if="configsLoja.mostrarQuantidadeEstoque && produto.controlar_estoque == '1'"
                            @click="exibirNotificacaoEstoque"
                            :value="estoqueAtual"
                            severity="secondary"
                            icon="pi pi-box"
                            class="fz-produto-conteudo__variacao-estoque-tag ml-1"
                            style="font-size: 12px; cursor: help;"
                        ></p-tag>
                        
                        <!-- Ícone de Desconto -->
                        <span 
                            v-if="temDesconto" 
                            class="fz-produto-conteudo__variacao-desconto fa-stack ml-1" 
                            style="cursor:pointer;font-size: 14px;" 
                            @click="abrirModalRegrasPrecos">
                            <i class="fa fa-tag fa-stack-2x text-success"></i>
                            <i class="fa fa-percent fa-stack-1x fa-inverse" style="font-size: 0.8em;"></i>
                        </span>
                        
                        <!-- SKU do Produto -->
                        <div v-if="mostrarSku">
                            <p-tag 
                                :value="produto.sku"
                                severity="secondary"
                                icon="pi pi-hashtag"
                                class="fz-produto-conteudo__quantidade-sku-tag"
                                style="font-size: 0.75rem;"
                            ></p-tag>
                        </div>
                    </label>
                    
                    <div class="fz-produto-conteudo__quantidade-input input-group col mx-auto mt-0 mt-sm-0 mb-0" style="max-width: 135px;padding: 0;">
                        <fz-variacao-quantidade
                            v-model="quantidade"
                            :min="qtdMinima"
                            :max="qtdMaxima"
                            :step="multiplicador"
                            class="w-100"
                        ></fz-variacao-quantidade>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `
};

FZComponents.VariacaoComVariacao = {
    components: {
        'p-divider': PrimeVue.Divider,
        'p-button': PrimeVue.Button,
        'p-tag': PrimeVue.Tag,
        'p-image': PrimeVue.Image,
        'fz-variacao-quantidade': FZComponents.VariacaoQuantidade
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: { type: Object, required: true },
        catalogoId: { type: [String, Number], required: true },
        carrinho: { type: Object, default: () => ({}) },
        somenteOrcamentos: { type: Boolean, default: false },
        precosRestritos: { type: Boolean, default: false },
        exibirPreco: { type: Boolean, default: true },
        exibirSku: { type: Boolean, default: true },
        exibirDivisoria: { type: Boolean, default: true },
        exibirDescontos: { type: Boolean, default: true },
        videoAtivo: { type: Boolean, default: false }
    },
    data() {
        return { quantidades: {} };
    },
    computed: {
        variacoesDisponiveis() {
            const variacoes = [];
            if (!this.produto.variacoes) return variacoes;
            
            // Converter objeto para array se necessário
            const variacoesArray = Array.isArray(this.produto.variacoes) 
                ? this.produto.variacoes 
                : Object.values(this.produto.variacoes);
            
            for (const variacao of variacoesArray) {
                if (this.produto.disponibilidade?.[variacao.id] !== "1") continue;
                
                const estoque = parseInt(this.produto.estoque?.[variacao.id]) || 0;
                const qtdMinima = parseInt(this.produto.qtds_minimas?.[this.catalogoId]?.[variacao.id]) || 0;
                
                if (this.produto.controlar_estoque == '1' && (estoque <= 0 || estoque < qtdMinima)) continue;
                
                const qtdMaximaConfig = parseInt(this.produto.qtds_maximas?.[this.catalogoId]?.[variacao.id]) || 0;
                let qtdMaxima = qtdMaximaConfig;
                
                if (this.produto.controlar_estoque == '1' && estoque > 0) {
                    if (qtdMaximaConfig > 0) {
                        qtdMaxima = Math.min(qtdMaximaConfig, estoque);
                    } else {
                        qtdMaxima = estoque;
                    }
                } else if (qtdMaximaConfig === 0) {
                    qtdMaxima = 999999;
                }
                
                variacoes.push({
                    ...variacao,
                    estoque,
                    qtdMinima,
                    qtdMaxima,
                    multiplicador: parseInt(this.produto.multiplicador?.padrao?.[0]) || 1,
                    precoVariacao: this.obterPrecoVariacao(variacao.id),
                    temDesconto: this.verificarDescontoVariacao(variacao.id),
                    sku: this.produto.sku_variacoes?.[variacao.id] || '',
                    imagem: this.produto.imagens_variacoes?.[variacao.id] || null,
                    imagemConfig: this.produto.imagens_variacoes_configs?.[variacao.id] || {},
                    posicaoImagem: this.produto.posicao_imagem_variacao?.[variacao.id] || 0
                });
            }
            
            variacoes.sort((a, b) => {
                const ordemA = parseInt(a.ordem) || 0;
                const ordemB = parseInt(b.ordem) || 0;
                return ordemA - ordemB;
            });
            
            return variacoes;
        },
        temDescontoGeral() {
            return this.exibirDescontos && !this.isEmpty(this.produto.regras_desconto);
        },
        exibirPrecos() {
            return this.produto.precos_produto?.precos_variacoes !== false && !this.somenteOrcamentos && !this.precosRestritos && this.exibirPreco;
        }
    },
    mounted() {
        for (const variacao of this.variacoesDisponiveis) {
            this.quantidades[variacao.id] = parseInt(this.carrinho[this.produto.id]?.[variacao.id]) || 0;
        }
        
        AudioManager.init(this.configsLoja);
        
        // Watch individual para cada variação
        this.$nextTick(() => {
            for (const variacao of this.variacoesDisponiveis) {
                this.$watch(
                    () => this.quantidades[variacao.id],
                    (newVal, oldVal) => {
                        if (newVal === oldVal || oldVal === undefined) {
                            return;
                        }
                        
                        this.conteudoStore.quantidadesSelecionadas[this.produto.id] = {...this.quantidades};
                        
                        const max2 = this.produto.controlar_estoque == '1' ? variacao.estoque : 0;
                        
                        const resultado = CarrinhoManager.validarQuantidade(
                            newVal,
                            variacao.qtdMinima,
                            variacao.qtdMaxima,
                            max2,
                            variacao.multiplicador
                        );
                        
                        if (resultado.valor !== newVal) {
                            this.quantidades[variacao.id] = resultado.valor;
                            
                            if (resultado.atingiuMaximo) {
                                CarrinhoManager.notificarMaximo(resultado.maxDefinido);
                            }
                            return;
                        }
                        
                        CarrinhoManager.atualizarQuantidade(
                            this.produto.id,
                            variacao.id,
                            newVal,
                            this.produto.nome,
                            this.produto.preco,
                            this.configsLoja
                        );
                    }
                );
            }
        });
    },
    watch: {
        carrinho: {
            handler(newVal) {
                for (const variacao of this.variacoesDisponiveis) {
                    const qtdCarrinho = parseInt(newVal[this.produto.id]?.[variacao.id]) || 0;
                    if (this.quantidades[variacao.id] !== qtdCarrinho) {
                        this.quantidades[variacao.id] = qtdCarrinho;
                    }
                }
            },
            deep: true
        },
        quantidades: {
            handler(newVal) {
                this.conteudoStore.quantidadesSelecionadas[this.produto.id] = {...newVal};
            },
            deep: true
        }
    },
    methods: {
        obterPrecoVariacao(variacaoId) {
            return this.produto.precos_produto?.variacoes?.[variacaoId] || this.produto.precos_produto || {};
        },
        verificarDescontoVariacao(variacaoId) {
            if (!this.exibirDescontos) return false;
            const regrasPrecos = this.produto.precos_produto?.regras_precos?.[variacaoId];
            if (!regrasPrecos) return false;
            const dataAtual = Date.now() / 1000;
            for (const regra of Object.values(regrasPrecos)) {
                let regraAtiva = true;
                if (regra.data_inicio) {
                    const inicio = new Date(regra.data_inicio.split('/').reverse().join('-')).getTime() / 1000;
                    if (dataAtual < inicio) regraAtiva = false;
                }
                if (regra.data_termino) {
                    const termino = new Date(regra.data_termino.split('/').reverse().join('-')).getTime() / 1000 + 86399;
                    if (dataAtual > termino) regraAtiva = false;
                }
                if (regraAtiva) return true;
            }
            return false;
        },
        irParaImagem(posicao) {
            ProdutoConteudoMixin.methods.irParaImagem.call(this, posicao - 1, this.produto.id, this.videoAtivo ? 1 : 0);
        },
        abrirModalRegrasPrecos(variacaoId) {
            this.abrirDialogRegrasPrecos(this.produto, variacaoId);
        },
        exibirNotificacaoEstoque(estoque) {
            showNotification('Quantidade disponível em estoque', `Existem ${estoque} unidades disponíveis.`, 'info');
        }
    },
    template: `
    <div class="fz-produto-conteudo__variacoes">
        <p-divider v-if="exibirDivisoria" align="left" type="solid" class="fz-produto-conteudo__divisoria">
            <b>Escolha as Variações</b>
        </p-divider>

        <div v-for="variacao in variacoesDisponiveis" :key="variacao.id" class="fz-produto-conteudo__variacao">
            <div class="fz-produto-conteudo__variacao-bloco bloco-mensagem bloco-variacao w-100" style="box-shadow:0 0 0;border-top:1px solid #eee;margin-bottom: 0;">
                <div class="container-fluid px-1"><div class="row align-items-center">
                    <div :class="exibirPrecos ? 'col mb-0 text-left' : 'col mb-0 text-left'" :style="exibirPrecos ? '' : 'font-weight: 500;'">
                        <p-image 
                            v-if="variacao.imagem" 
                            :id="'img-variacao-'+produto.id+'-'+variacao.id" 
                            :src="obterURLArquivos(variacao.imagem)" 
                            preview 
                            image-class="fz-produto-conteudo__variacao-imagem img-30 align-middle mr-1 img-variacoes" 
                            :image-style="{ cursor: 'pointer' }" 
                            @error="handleImageError"
                            :pt="{ root: { style: 'display: inline-block; vertical-align: middle; margin-right: 0.25rem;' } }"
                        >
                            <template #previewicon>
                                <span></span>
                            </template>
                        </p-image>
                        <div class="fz-produto-conteudo__variacao-info d-inline-block align-middle">
                            <span :style="exibirPrecos ? 'font-weight: 500;' : ''">
                                <i v-if="variacao.cor" class="fz-produto-conteudo__variacao-cor mr-1" :style="'color:'+variacao.cor+';background: '+variacao.cor+';'"></i>
                                <span class="fz-produto-conteudo__variacao-nome variacao_nome">{{ variacao.nome }}</span>
                                <span v-if="temDescontoGeral" class="fz-produto-conteudo__variacao-desconto fa-stack ml-1" style="cursor:pointer;font-size: 14px;" @click="abrirModalRegrasPrecos(0)"><i class="fa fa-tag fa-stack-2x text-success"></i><i class="fa fa-percent fa-stack-1x fa-inverse" style="font-size: 0.8em;"></i></span>
                                <span v-else-if="variacao.temDesconto" class="fz-produto-conteudo__variacao-desconto fa-stack ml-1" style="cursor:pointer;font-size: 14px;" @click="abrirModalRegrasPrecos(variacao.id)"><i class="fa fa-tag fa-stack-2x text-success"></i><i class="fa fa-percent fa-stack-1x fa-inverse" style="font-size: 0.8em;"></i></span>

                                <p-tag 
                                    v-if="configsLoja.mostrarQuantidadeEstoque && produto.controlar_estoque == '1'"
                                    @click="exibirNotificacaoEstoque(variacao.estoque)"
                                    :value="variacao.estoque"
                                    severity="secondary"
                                    icon="pi pi-box"
                                    class="fz-produto-conteudo__variacao-estoque-tag ml-1"
                                ></p-tag>
                            </span>
                            <template v-if="exibirPrecos"><br/>
                                <span class="fz-produto-conteudo__variacao-preco">
                                    <template v-if="variacao.precoVariacao.promocional !== false && variacao.precoVariacao.promocional !== null">De: <del>R$ {{ formatarPreco(variacao.precoVariacao.padrao) }}</del><br/>Por: R$ {{ formatarPreco(variacao.precoVariacao.promocional) }}</template>
                                    <template v-else>R$ {{ formatarPreco(variacao.precoVariacao.padrao) }}</template>
                                </span>
                            </template>
                            <div v-if="exibirSku && configsLoja.mostrarCodigoReferenciaProduto && configsLoja.exibirSkuVariacoes && variacao.sku" class="mt-1">
                                <p-tag 
                                    :value="variacao.sku"
                                    severity="secondary"
                                    icon="pi pi-hashtag"
                                    class="fz-produto-conteudo__variacao-sku-tag"
                                    style="font-size: 0.75rem;"
                                ></p-tag>
                            </div>
                        </div>
                    </div>
                    <div class="fz-produto-conteudo__variacao-quantidade input-group col mx-auto mt-0 mt-sm-0 mb-0" style="max-width: 135px;padding: 0;">
                        <fz-variacao-quantidade v-model="quantidades[variacao.id]" :min="variacao.qtdMinima" :max="variacao.qtdMaxima" :step="variacao.multiplicador" class="w-100"></fz-variacao-quantidade>
                    </div>
                </div></div>
            </div>
        </div>
    </div>`
};

FZComponents.VariacaoComSubgruposVariacao = {
    components: {
        'p-divider': PrimeVue.Divider,
        'p-tabs': PrimeVue.Tabs,
        'p-tablist': PrimeVue.TabList,
        'p-tab': PrimeVue.Tab,
        'p-tabpanels': PrimeVue.TabPanels,
        'p-tabpanel': PrimeVue.TabPanel,
        'p-button': PrimeVue.Button,
        'p-tag': PrimeVue.Tag,
        'p-image': PrimeVue.Image,
        'fz-variacao-quantidade': FZComponents.VariacaoQuantidade
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: { type: Object, required: true },
        catalogoId: { type: [String, Number], required: true },
        carrinho: { type: Object, default: () => ({}) },
        somenteOrcamentos: { type: Boolean, default: false },
        precosRestritos: { type: Boolean, default: false },
        exibirPreco: { type: Boolean, default: true },
        exibirSku: { type: Boolean, default: true },
        exibirDivisoria: { type: Boolean, default: true },
        exibirDescontos: { type: Boolean, default: true },
        videoAtivo: { type: Boolean, default: false },
        variacoesIsoladas: { type: Boolean, default: true }
    },
    data() {
        return {
            quantidades: {},
            activeTab: '0'
        };
    },
    computed: {
        subgruposDisponiveis() {
            const subgrupos = [];
            if (!this.produto.subgrupos_variacoes) return subgrupos;
            
            let subgrupoId = 1;
            for (const [nomeSubgrupo, variacoes] of Object.entries(this.produto.subgrupos_variacoes)) {
                const temVariacaoDisponivel = variacoes.some(v => {
                    if (this.produto.disponibilidade?.[v.id] != "1") return false;
                    const estoque = parseInt(this.produto.estoque?.[v.id]) || 0;
                    const qtdMinima = parseInt(this.produto.qtds_minimas?.[this.catalogoId]?.[v.id]) || 0;
                    if (this.produto.controlar_estoque == '1' && (estoque <= 0 || estoque < qtdMinima)) return false;
                    return true;
                });

                if (temVariacaoDisponivel) {
                    subgrupos.push({
                        id: subgrupoId,
                        nome: nomeSubgrupo,
                        cor: this.produto.subgrupos_variacoes_cores?.[nomeSubgrupo] || null,
                        variacoes: this.obterVariacoesSubgrupo(variacoes)
                    });
                }
                subgrupoId++;
            }
            
            return subgrupos;
        },
        temDescontoGeral() {
            return this.exibirDescontos && !this.isEmpty(this.produto.regras_desconto);
        },
        exibirPrecos() {
            return this.produto.precos_produto?.precos_variacoes !== false && !this.somenteOrcamentos && !this.precosRestritos && this.exibirPreco;
        },
        estiloBloco() {
            return (this.produto.total_disponibilidade > this.configsLoja.maxVariacoesMostrar || this.variacoesIsoladas === false) ? 'box-shadow:0 0 0;padding:0;margin-bottom: 0;' : '';
        }
    },
    mounted() {
        for (const subgrupo of this.subgruposDisponiveis) {
            for (const variacao of subgrupo.variacoes) {
                this.quantidades[variacao.id] = parseInt(this.carrinho[this.produto.id]?.[variacao.id]) || 0;
            }
        }
        
        AudioManager.init(this.configsLoja);
        
        this.$nextTick(() => {
            for (const subgrupo of this.subgruposDisponiveis) {
                for (const variacao of subgrupo.variacoes) {
                    this.$watch(
                        () => this.quantidades[variacao.id],
                        (newVal, oldVal) => {
                            if (newVal === oldVal || oldVal === undefined) {
                                return;
                            }
                            
                            this.conteudoStore.quantidadesSelecionadas[this.produto.id] = {...this.quantidades};
                            
                            const max2 = this.produto.controlar_estoque == '1' ? variacao.estoque : 0;
                            
                            const resultado = CarrinhoManager.validarQuantidade(
                                newVal,
                                variacao.qtdMinima,
                                variacao.qtdMaxima,
                                max2,
                                variacao.multiplicador
                            );
                            
                            if (resultado.valor !== newVal) {
                                this.quantidades[variacao.id] = resultado.valor;
                                
                                if (resultado.atingiuMaximo) {
                                    CarrinhoManager.notificarMaximo(resultado.maxDefinido);
                                }
                                return;
                            }
                            
                            CarrinhoManager.atualizarQuantidade(
                                this.produto.id,
                                variacao.id,
                                newVal,
                                this.produto.nome,
                                this.produto.preco,
                                this.configsLoja
                            );
                        }
                    );
                }
            }
        });
    },
    beforeUnmount() {
    },
    watch: {
        carrinho: {
            handler(newVal) {
                for (const subgrupo of this.subgruposDisponiveis) {
                    for (const variacao of subgrupo.variacoes) {
                        const qtdCarrinho = parseInt(newVal[this.produto.id]?.[variacao.id]) || 0;
                        if (this.quantidades[variacao.id] !== qtdCarrinho) {
                            this.quantidades[variacao.id] = qtdCarrinho;
                        }
                    }
                }
            },
            deep: true
        },
        quantidades: {
            handler(newVal) {
                this.conteudoStore.quantidadesSelecionadas[this.produto.id] = {...newVal};
            },
            deep: true
        }
    },
    methods: {
        obterVariacoesSubgrupo(variacoes) {
            const resultado = [];
            for (const variacao of variacoes) {
                if (this.produto.disponibilidade?.[variacao.id] != "1") continue;
                const estoque = parseInt(this.produto.estoque?.[variacao.id]) || 0;
                const qtdMinima = parseInt(this.produto.qtds_minimas?.[this.catalogoId]?.[variacao.id]) || 0;
                if (this.produto.controlar_estoque == '1' && (estoque <= 0 || estoque < qtdMinima)) continue;
                
                const qtdMaximaConfig = parseInt(this.produto.qtds_maximas?.[this.catalogoId]?.[variacao.id]) || 0;
                let qtdMaxima = qtdMaximaConfig;
                
                if (this.produto.controlar_estoque == '1' && estoque > 0) {
                    if (qtdMaximaConfig > 0) {
                        qtdMaxima = Math.min(qtdMaximaConfig, estoque);
                    } else {
                        qtdMaxima = estoque;
                    }
                } else if (qtdMaximaConfig === 0) {
                    qtdMaxima = 999999;
                }
                
                resultado.push({
                    ...variacao,
                    estoque,
                    qtdMinima,
                    qtdMaxima,
                    multiplicador: parseInt(this.produto.multiplicador?.padrao?.[0]) || 1,
                    precoVariacao: this.obterPrecoVariacao(variacao.id),
                    temDesconto: this.verificarDescontoVariacao(variacao.id),
                    sku: this.produto.sku_variacoes?.[variacao.id] || '',
                    imagem: this.produto.imagens_variacoes?.[variacao.id] || null,
                    imagemConfig: this.produto.imagens_variacoes_configs?.[variacao.id] || {},
                    posicaoImagem: this.produto.posicao_imagem_variacao?.[variacao.id] || 0
                });
            }
            
            resultado.sort((a, b) => {
                const ordemA = parseInt(a.ordem) || 0;
                const ordemB = parseInt(b.ordem) || 0;
                return ordemA - ordemB;
            });
            
            return resultado;
        },
        obterPrecoVariacao(variacaoId) {
            return this.produto.precos_produto?.variacoes?.[variacaoId] || this.produto.precos_produto || {};
        },
        verificarDescontoVariacao(variacaoId) {
            if (!this.exibirDescontos) return false;
            const regrasPrecos = this.produto.precos_produto?.regras_precos?.[variacaoId];
            if (!regrasPrecos) return false;
            const dataAtual = Date.now() / 1000;
            // Converter objeto para array se necessário
            const regrasArray = Array.isArray(regrasPrecos) ? regrasPrecos : Object.values(regrasPrecos);
            for (const regra of regrasArray) {
                let regraAtiva = true;
                if (regra.data_inicio) {
                    const inicio = new Date(regra.data_inicio.split('/').reverse().join('-') + ' 00:00:00').getTime() / 1000;
                    if (dataAtual < inicio) regraAtiva = false;
                }
                if (regra.data_termino) {
                    const termino = new Date(regra.data_termino.split('/').reverse().join('-') + ' 23:59:59').getTime() / 1000;
                    if (dataAtual > termino) regraAtiva = false;
                }
                if (regraAtiva) return true;
            }
            return false;
        },
        irParaImagem(posicao) {
            ProdutoConteudoMixin.methods.irParaImagem.call(this, posicao - 1, this.produto.id, this.videoAtivo ? 1 : 0);
        },
        abrirModalRegrasPrecos(variacaoId) {
            this.abrirDialogRegrasPrecos(this.produto, variacaoId || 0);
        },
        exibirNotificacaoEstoque(estoque) {
            showNotification('Quantidade disponível em estoque', `Existem ${estoque} unidades disponíveis.`, 'info');
        }
    },
    template: `
    <div class="fz-produto-conteudo__subgrupos">
        <p-divider v-if="exibirDivisoria" align="left" type="solid" class="fz-produto-conteudo__divisoria">
            <b>Escolha as Variações</b>
        </p-divider>

        <p-tabs v-model:value="activeTab" scrollable class="fz-produto-conteudo__subgrupos-tabs">
            <p-tablist>
                <p-tab v-for="(subgrupo, index) in subgruposDisponiveis" :key="subgrupo.id" :value="String(index)">
                    <i v-if="subgrupo.cor" class="fz-produto-conteudo__subgrupo-cor mr-1" :style="'color:'+subgrupo.cor+';background: '+subgrupo.cor+';'"></i>
                    <span class="fz-produto-conteudo__subgrupo-nome">{{ subgrupo.nome }}</span>
                </p-tab>
            </p-tablist>
            <p-tabpanels>
                <p-tabpanel v-for="(subgrupo, index) in subgruposDisponiveis" :key="subgrupo.id" :value="String(index)">
                    <div class="fz-produto-conteudo__subgrupo-variacoes">
                        <div v-for="variacao in subgrupo.variacoes" :key="variacao.id" class="fz-produto-conteudo__variacao row">
                            <div class="fz-produto-conteudo__variacao-bloco bloco-mensagem bloco-variacao w-100" :style="(produto.total_disponibilidade > configsLoja.maxVariacoesMostrar || variacoesIsoladas === false)?'box-shadow:0 0 0;border-top:1px solid #eee;margin-bottom: 0;':''">
                                <div class="container-fluid px-1"><div class="row align-items-center">
                                    <div class="col mb-0 text-left" :class="exibirPrecos ? '' : 'font-weight-500'">
                                        <p-image 
                                            v-if="variacao.imagem" 
                                            :id="'img-variacao-'+produto.id+'-'+variacao.id" 
                                            :src="obterURLArquivos(variacao.imagem)" 
                                            preview 
                                            image-class="fz-produto-conteudo__variacao-imagem img-30 align-middle mr-1 img-variacoes" 
                                            :image-style="{ cursor: 'pointer' }" 
                                            @error="handleImageError"
                                            :pt="{ root: { style: 'display: inline-block; vertical-align: middle; margin-right: 0.25rem;' } }"
                                        >
                                            <template #previewicon><span></span></template>
                                        </p-image>
                                        <div class="fz-produto-conteudo__variacao-info d-inline-block align-middle">
                                            <span :class="exibirPrecos ? 'font-weight-500' : ''">
                                                <i v-if="variacao.cor" class="fz-produto-conteudo__variacao-cor mr-1" :style="'color:'+variacao.cor+';background: '+variacao.cor+';'"></i>
                                                <span class="fz-produto-conteudo__variacao-nome variacao_nome">{{ variacao.nome_tratado || variacao.nome }}</span>
                                                <span v-if="temDescontoGeral" class="fz-produto-conteudo__variacao-desconto fa-stack ml-1" style="cursor:pointer;font-size: 14px;" @click="abrirModalRegrasPrecos(0)"><i class="fa fa-tag fa-stack-2x text-success"></i><i class="fa fa-percent fa-stack-1x fa-inverse" style="font-size: 0.8em;"></i></span>
                                                <span v-else-if="variacao.temDesconto" class="fz-produto-conteudo__variacao-desconto fa-stack ml-1" style="cursor:pointer;font-size: 14px;" @click="abrirModalRegrasPrecos(variacao.id)"><i class="fa fa-tag fa-stack-2x text-success"></i><i class="fa fa-percent fa-stack-1x fa-inverse" style="font-size: 0.8em;"></i></span>

                                                <p-tag 
                                                    v-if="configsLoja.mostrarQuantidadeEstoque && produto.controlar_estoque == '1'"
                                                    @click="exibirNotificacaoEstoque(variacao.estoque)"
                                                    :value="variacao.estoque"
                                                    severity="secondary"
                                                    icon="pi pi-box"
                                                    class="fz-produto-conteudo__variacao-estoque-tag ml-1"
                                                ></p-tag>
                                            </span>
                                            <template v-if="exibirPrecos"><br/>
                                                <span class="fz-produto-conteudo__variacao-preco">
                                                    <template v-if="variacao.precoVariacao.promocional !== false && variacao.precoVariacao.promocional !== null">De: <del>R$ {{ formatarPreco(variacao.precoVariacao.padrao) }}</del><br/>Por: R$ {{ formatarPreco(variacao.precoVariacao.promocional) }}</template>
                                                    <template v-else>R$ {{ formatarPreco(variacao.precoVariacao.padrao) }}</template>
                                                </span>
                                            </template>
                                            <div v-if="exibirSku && configsLoja.mostrarCodigoReferenciaProduto && configsLoja.exibirSkuVariacoes && variacao.sku" class="mt-1">
                                                <p-tag 
                                                    :value="variacao.sku"
                                                    severity="secondary"
                                                    icon="pi pi-hashtag"
                                                    class="fz-produto-conteudo__variacao-sku-tag"
                                                    style="font-size: 0.75rem;"
                                                ></p-tag>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="fz-produto-conteudo__variacao-quantidade input-group col mx-auto mt-0 mt-sm-0 mb-0" style="max-width: 135px;padding: 0;">
                                        <fz-variacao-quantidade v-model="quantidades[variacao.id]" :min="variacao.qtdMinima" :max="variacao.qtdMaxima" :step="variacao.multiplicador" class="w-100"></fz-variacao-quantidade>
                                    </div>
                                </div></div>
                            </div>
                        </div>
                    </div>
                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>
    </div>`
};

FZComponents.VariacaoComGrade = {
    components: {
        'p-divider': PrimeVue.Divider,
        'p-button': PrimeVue.Button,
        'p-tag': PrimeVue.Tag,
        'p-inputnumber': PrimeVue.InputNumber,
        'p-image': PrimeVue.Image,
        'fz-variacao-quantidade': FZComponents.VariacaoQuantidade
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: { type: Object, required: true },
        catalogoId: { type: [String, Number], required: true },
        carrinho: { type: Object, default: () => ({}) },
        exibirSku: { type: Boolean, default: true },
        exibirDescontos: { type: Boolean, default: true },
        videoAtivo: { type: Boolean, default: false },
        variacoesIsoladas: { type: Boolean, default: true }
    },
    data() {
        return { quantidadeGrade: 0 };
    },
    computed: {
        composicaoGrade() {
            const composicao = [];
            if (!this.produto.variacoes) return composicao;
            
            // Converter objeto para array se necessário
            const variacoesArray = Array.isArray(this.produto.variacoes) 
                ? this.produto.variacoes 
                : Object.values(this.produto.variacoes);
            
            for (const variacao of variacoesArray) {
                const qtdGrade = parseInt(this.produto.grade?.[variacao.id]) || 0;
                if (qtdGrade > 0 && this.produto.disponibilidade?.[variacao.id] == '1') {
                    composicao.push({
                        ...variacao,
                        qtdGrade,
                        imagem: this.produto.imagens_variacoes?.[variacao.id] || null,
                        posicaoImagem: this.produto.posicao_imagem_variacao?.[variacao.id] || 0
                    });
                }
            }
            
            composicao.sort((a, b) => {
                const ordemA = parseInt(a.ordem) || 0;
                const ordemB = parseInt(b.ordem) || 0;
                return ordemA - ordemB;
            });
            
            return composicao;
        },
        maxGrade() {
            return this.produto.controlar_estoque == '1' ? (parseInt(this.produto.estoque?.grade) || 0) : 999999;
        },
        temDesconto() {
            return this.exibirDescontos && !this.isEmpty(this.produto.regras_desconto);
        },
        estiloBloco() {
            return this.variacoesIsoladas ? '' : 'box-shadow:0 0 0;border-top:1px solid #eee;margin-bottom: 0;';
        }
    },
    mounted() {
        this.quantidadeGrade = parseInt(this.carrinho[this.produto.id]?.grade) || 0;
        
        AudioManager.init(this.configsLoja);
    },
    watch: {
        quantidadeGrade(newVal, oldVal) {
            this.conteudoStore.quantidadesSelecionadas[this.produto.id] = { grade: newVal };
            
            if (oldVal === undefined) return;
            
            const resultado = CarrinhoManager.validarQuantidade(
                newVal,
                0,
                this.maxGrade,
                0,
                1
            );
            
            if (resultado.valor !== newVal) {
                this.quantidadeGrade = resultado.valor;
                
                if (resultado.atingiuMaximo) {
                    CarrinhoManager.notificarMaximo(resultado.maxDefinido);
                }
                return;
            }
            
            CarrinhoManager.atualizarQuantidade(
                this.produto.id,
                'grade',
                newVal,
                this.produto.nome,
                this.produto.preco,
                this.configsLoja
            );
        }
    },
    methods: {
        irParaImagem(posicao) {
            ProdutoConteudoMixin.methods.irParaImagem.call(this, posicao - 1, this.produto.id, this.videoAtivo ? 1 : 0);
        },
        abrirModalRegrasPrecos() {
            this.abrirDialogRegrasPrecos(this.produto, 0);
        },
        mostrarInfoGrade() {
            if (typeof showNotification === 'function') {
                showNotification('Venda em Grade', 'Para você comprar este produto, você precisa comprar a grade completa composta por uma quantidade fixa de cada variação do produto.', 'info');
            }
        }
    },
    template: `
    <div class="fz-produto-conteudo__grade">
        <div class="fz-produto-conteudo__grade-controle  bloco-variacao w-100" :style="estiloBloco"><div class="container-fluid pl-1"><div class="row align-items-center">
            <label class="fz-produto-conteudo__grade-label col mb-0 text-center text-sm-left" style="font-weight: 500;">
                <span class="fz-produto-conteudo__grade-titulo" style="cursor: help;" @click="mostrarInfoGrade">
                    <i class="fz-produto-conteudo__grade-icone ti-layout-grid2 mr-1 align-middle"></i> 
                    <span class="fz-produto-conteudo__grade-nome variacao_nome">Grade</span>
                    <i class="fa fa-question-circle text-info mr-1 p-1" style="font-size: 18px;"></i>
                </span>
                <span v-if="temDesconto" class="fz-produto-conteudo__grade-desconto fa-stack ml-1" style="cursor:pointer;font-size: 14px;" @click="abrirModalRegrasPrecos"><i class="fa fa-tag fa-stack-2x text-success"></i><i class="fa fa-percent fa-stack-1x fa-inverse" style="font-size: 0.8em;"></i></span>
                <div v-if="exibirSku && produto.sku" class="mt-1">
                    <p-tag 
                        :value="produto.sku"
                        severity="secondary"
                        icon="pi pi-hashtag"
                        class="fz-produto-conteudo__grade-sku-tag"
                        style="font-size: 0.75rem;"
                    ></p-tag>
                </div>
            </label>
            <div class="fz-produto-conteudo__grade-quantidade input-group col mx-auto mt-0 mt-sm-0 mb-0" style="max-width: 135px;padding: 0;">
                <fz-variacao-quantidade v-model="quantidadeGrade" :min="0" :max="maxGrade" :step="1" class="w-100"></fz-variacao-quantidade>
            </div>
        </div></div></div>

        <p-divider align="left" type="solid" class="fz-produto-conteudo__divisoria" @click="mostrarInfoGrade" style="cursor: help;">
            <b>Composição da Grade</b> <i class="fa fa-question-circle text-info" style="font-size: 18px;vertical-align: middle;"></i>
        </p-divider>

        <table class="fz-produto-conteudo__grade-tabela table table-bordered table-sm text-center mb-0" :style="estiloBloco">
            <tbody>
                <tr class="fz-produto-conteudo__grade-tabela-cabecalho">
                    <td class="px-2 py-1 w-50" style="font-weight: 500;">Variação</td>
                    <td class="px-2 py-1 w-50" style="font-weight: 500;">Qtd. por Grade</td>
                </tr>
                <tr v-for="variacao in composicaoGrade" :key="variacao.id" class="fz-produto-conteudo__grade-variacao">
                    <td class="fz-produto-conteudo__grade-variacao-info px-2 py-1 text-left">
                        <p-image v-if="variacao.imagem" :id="'img-variacao-'+produto.id+'-'+variacao.id" :src="obterURLArquivos(variacao.imagem)" preview image-class="fz-produto-conteudo__grade-variacao-imagem img-30 align-middle mr-1 img-variacoes" :image-style="{ cursor: 'pointer' }" @error="handleImageError" :pt="{ root: { style: 'display: inline-block; vertical-align: middle; margin-right: 0.25rem;' } }"><template #previewicon><span></span></template></p-image>
                        <i v-if="variacao.cor" class="fz-produto-conteudo__grade-variacao-cor mr-1" :style="'color:'+variacao.cor+';background: '+variacao.cor+';'"></i>
                        <span class="fz-produto-conteudo__grade-variacao-nome">{{ variacao.nome }}</span>
                    </td>
                    <td class="fz-produto-conteudo__grade-variacao-qtd px-2 py-1">{{ variacao.qtdGrade }}</td>
                </tr>
            </tbody>
        </table>
    </div>`
};


FZComponents.ProdutoSkeleton = {
    components: {
        'p-skeleton': PrimeVue.Skeleton
    },
    template: `
    <div class="fz-produto-skeleton px-2" style="margin-bottom: 5px !important;">
        <div class="container-fluid">
            <div class="row">
                <div class="fz-produto-skeleton__card bloco-mensagem w-100 p-0" style="box-shadow: rgb(0 0 0 / 12%) 0px 4px 7px;">
                    
                    <!-- Imagem Skeleton -->
                    <div class="fz-produto-skeleton__imagem p-2" style="border-bottom: 1px solid #ebebeb;">
                        <p-skeleton width="100%" height="200px" class="mx-auto"></p-skeleton>
                    </div>

                    <!-- Título Skeleton -->
                    <div class="fz-produto-skeleton__titulo px-2 pt-2 pb-2 text-center">
                        <p-skeleton width="80%" height="1.2rem" class="mb-2 mx-auto"></p-skeleton>
                        <p-skeleton width="60%" height="1rem" class="mx-auto"></p-skeleton>
                    </div>

                    <!-- Preço Skeleton -->
                    <div class="fz-produto-skeleton__preco px-3 pt-1 pb-2 text-center">
                        <p-skeleton width="50%" height="1.5rem" class="mb-2 mx-auto"></p-skeleton>
                        <p-skeleton width="70%" height="1rem" class="mx-auto"></p-skeleton>
                    </div>

                    <!-- Botão Skeleton -->
                    <div class="fz-produto-skeleton__botao px-2 pt-2 pb-2 text-center">
                        <p-skeleton width="100%" height="2.5rem" borderRadius="4px" class="mx-auto"></p-skeleton>
                    </div>

                    <!-- Skeleton dos 3 botões circulares de curtir, compartilhar e comentar -->
                    <div class="fz-produto-skeleton__acoes d-flex justify-content-around px-2 py-2">
                        <p-skeleton width="36px" height="36px" borderRadius="50%"></p-skeleton>
                        <p-skeleton width="36px" height="36px" borderRadius="50%"></p-skeleton>
                        <p-skeleton width="36px" height="36px" borderRadius="50%"></p-skeleton>
                    </div>

                </div>
            </div>
        </div>
    </div>
    `
};

FZComponents.ProdutoSlider = {
    components: {},
    mixins: [ProdutoBaseMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        ocultarDestaque: {
            type: Boolean,
            default: false
        },
        prefixoSlider: {
            type: String,
            default: ""
        },
        habilitarAviseMeQuandoChegar: {
            type: Boolean,
            default: false
        },
        gridFormatoImagem: {
            type: String,
            default: "original"
        }
    },
    data() {
        return {
            swiperInstance: null
        };
    },
    computed: {
        produtoIndisponivel() {
            return this.produto.total_estoque <= 0 && this.produto.controlar_estoque == "1" && this.habilitarAviseMeQuandoChegar;
        },
        sliderId() {
            return (this.prefixoSlider || '') + 'slide_produto_' + this.produto.id;
        },
        temMultiplasImagens() {
            return this.produto.imagens && this.produto.imagens.length > 1;
        }
    },
    mounted() {
        if (this.temMultiplasImagens) {
            this.$nextTick(() => {
                this.initSwiper();
            });
        }
    },
    watch: {
        'produto.imagens': {
            handler(newValue) {
                if (newValue && newValue.length > 1) {
                    this.$nextTick(() => {
                        this.initSwiper();
                    });
                }
            },
            deep: true
        }
    },
    methods: {
        initSwiper() {
            if (typeof Swiper !== 'undefined' && this.temMultiplasImagens) {
                // Destrói instância anterior se existir
                if (this.swiperInstance && typeof this.swiperInstance.destroy === 'function') {
                    this.swiperInstance.destroy(true, true);
                }
                
                this.swiperInstance = new Swiper('#' + this.sliderId, {
                    slidesPerView: 1,
                    spaceBetween: 0,
                    observer: true,
                    observeSlideChildren: true,
                    touchAngle: 20,
                    autoHeight: true,
                    navigation: {
                        enabled: true,
                        nextEl: '#' + this.sliderId + ' .swiper-button-next',
                        prevEl: '#' + this.sliderId + ' .swiper-button-prev',
                    },
                    pagination: {
                        enabled: true,
                        el: '#' + this.sliderId + ' .swiper-pagination',
                        type: 'bullets',
                    },
                });
            }
        }
    },
    beforeUnmount() {
        // Limpa instância do Swiper ao desmontar
        if (this.swiperInstance && typeof this.swiperInstance.destroy === 'function') {
            this.swiperInstance.destroy(true, true);
        }
    },
    template: `
    <div class="fz-produto-slider">
        <span v-if="produtoIndisponivel" class="fz-produto-slider__badge fz-produto-slider__badge--indisponivel badge badge-secondary bg-success">
            Produto<br>indisponível
        </span>
        <span v-else-if="produto.comprado_recentemente" class="fz-produto-slider__badge fz-produto-slider__badge--recente badge badge-secondary bg-success">
            <i class="fa fa-star" aria-hidden="true"></i> Você comprou<br>recentemente
        </span>
        <span v-else-if="produto.destaque == '1' && !ocultarDestaque" class="fz-produto-slider__badge fz-produto-slider__badge--destaque badge badge-secondary bg-success">
            Destaque
        </span>

        <div v-if="temMultiplasImagens" class="fz-produto-slider__swiper slide_produtos swiper" :id="sliderId" :style="produtoIndisponivel ? 'opacity:0.4' : ''">
            <div class="swiper-wrapper">
                <div v-for="(imagem, index) in produto.imagens" :key="index" class="swiper-slide" style="cursor:pointer" @click="abrirProduto">
                    <img 
                        :src="obterURLThumb(imagem)"
                        class="fz-produto-slider__imagem img-fluid w-100"
                        :class="{
                            'square-image': gridFormatoImagem == 'square',
                            'rectangle-image': gridFormatoImagem != 'original' && gridFormatoImagem != 'square',
                        }"
                        loading="lazy"
                        @error="handleImageError"
                    />
                </div>
            </div>
            <div class="swiper-pagination d-block d-lg-none"></div>
            <div class="swiper-button-prev slider-produto d-none d-lg-flex"></div>
            <div class="swiper-button-next slider-produto d-none d-lg-flex"></div>
        </div>

        <a v-else :href="linkProduto" class="fz-produto-slider__link" :style="produtoIndisponivel ? 'opacity:0.4' : ''" style="cursor:pointer" @click="abrirProduto">
            <img 
                :src="obterURLThumb(produto.imagens[0])"
                class="fz-produto-slider__imagem img-fluid w-100"
                :class="{
                    'square-image': gridFormatoImagem == 'square',
                    'rectangle-image': gridFormatoImagem != 'original' && gridFormatoImagem != 'square',
                }"
                loading="lazy"
                @error="handleImageError"
            />
        </a>
    </div>
    `,
};

FZComponents.TagCampanhaPromocional = {
    components: {},
    mixins: [ProdutoBaseMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        campanhaPromocionalAtivaNoMomento: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosAtivada: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosTexto: {
            type: String,
            default: ""
        },
        campanhaPromocionalTagProdutosCorFundo: {
            type: String,
            default: "#28a745"
        },
        campanhaPromocionalTagProdutosCorTexto: {
            type: String,
            default: "#ffffff"
        }
    },
    template: `
    <div v-if="exibirTag" class="fz-tag-campanha-promocional px-2 py-1 text-center font-weight-bold" :style="estiloTag">
        {{ campanhaPromocionalTagProdutosTexto }}
    </div>
    `,
    computed: {
        exibirTag() {
            return this.campanhaPromocionalAtivaNoMomento &&
                   this.campanhaPromocionalTagProdutosAtivada &&
                   this.campanhaPromocionalTagProdutosTexto &&
                   this.produto.campanha_promocional == true;
        },
        estiloTag() {
            return {
                backgroundColor: this.campanhaPromocionalTagProdutosCorFundo || "#28a745",
                color: this.campanhaPromocionalTagProdutosCorTexto || "#ffffff"
            };
        }
    }
};


FZComponents.ProdutoGridNovo = {
    components: {
        'p-tag': PrimeVue.Tag,
        'fz-produto-slider': FZComponents.ProdutoSlider,
        'fz-tag-campanha-promocional': FZComponents.TagCampanhaPromocional,
        'fz-produto-preco': FZComponents.ProdutoPreco,
        'fz-produto-botao-compra': FZComponents.ProdutoBotaoCompra,
        'fz-simulador-parcelas-melhor-parcelamento': FZComponents.SimuladorParcelasMelhorParcelamento,
        'fz-produto-acoes': FZComponents.ProdutoAcoes
    },
    mixins: [ProdutoBaseMixin],
    props: {
        class: {
            type: String,
            default: ""
        },
        produto: {
            type: Object,
            required: true
        },
        prefixoSlider: {
            type: String,
            default: ""
        },
        precosRestritos: {
            type: Boolean,
            default: false
        },
        paginaLive: {
            type: Boolean,
            default: false
        },
        ocultarDestaque: {
            type: Boolean,
            default: false
        },
        somenteOrcamentos: {
            type: Boolean,
            default: false
        },
        mostrarQuantidadeVenda: {
            type: Boolean,
            default: false
        },
        habilitarCurtidas: {
            type: Boolean,
            default: false
        },
        habilitarPerguntas: {
            type: Boolean,
            default: false
        },
        permitirCompartilharProduto: {
            type: Boolean,
            default: false
        },
        ativarSimuladorParcelas: {
            type: Boolean,
            default: false
        },
        textoBotaoAcaoProdutos: {
            type: String,
            default: "Comprar"
        },
        habilitarAviseMeQuandoChegar: {
            type: Boolean,
            default: false
        },
        gridFormatoImagem: {
            type: String,
            default: "original"
        },
        campanhaPromocionalAtivaNoMomento: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosAtivada: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosTexto: {
            type: String,
            default: ""
        },
        campanhaPromocionalTagProdutosCorFundo: {
            type: String,
            default: "#28a745"
        },
        campanhaPromocionalTagProdutosCorTexto: {
            type: String,
            default: "#ffffff"
        }
    },
    template: `
    <div :class="['fz-produto', 'fz-produto--grid-novo', classe, 'px-2', 'produto_div_' + produto.id]" :id="'produto_div_' + produto.id" style="margin-bottom: 5px !important;">
        <div class="container-fluid">
            <div class="row">
                <div class="fz-produto__card bloco-mensagem w-100">

                    <div class="fz-produto__imagem-container p-2">
                        <fz-produto-slider
                            :produto="produto"
                            :prefixo-slider="prefixoSlider"
                            :ocultar-destaque="ocultarDestaque"
                            :habilitar-avise-me-quando-chegar="habilitarAviseMeQuandoChegar"
                            :grid-formato-imagem="gridFormatoImagem">
                        </fz-produto-slider>
                    </div>

                    <fz-tag-campanha-promocional
                        :produto="produto"
                        :campanha-promocional-ativa-no-momento="campanhaPromocionalAtivaNoMomento"
                        :campanha-promocional-tag-produtos-ativada="campanhaPromocionalTagProdutosAtivada"
                        :campanha-promocional-tag-produtos-texto="campanhaPromocionalTagProdutosTexto"
                        :campanha-promocional-tag-produtos-cor-fundo="campanhaPromocionalTagProdutosCorFundo"
                        :campanha-promocional-tag-produtos-cor-texto="campanhaPromocionalTagProdutosCorTexto">
                    </fz-tag-campanha-promocional>

                    <a class="fz-produto__titulo link-produto px-2 pt-2 pb-2 text-center cursor-pointer d-block" 
                       @click="abrirProduto"
                       :href="linkProduto">
                        {{ produto.nome }}
                    </a>

                    <a class="fz-produto__preco-link link-produto px-3 pt-1 pb-2 text-center cursor-pointer d-block" 
                       @click="abrirProduto"
                       :href="linkProduto">
                        <fz-produto-preco
                            :produto="produto"
                            :somente-orcamentos="somenteOrcamentos"
                            :precos-restritos="precosRestritos"
                            :pagina-live="paginaLive"
                            :ativar-simulador-parcelas="ativarSimuladorParcelas"
                            alinhamento="centro">
                        </fz-produto-preco>
                    </a>

                    <!-- Quantidade de vendas -->
                    <a v-if="mostrarQuantidadeVenda && produto.total_vendas > 0" 
                       class="fz-produto__vendas link-produto px-3 pt-0 pb-1 text-center cursor-pointer d-block"
                       @click="abrirProduto"
                       :href="linkProduto">
                        <p-tag 
                            :value="produto.total_vendas + (produto.total_vendas == 1 ? ' venda' : ' vendas')"
                            severity="secondary"
                            icon="pi pi-shopping-cart"
                            class="fz-produto__tag-vendas"
                        ></p-tag>
                    </a>

                    <!-- Botão de ação -->
                    <div class="fz-produto__botao-container text-center px-3" :class="paginaLive ? 'pt-0 pb-2' : 'pt-2 pb-0'">
                        <fz-produto-botao-compra
                            :produto="produto"
                            :texto-botao="textoBotaoAcao"
                            :precos-restritos="precosRestritos"
                            :pagina-live="paginaLive"
                            :habilitar-avise-me-quando-chegar="habilitarAviseMeQuandoChegar"
                            @click="abrirProduto">
                        </fz-produto-botao-compra>
                    </div>

                    <!-- Simulador de Parcelas - Melhor Parcelamento (apenas quando não é live) -->
                    <fz-simulador-parcelas-melhor-parcelamento
                        v-if="!paginaLive && !somenteOrcamentos && !precosRestritos && ativarSimuladorParcelas && !produto.venda_externa"
                        :produto="produto"
                        :simulacao="produto.simulacao_parcelas"
                        :abrir-modal="true"
                        alinhamento="centro"
                        class="fz-produto__simulador px-1 pt-3 pb-1 text-center">
                    </fz-simulador-parcelas-melhor-parcelamento>

                    <!-- Curtidas, Perguntas, Compartilhar (apenas quando não é live) -->
                    <div v-if="!paginaLive" class="fz-produto__acoes-container d-flex justify-content-around text-center">
                        <fz-produto-acoes
                            :produto="produto"
                            :habilitar-curtidas="habilitarCurtidas"
                            :habilitar-perguntas="habilitarPerguntas"
                            :permitir-compartilhar-produto="permitirCompartilharProduto">
                        </fz-produto-acoes>
                    </div>

                </div>
            </div>
        </div>
    </div>
    `
};


FZComponents.ProdutoGrid = {
    components: {
        'fz-produto-slider': FZComponents.ProdutoSlider,
        'fz-tag-campanha-promocional': FZComponents.TagCampanhaPromocional,
        'fz-produto-acoes': FZComponents.ProdutoAcoes,
        'fz-produto-preco': FZComponents.ProdutoPreco,
        'fz-simulador-parcelas-melhor-parcelamento': FZComponents.SimuladorParcelasMelhorParcelamento,
        'fz-produto-botao-compra': FZComponents.ProdutoBotaoCompra,
        'fz-variacao-sem-variacao': FZComponents.VariacaoSemVariacao,
        'fz-variacao-com-variacao': FZComponents.VariacaoComVariacao,
        'fz-variacao-com-grade': FZComponents.VariacaoComGrade
    },
    mixins: [ProdutoBaseMixin],
    props: {
        class: {
            type: String,
            default: ""
        },
        produto: {
            type: Object,
            required: true
        },
        prefixoSlider: {
            type: String,
            default: ""
        },
        precosRestritos: {
            type: Boolean,
            default: false
        },
        paginaLive: {
            type: Boolean,
            default: false
        },
        ocultarDestaque: {
            type: Boolean,
            default: false
        },
        somenteOrcamentos: {
            type: Boolean,
            default: false
        },
        mostrarQuantidadeVenda: {
            type: Boolean,
            default: false
        },
        habilitarCurtidas: {
            type: Boolean,
            default: false
        },
        habilitarPerguntas: {
            type: Boolean,
            default: false
        },
        permitirCompartilharProduto: {
            type: Boolean,
            default: false
        },
        ativarSimuladorParcelas: {
            type: Boolean,
            default: false
        },
        textoBotaoAcaoProdutos: {
            type: String,
            default: "Comprar"
        },
        habilitarAviseMeQuandoChegar: {
            type: Boolean,
            default: false
        },
        gridFormatoImagem: {
            type: String,
            default: "original"
        },
        exibirVariacoesDiretoPagina: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalAtivaNoMomento: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosAtivada: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosTexto: {
            type: String,
            default: ""
        },
        campanhaPromocionalTagProdutosCorFundo: {
            type: String,
            default: "#28a745"
        },
        campanhaPromocionalTagProdutosCorTexto: {
            type: String,
            default: "#ffffff"
        }
    },
    computed: {
        deveExibirVariacoesDiretoPagina() {
            if (!this.exibirVariacoesDiretoPagina) {
                return false;
            }
            
            if (this.produto.venda_externa) {
                return false;
            }
            
            if (this.precosRestritos) {
                return false;
            }
            
            const maxVariacoes = this.configsLoja.maxVariacoesMostrar || 20;
            if (this.produto.total_disponibilidade > maxVariacoes) {
                return false;
            }
            
            return true;
        },
        determinarComponenteVariacao() {
            if (this.produto.grade && Object.keys(this.produto.grade).length > 0 && !this.produto.grade_quebrada) {
                return 'fz-variacao-com-grade';
            }
            
            if (!this.produto.variacoes || Object.keys(this.produto.variacoes).length === 0) {
                const estoqueDisponivel = this.produto.controlar_estoque != '1' || (this.produto.estoque && this.produto.estoque['0'] > 0);
                if (estoqueDisponivel) {
                    return 'fz-variacao-sem-variacao';
                }
                return null;
            }
            
            return 'fz-variacao-com-variacao';
        }
    },
    template: `
    <div :class="['fz-produto', 'fz-produto--grid', classe, 'produtos_div', 'produto_div_' + produto.id]" :id="'produto_div_' + produto.id" style="margin-bottom: 45px !important;">
                <div class="fz-produto__card bloco-mensagem w-100 text-center">
                    <!-- Category link above image -->
                    <a class="fz-produto__categoria link-produto mt-0 mb-1 cursor-pointer text-left" 
                       @click="abrirProduto"
                       :href="linkProduto">
                        {{ produto.categoria_nome }}
                    </a>

                    <div class="fz-produto__imagem-container w-100">
                        <fz-produto-slider
                            :produto="produto"
                            :prefixo-slider="prefixoSlider"
                            :ocultar-destaque="ocultarDestaque"
                            :habilitar-avise-me-quando-chegar="habilitarAviseMeQuandoChegar"
                            :grid-formato-imagem="gridFormatoImagem">
                        </fz-produto-slider>
                    </div>

                    <fz-tag-campanha-promocional
                        :produto="produto"
                        :campanha-promocional-ativa-no-momento="campanhaPromocionalAtivaNoMomento"
                        :campanha-promocional-tag-produtos-ativada="campanhaPromocionalTagProdutosAtivada"
                        :campanha-promocional-tag-produtos-texto="campanhaPromocionalTagProdutosTexto"
                        :campanha-promocional-tag-produtos-cor-fundo="campanhaPromocionalTagProdutosCorFundo"
                        :campanha-promocional-tag-produtos-cor-texto="campanhaPromocionalTagProdutosCorTexto">
                    </fz-tag-campanha-promocional>

                    <!-- Interactions above title -->
                    <div class="fz-produto__acoes-vendas-container d-flex justify-content-around align-items-center mt-2">
                        <fz-produto-acoes
                            :produto="produto"
                            :habilitar-curtidas="habilitarCurtidas"
                            :habilitar-perguntas="habilitarPerguntas"
                            :permitir-compartilhar-produto="permitirCompartilharProduto">
                        </fz-produto-acoes>

                        <!-- Quantidade de vendas -->
                        <p v-if="mostrarQuantidadeVenda && produto.total_vendas > 0" 
                           class="fz-produto__badge-vendas badge badge-default text-dark m-0" 
                           style="font-size:12px;">
                            {{ produto.total_vendas }} {{ produto.total_vendas == 1 ? "vendido" : "vendidos" }}
                        </p>
                    </div>

                    <a class="fz-produto__titulo link-produto d-block font-weight-bold my-2 cursor-pointer" 
                       @click="abrirProduto"
                       :href="linkProduto">
                        {{ produto.nome }}
                    </a>

                    <a class="fz-produto__preco-link link-produto d-block my-2 cursor-pointer" 
                       @click="abrirProduto"
                       :href="linkProduto">
                        <fz-produto-preco
                            :produto="produto"
                            :somente-orcamentos="somenteOrcamentos"
                            :precos-restritos="precosRestritos"
                            :pagina-live="paginaLive"
                            :ativar-simulador-parcelas="ativarSimuladorParcelas"
                            alinhamento="centro">
                        </fz-produto-preco>
                    </a>

                    <!-- Simulador de Parcelas - Melhor Parcelamento -->
                    <div v-if="!somenteOrcamentos && !precosRestritos && ativarSimuladorParcelas && !produto.venda_externa" class="fz-produto__simulador d-block my-2">
                        <fz-simulador-parcelas-melhor-parcelamento
                            :produto="produto"
                            :simulacao="produto.simulacao_parcelas"
                            :abrir-modal="true"
                            alinhamento="centro">
                        </fz-simulador-parcelas-melhor-parcelamento>
                    </div>

                    <!-- Botão de ação -->
                    <div v-if="!deveExibirVariacoesDiretoPagina" class="fz-produto__botao-container my-2 w-100 text-center">
                        <fz-produto-botao-compra
                            :produto="produto"
                            :texto-botao="textoBotaoAcao"
                            :precos-restritos="precosRestritos"
                            :pagina-live="false"
                            :habilitar-avise-me-quando-chegar="habilitarAviseMeQuandoChegar"
                            @click="abrirProduto"
                            style="font-size: 16px;">
                        </fz-produto-botao-compra>
                    </div>

                    <!-- Variações Direto na Página -->
                        <component 
                            :is="determinarComponenteVariacao"
                            v-if="deveExibirVariacoesDiretoPagina && determinarComponenteVariacao"
                            :produto="produto"
                            :catalogo-id="configsLoja.catalogoId"
                            :carrinho="configsLoja.carrinho"
                            :somente-orcamentos="somenteOrcamentos"
                            :precos-restritos="precosRestritos"
                            :exibir-preco="true"
                            :exibir-sku="true"
                            :exibir-divisoria="true"
                            :exibir-descontos="true"
                            :video-ativo="false"
                            :variacoes-isoladas="true">
                        </component>
                </div>
    </div>
    `
};


FZComponents.ProdutoLista = {
    components: {
        'fz-produto-slider': FZComponents.ProdutoSlider,
        'fz-produto-acoes': FZComponents.ProdutoAcoes,
        'fz-tag-campanha-promocional': FZComponents.TagCampanhaPromocional,
        'fz-produto-preco': FZComponents.ProdutoPreco,
        'fz-simulador-parcelas-melhor-parcelamento': FZComponents.SimuladorParcelasMelhorParcelamento,
        'fz-produto-botao-compra': FZComponents.ProdutoBotaoCompra,
        'fz-variacao-sem-variacao': FZComponents.VariacaoSemVariacao,
        'fz-variacao-com-variacao': FZComponents.VariacaoComVariacao,
        'fz-variacao-com-grade': FZComponents.VariacaoComGrade
    },
    mixins: [ProdutoBaseMixin],
    props: {
        class: {
            type: String,
            default: ""
        },
        produto: {
            type: Object,
            required: true
        },
        prefixoSlider: {
            type: String,
            default: ""
        },
        precosRestritos: {
            type: Boolean,
            default: false
        },
        paginaLive: {
            type: Boolean,
            default: false
        },
        ocultarDestaque: {
            type: Boolean,
            default: false
        },
        somenteOrcamentos: {
            type: Boolean,
            default: false
        },
        mostrarQuantidadeVenda: {
            type: Boolean,
            default: false
        },
        habilitarCurtidas: {
            type: Boolean,
            default: false
        },
        habilitarPerguntas: {
            type: Boolean,
            default: false
        },
        permitirCompartilharProduto: {
            type: Boolean,
            default: false
        },
        ativarSimuladorParcelas: {
            type: Boolean,
            default: false
        },
        textoBotaoAcaoProdutos: {
            type: String,
            default: "Comprar"
        },
        habilitarAviseMeQuandoChegar: {
            type: Boolean,
            default: false
        },
        gridFormatoImagem: {
            type: String,
            default: "original"
        },
        exibirVariacoesDiretoPagina: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalAtivaNoMomento: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosAtivada: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosTexto: {
            type: String,
            default: ""
        },
        campanhaPromocionalTagProdutosCorFundo: {
            type: String,
            default: "#28a745"
        },
        campanhaPromocionalTagProdutosCorTexto: {
            type: String,
            default: "#ffffff"
        }
    },
    computed: {
        deveExibirVariacoesDiretoPagina() {
            if (!this.exibirVariacoesDiretoPagina) {
                return false;
            }
            
            if (this.produto.venda_externa) {
                return false;
            }
            
            if (this.precosRestritos) {
                return false;
            }
            
            const maxVariacoes = this.configsLoja.maxVariacoesMostrar || 20;
            if (this.produto.total_disponibilidade > maxVariacoes) {
                return false;
            }
            
            return true;
        },
        determinarComponenteVariacao() {
            if (this.produto.grade && Object.keys(this.produto.grade).length > 0 && !this.produto.grade_quebrada) {
                return 'fz-variacao-com-grade';
            }
            
            if (!this.produto.variacoes || Object.keys(this.produto.variacoes).length === 0) {
                const estoqueDisponivel = this.produto.controlar_estoque != '1' || (this.produto.estoque && this.produto.estoque['0'] > 0);
                if (estoqueDisponivel) {
                    return 'fz-variacao-sem-variacao';
                }
                return null;
            }
            
            return 'fz-variacao-com-variacao';
        }
    },
    template: `
    <div :class="[classe, 'fz-produto', 'fz-produto--lista', 'produtos_div', 'produto_div_' + produto.id]" :id="'produto_div_' + produto.id" style="margin-bottom: 5px !important;">
                <div class="fz-produto__card bloco-mensagem w-100">
                    <div class="row">
                        <!-- Left column: Image (5/12 width) -->
                        <div class="col-5 col-lg-4 col-xl-4">
                            <div class="fz-produto__imagem-container w-100">
                                <fz-produto-slider
                                    :produto="produto"
                                    :ocultar-destaque="ocultarDestaque"
                                    :prefixo-slider="prefixoSlider"
                                    :habilitar-avise-me-quando-chegar="habilitarAviseMeQuandoChegar"
                                    :grid-formato-imagem="gridFormatoImagem">
                                </fz-produto-slider>


                                <!-- Interactions -->
                                <fz-produto-acoes
                                    :produto="produto"
                                    :habilitar-curtidas="habilitarCurtidas"
                                    :habilitar-perguntas="habilitarPerguntas"
                                    :permitir-compartilhar-produto="permitirCompartilharProduto"
                                    class="fz-produto__acoes-container">
                                </fz-produto-acoes>
                            </div>
                        </div>

                        <!-- Right column: Details (7/12 width) -->
                        <div class="col-7 col-lg-8 col-xl-8">
                            <fz-tag-campanha-promocional
                                :produto="produto"
                                :campanha-promocional-ativa-no-momento="campanhaPromocionalAtivaNoMomento"
                                :campanha-promocional-tag-produtos-ativada="campanhaPromocionalTagProdutosAtivada"
                                :campanha-promocional-tag-produtos-texto="campanhaPromocionalTagProdutosTexto"
                                :campanha-promocional-tag-produtos-cor-fundo="campanhaPromocionalTagProdutosCorFundo"
                                :campanha-promocional-tag-produtos-cor-texto="campanhaPromocionalTagProdutosCorTexto">
                            </fz-tag-campanha-promocional>

                            <a class="fz-produto__titulo link-produto mt-2 mb-1 font-weight-bold cursor-pointer" 
                               style="font-size: 15px;" 
                               @click="abrirProduto"
                               :href="linkProduto">
                                {{ produto.nome }}
                            </a>

                            <a class="fz-produto__categoria link-produto mt-2 mb-1 cursor-pointer" v-if="produto.categoria_nome"
                               @click="abrirProduto"
                               :href="linkProduto">
                                <i class="fa fa-tags"></i> {{ produto.categoria_nome }}
                            </a>

                            <!-- Quantidade de vendas -->
                            <a v-if="mostrarQuantidadeVenda && produto.total_vendas > 0" 
                               class="fz-produto__vendas link-produto mt-2 mb-1 cursor-pointer" 
                               @click="abrirProduto"
                               :href="linkProduto">
                                <i class="fa fa-shopping-cart"></i> {{ produto.total_vendas }}
                                {{ produto.total_vendas == 1 ? 'vendido' : 'vendidos' }}
                            </a>

                            <!-- Preços -->
                            <a class="fz-produto__preco-link link-produto w-100 pt-2 pb-0 cursor-pointer" 
                               @click="abrirProduto"
                               :href="linkProduto">
                                <fz-produto-preco
                                    :produto="produto"
                                    :somente-orcamentos="somenteOrcamentos"
                                    :precos-restritos="precosRestritos"
                                    :pagina-live="paginaLive"
                                    :ativar-simulador-parcelas="ativarSimuladorParcelas"
                                    alinhamento="esquerda">
                                </fz-produto-preco>
                            </a>

                            <!-- Simulador de Parcelas - Melhor Parcelamento -->
                            <div v-if="!somenteOrcamentos && ativarSimuladorParcelas && !produto.venda_externa" class="fz-produto__simulador w-100 pt-2 pb-0">
                                <fz-simulador-parcelas-melhor-parcelamento
                                    :produto="produto"
                                    :simulacao="produto.simulacao_parcelas"
                                    :abrir-modal="true"
                                    alinhamento="esquerda">
                                </fz-simulador-parcelas-melhor-parcelamento>
                            </div>

                            <!-- Botão de ação -->
                            <div v-if="!deveExibirVariacoesDiretoPagina" class="fz-produto__botao-container w-100 pt-2 pb-0">
                                <fz-produto-botao-compra
                                    :produto="produto"
                                    :texto-botao="textoBotaoAcao"
                                    :precos-restritos="precosRestritos"
                                    :pagina-live="paginaLive"
                                    :habilitar-avise-me-quando-chegar="habilitarAviseMeQuandoChegar"
                                    @click="abrirProduto">
                                </fz-produto-botao-compra>
                            </div>
                        </div>
                    </div>

                    <!-- Variações Direto na Página -->
                        <component 
                            :is="determinarComponenteVariacao"
                            v-if="deveExibirVariacoesDiretoPagina && determinarComponenteVariacao"
                            :produto="produto"
                            :catalogo-id="configsLoja.catalogoId"
                            :carrinho="configsLoja.carrinho"
                            :somente-orcamentos="somenteOrcamentos"
                            :precos-restritos="precosRestritos"
                            :exibir-preco="true"
                            :exibir-sku="true"
                            :exibir-divisoria="true"
                            :exibir-descontos="true"
                            :video-ativo="false"
                            :variacoes-isoladas="true">
                        </component>
                </div>
    </div>
    `
};


FZComponents.Produto = {
    components: {
        'produto-grid': FZComponents.ProdutoGrid,
        'produto-grid-novo': FZComponents.ProdutoGridNovo,
        'produto-lista': FZComponents.ProdutoLista
    },
    props: {
        layout: {
            type: String,
            default: "grid_novo",
            validator: (value) => ['grid', 'grid_novo', 'lista'].includes(value)
        },
        class: {
            type: String,
            default: ""
        },
        produto: {
            type: Object,
            required: true
        },
        prefixoSlider: {
            type: String,
            default: ""
        },
        precosRestritos: {
            type: Boolean,
            default: false
        },
        paginaLive: {
            type: Boolean,
            default: false
        },
        ocultarDestaque: {
            type: Boolean,
            default: false
        },
        somenteOrcamentos: {
            type: Boolean,
            default: false
        },
        mostrarQuantidadeVenda: {
            type: Boolean,
            default: false
        },
        habilitarCurtidas: {
            type: Boolean,
            default: false
        },
        habilitarPerguntas: {
            type: Boolean,
            default: false
        },
        permitirCompartilharProduto: {
            type: Boolean,
            default: false
        },
        ativarSimuladorParcelas: {
            type: Boolean,
            default: false
        },
        textoBotaoAcaoProdutos: {
            type: String,
            default: "Comprar"
        },
        habilitarAviseMeQuandoChegar: {
            type: Boolean,
            default: false
        },
        gridFormatoImagem: {
            type: String,
            default: "original"
        },
        exibirVariacoesDiretoPagina: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalAtivaNoMomento: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosAtivada: {
            type: Boolean,
            default: false
        },
        campanhaPromocionalTagProdutosTexto: {
            type: String,
            default: ""
        },
        campanhaPromocionalTagProdutosCorFundo: {
            type: String,
            default: "#28a745"
        },
        campanhaPromocionalTagProdutosCorTexto: {
            type: String,
            default: "#ffffff"
        }
    },
    computed: {
        componentName() {
            const map = {
                'grid': 'produto-grid',
                'grid_novo': 'produto-grid-novo',
                'lista': 'produto-lista'
            };
            return map[this.layout] || 'produto-grid-novo';
        }
    },
    template: `
        <component 
            :is="componentName" 
            v-bind="$props">
        </component>
    `
};

FZComponents.ProdutoModalSkeletonDetalhes = {
    components: {
        'p-skeleton': PrimeVue.Skeleton
    },
    template: `
    <div class="fz-produto-conteudo__skeleton-detalhes">
        <!-- Preço -->
        <div class="py-3">
            <p-skeleton width="35%" height="2.5rem" class="mb-0"></p-skeleton>
        </div>
        
        <!-- Divisória -->
        <div class="w-100 mb-3">
            <p-skeleton width="40%" height="1.25rem" class="mt-2"></p-skeleton>
        </div>
        
        <!-- Variações -->
        <div class="fz-produto-conteudo__skeleton-variacoes">
            <p-skeleton v-for="n in 3" :key="n" width="100%" height="3.5rem" class="mb-2"></p-skeleton>
        </div>
        
        <!-- Botão -->
        <div class="mt-4 d-flex justify-content-center">
            <p-skeleton width="250px" height="2.5rem" border-radius="6px"></p-skeleton>
        </div>
    </div>
    `
};

FZComponents.ProdutoModalSkeleton = {
    components: {
        'p-skeleton': PrimeVue.Skeleton,
        'fz-produto-modal-skeleton-detalhes': FZComponents.ProdutoModalSkeletonDetalhes
    },
    template: `
    <div class="fz-produto-conteudo__skeleton">
        <div class="row">
            <!-- Left Column - Gallery Skeleton -->
            <div class="col-12 col-lg-6 mb-4 mb-lg-0">
                <p-skeleton height="400px" class="fz-produto-conteudo__skeleton-galeria mb-3"></p-skeleton>
                <div class="d-flex gap-2">
                    <p-skeleton v-for="n in 4" :key="n" width="80px" height="60px" class="fz-produto-conteudo__skeleton-miniatura"></p-skeleton>
                </div>
            </div>
            
            <!-- Right Column - Header + Details Skeleton -->
            <div class="col-12 col-lg-6">
                <!-- Header -->
                <div class="fz-produto-conteudo__skeleton-header mb-3">
                    <p-skeleton width="70%" height="2rem" class="mb-2"></p-skeleton>
                    <p-skeleton width="40%" height="1.5rem" class="mb-0"></p-skeleton>
                </div>
                
                <!-- Details (reusing partial skeleton structure) -->
                <fz-produto-modal-skeleton-detalhes></fz-produto-modal-skeleton-detalhes>
            </div>
        </div>
    </div>
    `
};

FZComponents.DialogRegrasPrecos = {
    components: {
        'p-dialog': PrimeVue.Dialog,
        'p-tag': PrimeVue.Tag,
        'p-divider': PrimeVue.Divider
    },
    mixins: [ProdutoConteudoMixin],
    computed: {
        visible: {
            get() {
                return this.conteudoStore.dialogRegrasPrecos.visible;
            },
            set(value) {
                this.conteudoStore.dialogRegrasPrecos.visible = value;
            }
        },
        regrasCategoria() {
            return this.conteudoStore.dialogRegrasPrecos.regrasCategoria;
        },
        regrasProduto() {
            return this.conteudoStore.dialogRegrasPrecos.regrasProduto;
        },
        temRegras() {
            return this.regrasCategoria.length > 0 || this.regrasProduto.length > 0;
        }
    },
    template: `
    <p-dialog 
        v-model:visible="visible"
        modal
        :draggable="false"
        :dismissableMask="true"
        header="Regras de Descontos"
        :style="{ width: '90vw', maxWidth: '550px' }"
        class="fz-dialog-regras-precos"
        :pt="{header: 'pb-2', content: 'pt-0'}"
    >
        <div v-if="temRegras">
            <!-- Regras da Categoria -->
            <div v-if="regrasCategoria.length > 0">
                <p-divider align="left" type="solid">
                    <i class="pi pi-tag"></i> <b>Desconto da Categoria</b>
                </p-divider>
                <div class="fz-dialog-regras-precos__lista mb-3">
                    <div v-for="(regra, index) in regrasCategoria" :key="'cat-' + index" class="fz-dialog-regras-precos__item">
                        <p class="mb-2">
                            Compras entre <strong>{{ regra.itensMinimo }}</strong> e <strong>{{ regra.itensMaximo }}</strong> itens: <strong>{{ regra.textoDesconto }}</strong>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Regras do Produto -->
            <div v-if="regrasProduto.length > 0">
                <p-divider align="left" type="solid">
                    <i class="pi pi-box"></i> <b>Desconto do Produto</b>
                </p-divider>
                <div class="fz-dialog-regras-precos__lista">
                    <div v-for="(regra, index) in regrasProduto" :key="'prod-' + index" class="fz-dialog-regras-precos__item">
                        <p class="mb-2">
                            Compras entre <strong>{{ regra.itensMinimo }}</strong> e <strong>{{ regra.itensMaximo }}</strong> itens: <strong>{{ regra.textoDesconto }}</strong>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </p-dialog>
    `
};

FZComponents.DialogVideoExterno = {
    components: {
        'p-dialog': PrimeVue.Dialog
    },
    mixins: [ProdutoConteudoMixin],
    data() {
        return {
            iframeLoaded: false
        };
    },
    computed: {
        visible: {
            get() {
                return this.conteudoStore.dialogVideoExterno.visible;
            },
            set(value) {
                this.conteudoStore.dialogVideoExterno.visible = value;
                if (!value) {
                    this.iframeLoaded = false;
                }
            }
        },
        videoId() {
            return this.conteudoStore.dialogVideoExterno.videoId;
        },
        service() {
            return this.conteudoStore.dialogVideoExterno.service;
        },
        isInstagram() {
            return this.service === 'instagram';
        },
        isYouTube() {
            return this.service === 'youtube';
        },
        videoUrl() {
            if (this.isInstagram) {
                return `https://www.instagram.com/p/${this.videoId}/embed/`;
            } else if (this.isYouTube) {
                return `https://www.youtube-nocookie.com/embed/${this.videoId}`;
            }
            return '';
        },
        dialogWidth() {
            return this.isYouTube ? '90vw' : '90vw';
        },
        dialogMaxWidth() {
            return this.isYouTube ? '800px' : '540px';
        }
    },
    watch: {
        visible(newVal) {
            if (newVal && this.videoUrl && !this.iframeLoaded) {
                this.$nextTick(() => {
                    const iframe = this.$refs.videoIframe;
                    if (iframe && iframe.dataset.src) {
                        iframe.src = iframe.dataset.src;
                        this.iframeLoaded = true;
                    }
                });
            }
        }
    },
    template: `
    <p-dialog 
        v-model:visible="visible"
        modal
        :draggable="false"
        :dismissableMask="true"
        header="Vídeo do Produto"
        :style="{ width: dialogWidth, maxWidth: dialogMaxWidth }"
        class="fz-dialog-video-externo"
    >
        <div v-if="isInstagram" class="fz-dialog-video-externo__container">
            <iframe 
                ref="videoIframe"
                class="fz-dialog-video-externo__iframe fz-dialog-video-externo__iframe--instagram"
                :data-src="videoUrl"
                allowtransparency="true" 
                allowfullscreen="true" 
                frameborder="0"
                scrolling="no"
                style="background: white; max-width: 540px; width: calc(100% - 2px); border-radius: 3px; border: 1px solid rgb(219, 219, 219); box-shadow: none; display: block; margin: 0px auto; min-width: 326px; padding: 0px; height: 510px;"
            ></iframe>
        </div>
        
        <div v-else-if="isYouTube" class="fz-dialog-video-externo__container">
            <iframe 
                ref="videoIframe"
                class="fz-dialog-video-externo__iframe fz-dialog-video-externo__iframe--youtube"
                :data-src="videoUrl"
                width="100%" 
                height="450"
                title="YouTube video player" 
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen
            ></iframe>
        </div>
    </p-dialog>
    `
};


FZComponents.ProdutoModalHeader = {
    components: {
        'p-tag': PrimeVue.Tag,
        'p-button': PrimeVue.Button
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: {
            type: Object,
            required: true
        }
    },
    computed: {
        categoriasNomes() {
            if (!this.produto.categorias || !this.configsLoja.categorias) return [];
            const nomes = [];
            for (const catId of Object.keys(this.produto.categorias)) {
                const categoria = this.configsLoja.categorias[catId];
                if (categoria?.nome) {
                    nomes.push(categoria.nome);
                }
            }
            return nomes;
        },
        exibirSku() {
            return this.configsLoja.mostrarCodigoReferenciaProduto && 
                   (this.isEmpty(this.produto.disponibilidade) || ! this.configsLoja.exibirSkuVariacoes) && 
                   this.produto.sku;
        },
        temVideoExterno() {
            return this.produto?.video_externo?.id && this.produto?.video_externo?.service;
        }
    },
    methods: {
        abrirVideoExterno() {
            this.abrirDialogVideoExterno(this.produto);
        }
    },
    template: `
    <div class="fz-produto-conteudo__cabecalho">
        <div class="row pt-1 pb-1 align-items-center">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h4 class="fz-produto-conteudo__titulo mb-1 font-weight-bold">
                            <span class="fz-produto-conteudo__titulo-texto">{{ produto.nome }}</span>
                        </h4>
                        <div class="fz-produto-conteudo__meta d-flex flex-wrap align-items-center gap-2 mt-2">
                            <template v-if="categoriasNomes.length > 0">
                                <p-tag 
                                    v-for="(categoria, index) in categoriasNomes" 
                                    :key="index"
                                    :value="categoria"
                                    severity="secondary"
                                    icon="pi pi-tag"
                                    class="fz-produto-conteudo__categoria-tag"
                                ></p-tag>
                            </template>
                            <p-tag 
                                v-else-if="produto.categoria_nome"
                                :value="produto.categoria_nome"
                                severity="secondary"
                                icon="pi pi-tag"
                                class="fz-produto-conteudo__categoria-tag"
                            ></p-tag>
                            <p-tag 
                                v-if="exibirSku"
                                :value="produto.sku"
                                severity="secondary"
                                icon="pi pi-hashtag"
                                class="fz-produto-conteudo__sku-tag"
                            ></p-tag>
                            <p-tag 
                                v-if="configsLoja.mostrarQuantidadeVenda && produto.total_vendas > 0"
                                :value="produto.total_vendas + (produto.total_vendas == 1 ? ' venda' : ' vendas')"
                                severity="secondary"
                                icon="pi pi-shopping-cart"
                                class="fz-produto-conteudo__vendas-tag"
                            ></p-tag>
                        </div>
                    </div>
                    
                    <div v-if="temVideoExterno" class="ml-2 flex-shrink-0">
                        <p-button 
                            @click="abrirVideoExterno"
                            severity="primary"
                            icon="pi pi-video"
                            label="Ver Vídeo"
                            size="small"
                            class="fz-produto-conteudo__btn-video"
                        ></p-button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `
};

FZComponents.ProdutoModalCarousel = {
    components: {
        'p-image': PrimeVue.Image,
        'p-button': PrimeVue.Button
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
    },
    data() {
        return {
            slideAtual: 0,
            swiperInstance: null,
            swiperThumbsInstance: null,
            videojsPlayer: null,
            playContabilizado: false,
            videoPausadoManualmente: false,
            zoomAtivo: false,
            zoomX: 0,
            zoomY: 0
        };
    },
    computed: {
        imagens() {
            const imgs = this.produto.imagens || [];
            return imgs.length > 0 ? imgs : ['https://assets.facilzap.app.br/sem_foto.png'];
        },
        temVideo() {
            return !this.isEmpty(this.produto.video);
        },
        temMultiplasImagens() {
            return this.imagens.length > 1 || this.temVideo;
        },
        carrouselId() {
            return `carousel_produto_${this.produto.id}`;
        },
        thumbsCarrouselId() {
            return `thumbs_carousel_produto_${this.produto.id}`;
        },
        videoId() {
            return `video_produto_${this.produto.id}`;
        }
    },
    mounted() {
        this.$nextTick(() => {
            this.inicializarSwiper();
            if (this.temVideo) {
                this.$nextTick(() => {
                    this.inicializarVideo();
                });
            }
        });
    },
    watch: {
        'produto.id'(newId, oldId) {
            if (newId != oldId) {
                this.limparInstancias();
                
                this.$nextTick(() => {
                    this.inicializarSwiper();
                    if (this.temVideo) {
                        this.$nextTick(() => {
                            this.inicializarVideo();
                        });
                    }
                });
            }
        },
        'dialogDrawerStore.isOpen'(isOpen) {
            if (!isOpen) {
                setTimeout(() => {
                    this.limparInstancias();
                }, 300);
            }
        }
    },
    beforeUnmount() {
        this.limparInstancias();
    },
    methods: {
        limparInstancias() {
            this.destruirVideo();
            if (this.swiperThumbsInstance && typeof this.swiperThumbsInstance.destroy === 'function') {
                this.swiperThumbsInstance.destroy(true, true);
                this.swiperThumbsInstance = null;
            }
            if (this.swiperInstance && typeof this.swiperInstance.destroy === 'function') {
                this.swiperInstance.destroy(true, true);
                this.swiperInstance = null;
            }
        },
        inicializarSwiper() {
            if (!this.temMultiplasImagens) return;
            
            const swiperEl = this.$refs.swiperContainer;
            const swiperThumbsEl = this.$refs.swiperThumbsContainer;
            
            if (!swiperEl) return;

            if (swiperThumbsEl) {
                this.swiperThumbsInstance = new Swiper(swiperThumbsEl, {
                    spaceBetween: 5,
                    slidesPerView: 'auto',
                    freeMode: true,
                    touchAngle: 20,
                    watchSlidesProgress: true,
                    direction: 'horizontal',
                    breakpoints: {
                        350: { direction: 'horizontal' },
                        430: { direction: 'horizontal' },
                        530: { direction: 'horizontal' },
                        768: { direction: 'horizontal' },
                        992: { direction: 'vertical' },
                        1200: { direction: 'vertical'},
                    }
                });
            }

            this.swiperInstance = new Swiper(swiperEl, {
                slidesPerView: 1,
                spaceBetween: 0,
                observer: true,
                observeSlideChildren: true,
                autoHeight: true,
                touchAngle: 20,
                scrollbar: {
                    el: '.swiper-scrollbar',
                    hide: false
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev'
                },
                thumbs: this.swiperThumbsInstance ? {
                    swiper: this.swiperThumbsInstance
                } : undefined,
                on: {
                    slideChange: (swiper) => {
                        this.slideAtual = swiper.activeIndex;
                        if (this.videojsPlayer) {
                            this.pausarVideo();
                        }
                    }
                }
            });
        },
        inicializarVideo() {
            const videoEl = this.$refs.videoElement;
            if (!videoEl || typeof videojs === 'undefined') return;

            this.videojsPlayer = videojs(videoEl, {
                responsive: true,
                controls: false,
            });

            const Button = videojs.getComponent('Button');
            
            const viewsButton = new Button(this.videojsPlayer, {
                className: 'vjs-views-count',
            });
            this.videojsPlayer.addChild(viewsButton);
            viewsButton.el().innerHTML = `<i class="fa fa-eye"></i> ${this.produto.video.views || 1}`;

            const pauseButton = new Button(this.videojsPlayer, {
                className: 'vjs-bottom-pause-button',
                clickHandler: () => {
                    this.videoPausadoManualmente = true;
                    this.videojsPlayer.pause();
                }
            });
            this.videojsPlayer.addChild(pauseButton);

            const muteButton = new Button(this.videojsPlayer, {
                className: 'vjs-bottom-mute-toggle-button muted',
                clickHandler: () => {
                    this.videojsPlayer.muted(!this.videojsPlayer.muted());
                }
            });
            this.videojsPlayer.addChild(muteButton);

            this.videojsPlayer.ready(() => {
                $(this.videojsPlayer.bigPlayButton.el()).show();
                this.videojsPlayer.trigger('loadedmetadata');

                this.videojsPlayer.on('volumechange', () => {
                    const muteBtn = $(this.videojsPlayer.el()).find('.vjs-bottom-mute-toggle-button');
                    if (!this.videojsPlayer.muted()) {
                        muteBtn.removeClass('muted');
                    } else {
                        muteBtn.addClass('muted');
                    }
                });

                this.videojsPlayer.on('timeupdate', () => {
                    const duration = this.videojsPlayer.duration() || 100;
                    const currentTime = this.videojsPlayer.currentTime() || 0;
                    const percentage = (currentTime / duration) * 100;

                    if (percentage >= 30 && percentage <= 40) {
                        if (!this.playContabilizado) {
                            this.playContabilizado = true;
                            this.contabilizarPlayVideo();
                        }
                    }
                    if (percentage >= 90) {
                        this.playContabilizado = false;
                    }
                });
            });

            this.videojsPlayer.on('loadedmetadata', () => {
                this.ajustarAlturaVideo();
            });

            this.videojsPlayer.on('play', () => {
                this.videoPausadoManualmente = false;
                const swiper = this.videojsPlayer.el().closest('.swiper');
                const pagination = swiper?.querySelector('.swiper-pagination');
                if (pagination) {
                    $(pagination).removeClass('d-block').addClass('d-none');
                }
                $(this.videojsPlayer.bigPlayButton.el()).hide();
                $('.vjs-bottom-pause-button', this.videojsPlayer.el()).show();
                this.videojsPlayer.trigger('volumechange');
            });

            this.videojsPlayer.on('pause', () => {
                const swiper = this.videojsPlayer.el().closest('.swiper');
                const pagination = swiper?.querySelector('.swiper-pagination');
                if (pagination) {
                    $(pagination).removeClass('d-none').addClass('d-block');
                }
                $(this.videojsPlayer.bigPlayButton.el()).show();
                $('.vjs-bottom-pause-button', this.videojsPlayer.el()).hide();
            });

            this.videojsPlayer.on('error', () => {
                const error = this.videojsPlayer.error();
                console.error('Video error:', error);
                
                if (this.swiperInstance) {
                    const videoSlide = this.videojsPlayer.el().closest('.swiper-slide');
                    if (videoSlide) {
                        const slideIndex = Array.from(videoSlide.parentElement.children).indexOf(videoSlide);
                        this.swiperInstance.removeSlide(slideIndex);
                        this.swiperThumbsInstance?.removeSlide(slideIndex);
                    }
                }
            });
        },
        pausarVideo() {
            if (this.videojsPlayer) {
                this.videojsPlayer.pause();
                this.videojsPlayer.currentTime(0);
            }
        },
        ajustarAlturaVideo(tentativa = 0) {
            if (!this.videojsPlayer) return;

            if (tentativa > 10) {
                console.warn('Tentativas de ajustar altura do vídeo excedidas');
                return;
            }

            const videoHeight = this.videojsPlayer.videoHeight();
            const videoWidth = this.videojsPlayer.videoWidth();
            const videoProportion = videoHeight / videoWidth;
            const playerWidth = this.videojsPlayer.currentWidth();

            if (!videoHeight || !videoWidth || !playerWidth || playerWidth === 0 || videoHeight === 0 || videoWidth === 0) {
                setTimeout(() => {
                    this.ajustarAlturaVideo(tentativa + 1);
                }, 500);
                return;
            }

            const playerHeight = playerWidth * videoProportion;

            const videoElement = this.videojsPlayer.el();
            if (videoElement) {
                $(videoElement).height(playerHeight);
                $(videoElement).css('height', playerHeight + 'px');
            }

            if (this.swiperInstance) {
                this.$nextTick(() => {
                    this.swiperInstance.update();
                });
            }
        },
        destruirVideo() {
            if (this.videojsPlayer) {
                this.videojsPlayer.dispose();
                this.videojsPlayer = null;
            }
        },
        contabilizarPlayVideo() {
            try {
                const url = this.obterLinkCatalogo('');
                $.post(url, {
                    acao: 'contabilizar_play_video',
                    produto_id: this.produto.id,
                    loja_id: this.produto.loja || 0
                });
            } catch (error) {
                console.error('Erro ao contabilizar play:', error);
            }
        },
        baixarMidia(url, filename) {
            const downloadUrl = url + '?response-content-disposition=attachment;filename=' + encodeURIComponent(filename || 'download');
            window.open(downloadUrl, '_blank');
        },
        handleMouseMove(event) {
            if (!this.zoomAtivo) return;
            
            const img = event.currentTarget;
            const rect = img.getBoundingClientRect();
            
            this.zoomX = (event.clientX - rect.left) / rect.width;
            this.zoomY = (event.clientY - rect.top) / rect.height;
        },
        handleMouseEnter() {
            this.zoomAtivo = true;
        },
        handleMouseLeave() {
            this.zoomAtivo = false;
            this.zoomX = 0;
            this.zoomY = 0;
        },
        getZoomStyle() {
            if (!this.zoomAtivo) {
                return {
                    transform: 'scale(1)',
                    transformOrigin: 'center center',
                    transition: 'transform 0.3s'
                };
            }
            
            const originX = this.zoomX * 100;
            const originY = this.zoomY * 100;
            
            return {
                transform: 'scale(2)',
                transformOrigin: `${originX}% ${originY}%`,
            };
        }
    },
    template: `
    <div class="fz-produto-conteudo__galeria">
        <div v-if="!temMultiplasImagens" class="fz-produto-conteudo__galeria-unica position-relative">
            <div 
                class="fz-produto-conteudo__galeria-zoom-container"
                @mouseenter="handleMouseEnter"
                @mouseleave="handleMouseLeave"
                @mousemove="handleMouseMove"
                style="overflow: hidden; border-radius: 0.25rem;"
            >
                <p-image
                    :src="obterURLArquivos(imagens[0])" 
                    :alt="produto.nome"
                    image-class="fz-produto-conteudo__galeria-imagem img-fluid rounded"
                    preview
                    @error="handleImageError"
                    :image-style="[
                        { width: '100%', height: 'auto', objectFit: 'contain', maxHeight: '500px', cursor: 'zoom-in' },
                        getZoomStyle()
                    ]"
                >
                    <template #previewicon>
                        <span></span>
                    </template>
                </p-image>
            </div>
            <p-button 
                v-if="configsLoja.permitirBaixarMidiaCatalogo"
                class="fz-produto-conteudo__btn-download"
                icon="pi pi-download" 
                severity="contrast" 
                rounded 
                @click="baixarMidia(obterURLArquivos(imagens[0]), produto.nome + '.jpg')"
                aria-label="Baixar Imagem"
            ></p-button>
        </div>
        
        <div v-else class="fz-produto-conteudo__galeria-multipla pos-relative">
            <div class="fz-produto-conteudo__galeria-com-thumbs">
                <div ref="swiperThumbsContainer" class="fz-produto-conteudo__galeria-miniaturas swiper swiper-thumbs" :id="thumbsCarrouselId">
                    <div class="swiper-wrapper">
                        <div v-if="temVideo" class="fz-produto-conteudo__galeria-miniatura fz-produto-conteudo__galeria-miniatura--video swiper-slide">
                            <div 
                                class="rounded bg-white d-flex justify-content-center align-items-center border w-100 h-100" 
                                :style="{
                                    cursor: 'pointer',
                                    backgroundImage: produto.video.thumb ? 'url(' + obterURLArquivos(produto.video.thumb) + ')' : 'none',
                                    backgroundSize: 'cover',
                                    backgroundPosition: 'center'
                                }"
                            >
                                <i class="fa fa-play-circle m-0 f-36 align-middle text-success"></i>
                            </div>
                        </div>
                        
                        <div 
                            v-for="(imagem, index) in imagens" 
                            :key="'thumb-' + index" 
                            class="fz-produto-conteudo__galeria-miniatura swiper-slide"
                        >
                            <img 
                                :src="obterURLArquivos(imagem)" 
                                :alt="'Thumb ' + (index + 1)"
                                class="fz-produto-conteudo__galeria-miniatura-imagem img-fluid"
                                @error="handleImageError"
                                style="width: 100%; height: auto; object-fit: cover; cursor: pointer;"
                            />
                        </div>
                    </div>
                </div>
                
                <div ref="swiperContainer" class="fz-produto-conteudo__galeria-principal swiper carrousel_produtos" :id="carrouselId" :data-produto-id="produto.id">
                    <div class="swiper-wrapper">
                    <div v-if="temVideo" class="fz-produto-conteudo__galeria-slide fz-produto-conteudo__galeria-slide--video swiper-slide position-relative">
                        <video
                            ref="videoElement"
                            :id="videoId"
                            class="fz-produto-conteudo__galeria-video video-js w-100 vjs-show-big-play-button-on-pause"
                            :data-loja-id="produto.loja|| 0"
                            :data-views="produto.video.views || 1"
                            data-setup="{}"
                            controls
                            preload="metadata"
                            loop
                            playsinline
                            :poster="produto.video.thumb ? obterURLArquivos(produto.video.thumb) : ''"
                        >
                            <source :src="obterURLArquivos(produto.video.url)" type="video/mp4">
                        </video>

                        <p-button 
                            v-if="configsLoja.permitirBaixarMidiaCatalogo"
                            class="fz-produto-conteudo__btn-download"
                            icon="pi pi-download" 
                            severity="contrast" 
                            rounded 
                            @click="baixarMidia(obterURLArquivos(produto.video.url), produto.nome + '.mp4')"
                            aria-label="Baixar Vídeo"
                        ></p-button>
                    </div>
                    
                    <div 
                        v-for="(imagem, index) in imagens" 
                        :key="'img-' + index" 
                        class="fz-produto-conteudo__galeria-slide swiper-slide position-relative"
                    >
                        <div 
                            class="fz-produto-conteudo__galeria-zoom-container"
                            @mouseenter="handleMouseEnter"
                            @mouseleave="handleMouseLeave"
                            @mousemove="handleMouseMove"
                            style="overflow: hidden; border-radius: 0.25rem;"
                        >
                            <p-image
                                :src="obterURLArquivos(imagem)" 
                                :alt="produto.nome + ' - Imagem ' + (index + 1)"
                                image-class="fz-produto-conteudo__galeria-imagem img-fluid rounded"
                                preview
                                @error="handleImageError"
                                :image-style="[
                                    { width: '100%', height: 'auto', objectFit: 'contain', maxHeight: '500px', cursor: 'zoom-in' },
                                    getZoomStyle()
                                ]"
                            >
                                <template #previewicon>
                                    <span></span>
                                </template>
                            </p-image>
                        </div>
                        
                        <p-button 
                            v-if="configsLoja.permitirBaixarMidiaCatalogo"
                            class="fz-produto-conteudo__btn-download"
                            icon="pi pi-download" 
                            severity="contrast" 
                            rounded 
                            @click="baixarMidia(obterURLArquivos(imagem), produto.nome + '.jpg')"
                            aria-label="Baixar Imagem"
                        ></p-button>
                    </div>
                </div>
                    <div class="fz-produto-conteudo__galeria-scrollbar swiper-scrollbar"></div>
                    <div class="fz-produto-conteudo__galeria-nav-proximo swiper-button-next d-none d-lg-flex"></div>
                    <div class="fz-produto-conteudo__galeria-nav-anterior swiper-button-prev d-none d-lg-flex"></div>
                </div>
            </div>
        </div>
    </div>
    `
};


FZComponents.ProdutoModalFooter = {
    components: {
        'p-button': PrimeVue.Button,
        'fz-produto-acoes': FZComponents.ProdutoAcoes
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: {
            type: Object,
            required: true
        },
        contexto: {
            type: String,
            required: false
        }
    },
    computed: {
        qtdMinMax() {
            const catalogoId = this.configsLoja.catalogoId;
            return {
                min: parseInt(this.produto.qtds_minimas?.[catalogoId]?.[0]) || 0,
                max: parseInt(this.produto.qtds_maximas?.[catalogoId]?.[0]) || 0
            };
        },
        produtoIndisponivelEstoque() {
            if (this.produto.controlar_estoque != "1") return false;
            const estoque = parseInt(this.produto.estoque?.[0]) || parseInt(this.produto.total_estoque) || 0;
            return estoque <= 0 || this.produto.grade_quebrada;
        },
        exibirBotaoAdicionar() {
            return !this.produto.venda_externa && 
                   !this.configsLoja.precosRestritos && 
                   !this.produtoIndisponivelEstoque;
        },
        linkWhatsApp() {
            if (!this.configsLoja.linkWhatsApp) return null;
            const mensagem = encodeURIComponent(`Gostaria de mais informações sobre o produto: ${this.produto.nome}`);
            return `${this.configsLoja.linkWhatsApp}${mensagem}`;
        }
    },
    methods: {
        validarQuantidadesSelecionadas(fecharModal = false, abrirCarrinho = false) {
            const produtoId = this.produto.id;
            const min = Number(this.qtdMinMax.min);
            const max = Number(this.qtdMinMax.max);
            
            const quantidades = this.conteudoStore.quantidadesSelecionadas[produtoId] || {};
            let totalQtd = 0;
            
            Object.values(quantidades).forEach(qtd => {
                totalQtd += Number(qtd) || 0;
            });
            
            if (totalQtd === 0 && !fecharModal) {
                showNotification('Selecione a quantidade para adicionar ao carrinho!', '', 'error');
                return false;
            }
            
            if (totalQtd < min && totalQtd > 0) {
                if (fecharModal) {
                    this.removerProdutoValidacaoQuantidade(produtoId, min);
                } else {
                    showNotification(`A quantidade mínima para este produto são ${min} unidades.`, '', 'error');
                }
                return false;
            }
            
            if (totalQtd > max && max > 0) {
                showNotification(`A quantidade máxima para este produto são ${max} unidades.`, '', 'error');
                return false;
            }
            
            this.pausarVideo();
            this.dialogDrawerStore.isOpen = false;
            
            if (abrirCarrinho) {
                if (typeof verCarrinho === 'function') {
                    verCarrinho();
                }
            }
            
            return true;
        },
        
        async removerProdutoValidacaoQuantidade(min) {
            showConfirmation(
                `A quantidade mínima para este produto são ${min} unidades.`,
                'Deseja removê-lo do carrinho?',
                async () => {
                    if (typeof facilZapEventos !== 'undefined' && facilZapEventos.removerDoCarrinho) {
                        facilZapEventos.removerDoCarrinho(this.produto.id, this.produto.nome, this.produto.preco);
                    }
                    
                    showLoading('', 'Removendo produto do carrinho...', '');
                    
                    try {
                        const formData = new FormData();
                        formData.append('acao', 'remover_produto');
                        formData.append('pid', this.produto.id);
                        
                        const response = await fetch(this.configsLoja.urlCatalogo, {
                            method: 'POST',
                            body: formData
                        });
                        
                        const data = await response.text();
                        const trimmedData = data.trim();
                        
                        closeLoading();
                        
                        if (trimmedData !== 'ok') {
                            showNotification('Erro', 'Tivemos um problema ao remover o produto do seu carrinho.<br/>Atualize a página e tente novamente!', 'error');
                        } else {
                            this.dialogDrawerStore.isOpen = false;
                            
                            if (typeof totalCarrinho === 'function') {
                                totalCarrinho();
                            }
                        }
                    } catch (error) {
                        console.error('Erro ao remover produto:', error);
                        
                        closeLoading();
                        showNotification('Erro', 'Tivemos um problema ao remover o produto do seu carrinho.<br/>Atualize a página e tente novamente!', 'error');
                    }
                }
            );
        },
        
        pausarVideo() {
            const carousel = this.$parent?.$refs?.carousel;
            if (carousel && typeof carousel.pausarVideo === 'function') {
                carousel.pausarVideo();
            }
        },
        
        adicionarAoCarrinho() {
            const validado = this.validarQuantidadesSelecionadas(false, false);
            if (validado) {
                verCarrinho();
            }
        },
    },
    template: `
    <div class="fz-produto-conteudo__rodape py-4">
        <div v-if="exibirBotaoAdicionar" class="fz-produto-conteudo__acoes fz-produto-conteudo__acoes-primarias d-flex justify-content-center gap-2 mb-3">
            <p-button 
                @click="adicionarAoCarrinho"
                severity="primary"
                icon="pi pi-shopping-cart"
                class="fz-produto-conteudo__btn-adicionar-carrinho"
                label="Adicionar ao Carrinho"
            ></p-button>
        </div>
        
        <div v-else-if="produto.venda_externa" class="fz-produto-conteudo__acoes d-flex justify-content-center gap-2 mb-3">
            <p-button 
                :href="produto.link_externo"
                as="a"
                target="_blank"
                severity="primary"
                class="fz-produto-conteudo__btn-externo"
                icon="pi pi-external-link"
                :label="produto.texto_botao_acao || 'Comprar'"
            ></p-button>
        </div>
        
        <div v-else-if="configsLoja.precosRestritos" class="fz-produto-conteudo__acoes d-flex justify-content-center gap-2 mb-3">
            <p-button 
                :href="obterLinkCatalogo('login')"
                as="a"
                severity="primary"
                class="fz-produto-conteudo__btn-login"
                icon="pi pi-lock"
                label="Ver Preços"
            ></p-button>
        </div>
        
        <div class="fz-produto-conteudo__acoes-sociais d-flex justify-content-center gap-3 mt-2">
            <fz-produto-acoes
                :produto="produto"
                :habilitar-curtidas="configsLoja.habilitarCurtidas"
                :habilitar-perguntas="configsLoja.habilitarPerguntas"
                :permitir-compartilhar-produto="configsLoja.permitirCompartilharProduto"
                :habilitar-whats-app="!!linkWhatsApp"
                :link-whats-app="linkWhatsApp"
                :link-produto="linkProduto"
                size="large"
            ></fz-produto-acoes>
        </div>
    </div>
    `
};

FZComponents.ProdutoModalAudioDescricao = {
    components: {},
    mixins: [ProdutoConteudoMixin],
    props: {
        audioPath: { type: String, required: true },
        produtoId: { type: [String, Number], required: true },
        vendedorNome: { type: String, default: '' },
        vendedorFoto: { type: String, default: '' },
        totalPlays: { type: Number, default: 0 }
    },
    data() {
        return {
            audio: null,
            tocando: false,
            duracao: '0:00',
            tempoAtual: '0:00',
            progresso: 0,
            playContabilizado: false,
            interval: null,
            audioWaveUrl: 'https://assets.facilzap.app.br/audio_wave2.png'
        };
    },
    computed: {
        audioUrl() {
            return this.obterURLArquivos(this.audioPath);
        },
        vendedorInicial() {
            return this.vendedorNome ? this.vendedorNome[0] : '';
        },
        vendedorImagem() {
            if (this.vendedorFoto) {
                return this.obterURLArquivos(this.vendedorFoto);
            }
            return '';
        },
        horaAtual() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' + 
                   now.getMinutes().toString().padStart(2, '0');
        },
        totalPlaysExibicao() {
            return this.playContabilizado ? this.totalPlays + 1 : this.totalPlays;
        }
    },
    mounted() {
        this.initAudio();
    },
    beforeUnmount() {
        this.destroyAudio();
    },
    methods: {
        initAudio() {
            this.audio = new Audio(this.audioUrl);
            this.audio.volume = 1;
            
            this.audio.addEventListener('durationchange', () => {
                this.duracao = this.formatarTempo(this.audio.duration);
            });
            
            this.audio.addEventListener('ended', () => {
                this.pararAudio();
            });
            
            this.audio.addEventListener('error', (e) => {
                console.error('Erro ao carregar áudio:', e);
            });
        },
        destroyAudio() {
            if (this.interval) {
                clearInterval(this.interval);
            }
            if (this.audio) {
                this.audio.pause();
                this.audio = null;
            }
        },
        formatarTempo(segundos) {
            if (!segundos || isNaN(segundos)) return '0:00';
            
            const hrs = ~~(segundos / 3600);
            const mins = ~~((segundos % 3600) / 60);
            const secs = ~~(segundos % 60);
            
            let ret = '';
            if (hrs > 0) {
                ret += hrs + ':' + (mins < 10 ? '0' : '');
            }
            ret += mins + ':' + (secs < 10 ? '0' : '');
            ret += secs;
            
            return ret;
        },
        toggleAudio() {
            if (this.tocando) {
                this.pararAudio();
            } else {
                this.tocarAudio();
            }
        },
        tocarAudio() {
            if (!this.audio) return;
            
            this.tocando = true;
            this.audio.play();
            
            this.interval = setInterval(() => {
                this.atualizarProgresso();
            }, 100);
            
            if (!this.playContabilizado) {
                this.contabilizarPlay();
            }
        },
        pararAudio() {
            if (!this.audio) return;
            
            this.tocando = false;
            this.audio.pause();
            this.audio.currentTime = 0;
            
            if (this.interval) {
                clearInterval(this.interval);
            }
            
            this.progresso = 0;
            this.tempoAtual = '0:00';
            this.duracao = this.formatarTempo(this.audio.duration);
        },
        atualizarProgresso() {
            if (!this.audio) return;
            
            this.tempoAtual = this.formatarTempo(this.audio.currentTime);
            this.progresso = (this.audio.currentTime / this.audio.duration) * 100;
        },
        async contabilizarPlay() {
            this.playContabilizado = true;
            
            try {
                const url = this.configsLoja.baseUrl + '/api/catalogo/contabilizar_play_audio';

                await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        tipo: 'produto',
                        produto: this.produtoId
                    })
                });
            } catch (error) {
                console.error('Erro ao contabilizar play:', error);
            }
        }
    },
    template: `
    <div class="fz-produto-conteudo__audio-descricao mb-1">
        <div class="fz-produto-conteudo__audio-container">
            <div class="fz-produto-conteudo__audio-box">
                <div class="fz-produto-conteudo__audio-conteudo">
                    <!-- Botão Play/Pause -->
                    <div class="fz-produto-conteudo__audio-btn-play">
                        <button 
                            type="button" 
                            @click="toggleAudio"
                            class="fz-produto-conteudo__audio-btn"
                            :aria-label="tocando ? 'Pausar áudio' : 'Reproduzir áudio'"
                        >
                            <i class="fa fa-fw" :class="tocando ? 'fa-pause' : 'fa-play'"></i>
                        </button>
                    </div>
                    
                    <!-- Waveform e controles -->
                    <div class="fz-produto-conteudo__audio-wave-container">
                        <div 
                            class="fz-produto-conteudo__audio-wave"
                            :style="{ 
                                backgroundImage: 'url(' + audioWaveUrl + '), linear-gradient(90deg, rgb(0, 0, 0) ' + progresso + '%, rgb(125, 125, 125) ' + progresso + '%)'
                            }"
                        ></div>
                        
                        <div class="fz-produto-conteudo__audio-info">
                            <span class="fz-produto-conteudo__audio-duracao">{{ tocando ? tempoAtual : duracao }}</span>
                            <span class="fz-produto-conteudo__audio-plays">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 485 485" class="fz-produto-conteudo__audio-icon-mic">
                                    <g>
                                        <path d="M242.5,0C160.048,0,92.969,67.079,92.969,149.531h30C122.969,83.621,176.59,30,242.5,30s119.531,53.621,119.531,119.531
                                            c0,14.859-2.692,29.357-8.002,43.09l-82.446,213.207C260.208,435.239,231.383,455,199.854,455h-51.885v30h51.885
                                            c21.999,0,43.13-6.637,61.111-19.191c17.554-12.258,30.901-29.257,38.599-49.16l82.446-213.207
                                            c6.65-17.197,10.022-35.336,10.022-53.91C392.031,67.079,324.952,0,242.5,0z"/>
                                        <path d="M167.969,316.563h-20v30h20c35.583,0,64.531-28.948,64.531-64.531c0-30.42-21.158-55.992-49.531-62.771v-69.729
                                            C182.969,116.706,209.674,90,242.5,90s59.531,26.706,59.531,59.531h30C332.031,100.163,291.868,60,242.5,60
                                            s-89.531,40.163-89.531,89.531V247.5h15c19.041,0,34.531,15.49,34.531,34.531S187.009,316.563,167.969,316.563z"/>
                                    </g>
                                </svg>
                                {{ totalPlaysExibicao }}
                            </span>
                            <span class="fz-produto-conteudo__audio-hora">{{ horaAtual }}</span>
                        </div>
                    </div>
                    
                    <!-- Foto do vendedor -->
                    <div class="fz-produto-conteudo__audio-vendedor">
                        <div 
                            class="fz-produto-conteudo__audio-vendedor-foto"
                            :style="vendedorImagem ? { backgroundImage: 'url(' + vendedorImagem + ')' } : {}"
                        >
                            <span v-if="!vendedorImagem" class="fz-produto-conteudo__audio-vendedor-inicial">
                                {{ vendedorInicial }}
                            </span>
                        </div>
                        <i class="fa fa-microphone fz-produto-conteudo__audio-vendedor-icone"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `
};

FZComponents.ProdutoModalDescricao = {
    components: {
        'p-divider': PrimeVue.Divider,
        'p-button': PrimeVue.Button
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        descricao: { type: String, required: true },
        produtoId: { type: [String, Number], required: true }
    },
    data() {
        return {
            expandido: false,
            alturaMaxima: 150,
            mostrarBotao: false
        };
    },
    mounted() {
        this.$nextTick(() => {
            this.verificarAltura();
        });
    },
    methods: {
        verificarAltura() {
            if (this.$refs.conteudoDescricao) {
                const altura = this.$refs.conteudoDescricao.scrollHeight;
                this.mostrarBotao = altura > this.alturaMaxima;
            }
        }
    },
    template: `
    <div class="fz-produto-conteudo__descricao mt-4">
        <p-divider align="left" type="solid" class="fz-produto-conteudo__divisoria">
            <i class="pi pi-align-left"></i> <b>Descrição do Produto</b>
        </p-divider>
        
        <div class="fz-produto-conteudo__descricao-wrapper">
            <div 
                ref="conteudoDescricao"
                class="fz-produto-conteudo__descricao-conteudo" 
                :class="{ 
                    'fz-produto-conteudo__descricao-conteudo--expandido': expandido,
                    'fz-produto-conteudo__descricao-conteudo--truncado': mostrarBotao && !expandido
                }"
                :style="!expandido && mostrarBotao ? { maxHeight: alturaMaxima + 'px', overflow: 'hidden' } : {}"
                v-html="descricao"
            ></div>
            
            <div v-if="mostrarBotao" class="fz-produto-conteudo__descricao-toggle mt-3 text-center">
                <p-button 
                    :label="expandido ? 'Ler Menos' : 'Ler Mais'" 
                    :icon="expandido ? 'pi pi-chevron-up' : 'pi pi-chevron-down'"
                    text
                    severity="primary"
                    @click="expandido = !expandido"
                    class="fz-produto-conteudo__btn-ler-mais"
                ></p-button>
            </div>
        </div>
    </div>`
};

FZComponents.ProdutoModalGuiaMedidas = {
    components: {
        'p-divider': PrimeVue.Divider
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: { type: Object, required: true }
    },
    computed: {
        guiaMedidas() {
            return this.produto.guia_medidas || null;
        }
    },
    template: `
    <div class="fz-produto-conteudo__guia-medidas mt-4">
        <p-divider align="left" type="solid" class="fz-produto-conteudo__divisoria">
            <i class="ti-ruler-alt"></i> <b>Guia de Medidas</b>
        </p-divider>
        
        <div class="fz-produto-conteudo__guia-medidas-conteudo" v-html="guiaMedidas"></div>
    </div>`
};

FZComponents.ProdutoModalSimuladorFrete = {
    components: {
        'p-divider': PrimeVue.Divider,
        'fz-simulador-frete-formulario': FZComponents.SimuladorFreteFormulario
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: { type: Object, required: true }
    },
    computed: {
        quantidadeTotal() {
            const catalogoId = this.configsLoja.catalogoId;
            const quantidades = this.conteudoStore.quantidadesSelecionadas[this.produto.id] || {};
            
            let total = 0;
            Object.values(quantidades).forEach(qtd => {
                total += parseInt(qtd) || 0;
            });
            
            return total;
        },
        precoTotal() {
            const preco = parseFloat(this.produto.preco_venda) || 0;
            return preco * this.quantidadeTotal;
        }
    },
    methods: {
        handleSimular({ cep, pais }) {
            this.abrirDialogSimuladorFrete(
                cep,
                pais,
                this.produto.id,
                this.quantidadeTotal,
                this.precoTotal
            );
        }
    },
    template: `
    <div class="fz-produto-conteudo__frete mt-4 mb-3">
        <p-divider align="left" type="solid" class="fz-produto-conteudo__divisoria">
            <i class="pi pi-truck"></i> <b>Simular Frete</b>
        </p-divider>

        <fz-simulador-frete-formulario
            :produto-id="produto.id"
            :compact="true"
            @simular="handleSimular"
        ></fz-simulador-frete-formulario>
    </div>`
};

FZComponents.ProdutoModalProdutosRelacionados = {
    components: {
        'p-divider': PrimeVue.Divider,
        'fz-produto': FZComponents.Produto
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: { type: Object, required: true }
    },
    data() {
        return {
            swiperRelacionados: null
        };
    },
    computed: {
        produtos() {
            if (!Array.isArray(this.produto.produtos_relacionados)) {
                return [];
            }

            return this.produto.produtos_relacionados;
        },
        temProdutos() {
            return this.produtos.length > 0;
        }
    },
    mounted() {
        if (this.temProdutos) {
            this.$nextTick(() => {
                this.initSwiper();
            });
        }
    },
    beforeUnmount() {
        if (this.swiperRelacionados) {
            this.swiperRelacionados.destroy();
        }
    },
    methods: {
        initSwiper() {
            const elem = this.$refs.swiperRelacionados;
            if (!elem || typeof Swiper === 'undefined') return;
            
            this.swiperRelacionados = new Swiper(elem, {
                slidesPerView: "auto",
                spaceBetween: 1,
                autoplay: {
                    delay: 4000,
                    disableOnInteraction: true,
                },
                navigation: {
                    nextEl: '.swiper-button-next.relacionados',
                    prevEl: '.swiper-button-prev.relacionados'
                }
            });
        }
    },
    template: `
    <div v-if="temProdutos" class="fz-produto-conteudo__relacionados mt-4">
        <p-divider align="left" type="solid" class="fz-produto-conteudo__divisoria">
            <i class="ti-layout-grid2"></i> <b>Produtos Relacionados</b>
        </p-divider>
        
        <div ref="swiperRelacionados" class="fz-produto-conteudo__relacionados-carousel swiper" style="position: relative;">
            <div class="swiper-wrapper">
                <div v-for="produtoRelacionado in produtos" :key="produtoRelacionado.id" class="swiper-slide fz-produto-conteudo__relacionados-item">
                    <fz-produto :produto="produtoRelacionado"></fz-produto>
                </div>
            </div>
            <div class="fz-produto-conteudo__relacionados-nav-proximo swiper-button-next relacionados"></div>
            <div class="fz-produto-conteudo__relacionados-nav-anterior swiper-button-prev relacionados"></div>
        </div>
    </div>`
};

FZComponents.ProdutoModalComentarios = {
    components: {
        'p-divider': PrimeVue.Divider,
        'p-skeleton': PrimeVue.Skeleton,
        'p-paginator': PrimeVue.Paginator,
        'p-textarea': PrimeVue.Textarea,
        'p-button': PrimeVue.Button,
        'p-message': PrimeVue.Message
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: { type: Object, required: true }
    },
    data() {
        return {
            perguntas: [],
            carregando: false,
            novoComentario: '',
            enviando: false,
            erro: null,
            paginaAtual: 1,
            totalRegistros: 0,
            porPagina: 10
        };
    },
    computed: {
        temPerguntas() {
            return this.perguntas.length > 0;
        },
        podeEnviarComentario() {
            return this.configsLoja.clienteLogado || this.configsLoja.visitanteLogado;
        },
        caracteresRestantes() {
            return 500 - (this.novoComentario?.length || 0);
        },
        cacheKey() {
            return `comentarios_${this.produto.id}`;
        },
        totalPaginas() {
            return Math.ceil(this.totalRegistros / this.porPagina);
        }
    },
    mounted() {
        this.carregarComentarios(1);
    },
    methods: {
        async carregarComentarios(pagina = 1) {
            const cache = this.conteudoStore.cacheProdutos[this.produto.id]?.comentarios;
            if (cache && cache.paginaAtual === pagina && Date.now() - cache.timestamp < 60000) {
                this.perguntas = cache.perguntas;
                this.totalRegistros = cache.total;
                this.paginaAtual = pagina;
                return;
            }

            this.carregando = true;
            this.erro = null;

            try {
                const url = this.obterLinkCatalogo(`produto/${this.produto.id}?comentarios&pagina=${pagina}`);
                const response = await fetch(url);
                const data = await response.json();

                this.perguntas = data.perguntas || [];
                this.totalRegistros = data.total || 0;
                this.porPagina = data.porPagina || 10;
                this.paginaAtual = pagina;

                if (!this.conteudoStore.cacheProdutos[this.produto.id]) {
                    this.conteudoStore.cacheProdutos[this.produto.id] = {};
                }
                this.conteudoStore.cacheProdutos[this.produto.id].comentarios = {
                    perguntas: this.perguntas,
                    total: this.totalRegistros,
                    paginaAtual: pagina,
                    timestamp: Date.now()
                };
            } catch (error) {
                console.error('[Comentários] Erro ao carregar comentários:', error);
                this.erro = 'Erro ao carregar comentários.';
            } finally {
                this.carregando = false;
            }
        },
        limparCache() {
            if (this.conteudoStore.cacheProdutos[this.produto.id]?.comentarios) {
                delete this.conteudoStore.cacheProdutos[this.produto.id].comentarios;
            }
        },
        formatarData(data) {
            const date = new Date(data);
            return date.toLocaleDateString('pt-BR');
        },
        getNomePergunta(pergunta) {
            if (pergunta.nome) {
                return this.limitarNome(pergunta.nome);
            } else if (pergunta.cliente_nome) {
                return this.limitarNome(pergunta.cliente_nome);
            }
            return 'Anônimo';
        },
        limitarNome(nome) {
            const palavras = nome.split(' ');
            const primeiroNome = palavras[0];
            return primeiroNome.length > 15 ? primeiroNome.substring(0, 15) : primeiroNome;
        },
        getTelefone(pergunta) {
            // Simplificado - formatação i18n será adicionada depois
            if (pergunta.cliente_whatsapp) {
                return pergunta.cliente_whatsapp;
            } else if (pergunta.whatsapp) {
                return pergunta.whatsapp;
            }
            return '';
        },
        parseMensagem(mensagem) {
            if (!mensagem) return '';
            try {
                const parsed = JSON.parse(mensagem);
                return parsed.replace(/\n/g, '<br>');
            } catch (e) {
                return mensagem.replace(/\n/g, '<br>');
            }
        },
        async enviarComentario() {
            if (!this.novoComentario.trim()) {
                this.showNotification('Digite o comentário!', 'info');
                return;
            }

            if (this.novoComentario.length > 500) {
                this.showNotification('O comentário deve ter no máximo 500 caracteres.', 'warn');
                return;
            }

            this.enviando = true;
            this.erro = null;

            try {
                const formData = new FormData();
                formData.append('acao', 'enviar_pergunta');
                formData.append('produto', this.produto.id);
                formData.append('pergunta', this.novoComentario.trim());

                const response = await fetch(this.configsLoja.urlCatalogo, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.sucesso) {
                    this.novoComentario = '';
                    this.showNotification('Comentário enviado com sucesso!', 'success');
                    
                    this.limparCache();
                    this.carregarComentarios(1);
                } else {
                    this.showNotification(data?.mensagem || 'Houve um erro! Tente novamente mais tarde.', 'error');
                }
            } catch (error) {
                this.showNotification('Erro ao enviar comentário. Tente novamente.', 'error');
            } finally {
                this.enviando = false;
            }
        },
        onPageChange(event) {
            this.carregarComentarios(event.page + 1);
        },
        showNotification(message, type) {
            if (typeof showNotification2 === 'function') {
                showNotification2(message, type);
            }
        },
        abrirLoginVisitante() {
            if (typeof abrirModalLoginVisitante === 'function') {
                this.dialogDrawerStore.isOpen = false;
                abrirModalLoginVisitante('recarregar');
            }
        }
    },
    template: `
    <div class="fz-produto-conteudo__comentarios mt-4">
        <p-divider align="left" type="solid">
            <i class="pi pi-comments"></i> <b>Comentários</b>
        </p-divider>

        <!-- Loading Skeleton -->
        <div v-if="carregando" class="fz-produto-conteudo__comentarios-loading">
            <p-skeleton v-for="n in 2" :key="n" height="40px" class="mb-3"></p-skeleton>
        </div>

        <!-- Lista de Comentários -->
        <div v-else class="fz-produto-conteudo__comentarios-lista mb-3">
            <template v-if="temPerguntas">
                <div v-for="(pergunta, index) in perguntas" :key="index" class="fz-produto-conteudo__comentario">
                    <!-- Cabeçalho do Comentário -->
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fa fa-user-circle text-muted" style="font-size: 1.2rem;"></i>
                            <div>
                                <div class="font-weight-bold" style="font-size: 14px;">
                                    {{ getNomePergunta(pergunta) }}
                                    <span v-if="getTelefone(pergunta)" class="text-muted font-weight-normal ml-1" style="font-size: 12px;">
                                        {{ getTelefone(pergunta) }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <small class="text-muted">
                            <i class="fa fa-calendar"></i> {{ formatarData(pergunta.created_at) }}
                        </small>
                    </div>

                    <!-- Mensagem do Comentário -->
                    <div class="fz-produto-conteudo__comentario-mensagem" v-html="parseMensagem(pergunta.mensagem)"></div>

                    <!-- Resposta da Loja -->
                    <div v-if="pergunta.resposta" class="fz-produto-conteudo__comentario-resposta mt-2">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="font-weight-bold text-success" style="font-size: 13px;">
                                <i class="fa fa-store"></i> {{ configsLoja.nomeLoja }}
                            </div>
                            <small class="text-muted">
                                <i class="fa fa-calendar"></i> {{ formatarData(pergunta.resposta_data) }}
                            </small>
                        </div>
                        <div class="text-dark" v-html="parseMensagem(pergunta.resposta)"></div>
                    </div>
                </div>
            </template>

            <!-- Mensagem quando não há comentários -->
            <div v-else class="fz-produto-conteudo__sem-comentarios p-3 rounded text-center">
                <p class="mb-0 text-muted">
                    Nenhum comentário neste produto ainda.<br/>
                    Que tal enviar o primeiro comentário?
                </p>
            </div>
        </div>

        <!-- Paginação -->
        <p-paginator
            v-if="totalPaginas > 1"
            :rows="porPagina"
            :totalRecords="totalRegistros"
            :first="(paginaAtual - 1) * porPagina"
            @page="onPageChange"
            class="mb-3"
        ></p-paginator>

        <!-- Formulário de Novo Comentário -->
        <div class="fz-produto-conteudo__novo-comentario">
            <template v-if="!podeEnviarComentario">
                <div class="text-center">
                    <p-button 
                        label="Enviar Comentário" 
                        icon="fa fa-sign-in"
                        severity="primary"
                        @click="abrirLoginVisitante"
                    ></p-button>
                </div>
            </template>

            <template v-else>
                <div class="fz-produto-conteudo__form-comentario">
                    <label class="font-weight-bold mb-2">Envie um Comentário:</label>
                    <p-textarea
                        v-model="novoComentario"
                        rows="4"
                        :disabled="enviando"
                        placeholder="Digite seu comentário aqui..."
                        :maxlength="500"
                        class="w-100 mb-1"
                        :auto-resize="true"
                    ></p-textarea>
                    <small class="fz-produto-conteudo__contador-caracteres text-muted d-block mb-2">
                        {{ caracteresRestantes }} caracteres restantes
                    </small>

                    <div class="text-center">
                        <p-button
                            label="Enviar Comentário"
                            icon="fa fa-paper-plane"
                            severity="primary"
                            :loading="enviando"
                            :disabled="enviando || !novoComentario.trim()"
                            @click="enviarComentario"
                        ></p-button>
                    </div>
                </div>
            </template>
        </div>
    </div>
    `
};

FZComponents.ProdutoModalAviseMeForm = {
    components: {
        'p-message': PrimeVue.Message,
        'p-inputtext': PrimeVue.InputText,
        'p-button': PrimeVue.Button,
        'fz-input-phone': FZComponents.InputPhone
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produto: {
            type: Object,
            required: true
        }
    },
    data() {
        return {
            nome: '',
            whatsapp: {
                raw: '',
                e164: '',
                ddi: '',
                country: '',
                valid: false
            },
            enviando: false,
            sucesso: false,
            erro: null
        };
    },
    computed: {
        formularioValido() {
            return this.nome && this.whatsapp.valid;
        }
    },
    methods: {
        async enviarAviseMe() {
            if (!this.formularioValido) {
                this.erro = 'Preencha todos os campos corretamente';
                return;
            }
            
            this.enviando = true;
            this.erro = null;
            
            try {
                const formData = new FormData();
                formData.append('acao', 'avise_me');
                formData.append('produto', this.produto.id);
                formData.append('nome', this.nome);
                formData.append('whatsapp', this.whatsapp.raw);
                formData.append('whatsapp_e164', this.whatsapp.e164);
                formData.append('whatsapp_ddi', this.whatsapp.ddi);
                formData.append('whatsapp_country', this.whatsapp.country);
                
                const response = await fetch(this.obterLinkCatalogo(''), {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    this.sucesso = true;
                    this.nome = '';
                    this.whatsapp = {
                        raw: '',
                        e164: '',
                        ddi: '',
                        country: '',
                        valid: false
                    };
                } else {
                    this.erro = result.erro || 'Erro ao enviar solicitação';
                }
            } catch (error) {
                this.erro = 'Erro ao enviar solicitação';
                console.error(error);
            } finally {
                this.enviando = false;
            }
        }
    },
    template: `
    <div class="fz-produto-conteudo__avise-me p-3 bg-light rounded">
        <h5 class="fz-produto-conteudo__avise-me-titulo mb-3">
            <i class="fz-produto-conteudo__avise-me-icone pi pi-bell"></i> Avise-me quando chegar
        </h5>
        
        <p-message 
            v-if="sucesso" 
            severity="success" 
            size="small"
            :closable="false"
            icon="pi pi-check"
            class="mb-3"
        >
            Solicitação enviada com sucesso! Você será notificado quando o produto estiver disponível.
        </p-message>
        
        <form v-else @submit.prevent="enviarAviseMe" class="fz-produto-conteudo__avise-me-formulario">
            <div class="fz-produto-conteudo__avise-me-campo mb-3">
                <label class="fz-produto-conteudo__avise-me-label form-label">Nome:</label>
                <p-inputtext
                    v-model="nome"
                    type="text"
                    placeholder="Seu nome"
                    :required="true"
                    class="w-100"
                ></p-inputtext>
            </div>
            
            <div class="fz-produto-conteudo__avise-me-campo mb-3">
                <label class="fz-produto-conteudo__avise-me-label form-label">WhatsApp:</label>
                <fz-input-phone 
                    v-model="whatsapp"
                    placeholder="(00) 00000-0000"
                    :required="true"
                    :disabled="enviando"
                    size="normal"
                ></fz-input-phone>
                <p-message 
                    v-if="whatsapp.raw && !whatsapp.valid" 
                    severity="error" 
                    size="small"
                    :closable="false"
                    icon="pi pi-exclamation-triangle"
                    class="mt-2"
                >
                    Número de telefone inválido
                </p-message>
            </div>
            
            <p-message 
                v-if="erro" 
                severity="error" 
                size="small"
                :closable="false"
                icon="pi pi-exclamation-triangle"
                class="mb-3"
            >
                {{ erro }}
            </p-message>
            
            <p-button 
                type="submit"
                :label="enviando ? 'Enviando...' : 'Avise-me'"
                icon="pi pi-bell"
                :loading="enviando"
                :disabled="!formularioValido"
                severity="primary"
                class="w-100"
            ></p-button>
        </form>
    </div>
    `
};

// ============================================================================
// MAIN COMPONENTS
// ============================================================================

FZComponents.ProdutoConteudo = {
    components: {
        'p-message': PrimeVue.Message,
        'fz-produto-modal-skeleton': FZComponents.ProdutoModalSkeleton,
        'fz-produto-modal-skeleton-detalhes': FZComponents.ProdutoModalSkeletonDetalhes,
        'fz-produto-modal-carousel': FZComponents.ProdutoModalCarousel,
        'fz-produto-modal-header': FZComponents.ProdutoModalHeader,
        'fz-produto-modal-audio-descricao': FZComponents.ProdutoModalAudioDescricao,
        'fz-variacao-sem-variacao': FZComponents.VariacaoSemVariacao,
        'fz-variacao-com-variacao': FZComponents.VariacaoComVariacao,
        'fz-variacao-com-subgrupos-variacao': FZComponents.VariacaoComSubgruposVariacao,
        'fz-variacao-com-grade': FZComponents.VariacaoComGrade,
        'fz-produto-modal-footer': FZComponents.ProdutoModalFooter,
        'fz-produto-modal-descricao': FZComponents.ProdutoModalDescricao,
        'fz-produto-modal-guia-medidas': FZComponents.ProdutoModalGuiaMedidas,
        'fz-produto-modal-produtos-relacionados': FZComponents.ProdutoModalProdutosRelacionados,
        'fz-produto-modal-comentarios': FZComponents.ProdutoModalComentarios,
        'fz-produto-modal-avise-me-form': FZComponents.ProdutoModalAviseMeForm,
        'fz-produto-modal-simulador-frete': FZComponents.ProdutoModalSimuladorFrete,
        'fz-dialog-regras-precos': FZComponents.DialogRegrasPrecos,
        'fz-dialog-video-externo': FZComponents.DialogVideoExterno,
        'fz-produto-preco': FZComponents.ProdutoPreco,
        'fz-simulador-parcelas-melhor-parcelamento': FZComponents.SimuladorParcelasMelhorParcelamento,
        'fz-simulador-frete-formulario': FZComponents.SimuladorFreteFormulario,
        'fz-produto-acoes': FZComponents.ProdutoAcoes
    },
    mixins: [ProdutoConteudoMixin],
    props: {
        produtoInicial: {
            type: Object,
            required: true
        },
        carregarDadosCompletos: {
            type: Boolean,
            default: true
        },
        contexto: {
            type: String,
            default: 'dialog-drawer',
            validator: (value) => ['dialog-drawer', 'pagina'].includes(value)
        }
    },
    emits: ['produto-carregado', 'erro-carregamento', 'estatistica-enviada', 'voltar'],
    data() {
        return {
            store: ProdutoConteudoStore
        };
    },
    computed: {
        produto() {
            return this.store.dadosCompletos || this.produtoInicial;
        },
        produtoSomenteId() {
            const produto = this.produtoInicial;
            if (!produto) return false;
            const keys = Object.keys(produto);
            return keys.length === 1 && keys[0] === 'id';
        },
        carregandoDados() {
            return this.store.carregando && !this.store.dadosCompletos;
        },
        dadosCompletos() {
            return !!this.store.dadosCompletos;
        },
        produtoIndisponivelEstoque() {
            if (!this.produto) return true;
            if (this.produto.controlar_estoque != "1") return false;
            return this.produto.total_estoque <= 0 || this.produto.grade_quebrada;
        },
        exibirAviseMeForm() {
            return this.produtoIndisponivelEstoque && 
                   this.configsLoja.habilitarAviseMeQuandoChegar;
        }
    },
    watch: {
        produtoInicial: {
            handler(newProduto, oldProduto) {
                if (newProduto && newProduto.id) {
                    const produtoMudou = !oldProduto || newProduto.id !== oldProduto.id;
                    if (produtoMudou) {
                        this.inicializarProduto();
                    }
                }
            },
            immediate: true
        },
        'store.dadosCompletos'(newValue, oldValue) {
            // Se dadosCompletos foi resetado (null) e temos um produto inicial válido,
            // precisamos reinicializar para carregar os dados novamente
            if (newValue === null && oldValue !== null && this.produtoInicial?.id) {
                this.inicializarProduto();
            }
        }
    },
    mounted() {
        AudioManager.init(this.configsLoja);
    },
    methods: {
        async inicializarProduto() {
            if (!this.produtoInicial?.id) return;
            
            const produtoId = this.produtoInicial.id;
            this.store.produtoId = produtoId;
            this.store.produtoInicial = this.produtoInicial;
            this.store.tempoAberto = Date.now();
            this.store.estatisticaEnviada = false;
            
            if (typeof facilZapEventos !== 'undefined' && facilZapEventos.verProduto) {
                facilZapEventos.verProduto(produtoId, this.produtoInicial.nome, this.produtoInicial.preco);
            }
            
            if (this.store.cacheProdutos[produtoId]) {
                this.store.dadosCompletos = this.store.cacheProdutos[produtoId];
                this.$emit('produto-carregado', this.store.dadosCompletos);
            } else {
                const keys = Object.keys(this.produtoInicial);
                const somenteId = keys.length === 1 && keys[0] === 'id';

                if (somenteId) {
                    await this.carregarDadosCompletosAPI();
                } else {
                    this.store.dadosCompletos = this.produtoInicial;
                    this.store.cacheProdutos[produtoId] = this.produtoInicial;

                    this.$emit('produto-carregado', this.produtoInicial);
                }
            }
            
            setTimeout(() => {
                this.enviarEstatistica();
            }, 2000);
        },
        async carregarDadosCompletosAPI() {
            if (!this.produtoInicial?.id) return;
            
            const produtoId = this.produtoInicial.id;
            
            if (this.store.cacheProdutos[produtoId]) {
                this.store.dadosCompletos = this.store.cacheProdutos[produtoId];
                this.$emit('produto-carregado', this.store.dadosCompletos);
                return;
            }
            
            this.store.carregando = true;
            this.store.erro = null;
            
            try {
                const url = this.obterLinkCatalogo(`produto/${produtoId}`) + '?ajax=ajax';
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar produto');
                }
                
                const data = await response.json();
                this.store.cacheProdutos[produtoId] = data;
                this.store.dadosCompletos = data;
                this.$emit('produto-carregado', data);
            } catch (error) {
                console.error('Erro ao carregar dados do produto:', error);
                this.store.erro = 'Erro ao carregar informações do produto';
                this.$emit('erro-carregamento', error);
            } finally {
                this.store.carregando = false;
            }
        },
        async enviarEstatistica() {
            if (this.store.estatisticaEnviada || !this.produto?.id) return;
            
            const tempoAberto = Date.now() - this.store.tempoAberto;
            if (tempoAberto < 2000) return;
            
            const produtoId = Number(this.produto.id);
            
            if (this.store.estatisticasEnviadas.has(produtoId)) {
                this.store.estatisticaEnviada = true;
                return;
            }
            
            try {
                const url = this.obterLinkCatalogo(`produto/${produtoId}`) + '?estatisticas&ajax=ajax';
                await fetch(url);
                
                this.store.estatisticasEnviadas.add(produtoId);
                this.store.estatisticaEnviada = true;
                this.$emit('estatistica-enviada', produtoId);
            } catch (error) {
                console.error('Erro ao enviar estatística:', error);
            }
        },
        handleVoltar() {
            this.$emit('voltar');
        }
    },
    template: `
    <div class="fz-produto-conteudo">
        <!-- Error State -->
        <div v-if="store.erro" class="fz-produto-conteudo__erro p-4">
            <p-message severity="error" :closable="false">
                {{ store.erro }}
            </p-message>
        </div>
        
        <!-- Loading Skeleton - Full (when product has only ID) -->
        <div v-else-if="produtoSomenteId && carregandoDados" class="fz-produto-conteudo__container container-fluid p-4">
            <fz-produto-modal-skeleton></fz-produto-modal-skeleton>
        </div>
        
        <!-- Product Content -->
        <div v-else-if="produto" class="fz-produto-conteudo__container container-fluid p-4">
            <div class="row">
                <!-- Left Column - Images -->
                <div class="fz-produto-conteudo__coluna-esquerda col-12 col-lg-6 mb-4 mb-lg-0">
                    <fz-produto-modal-carousel
                        :produto="produto"
                    ></fz-produto-modal-carousel>
                </div>
                
                <!-- Right Column - Details -->
                <div class="fz-produto-conteudo__coluna-direita col-12 col-lg-6">
                    <fz-produto-modal-header
                        :produto="produto"
                    ></fz-produto-modal-header>
                    
                    <fz-produto-modal-audio-descricao
                        v-if="dadosCompletos && produto.audio_descricao"
                        :audio-path="produto.audio_descricao"
                        :produto-id="produto.id"
                        :vendedor-nome="configsLoja.vendedorNome || ''"
                        :vendedor-foto="configsLoja.vendedorFoto || ''"
                        :total-plays="produto.total_plays_audio || 0"
                    ></fz-produto-modal-audio-descricao>
                    
                    <!-- Skeleton for data that needs complete fetch -->
                    <fz-produto-modal-skeleton-detalhes v-if="carregandoDados"></fz-produto-modal-skeleton-detalhes>
                    
                    <!-- Complete data content -->
                    <div v-else class="fz-produto-conteudo__dados-completos">
                        <!-- Pricing & Simulator -->
                        <div v-if="!configsLoja.somenteOrcamentos && !configsLoja.precosRestritos" class="fz-produto-conteudo__preco-simulador py-2">
                            <div class="d-flex justify-content-between align-items-start flex-wrap" style="gap: 1rem;">
                                <div class="fz-produto-conteudo__preco flex-grow-0">
                                    <fz-produto-preco
                                        :produto="produto"
                                        :somente-orcamentos="configsLoja.somenteOrcamentos"
                                        :precos-restritos="configsLoja.precosRestritos"
                                        :pagina-live="false"
                                        :ativar-simulador-parcelas="configsLoja.ativarSimuladorParcelas"
                                        alinhamento="esquerda"
                                    ></fz-produto-preco>
                                </div>
                                
                                <div v-if="configsLoja.ativarSimuladorParcelas && !produto.venda_externa" class="fz-produto-conteudo__simulador-parcelamento flex-shrink-0 text-right">
                                    <fz-simulador-parcelas-melhor-parcelamento
                                        :produto="produto"
                                        :simulacao="produto.simulacao_parcelas"
                                        :abrir-modal="true"
                                        alinhamento="modal"
                                    ></fz-simulador-parcelas-melhor-parcelamento>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Avise-me Form (if out of stock) -->
                        <div v-if="exibirAviseMeForm" class="fz-produto-conteudo__avise-me-container py-3">
                            <fz-produto-modal-avise-me-form
                                :produto="produto"
                            ></fz-produto-modal-avise-me-form>
                        </div>
                        
                        <!-- Variations / Quantity (if in stock) -->
                        <div v-else-if="!produto.venda_externa && !configsLoja.precosRestritos" class="fz-produto-conteudo__variacoes-container">
                            <!-- Venda em Grade -->
                            <template v-if="produto.grade && !isEmpty(produto.grade)">
                                <fz-variacao-com-grade
                                    :produto="produto"
                                    :catalogo-id="configsLoja.catalogoId"
                                    :carrinho="configsLoja.carrinho || {}"
                                    :exibir-sku="true"
                                    :exibir-descontos="true"
                                    :video-ativo="!isEmpty(produto.video)"
                                    :variacoes-isoladas="false"
                                ></fz-variacao-com-grade>
                            </template>
                            
                            <!-- Produto com subgrupos de variações -->
                            <template v-else-if="produto.subgrupos_variacoes && !isEmpty(produto.subgrupos_variacoes)">
                                <fz-variacao-com-subgrupos-variacao
                                    :produto="produto"
                                    :catalogo-id="configsLoja.catalogoId"
                                    :carrinho="configsLoja.carrinho || {}"
                                    :somente-orcamentos="configsLoja.somenteOrcamentos"
                                    :precos-restritos="configsLoja.precosRestritos"
                                    :exibir-preco="true"
                                    :exibir-sku="true"
                                    :exibir-divisoria="true"
                                    :exibir-descontos="true"
                                    :video-ativo="!isEmpty(produto.video)"
                                    :variacoes-isoladas="false"
                                ></fz-variacao-com-subgrupos-variacao>
                            </template>
                            
                            <!-- Produto com variações simples -->
                            <template v-else-if="produto.variacoes && !isEmpty(produto.variacoes)">
                                <fz-variacao-com-variacao
                                    :produto="produto"
                                    :catalogo-id="configsLoja.catalogoId"
                                    :carrinho="configsLoja.carrinho || {}"
                                    :somente-orcamentos="configsLoja.somenteOrcamentos"
                                    :precos-restritos="configsLoja.precosRestritos"
                                    :exibir-preco="true"
                                    :exibir-sku="true"
                                    :exibir-divisoria="true"
                                    :exibir-descontos="true"
                                    :video-ativo="!isEmpty(produto.video)"
                                ></fz-variacao-com-variacao>
                            </template>
                            
                            <!-- Produto sem variações -->
                            <template v-else>
                                <fz-variacao-sem-variacao
                                    :produto="produto"
                                    :catalogo-id="configsLoja.catalogoId"
                                    :carrinho="configsLoja.carrinho || {}"
                                    :exibir-sku="true"
                                    :exibir-descontos="true"
                                ></fz-variacao-sem-variacao>
                            </template>
                        </div>
                        
                        <!-- Simulators -->
                        <div v-if="!produtoIndisponivelEstoque" class="fz-produto-conteudo__simuladores">
                            <!-- Shipping Simulator -->
                            <fz-produto-modal-simulador-frete
                                v-if="configsLoja.habilitarSimuladorFreteProduto"
                                :produto="produto"
                            ></fz-produto-modal-simulador-frete>
                        </div>

                        <!-- Action Buttons Footer -->
                        <fz-produto-modal-footer
                            :contexto="contexto"
                            :produto="produto"
                        ></fz-produto-modal-footer>
                    </div>
                </div>
            </div>
            
            <!-- Additional Content Sections -->
            <div class="fz-produto-conteudo__secoes-adicionais row">
                <div class="col-12">
                    <fz-produto-modal-descricao
                        v-if="dadosCompletos && produto.descricao"
                        :descricao="produto.descricao"
                        :produto-id="produto.id"
                    ></fz-produto-modal-descricao>
                    
                    <fz-produto-modal-guia-medidas
                        v-if="dadosCompletos && produto.guia_medidas"
                        :produto="produto"
                    ></fz-produto-modal-guia-medidas>
                    
                    <fz-produto-modal-produtos-relacionados
                        v-if="dadosCompletos && configsLoja.exibirProdutosRelacionadosTelaProduto"
                        :produto="produto"
                    ></fz-produto-modal-produtos-relacionados>
                    
                    <fz-produto-modal-comentarios
                        v-if="dadosCompletos && configsLoja.exibirComentariosTelaProduto"
                        :produto="produto"
                    ></fz-produto-modal-comentarios>
                </div>
            </div>
        </div>

        <!-- Loading Skeleton -->
        <div v-else-if="carregandoDados" class="p-4">
            <fz-produto-modal-skeleton></fz-produto-modal-skeleton>
        </div>
        
        <!-- Dialog de Regras de Preços -->
        <fz-dialog-regras-precos></fz-dialog-regras-precos>
        
        <!-- Dialog de Vídeo Externo -->
        <fz-dialog-video-externo></fz-dialog-video-externo>
    </div>
    `
};

FZComponents.ProdutoDialogDrawer = {
    components: {
        'p-dialog': PrimeVue.Dialog,
        'p-drawer': PrimeVue.Drawer,
        'p-button': PrimeVue.Button,
        'fz-produto-conteudo': FZComponents.ProdutoConteudo
    },
    mixins: [ProdutoConteudoMixin],
    data() {
        return {
            isMobile: false,
            navegando: false
        };
    },
    computed: {
        visible: {
            get() {
                return this.dialogDrawerStore.isOpen;
            },
            set(value) {
                if (!value) {
                    this.dialogDrawerStore.isOpen = false;
                }
            }
        },
        produtoAtual() {
            return this.conteudoStore.produtoInicial;
        },
        useDrawer() {
            return this.isMobile;
        },
        useDialog() {
            return !this.isMobile;
        },
        temNavegacao() {
            return this.visible && this.dialogDrawerStore.ordemProdutos && this.dialogDrawerStore.ordemProdutos.length > 1;
        },
        temProdutoAnterior() {
            return this.temNavegacao && this.dialogDrawerStore.indiceProdutoAtual > 0;
        },
        temProximoProduto() {
            return this.temNavegacao && this.dialogDrawerStore.indiceProdutoAtual < this.dialogDrawerStore.ordemProdutos.length - 1;
        },
        posicaoAtual() {
            if (!this.temNavegacao) return '';
            const indiceAtual = Math.max(1, this.dialogDrawerStore.indiceProdutoAtual + 1);
            return `${indiceAtual} de ${this.dialogDrawerStore.ordemProdutos.length}`;
        },
        proximoDoFimDaLista() {
            const margem = 3;
            return this.temNavegacao && 
                   (this.dialogDrawerStore.ordemProdutos.length - this.dialogDrawerStore.indiceProdutoAtual) <= margem;
        }
    },
    watch: {
        'dialogDrawerStore.isOpen'(isOpen) {
            if (isOpen) {
                this.aoAbrirDialogDrawer();
            } else {
                this.aoFecharDialogDrawer();
            }
        }
    },
    mounted() {
        this.checkViewport();
        
        window.addEventListener('hashchange', this.handleHashChange);
        window.addEventListener('keydown', this.handleKeydown);
        this.handleHashChange();
    },
    beforeUnmount() {
        window.removeEventListener('hashchange', this.handleHashChange);
        window.removeEventListener('keydown', this.handleKeydown);
    },
    methods: {
        checkViewport() {
            this.isMobile = window.innerWidth < 992;
        },
        handleHashChange() {
            const hash = window.location.hash;
            const match = hash.match(/#produto(\d+)/);
            
            if (match) {
                const produtoId = match[1];

                this.dialogDrawerStore.ordemProdutos.unshift(produtoId);

                if (this.conteudoStore.produtoId !== produtoId) {
                    window.abrirModalProdutoVue({ id: produtoId });
                }
            } else if (this.dialogDrawerStore.isOpen) {
                this.fecharDialogDrawer();
            }
        },
        handleKeydown(event) {
            if (!this.dialogDrawerStore.isOpen) return;
            
            const tagName = event.target.tagName.toLowerCase();
            if (tagName === 'input' || tagName === 'textarea') return;
            
            if (event.key === 'ArrowLeft') {
                event.preventDefault();
                this.irParaProdutoAnterior();
            } else if (event.key === 'ArrowRight') {
                event.preventDefault();
                this.irParaProximoProduto();
            }
        },
        verificarCarregarMaisProdutos() {
            if (this.proximoDoFimDaLista) {
                const event = new CustomEvent('fz-carregar-mais-produtos');
                window.dispatchEvent(event);
            }
        },
        async irParaProdutoAnterior() {
            if (!this.temProdutoAnterior || this.navegando) return;
            
            const novoIndice = this.dialogDrawerStore.indiceProdutoAtual - 1;
            const produtoId = this.dialogDrawerStore.ordemProdutos[novoIndice];
            
            if (!produtoId) return;
            
            this.navegando = true;
            this.dialogDrawerStore.indiceProdutoAtual = novoIndice;
            
            await Vue.nextTick();
            
            const produtoCache = this.conteudoStore.cacheProdutos[produtoId];
            if (produtoCache) {
                window.abrirModalProdutoVue(produtoCache, false);
            } else {
                window.abrirModalProdutoVue({ id: produtoId });
            }
            
            await new Promise(resolve => setTimeout(resolve, 100));
            this.navegando = false;
        },
        async irParaProximoProduto() {
            if (!this.temProximoProduto || this.navegando) return;
            
            const novoIndice = this.dialogDrawerStore.indiceProdutoAtual + 1;
            const produtoId = this.dialogDrawerStore.ordemProdutos[novoIndice];
            
            if (!produtoId) return;
            
            this.navegando = true;
            this.dialogDrawerStore.indiceProdutoAtual = novoIndice;
            
            this.verificarCarregarMaisProdutos();
            
            await Vue.nextTick();
            
            const produtoCache = this.conteudoStore.cacheProdutos[produtoId];
            if (produtoCache) {
                window.abrirModalProdutoVue(produtoCache, false);
            } else {
                window.abrirModalProdutoVue({ id: produtoId }, false);
            }
            
            await new Promise(resolve => setTimeout(resolve, 100));
            this.navegando = false;
        },
        aoAbrirDialogDrawer() {
            if (this.produtoAtual?.id) {
                window.location.hash = `produto${this.produtoAtual.id}`;
            }
            
            const scrollContainer = this.isMobile 
                ? document.querySelector('.p-drawer-content')
                : document.querySelector('.p-dialog-content');
            if (scrollContainer) {
                scrollContainer.scrollTop = 0;
            }
        },
        aoFecharDialogDrawer() {
            if (window.location.hash.startsWith('#produto')) {
                history.replaceState('', document.title, window.location.pathname);
            }
            
            setTimeout(() => {
                this.conteudoStore.produtoId = null;
                this.conteudoStore.produtoInicial = null;
                this.conteudoStore.dadosCompletos = null;
                this.conteudoStore.quantidadesSelecionadas = {};
                this.conteudoStore.erro = null;
            }, 300);
        },
        fecharDialogDrawer() {
            this.dialogDrawerStore.isOpen = false;
        }
    },
    template: `
    <!-- Drawer for Mobile/Tablet (< 992px) -->
    <p-drawer
        v-if="useDrawer"
        v-model:visible="visible"
        position="full"
        :dismissable="true"
        :closable="false"
        :style="{ height: '100vh' }"
        :base-z-index="100000"
        class="fz-produto-dialog-drawer fz-produto-drawer"
    >
        <template #container="{ closeCallback }">
            <!-- Close Button Mobile -->
            <button 
                type="button" 
                class="fz-produto-dialog-drawer__btn-fechar fz-produto-dialog-drawer__btn-fechar--mobile"
                @click="fecharDialogDrawer"
                aria-label="Fechar"
            >
                <i class="ti-close"></i>
            </button>

            <fz-produto-conteudo
                v-if="produtoAtual"
                :key="produtoAtual.id"
                :produto-inicial="produtoAtual"
                contexto="dialog-drawer"
            ></fz-produto-conteudo>
        </template>
    </p-drawer>

    <!-- Dialog for Desktop (>= 992px) -->
    <p-dialog
        v-else
        v-model:visible="visible"
        :modal="true"
        :dismissable-mask="true"
        :draggable="false"
        :closable="false"
        :style="{ width: '95vw', maxWidth: '1100px' }"
        :content-style="{ padding: 0 }"
        :base-z-index="100000"
        class="fz-produto-dialog-drawer fz-produto-dialog produto-modal-dialog"
    >
        <template #header>
            <div></div>
        </template>

        <!-- Close Button Desktop -->
        <button 
            type="button" 
            class="fz-produto-dialog-drawer__btn-fechar fz-produto-dialog-drawer__btn-fechar--desktop"
            @click="fecharDialogDrawer"
            aria-label="Fechar"
        >
            <i class="ti-close"></i>
        </button>

        <fz-produto-conteudo
            v-if="produtoAtual"
            :key="produtoAtual.id"
            :produto-inicial="produtoAtual"
            contexto="dialog-drawer"
        ></fz-produto-conteudo>
    </p-dialog>

    <!-- Navigation Arrows (only for desktop dialog) -->
    <p-button
        v-if="useDialog && temProdutoAnterior"
        class="fz-produto-dialog-drawer__btn-navegar fz-produto-dialog-drawer__btn-navegar--anterior"
        icon="pi pi-chevron-left"
        @click="irParaProdutoAnterior"
        aria-label="Produto anterior"
        title="Produto anterior (←)"
        rounded
        size="large"
        severity="secondary"
    ></p-button>
    
    <p-button
        v-if="useDialog && temProximoProduto"
        class="fz-produto-dialog-drawer__btn-navegar fz-produto-dialog-drawer__btn-navegar--proximo"
        icon="pi pi-chevron-right"
        @click="irParaProximoProduto"
        aria-label="Próximo produto"
        title="Próximo produto (→)"
        rounded
        size="large"
        severity="secondary"
    ></p-button>
    
    <!-- Position Counter -->
    <div v-if="useDialog && temNavegacao" class="fz-produto-dialog-drawer__contador-posicao">
        {{ posicaoAtual }}
    </div>
    `
};

// ============================================================================
// GLOBAL HELPER FUNCTIONS
// ============================================================================

window.abrirModalProdutoVue = function(produto, recalcularIndice = true) {
    if (!produto || !produto.id) {
        console.error('Produto inválido passado para abrirModalProdutoVue:', produto);
        return;
    }
    
    ProdutoConteudoStore.dadosCompletos = null;
    ProdutoConteudoStore.erro = null;
    
    ProdutoConteudoStore.produtoId = produto.id;
    ProdutoConteudoStore.produtoInicial = produto;
    ProdutoDialogDrawerStore.isOpen = true;
    
    if (ProdutoDialogDrawerStore.ordemProdutos.length > 0 && recalcularIndice) {
        ProdutoDialogDrawerStore.indiceProdutoAtual = ProdutoDialogDrawerStore.ordemProdutos.indexOf(produto.id);
    }
};



--- SCRIPT 68 ---


    if (document.getElementById('catalogo-app')) {
        const FZCatalogoApp = Vue.createApp({
            components: {
                'p-button': PrimeVue.Button,
                'p-message': PrimeVue.Message,
                'p-toast': PrimeVue.Toast,
                'fz-produto-skeleton': FZComponents.ProdutoSkeleton,
                'fz-titulo-secao': FZComponents.TituloSecao,
                'fz-produto': FZComponents.Produto,
                'fz-produto-dialog-drawer': FZComponents.ProdutoDialogDrawer,
                'fz-dialog-simulador-parcelas': FZComponents.DialogSimuladorParcelas,
                'fz-simulador-frete-dialog': FZComponents.SimuladorFreteDialog
            },
            data() {
                return {
                    busca: '',
                    categoria: 0,
                    categoriaTitulo: '',
                    produtos: [],
                    carregandoProdutos: false,
                    paginaAtual: 1,
                    ultimaPaginaAlcancada: false,
                    produtosPorPagina: 12,
                    isMobile: false,
                    scrollListenerAtivo: false,
                    searchId: '31876175-4ca8-4cd6-b66a-e82a8ff3a146',
                    idPerfilCompra: '',
                    resizeTimeout: null,
                    categoriasExibidas: []
                }
            },
            mounted() {
                this.detectarDispositivo();
                this.inicializarScrollListener();

                const hash = window.location.hash;
                const match = hash.match(/#produto(\d+)/);

                let timeoutCarregarProdutos = 0;

                if (match) {
                    timeoutCarregarProdutos = 1000;
                }

                setTimeout(() => {
                    this.carregarPaginaProdutos();
                }, timeoutCarregarProdutos);
                
                window.addEventListener('resize', this.handleResize);
                window.addEventListener('fz-carregar-mais-produtos', this.handleCarregarMaisProdutos);
            },
            beforeUnmount() {
                window.removeEventListener('resize', this.handleResize);
                window.removeEventListener('fz-carregar-mais-produtos', this.handleCarregarMaisProdutos);
                if (this.handleScroll) {
                    window.removeEventListener('scroll', this.handleScroll);
                }
                if (this.resizeTimeout) {
                    clearTimeout(this.resizeTimeout);
                }
            },
            computed: {
                configsLoja() {
                    return configsLoja;
                },
                baseUrlCatalogo() {
                    return baseUrlCatalogo;
                },
                exibirMensagemSemProdutos() {
                    return !this.carregandoProdutos && this.produtos.length === 0 && this.paginaAtual === 1;
                },
                exibirBotaoCarregarMais() {
                    return this.produtos.length > 0 && !this.ultimaPaginaAlcancada;
                },
                textoBotaoCarregarMais() {
                    if (this.carregandoProdutos) {
                        return 'Carregando mais produtos...';
                    }
                    if (this.ultimaPaginaAlcancada) {
                        return 'Sem mais produtos para mostrar!';
                    }
                    return 'Carregar Mais Produtos';
                },
                skeletonQuantidade() {
                    return this.isMobile ? 6 : 12;
                },
                classeGridProdutos() {
                    const layoutProdutos = this.configsLoja.layoutProdutos;

                    if (layoutProdutos === 'lista') {
                        return 'col-12 col-md-6 col-lg-4 col-xl-4';
                    }

                    const tamanhoMobile = this.configsLoja.tamanhoGridMobile;
                    const tamanhoPc = this.configsLoja.tamanhoGridPc;
                    
                    return `${tamanhoMobile == 1 ? 'col-12' : 'col-6'} ${tamanhoPc == 4 ? 'col-md-6 col-lg-4 col-xl-3' : 'col-md-4 col-lg-3 col-xl-2'}`;
                },
                produtosComTitulos() {
                    if (!this.configsLoja.exibirTituloCategoria || !this.configsLoja.mostrarMenuCategorias || this.categoria > 0 || this.busca !== '') {
                        return this.produtos.map(p => ({ tipo: 'produto', dados: p }));
                    }

                    const resultado = [];
                    const categoriasJaExibidas = new Set();

                    this.produtos.forEach(produto => {
                        let chaveCategoria;
                        let tituloCategoria;
                        let categoriaId;

                        if (produto.comprado_recentemente === true) {
                            chaveCategoria = 'Sistema:CompradoRecentemente';
                            tituloCategoria = 'Produtos que você comprou recentemente';
                            categoriaId = 'comprado_recentemente';
                        } else {
                            chaveCategoria = produto.categoria_nome;
                            tituloCategoria = produto.categoria_nome;
                            categoriaId = produto.categoria;
                        }

                        if (!categoriasJaExibidas.has(chaveCategoria)) {
                            resultado.push({
                                tipo: 'titulo',
                                dados: {
                                    titulo: tituloCategoria,
                                    categoriaId: categoriaId,
                                    chave: chaveCategoria
                                }
                            });
                            categoriasJaExibidas.add(chaveCategoria);
                        }

                        resultado.push({ tipo: 'produto', dados: produto });
                    });

                    return resultado;
                }
            },
            methods: {
                trocarCategoria(idCategoria, nomeCategoria) {
                    this.categoria = parseInt(idCategoria);
                    this.categoriaTitulo = nomeCategoria || '';
                    this.busca = '';
                    this.produtos = [];
                    this.paginaAtual = 1;
                    this.ultimaPaginaAlcancada = false;
                    this.carregandoProdutos = false;
                    
                    this.carregarPaginaProdutos();

                    setTimeout(() => {
                        window.scrollTo({ top: 100, behavior: 'smooth' });
                    }, 400);
                },
                detectarDispositivo() {
                    this.isMobile = window.innerWidth < 700;
                    this.produtosPorPagina = this.isMobile ? 6 : 12;
                },
                handleResize() {
                    clearTimeout(this.resizeTimeout);
                    this.resizeTimeout = setTimeout(() => {
                        const wasMobile = this.isMobile;
                        this.detectarDispositivo();
                    }, 250);
                },
                construirURLCarregarProdutos() {
                    let url = urlCarregarProdutos.replace('{PAGE}', this.paginaAtual).replace('{CATEGORY}', this.categoria > 0 ? this.categoria : 'todas');
                    let params = [];
                    
                    if (this.idPerfilCompra && this.idPerfilCompra !== '') {
                        params.push('perfil=' + this.idPerfilCompra);
                    }
                    
                    if (this.searchId && this.searchId !== '') {
                        params.push('search_id=' + this.searchId);
                    }

                    params.push('mobile=' + (this.isMobile ? '1' : '0'));

                    if (this.configsLoja.filtrosCatalogo?.variacoes && Array.isArray(this.configsLoja.filtrosCatalogo.variacoes) && this.configsLoja.filtrosCatalogo.variacoes.length > 0) {
                        params.push('variacoes=' + this.configsLoja.filtrosCatalogo.variacoes.join(','));
                    }
                    
                    if (params.length > 0) {
                        url += (url.includes('?') ? '&' : '?') + params.join('&');
                    }

                    return url;
                },
                carregarPaginaProdutos() {
                    const self = this;
                    
                    if (this.carregandoProdutos) {
                        return;
                    }
                    
                    if (this.ultimaPaginaAlcancada) {
                        return;
                    }
                    
                    this.carregandoProdutos = true;
                    
                    const url = this.construirURLCarregarProdutos();

                    const postData = {};

                    if (this.busca !== '') {
                        postData.busca = this.busca;
                    }
                    
                    fetch(url, {
                        method: 'POST',
                        body: JSON.stringify(postData),
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept-Encoding': 'gzip, deflate, br'
                        },
                    })
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Erro ao carregar produtos: ' + response.status);
                        }
                        return response.text();
                    })
                    .then(function(text) {
                        try {
                            var data = JSON.parse(text);
                            return data;
                        } catch (e) {
                            console.error('Erro ao fazer parse do JSON:', e);
                            console.error('Texto recebido:', text);
                            throw new Error('Resposta inválida do servidor');
                        }
                    })
                    .then(function(data) {
                        let acao = data?.acao;

                        if (acao == 'sem_mais_produtos') {
                            self.ultimaPaginaAlcancada = true;
                            self.carregandoProdutos = false;
                            return;
                        }

                        if (acao == 'atualizar_pagina') {
                            window.location.href = window.location.href;
                            return;
                        }

                        if (Array.isArray(data)) {
                            const produtosNovos = data.filter(novoProduto => {
                                return !self.produtos.some(produtoExistente => produtoExistente.id === novoProduto.id);
                            });

                            if (produtosNovos.length === 0) {
                                return;
                            }
                            
                            produtosNovos.forEach(produto => {
                                ProdutoDialogDrawerStore.ordemProdutos.push(produto.id);
                                ProdutoConteudoStore.cacheProdutos[produto.id] = produto;
                            });
                            
                            self.produtos.push(...produtosNovos);
                            
                            self.paginaAtual++;
                            
                            if (self.paginaAtual === 2 && self.configsLoja.exibirTituloCategoria && self.configsLoja.mostrarMenuCategorias) {
                                const tituloTodosProdutos = document.querySelector('.titulo-todos-produtos');
                                if (tituloTodosProdutos) {
                                    tituloTodosProdutos.remove();
                                }
                            }
                        }
                        
                        self.carregandoProdutos = false;
                    })
                    .catch(function(error) {
                        console.error('Erro ao carregar produtos do catálogo:', error);

                        const toast = PrimeVue.useToast();

                        toast.add({
                            severity:'error',
                            summary: 'Ops!',
                            detail: 'Não foi possível carregar os produtos. Por favor, tente novamente mais tarde.',
                            life: 5000
                        });
                        self.carregandoProdutos = false;
                    });
                },
                inicializarScrollListener() {
                    if (this.scrollListenerAtivo) {
                        return;
                    }
                    
                    this.scrollListenerAtivo = true;
                    
                    let ticking = false;
                    
                    const handleScroll = () => {
                        if (!ticking) {
                            window.requestAnimationFrame(() => {
                                this.verificarCarregamentoAutomatico();
                                ticking = false;
                            });
                            ticking = true;
                        }
                    };
                    
                    this.handleScroll = handleScroll;
                    window.addEventListener('scroll', handleScroll, { passive: true });
                },
                verificarCarregamentoAutomatico() {
                    if (this.carregandoProdutos || this.ultimaPaginaAlcancada) {
                        return;
                    }
                    
                    const btnCarregarMais = document.querySelector('.btn-carregar-produtos');
                    
                    if (btnCarregarMais) {
                        const btnRect = btnCarregarMais.getBoundingClientRect();
                        const windowHeight = window.innerHeight;
                        
                        const margemAntesDoBotao = 300;
                        
                        if (btnRect.top < windowHeight + margemAntesDoBotao) {
                            this.carregarPaginaProdutos();
                        }
                    } else {
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                        const windowHeight = window.innerHeight;
                        const documentHeight = document.documentElement.scrollHeight;
                        const distanciaDoFinal = documentHeight - (scrollTop + windowHeight);
                        
                        if (distanciaDoFinal < 1500) {
                            this.carregarPaginaProdutos();
                        }
                    }
                },
                carregarMaisProdutos() {
                    this.carregarPaginaProdutos();
                },
                handleCarregarMaisProdutos() {
                    if (!this.ultimaPaginaAlcancada && !this.carregandoProdutos) {
                        this.carregarPaginaProdutos();
                    }
                }
            }
        });

        FZCatalogoApp.use(PrimeVue.Config, {
            theme: {
                preset: lojaPreset,
                options: {
                    darkModeSelector: false,
                }
            }
        });
        FZCatalogoApp.use(PrimeVue.ToastService);
        FZCatalogoApp.use(PrimeVue.ConfirmationService);

        FZCatalogoApp.provide('configsLoja', configsLoja);
        FZCatalogoApp.provide('baseUrlCatalogo', baseUrlCatalogo);
        FZCatalogoApp.provide('urlCarregarProdutos', urlCarregarProdutos);
        FZCatalogoApp.provide('obterURLImageTransform', obterURLImageTransform);

        FZCatalogoApp.directive('tooltip', PrimeVue.Tooltip);

        window.FZCatalogoAppInstance = FZCatalogoApp.mount('#catalogo-app');
    }


--- SCRIPT 69 ---


    const categoriasAtivasCatalogo = [{"id":"22614","nome":"Calcinhas","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1730312397_8466dfded75d81d75be6.jpeg.webp"},{"id":"22615","nome":"Lingerie","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/6900c49ab6839_fz2jL3xq.webp"},{"id":"22616","nome":"Suti\u00e3s","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1740594873_f2553e8ffdbdedffd88a.jpeg.webp"},{"id":"22617","nome":"Conjuntos","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/689b3e612a60c_Zyehw03a.webp"},{"id":"22618","nome":"Baby doll","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1759171033_3bc4f786a03b92694bf7.jpeg.webp"},{"id":"22619","nome":"Camisolas","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1763486230_11f0f7a8ab06201c74b7.webp"},{"id":"23011","nome":"Camisola + Robe","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1765394898_edb2fc631796855a0d6a.webp"},{"id":"24298","nome":"Pijama Longo ","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1747747137_3235a0b6ea16e34b6226.jpeg.webp"},{"id":"24680","nome":"Plus Size ","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1753808647_cf453b118921f32e3255.jpeg.webp"},{"id":"24681","nome":"Cropped Super LUXO ","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1747161100_584051d286969f31fad1.jpeg.webp"},{"id":"30388","nome":"Espartilho ","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1715005529_7c9b14f5184df4f13c4a.jpg.webp"},{"id":"53587","nome":"Pijama de Inverno","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1746554632_e1b3d8e9e73c316fc092.jpeg.webp"},{"id":"86005","nome":"Cueca Boxer","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1729104502_3a95e35eac448f175de4.jpeg.webp"},{"id":"116421","nome":"Amamenta\u00e7\u00e3o","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1739992702_86f3af6541099dac76ea.jpeg.webp"},{"id":"203325","nome":"Blusas","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1728579294_8874b34f59747019deb4.webp.webp"},{"id":"206323","nome":"Body","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1731610236_79958396a4d53b2189e6.jpeg.webp"},{"id":"209173","nome":"TOP","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1740056128_9815f62a19cdb8b31232.jpeg.webp"},{"id":"225378","nome":"M\u00e3e e Filha","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1734113001_7b1f08ffc844d4d1f10a.jpeg.webp"},{"id":"227551","nome":"KIT","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1729865174_d8ae7373469718b333bc.jpeg.webp"},{"id":"232424","nome":"Cropped","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/categorias\/1730985352_08b18c689dc824f5a8b9.jpeg.webp"},{"id":"281377","nome":"Pe\u00e7as em Promo\u00e7\u00e3o","imagem":"https:\/\/facilzap.app.br\/cdn-cgi\/image\/width%3D700%2Cheight%3D700%2Cquality%3D85%2Cformat%3Dwebp\/https:\/\/arquivos.facilzap.app.br\/produtos\/1753291127_5768458ac0a45bec2265.jpeg.webp"}];


--- SCRIPT 70 ---


if (typeof FZComponents === 'undefined') {
    var FZComponents = {};
}

FZComponents.CarrosselCategorias = {
    components: {
        'fz-titulo-secao': FZComponents.TituloSecao
    },
    props: ['titulo', 'margemSuperior', 'margemInferior'],
    inject: ['categoriasAtivasCatalogo', 'baseUrlCatalogo'],
    data() {
        return {
            swiperInstance: null,
            componentId: 'carrossel-categorias-' + Math.random().toString(36).substr(2, 9)
        }
    },
    computed: {
        estiloMargens() {
            const margemSup = this.margemSuperior ?? 20;
            const margemInf = this.margemInferior ?? 20;
            return `margin-top: ${margemSup}px; margin-bottom: ${margemInf}px;`;
        },
        categorias() {
            return (this.categoriasAtivasCatalogo || []).filter(categoria => categoria.id);
        }
    },
    mounted() {
        this.$nextTick(() => {
            this.initSwiper();
        });
    },
    beforeUnmount() {
        if (this.swiperInstance) {
            this.swiperInstance.destroy(true, true);
        }
    },
    methods: {
        getInicialCategoria(nome) {
            return nome ? nome.charAt(0).toUpperCase() : '?';
        },
        getLinkCategoria(categoria) {
            return this.baseUrlCatalogo.replace('{PATH}', 'categoria/' + categoria.id);
        },
        initSwiper() {
            if (typeof Swiper !== 'undefined' && this.categorias.length > 0) {
                this.swiperInstance = new Swiper(`#${this.componentId}`, {
                    slidesPerView: 8.5,
                    spaceBetween: 5,
                    centeredSlides: false,
                    centerInsufficientSlides: true,
                    watchSlidesProgress: true,
                    autoplay: {
                        delay: 3500,
                        disableOnInteraction: true,
                    },
                    pagination: {
                        el: `#${this.componentId} .swiper-pagination`,
                        clickable: true,
                    },
                    navigation: {
                        nextEl: `#${this.componentId} .swiper-button-next`,
                        prevEl: `#${this.componentId} .swiper-button-prev`,
                    },
                    breakpoints: {
                        320: {
                            slidesPerView: 3.5,
                            spaceBetween: 3,
                        },
                        480: {
                            slidesPerView: 4.5,
                            spaceBetween: 3,
                        },
                        768: {
                            slidesPerView: 5.5,
                            spaceBetween: 3,
                        },
                        992: {
                            slidesPerView: 5.5,
                            spaceBetween: 3,
                        },
                        1200: {
                            slidesPerView: 7.5,
                            spaceBetween: 5,
                        },
                        1400: {
                            slidesPerView: 8.5,
                            spaceBetween: 5,
                        }
                    }
                });
            }
        }
    },
    template: `
    <div class="fz-carrossel-categorias" :style="estiloMargens">
        <fz-titulo-secao :titulo="titulo"></fz-titulo-secao>
        <div class="container-fluid">
            <div class="swiper" :id="componentId">
                <div class="swiper-wrapper">
                    <div 
                        v-for="categoria in categorias" 
                        :key="categoria.id" 
                        class="swiper-slide">
                        <a :href="getLinkCategoria(categoria)" class="categoria-item link-categoria" :data-categoria-id="categoria.id" :data-categoria-nome="categoria.nome">
                            <div 
                                class="categoria-circulo"
                                :style="categoria.imagem ? { backgroundImage: 'url(' + categoria.imagem + ')' } : {}">
                                <span v-if="!categoria.imagem" class="categoria-inicial">
                                    {{ getInicialCategoria(categoria.nome) }}
                                </span>
                            </div>
                            <div class="categoria-nome">{{ categoria.nome }}</div>
                        </a>
                    </div>
                </div>
                <div class="swiper-pagination d-block d-lg-none"></div>
                <div class="swiper-button-prev small d-none d-lg-flex"></div>
                <div class="swiper-button-next small d-none d-lg-flex"></div>
            </div>
        </div>
    </div>
    `,
}


--- SCRIPT 71 ---


    if (document.getElementById('carrossel-categorias-app')) {
        const appCarrosselCategorias = Vue.createApp({
            components: {
                'fz-carrossel-categorias': FZComponents.CarrosselCategorias
            },
            computed: {
                temCategorias() {
                    return categoriasAtivasCatalogo.length > 0;
                }
            },
        });

        appCarrosselCategorias.use(PrimeVue.Config, {
            theme: {
                preset: lojaPreset,
                options: {
                    darkModeSelector: false,
                }
            }
        });
        appCarrosselCategorias.use(PrimeVue.ToastService);
        appCarrosselCategorias.use(PrimeVue.ConfirmationService);

        appCarrosselCategorias.provide('baseUrlCatalogo', `https://calientelingerie.com.br/c/calientelingerie/{PATH}/17996842783`);
        appCarrosselCategorias.provide('categoriasAtivasCatalogo', categoriasAtivasCatalogo);

        appCarrosselCategorias.mount('#carrossel-categorias-app');
    }


--- SCRIPT 72 ---


function formatatarDropdownPais(option) {
  if (!option.id) {
    return option.text;
  }

  return $(`<span><span class="fi fi-${option.id.toLowerCase()}"></span> ${option.text}</span>`);
}

function formatatarDropdownPaisReduzido(option) {
  if (!option.id) {
    return option.text;
  }

  return $(`<span><span class="fi fi-${option.id.toLowerCase()}"></span> ${option.id.toUpperCase()}&nbsp;&nbsp;</span>`);
}
(function(){
  $("#pais-calculo-frete-carrinho-modal").select2({
      language: "pt-BR",
      data: listaPaises,
      templateResult: formatatarDropdownPais,
            templateSelection: formatatarDropdownPaisReduzido,
      dropdownCssClass: 'select2-dropdown-reduced',
                  dropdownParent: $('#calculoFreteFormularioModal'),
        });
})();


--- SCRIPT 73 ---


if (typeof simularFreteModal_AtualizarCEPs === 'function') {
    simularFreteModal_AtualizarCEPs();
}


--- SCRIPT 74 ---


$('#calculoFreteModal').on('click', '.radio-form-entrega', function() {
    showNotification('', 'Você poderá selecionar a forma de entrega desejada ao finalizar o pedido.', 'info');
});

var elegivelFreteGratis = localStorage.getItem("frete_gratis_elegivel");
var freteGratisAtivado = false;
var freteGratisValorMinimo = 400.00;
var freteGratisCondicao = "valor_pedido";
var faixasCepGratis = JSON.parse('null');

var freteFixoAtivado = false;
var freteFixoValorMinimo = 0.00;
var faixasCepFreteFixo = JSON.parse('null');

function simularFreteModal(cep, pais, idProduto) {
    precoTotalSimulacao = 0;
    totalQtd = 0;

    if (idProduto !== undefined) {
        $( ".produto_"+idProduto+"_modal .qtds_input" ).each(function( index ) {
            totalQtd += Number($( this ).val());
        });

        if (totalQtd == 0) {
            showNotification('Ops!', 'Informe a quantidade desejada do produto.', 'warning');
            return false;
        }

        precoProduto = obterPrecoProduto(idProduto);
        precoTotalSimulacao = precoProduto * totalQtd;
    } else {
        precoTotalSimulacao = obterSubtotalCarrinho();
    }

    $('#calculoFreteModal .div-resultado-calculo-frete').empty();
    $('#calculoFreteModal .demais_formas_entrega').hide();

    let entregaBrasil = false;
    if (pais == 'BR' || pais == '' || pais == undefined) {
        entregaBrasil = true;
    }

    var cep = cep.replace(/\D/g, '');
    
    elegivelFreteGratis = false;
    if (freteGratisAtivado && entregaBrasil && simularFreteModal_ValidarFaixasCep(cep, faixasCepGratis)) {
        elegivelFreteGratis = true;
    }
    localStorage.setItem("frete_gratis_elegivel", elegivelFreteGratis);
    localStorage.setItem("entrega_brasil", entregaBrasil);
    localStorage.setItem("cliente_cep", cep);

    simularFreteModal_AtualizarCEPs();

    if (typeof atualizarProgressoFreteGratis === 'function') {
        atualizarProgressoFreteGratis();
    }

        var cliente_cpf_cnpj = "";

    showLoading("Verificando formas de entrega disponíveis para seu CEP...", "Aguarde um instante, por favor!", "info");

    if (idProduto !== undefined) {
        var dados = {
            acao: 'calculo_frete_produto',
            cep: cep,
            pais: pais,
            cliente_cpf_cnpj: cliente_cpf_cnpj,
            produto_id: idProduto,
            qtd: totalQtd,
        };
    } else {
        var dados = {
            acao: 'calculo_frete',
            cep: cep,
            pais: pais,
            cliente_cpf_cnpj: cliente_cpf_cnpj,
        };
    }

    $.post("https://calientelingerie.com.br/c/calientelingerie/17996842783", dados, function(data) {

        closeLoading();

        if (data.sucesso == "1") {
                                                $('#calculoFreteModal .div-resultado-calculo-frete').append($('<div>').addClass('calculo_frete_fretefacil calculo_frete_shuffle col-sm-12 p-0').html(data.fretefacil));
                                                                $('#calculoFreteModal .div-resultado-calculo-frete').append($('<div>').addClass('calculo_frete_correios calculo_frete_shuffle col-sm-12 p-0').html(data.correios));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        $('#calculoFreteModal .calculo_frete_shuffle').shuffle(['calculo_frete_fretefacil']);
        }

        $('#calculoFreteModal .calculo_frete_shuffle').show();

        simularFreteModal_ExibirSimulacao(cep, precoTotalSimulacao, totalQtd, entregaBrasil, idProduto);
        
    }, "json");

    }

function simularFreteModal_ExibirSimulacao(cep, precoTotalSimulacao, totalQtd, entregaBrasil, idProduto) {
    $('#calculoFreteModal .demais_formas_entrega').show();

    simularFreteModal_ValidaCEP(cep);

    let valorCondicaoFreteGratis = precoTotalSimulacao;
    if (freteGratisCondicao == 'qtd_itens') {
        valorCondicaoFreteGratis = totalQtd;
    }

    if (valorCondicaoFreteGratis >= freteGratisValorMinimo && freteGratisAtivado && entregaBrasil && simularFreteModal_ValidarFaixasCep(cep, faixasCepGratis)) {
        $('#calculoFreteModal .frete_gratis_div').show();
    } else {
        $('#calculoFreteModal .frete_gratis_div').hide();
    }

    if (precoTotalSimulacao >= freteFixoValorMinimo && freteFixoAtivado && entregaBrasil && simularFreteModal_ValidarFaixasCep(cep, faixasCepFreteFixo)) {
        $('#calculoFreteModal .frete_fixo_div').show();
    } else {
        $('#calculoFreteModal .frete_fixo_div').hide();
    }

    if (idProduto !== undefined) {
        $(".produto_"+idProduto+"_modal").modal('hide');

        $('#calculoFreteModal').off('hidden.bs.modal').on('hidden.bs.modal', function (e) {
            if ($(".produto_"+idProduto+"_modal").hasClass('modal')) {
                $(".produto_"+idProduto+"_modal").modal('show');
            }
            $('#calculoFreteModal').off('hidden.bs.modal');
        });
    } else {
        $('#calculoFreteFormularioModal').modal('hide');

        if ($('#carrinhoModal').is(':visible')) {
            $('#carrinhoModal').modal('hide');
            $('#calculoFreteModal').off('hidden.bs.modal').on('hidden.bs.modal', function (e) {
                $('#carrinhoModal').modal('show');
                $('#calculoFreteModal').off('hidden.bs.modal');
            });
        }

    }

    $('#calculoFreteModal').modal('show');
}

function simularFreteModal_ValidaCEP(cep) {
    //Expressão regular para validar o CEP.
    var validacep = /^[0-9]{8}$/;

    //Valida o formato do CEP.
    if (validacep.test(cep)) {

        $.getJSON("https://api.facilzap.app.br/bureau_interno/cep/" + cep, function(dados) {

            if (!("erro" in dados)) {

                simularFreteModal_ValidarLocalidadeFormasEntregaManuais(dados.uf, dados.localidade);

            } else {
                simularFreteModal_ValidarLocalidadeFormasEntregaManuais();
            }
        });
    } else {
        simularFreteModal_ValidarLocalidadeFormasEntregaManuais();
    }
}

function simularFreteModal_ValidarFaixasCep(cep, faixasCep) {
    if (
    typeof faixasCep === 'object' &&
    faixasCep !== null &&
    !Array.isArray(faixasCep)
    ) {
        var cepNaFaixa = false;
        Object.values(faixasCep).forEach(faixa => {
            let inicio = Number(faixa.inicio.replace(/\D/g, ''));
            let termino = Number(faixa.termino.replace(/\D/g, ''));
            if (cep >= inicio && cep <= termino) {
                cepNaFaixa = true;
            }
        });

        return cepNaFaixa;
    } else {
        return true;
    }

    return false;
}

function simularFreteModal_ValidarLocalidadeFormasEntregaManuais(uf, cidade) {
    if (uf == undefined || cidade == undefined) {
        $('.localidade_disponivel_divs').slideUp();
        return;
    }
    
    uf = normalizeClassName(uf);
    cidade = normalizeClassName(cidade);

    $('.localidade_disponivel_divs').slideUp().promise().done(function() {
        $('.localidade_disponivel_'+uf).slideDown();
        $('.localidade_disponivel_'+uf+'_'+cidade).slideDown();
    });
}

function simularFreteModal_AtualizarCEPs() {
    var cepCliente = '';
    var cepSessao = localStorage.getItem("cliente_cep");
    
    if (cepSessao != null && cepSessao != '') {
        $('.form-ceps-calculo-frete').val(cepSessao);
        return;
    }
    
    if (cepCliente != '') {
        $('.form-ceps-calculo-frete').val(cepCliente);
    }
}

$(function() {
    simularFreteModal_AtualizarCEPs();
});


--- SCRIPT 76 ---


function fecharSubmenuCategoria() {
    $('.submenu-container .submenu-categoria').removeClass('show');
    $('.submenu-container').removeClass('show');
    $('.submenu-container').hide();
}

function abrirSubmenuCategoria(idCategoria) {
    if ($('.submenu-container #submenu-categoria-' + idCategoria).hasClass("show")) {
        fecharSubmenuCategoria();
        return;
    }
    $('.submenu-container .submenu-categoria').removeClass('show');
    $('.submenu-container .submenu-categoria').hide();
    $('.submenu-container #submenu-categoria-' + idCategoria).addClass("show")
    $('.submenu-container #submenu-categoria-' + idCategoria).show();
    $('.submenu-container').show();
    $('.submenu-container').addClass('show');
}
$(document).on('click', function(e) {
    if ($('.submenu-container').hasClass("show")) {
        if ($(e.target).closest(".submenu-container").length === 0 && $(e.target).closest(".nav-item").length === 0) {
            fecharSubmenuCategoria();
        }
    }
});


--- SCRIPT 77 ---


    $('.btn-abrir-menu-mobile').on('click', function() {
        $('#navbarMobile').addClass('show');
        $('body').addClass('modal-open');
        $('body').append('<div class="modal-backdrop show"></div>');
    });

    $('.btn-fechar-menu-mobile').on('click', function() {
        fecharMenuMobile();
    });

    function fecharMenuMobile() {
        $('#navbarMobile').removeClass('show');
        $('body').removeClass('modal-open');
        $('.modal-backdrop').remove();
    }

    $(document).on('click', function(e) {
        if ($('#navbarMobile').hasClass("show")) {
            if ($(e.target).closest("#navbarMobile").length === 0 && $(e.target).closest(".btn-abrir-menu-mobile").length === 0) {
                fecharMenuMobile();
            }
        }
    });

    $("ul.dropdown-menu [data-toggle='dropdown']").on("click", function(event) {
        event.preventDefault();
        event.stopPropagation();

        $(this).siblings().toggleClass("show");


        if (!$(this).next().hasClass('show')) {
            $(this).parents('.dropdown-menu').first().find('.show').removeClass("show");
        }
        $(this).parents('li.nav-item.dropdown.show').on('hidden.bs.dropdown', function(e) {
            $('.dropdown-submenu .show').removeClass("show");
        });

    });


--- SCRIPT 78 ---


class FZStories {
    constructor(urlLoja, origem) {
        this.urlLoja = urlLoja;
        this.origem = origem;
        this.containerId = 'fz-stories-container';
        this.whatsAppCliente = null;
        this.listaLojas = [];
        this.listaCatalogosLojas = new Map();
        this.indexLojaAtual = 0;
        this.idLojaAtual = null;
        this.swiperContainer = null;
        this.swiperStories = new Object();
        this.baseUrlArquivos = 'https://arquivos.facilzap.app.br';
        this.videoDesmutado = false;
        this.estruturaInicializada = false;
        this.seguirProximoStories = false;
        this.tempoStory = 4000;
        this.tempoStoryAtual = null;
        this.tempoStoryAssistido = 0;
        this.dadosLojas = new Map();
        this.dadosStories = new Map();
        this.storiesCurtidos = new Map();
        this.curtidaEmAndamento = false;
        this.storiesVisualizados = new Map();
        this.videosStories = new Object();
        this.videosStoriesHtml = new Object();
        this.autoPlayTimeout = null;
        this.storyProgressInterval = null;
        this.facilZapAPI = new FacilZapAPI();
        this.facilZapAPI.setarExibirMensagemErro(false);
    }

    setarWhatsAppCliente(whatsAppCliente) {
        this.whatsAppCliente = whatsAppCliente;
    }

    adicionarLoja(idLoja, idCatalogo) {
        if (this.listaLojas.includes(idLoja)) {
            return;
        }

        this.listaLojas.push(idLoja);
        this.listaCatalogosLojas.set(idLoja, idCatalogo);
    }

    possuiStories(idLoja) {
        if (! this.dadosStories.has(idLoja)) {
            return false;
        }

        const stories = this.dadosStories.get(idLoja);
        
        return stories.length > 0;
    }

    abrirStories(idLoja, tentativa = 1) {
        if (tentativa > 20) {
            this.fecharStories();
            return;
        }

        this.idLojaAtual = idLoja;

        console.log('abrirStories', this.idLojaAtual, this.indexLojaAtual);

        if (this.indexLojaAtual == -1) {
            this.adicionarLoja(idLoja);
            this.obterDadosStories();
            this.abrirStories(idLoja, 1);
            return;
        }

        this.exibirContainerStories();

        const dadosStoriesCarregados = this.dadosStories.has(idLoja);

        if (! dadosStoriesCarregados) {
            showLoadingOverlay(`#${this.containerId}`, "rgba(0, 0, 0, 0.5)");

            setTimeout(() => {
                this.abrirStories(idLoja, tentativa + 1);
            }, 500);

            return;
        }

        closeLoadingOverlay(`#${this.containerId}`);

        if (! this.possuiStories(idLoja)) {
            this.fecharStories();
            return;
        }

        this.inicializarSwiperContainer();
    }

    atualizarIndexLojaAtual() {
        const slides = this.swiperContainer?.slides || [];

        this.indexLojaAtual = -1;

        if (! slides.length) {
            this.indexLojaAtual = 0;
            return this.indexLojaAtual;
        }

        for (let i = 0; i < slides.length; i++) {
            const slide = slides[i];
            const idLoja = $(slide).data('loja-id');

            if (idLoja == this.idLojaAtual) {
                this.indexLojaAtual = i;
                break;
            }
        }

        return this.indexLojaAtual;
    }

    abrirProximoStories() {
        const slides = this.swiperContainer.slides;
        
        if (! slides.length || this.indexLojaAtual == slides.length - 1) {
            this.fecharStories();
            return;
        }
        
        this.indexLojaAtual++;
        this.idLojaAtual = $(slides[this.indexLojaAtual]).data('loja-id');
        this.swiperContainer.slideNext();
    }

    fecharStories() {
        try {
            const slideAtual = this.swiperStories[this.idLojaAtual].slides[this.swiperStories[this.idLojaAtual].activeIndex];
            const idStoryAtual = $(slideAtual).data('story-id');
            this.pausarVideoStory(idStoryAtual);
        } catch (error) {
            console.error(error);
        }

        clearTimeout(this.autoPlayTimeout);
        clearInterval(this.storyProgressInterval);

        this.ocultarContainerStories().then(() => {
            this.indexLojaAtual = 0;
    
            this.swiperContainer.removeAllSlides();
            this.swiperContainer.destroy();
            this.swiperContainer = null;
            Object.keys(this.swiperStories).forEach(idLoja => {
                this.swiperStories[idLoja].detachEvents();
                this.swiperStories[idLoja].destroy();
                this.swiperStories[idLoja] = undefined;
            });
            this.swiperStories = new Object();
            this.videosStories = new Object();
    
            this.inicializar();
        });
    }

    obterDadosStories() {
        const lojasSemDados = [];

        this.listaLojas.forEach((loja, index) => {
            if (!this.dadosStories.has(loja)) {
                lojasSemDados.push({
                    id: loja,
                    catalogo: this.listaCatalogosLojas.get(loja)
                });
            }
        });

        if (!lojasSemDados.length) {
            this.ativarBotoesStories();

            return;
        }

        this.facilZapAPI.setarMetodo('GET');
        this.facilZapAPI.setarEndpoint('stories/listagem_geral');
        this.facilZapAPI.setarParametros({
            lojas: lojasSemDados
        });

        this.facilZapAPI.enviar().then(() => {
            if (this.facilZapAPI.obterStatus() != 'erro') {
                var retorno = this.facilZapAPI.obterRetorno();

                retorno.forEach(dados => {
                    this.dadosStories.set(dados.loja.id, dados.stories);
                    this.dadosLojas.set(dados.loja.id, dados.loja);
                });
            }

            this.ativarBotoesStories();
        });
    }

    ativarBotoesStories() {
        this.dadosStories.forEach((stories, idLoja) => {
            if (stories.length) {
                this.ativarBotaoStoriesLoja(idLoja);
            }
        });
    }

    ativarBotaoStoriesLoja(idLoja) {
        if (! $(`.btn_abrir_stories_${idLoja}`).length) {
            return;
        }

        $(`.btn_abrir_stories_${idLoja} .nao-tem-stories-2`).addClass('tem-stories-2').removeClass('nao-tem-stories-2');
        $(`.btn_abrir_stories_${idLoja} .nao-tem-stories`).addClass('tem-stories').removeClass('nao-tem-stories');
    }

    inicializar() {
        this.inicializarEstruturaContainer();
        this.obterDadosStories();
    }

    inicializarEstruturaContainer() {
        if (this.estruturaInicializada) {
            return;
        }
        
        const html = `
            <div id="${this.containerId}" class="fz-stories-container" style="display:none">
                <div class="fz-stories-container-close">
                    <i class="ti-close"></i>
                </div>
                <div class="swiper fz-stories-container-swiper">
                    <div class="swiper-wrapper">
                    </div>
                </div>
            </div>
        `;

        document.querySelector('body').insertAdjacentHTML('beforeend', html);

        this.estruturaInicializada = true;

        $(`#${this.containerId} .fz-stories-container-close`).on('click', () => {
            this.fecharStories();
        });
    }

    inicializarSwiperContainer() {
        if (this.swiperContainer !== null) {
            this.swiperContainer.slideTo(this.indexLojaAtual, 1);
            return;
        }

        this.swiperContainer = new Swiper(`#${this.containerId} .fz-stories-container-swiper`, {
            direction: 'horizontal',
            loop: false,
            spaceBetween: 0,
            slidesPerView: 1,
            allowTouchMove: true,
            autoHeight: false,
            effect: "creative",
            creativeEffect: {
                prev: {
                    shadow: true,
                    // origin: "left center",
                    translate: ["-70%", 0, -500],
                    rotate: [0, -90, -1],
                },
                next: {
                    shadow: true,
                    // origin: "right center",
                    translate: ["70%", 0, -500],
                    rotate: [0, 90, 1],
                },
            },
        });

        this.inicializarEstruturaStoriesProximos().then(() => {
            this.atualizarIndexLojaAtual();
            console.log('slideTo', this.indexLojaAtual);
            this.swiperContainer.slideTo(this.indexLojaAtual, 1);

            this.swiperContainer.on('slideChange', () => {
                const indexAtual = this.swiperContainer.activeIndex;
                const slideAtual = this.swiperContainer.slides[indexAtual];
                const idLoja = $(slideAtual).data('loja-id');

                if (this.swiperStories[idLoja]) {
                    this.swiperStories[idLoja].slideTo(0, 1);
                }

                this.idLojaAtual = idLoja;
                this.atualizarIndexLojaAtual();

                this.inicializarVideoStoryAtual(idLoja);

                this.autoplayStories(idLoja);

                this.inicializarEstruturaStoriesProximos();
            });

            this.swiperContainer.on('slideNextTransitionStart', () => {
                const indexAtual = this.swiperContainer.activeIndex;
                
                const indexDestruir = Number(indexAtual) - 2;
                if (indexDestruir >= 0) {
                    const idLojaDestruir = $(this.swiperContainer.slides[indexDestruir]).data('loja-id');
                    this.destruirVideosStoriesLoja(idLojaDestruir);
                }
            });

            this.swiperContainer.on('slidePrevTransitionStart', () => {
                const indexAtual = this.swiperContainer.activeIndex;
                
                const indexDestruir = Number(indexAtual) + 2;
                if (indexDestruir < this.swiperContainer.slides.length) {
                    const idLojaDestruir = $(this.swiperContainer.slides[indexDestruir]).data('loja-id');
                    this.destruirVideosStoriesLoja(idLojaDestruir);
                }
            });
        })
    }

    exibirContainerStories() {
        $('body').css('overflow', 'hidden');
        return $(`#${this.containerId}`).fadeIn('fast').promise();
    }

    ocultarContainerStories() {
        $('body').css('overflow', 'auto');
        return $(`#${this.containerId}`).fadeOut('fast').promise();
    }

    inicializarEstruturaStoriesProximos() {
        return new Promise((resolve, reject) => {
            var indexListaLojaAtual = this.listaLojas.findIndex(loja => loja == this.idLojaAtual);

            if (indexListaLojaAtual == -1) {
                indexListaLojaAtual = 0;
            }

            for (let i = 0; i <= 4; i++) {
                const indexListaLoja = indexListaLojaAtual + i;
                const idLoja = this.listaLojas.at(indexListaLoja);

                if (idLoja) {
                    var stories = this.dadosStories.get(idLoja);
                    if (!stories || !stories.length) {
                        continue;
                    }

                    console.log('inicializarEstruturaStoriesProximos', idLoja);
                    console.log(this.listaLojas);

                    this.inicializarEstruturaStories(idLoja);
                    this.inicializarSwiperStories(idLoja);
                }
            }

            resolve();
        });
    }

    inicializarEstruturaStories(idLoja) {
        if (this.swiperStories[idLoja] !== undefined || $(`.fz-stories-${idLoja}`).length) {
            return;
        }

        const dadosLoja = this.dadosLojas.get(idLoja);

        const comLinkLoja = this.origem == 'portal';

        const html = `
            <div class="swiper-slide fz-stories fz-stories-${idLoja}" data-loja-id="${idLoja}">
                <div class="fz-stories-loja ${comLinkLoja ? 'com-link' : ''}">
                    <div class="tem-stories">
                        <div class="fz-stories-loja-logo" style="background-image:url(${this.baseUrlArquivos}/${dadosLoja.logo})"></div>
                    </div>
                    <div class="fz-stories-loja-info">
                        ${dadosLoja.nome}
                    </div>
                </div>
                <div class="swiper fz-stories-swiper">
                    <div class="fz-stories-top-shadow"></div>
                    <div class="swiper-wrapper">
                    </div>
                    <div class="swiper-pagination"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
            </div>
        `;

        this.swiperContainer.appendSlide(html);

        if (comLinkLoja) {
            $(`.fz-stories-${idLoja} .fz-stories-loja`).off('click').on('click', () => {
                if (typeof abrirModalLoja == 'function') {
                    this.fecharStories();
                    abrirModalLoja(dadosLoja.dominio);
                }
            });
        }
    }

    inicializarSwiperStories(idLoja) {
        if (this.swiperStories[idLoja] !== undefined) {
            this.swiperStories[idLoja].slideTo(0);
            return;
        }

        this.swiperStories[idLoja] = new Swiper(`#${this.containerId} .fz-stories-${idLoja} .fz-stories-swiper`, {
            init: false,
            direction: 'horizontal',
            loop: false,
            spaceBetween: 0,
            slidesPerView: 1,
            allowTouchMove: false,
            autoHeight: false,
            speed: 1,
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            pagination: {
                type: 'custom',
                el: `#${this.containerId} .fz-stories-${idLoja} .fz-stories-swiper .swiper-pagination`,
                clickable: false,
                renderCustom: function (swiper, current, total) {
                    var html = '';

                    total = Number(total) - 1;

                    for (var i = 1; i <= total; i++) {
                        var className = 'swiper-pagination-bullet';
                        if (i < current) {
                            className += ' swiper-pagination-bullet-done';
                        }
                        if (i == current) {
                            className += ' swiper-pagination-bullet-progress';
                        }

                        html += '<span class="'+className+'"></span>';
                    }

                    return html;
                },
            },
            on: {
                afterInit: () => {
                    this.popularStories(idLoja);
                },
                slideNextTransitionStart: () => {
                    if (this.swiperStories[idLoja].isEnd) {
                        this.abrirProximoStories();
                        return;
                    }
                },
                slidePrevTransitionStart: () => {
                },
                slideChangeTransitionStart: () => {
                },
                slideChange: () => {
                    const slideAnterior = this.swiperStories[idLoja].slides[this.swiperStories[idLoja].previousIndex];
                    const idStoryAnterior = $(slideAnterior).data('story-id');
                    this.pausarVideoStory(idStoryAnterior);

                    this.inicializarVideoStoryAtual(idLoja);

                    this.autoplayStories(idLoja);
                },
            },
        });

        this.swiperStories[idLoja].init();
    }

    autoplayStories(idLoja, tentativaAutoplay = 1) {
        const limiteTentativas = this.tempoStory / 100;
        if (tentativaAutoplay > limiteTentativas) {
            clearInterval(this.storyProgressInterval);
            if (this.swiperStories[idLoja]) {
                this.swiperStories[idLoja].slideNext();
            }
            return;
        }

        if (this.autoPlayTimeout) {
            clearTimeout(this.autoPlayTimeout);
        }
        if (this.storyProgressInterval) {
            clearInterval(this.storyProgressInterval);
        }

        if (! this.swiperStories[idLoja] || ! this.swiperStories[idLoja].slides.length) {
            return;
        }
        
        const slideAtual = this.swiperStories[idLoja].slides[this.swiperStories[idLoja].activeIndex];
        
        if (! slideAtual) {
            setTimeout(() => {
                this.autoplayStories(idLoja, tentativaAutoplay + 1);
            }, 100);
            
            return;
        }

        const idStory = $(slideAtual).data('story-id');

        this.contabilizarVisualizacao(idStory);
        
        const possuiVideo = $(slideAtual).find('.video-js').length;

        const temProximoSlide = this.swiperStories[idLoja].slides.length > this.swiperStories[idLoja].activeIndex + 1;

        if (! possuiVideo) {
            this.tempoStoryAtual = this.tempoStory;
        } else {
            const duracaoVideo = this.videosStories[idStory].duration();
            if (! duracaoVideo || duracaoVideo == NaN) {
                setTimeout(() => {
                    this.autoplayStories(idLoja, tentativaAutoplay + 1);
                }, 100);

                return;
            }

            this.tempoStoryAtual = this.tempoStory;
            if (duracaoVideo) {
                this.tempoStoryAtual = duracaoVideo * 1000;
            }
        }

        this.autoPlayTimeout = setTimeout(() => {
            this.swiperStories[idLoja].slideNext();
        }, this.tempoStoryAtual);

        this.tempoStoryAssistido = 0;
        this.atualizarProgressoStory();
    }

    atualizarProgressoStory() {
        this.storyProgressInterval = setInterval(() => {
            this.tempoStoryAssistido += 50;
            var porcentagemAssistido = parseInt((this.tempoStoryAssistido * 10000) / this.tempoStoryAtual) / 100;

            if (porcentagemAssistido >= 100) {
                porcentagemAssistido = 100;
            }

            $('.swiper-pagination-bullet-progress').css('background', `linear-gradient(90deg, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.6) ${porcentagemAssistido}%, rgba(255,255,255,0.3) ${porcentagemAssistido+1}%)`);

            if (porcentagemAssistido == 100) {
                clearInterval(this.storyProgressInterval);
            }
        }, 50);
    }

    pausarAutoplayStories() {
        clearTimeout(this.autoPlayTimeout);
        clearInterval(this.storyProgressInterval);
    }

    reiniciarAutoplayStories() {
        const tempoStoryRestante = this.tempoStoryAtual - this.tempoStoryAssistido;

        this.autoPlayTimeout = setTimeout(() => {
            this.swiperStories[this.idLojaAtual].slideNext();
        }, tempoStoryRestante);

        this.atualizarProgressoStory();
    }

    popularStories(idLoja) {
        const stories = this.dadosStories.get(idLoja);

        if ($(`.fz-stories-${idLoja} .fz-stories-swiper .swiper-slide`).length) {
            if (idLoja == this.idLojaAtual) {
                this.inicializarVideoStory(stories[0].id);
                this.autoplayStories(idLoja);
            }

            return;
        }

        stories.forEach((story, index) => {
            this.inicializarStory(idLoja, story);
        });

        const html = `<div class="swiper-slide fz-story fz-story-final" data-loja-id="${idLoja}"></div>`;
        this.swiperStories[idLoja].appendSlide(html);

        this.swiperStories[idLoja].slideTo(0);

        if (idLoja == this.idLojaAtual) {
            this.inicializarVideoStory(stories[0].id);
            this.autoplayStories(idLoja);
        }
    }

    inicializarStory(idLoja, story) {
        var midiaStoryHtml = '';

        if (story.tipo_midia == 'imagem') {
            midiaStoryHtml = `
            <div class="fz-story-imagem">
                <img src="${this.baseUrlArquivos}/${story.midia}" class="w-100" />
            </div>
            `;
        }

        if (story.tipo_midia == 'video') {
            midiaStoryHtml = `
                <video id="video-story-${story.id}" class="video-js w-100" style="height:100%" data-setup="{}" preload="metadata" loop playsinline>
                    <source src="${this.baseUrlArquivos}/${story.midia}" type="video/mp4">
                    Seu navegador não suporta a reprodução de vídeos.
                </video>
            `;
        }

        var produtoHtml = '';
        var precosHtml = '';
        
        if (story.produto) {
            if (story.produto.grade && story.produto.grade.length > 0) {
                if (Number(story.produto.preco_grade_desconto) > 0) {
                    precosHtml += `
                    <p class="mb-0 preco_promo_antigo">
                        R$ ${Number(story.produto.preco_grade_original).toFixed(2).replace('.', ',')}
                        <span class="badge bg-success text-white ml-1 preco_promo_badge">
                            <i class="ti-arrow-down"></i> ${story.produto.preco_grade_desconto}%
                        </span>
                    </p>
                    `;
                }

                if (story.produto.preco_grade > 0) {
                    precosHtml += `
                    <p class="mb-0 preco_produto_apartir">
                        R$ ${Number(story.produto.preco_grade).toFixed(2).replace('.', ',')}
                    </p>
                    `;
                }
            } else if (story.produto.precos_produto) {
                if (story.produto.precos_produto?.preco_a_partir?.ativado) {
                    precosHtml += `
                    <p class="mb-0 preco_produto_apartir_texto">
                        a partir de
                        ${Number(story.produto.precos_produto.preco_a_partir.promocional_desconto) > 0 ? `
                        <span class="badge bg-success text-white ml-1 preco_promo_badge">
                            <i class="ti-arrow-down"></i> ${story.produto.precos_produto.preco_a_partir.promocional_desconto}%
                        </span>
                        ` : ``}
                    </p>
                    <p class="mb-0 preco_produto_apartir">
                        R$ ${Number(story.produto.precos_produto.preco_a_partir.preco).toFixed(2).replace('.', ',')}
                    </p>
                    `;
                } else if (story.produto.precos_produto?.promocional !== false) {
                    precosHtml += `
                    <p class="mb-0 preco_promo_antigo">
                        R$ ${Number(story.produto.precos_produto.padrao).toFixed(2).replace('.', ',')}
                        ${Number(story.produto.precos_produto.promocional_desconto) > 0 ? `
                        <span class="badge bg-success text-white ml-1 preco_promo_badge">
                            <i class="ti-arrow-down"></i> ${story.produto.precos_produto.promocional_desconto}%
                        </span>
                        ` : ``}
                    </p>
    
                    <p class="mb-0 preco_promo">
                        R$ ${Number(story.produto.precos_produto.promocional).toFixed(2).replace('.', ',')}
                    </p>
                    `;
                } else if (story.produto.precos_produto?.padrao > 0) {
                    precosHtml += `
                    <p class="mb-0 preco_normal">
                        R$ ${Number(story.produto.precos_produto.padrao).toFixed(2).replace('.', ',')}
                    </p>
                    `;
                }
            }
            
            produtoHtml = `
            <div class="fz-story-produto-info d-flex align-items-center">
                <div>
                    <div class="fz-story-produto-img" style="background-image:url(${this.baseUrlArquivos}/${story.produto.imagem})"></div>
                </div>
                <div>
                    <p class="fz-story-produto-nome mb-0">${story.produto.nome}</p>
                    ${precosHtml}
                </div>
            </div>
            `;
        }

        const baseUrlWhatsApp = 'https://api.whatsapp.com/send?text=';

        const html = `
            <div class="swiper-slide fz-story fz-story-${story.id} ${story.tipo_midia == 'video' ? 'com-video' : ''} ${story.produto ? 'com-produto' : ''}" 
                data-story-id="${story.id}" data-loja-id="${idLoja}">
                <div class="fz-story-views">
                    <i class="fa fa-eye"></i> ${story.visualizacoes || 1}
                </div>
                ${midiaStoryHtml}
                <div class="fz-story-actions">
                    <a href="javascript:void(0)" class="fz-curtir-story fz-curtir-story-${story.id}">
                        <i class="fa ${story.curtido ? 'fa-heart': 'fa-heart-o'} m-0 text-white"></i>
                    </a>
                    <a href="${baseUrlWhatsApp}${this.urlLoja}%23stories-${idLoja}">
                        <i class="fa fa-share m-0 text-white"></i>
                    </a>
                </div>
                ${produtoHtml}
            </div>
        `;

        this.swiperStories[idLoja].appendSlide(html);

        if (story.curtido) {
            this.storiesCurtidos.set(story.id, true);
        }

        $(`#${this.containerId} .fz-story-${story.id} .fz-curtir-story`).on('click', () => {
            this.curtirStory(story.id);
        });

        if (story.produto) {
            $(`#${this.containerId} .fz-story-${story.id} .fz-story-produto-info`).on('click', () => {
                this.abrirModalProduto(story.id, story.produto.id);
            });
        }
    }

    inicializarVideoStory(idStory) {
        const containerVideo = `.fz-story-${idStory}`;

        if (! $(containerVideo + " .video-js").length || (this.videosStories[idStory] !== undefined)) {
            this.autoplayVideoStory(idStory);
            return;
        }

        this.videosStoriesHtml[idStory] = $(containerVideo).html();

        this.videosStories[idStory] = videojs(document.querySelector(containerVideo + " .video-js"), {
            responsive: true,
            controls: false,
            autoplay: this.videoDesmutado ? 'any' : 'muted',
        })

        var Button = videojs.getComponent('Button');
        var bottomMuteToggleButton = new Button(this.videosStories[idStory], {
            className: 'vjs-bottom-mute-toggle-button muted',
            clickHandler: (event) => {
                if (! this.videosStories[idStory].muted()) {
                    this.videoDesmutado = false;
                    this.videosStories[idStory].muted(true);
                } else {
                    this.videoDesmutado = true;
                    this.videosStories[idStory].muted(false);
                }
            }
        });

        this.videosStories[idStory].addChild(bottomMuteToggleButton);

        this.videosStories[idStory].ready(() => {
            this.autoplayVideoStory(idStory);
            this.videosStories[idStory].on('volumechange', () => {
                if (! this.videosStories[idStory].muted()) {
                    $('.vjs-bottom-mute-toggle-button', this.videosStories[idStory].el()).removeClass('muted');
                } else {
                    $('.vjs-bottom-mute-toggle-button', this.videosStories[idStory].el()).addClass('muted');
                }
            });
        });

        this.videosStories[idStory].on('play', () => {
            if (this.videosStories[idStory]) {
                this.videosStories[idStory].trigger('volumechange');
            }
        });

        this.videosStories[idStory].on('error', () => {
            const error = this.videosStories[idStory].error();
            console.error(error);
            const errorCode = error.code || 0;
            if (errorCode == 3 || errorCode == 4) {
                this.videosStories[idStory].el().closest('.swiper-slide').remove();
            }
        });
    }

    inicializarVideoStoryAtual(idLoja) {
        if (! this.swiperStories[idLoja] || ! this.swiperStories[idLoja].slides.length) {
            return;
        }

        const slideAtual = this.swiperStories[idLoja]?.slides[this.swiperStories[idLoja].activeIndex];
        const idStory = $(slideAtual).data('story-id');

        this.inicializarVideoStory(idStory);
    }

    destruirVideosStoriesLoja(idLoja) {
        const stories = this.dadosStories.get(idLoja);

        stories.forEach(story => {
            this.destruirVideoStory(story.id);
        });
    }

    destruirVideoStory(idStory) {
        if (this.videosStories[idStory] === undefined) {
            return;
        }

        this.videosStories[idStory].dispose();
        this.videosStories[idStory] = undefined;

        $(`.fz-story-${idStory}`).html(this.videosStoriesHtml[idStory]);
    }

    autoplayVideoStory(idStory) {
        if (this.videosStories[idStory] === undefined) {
            return;
        }

        if (! this.videoDesmutado) {
            this.videosStories[idStory].muted(true);
        }

        this.videosStories[idStory].play();

        const idLoja = $(`.fz-story-${idStory}`).data('loja-id');

        setTimeout(() => {
            if (! this.videosStories[idStory]) {
                return;
            }
            if (! this.videosStories[idStory].currentTime() || this.videosStories[idStory].currentTime() == 0) {
                this.videosStories[idStory].play();
            }
        }, 100);

        setTimeout(() => {
            if (! this.videosStories[idStory]) {
                return;
            }
            if (! this.videosStories[idStory].currentTime() || this.videosStories[idStory].currentTime() == 0) {
                this.videosStories[idStory].play();
            }
        }, 250);

        setTimeout(() => {
            if (! this.videosStories[idStory]) {
                return;
            }
            if (! this.videosStories[idStory].currentTime() || this.videosStories[idStory].currentTime() == 0) {
                this.videosStories[idStory].play();
            }
        }, 400);
    }

    pausarVideoStory(idStory, manterTempo = false) {
        if (this.videosStories[idStory] === undefined) {
            return;
        }

        this.videosStories[idStory].pause();
        if (! manterTempo) {
            this.videosStories[idStory].currentTime(0);
        }
    }

    abrirModalProduto(idStory, idProduto) {
        if (typeof window.abrirModalProdutoVue == 'function') {
            window.abrirModalProdutoVue({id:idProduto});
        } else {
            abrirModalProduto(idProduto);
        }

        this.pausarVideoStory(idStory, true);
        this.pausarAutoplayStories();

        if (this.origem == 'portal') {
            console.log('Evento close - portal');
            $("#produtoModal").one('hidden.bs.modal', () => {
                console.log('Trigger evento close - portal');
                this.reiniciarAutoplayStories();
                this.autoplayVideoStory(idStory);
            });
        }

        if (this.origem == 'loja') {
            console.log('Evento close - loja');
            $(".produto_" + idProduto + "_modal").one('hidden.bs.modal', () => {
                console.log('Trigger evento close - loja');
                this.reiniciarAutoplayStories();
                this.autoplayVideoStory(idStory);
            });
        }
    }

    curtirStory(idStory) {
        if (! this.whatsAppCliente) {
            abrirModalLoginVisitante(null, (whatsAppCliente) => {
                this.setarWhatsAppCliente(whatsAppCliente);
                this.curtirStory(idStory);
            });

            this.pausarVideoStory(idStory, true);
            this.pausarAutoplayStories();

            $("#visitanteLoginModal").one('hidden.bs.modal', () => {
                this.reiniciarAutoplayStories();
                this.autoplayVideoStory(idStory);
            });
            
            return;
        }

        if (this.curtidaEmAndamento) {
            return;
        }

        this.curtidaEmAndamento = true;

        const storyJaCurtido = this.storiesCurtidos.get(idStory);
        
        if (storyJaCurtido === true) {
            this.facilZapAPI.setarEndpoint(`stories/${idStory}/descurtir`);
        } else {
            this.facilZapAPI.setarEndpoint(`stories/${idStory}/curtir`);
        }

        this.facilZapAPI.setarMetodo('POST');
        this.facilZapAPI.setarDados({
            whatsapp: this.whatsAppCliente,
            whatsapp_e164: this.whatsAppCliente
        });

        this.facilZapAPI.enviar().then(() => {
            this.curtidaEmAndamento = false;
            if (this.facilZapAPI.obterStatus() != 'erro') {
                if (storyJaCurtido === true) {
                    console.log('descurtir produto', this.whatsAppCliente);

                    this.storiesCurtidos.set(idStory, false);
                    $(`.fz-curtir-story-${idStory} i`).removeClass('fa-heart').addClass('fa-heart-o');
                } else {
                    console.log('curtir produto', this.whatsAppCliente);

                    this.storiesCurtidos.set(idStory, true);
                    $(`.fz-curtir-story-${idStory} i`).removeClass('fa-heart-o').addClass('fa-heart');
                }
            }
        });
    }

    contabilizarVisualizacao(idStory) {
        if (! Number.isInteger(Number(idStory)) || this.storiesVisualizados.has(idStory)) {
            return;
        }

        this.facilZapAPI.setarMetodo('GET');
        this.facilZapAPI.setarEndpoint(`stories/${idStory}/contabilizar_visualizacao`);
        this.facilZapAPI.enviar();

        this.storiesVisualizados.set(idStory, true);
    }
}


--- SCRIPT 79 ---


document.addEventListener("DOMContentLoaded", function(event) {
    try {
        const  inputPhonei18nID = `inputPhonei18n` + Math.floor(Math.random() * (99999 - 10000 + 1)) + 10000;
        $('.visitante_whatsapp').addClass('mb-1 text-dark');

        const label = `Seu WhatsApp`;

        const initialNumber = "";

        const initialCountry = "BR";

        $('.visitante_whatsapp').html(`
            ${label.length > 0 ? `
            <div>
                <label class="" for="${inputPhonei18nID}">
                    ${label}
                    <span class="text-danger">*</span>                </label>
            </div>
            ` : ''}
            <div class="d-flex">
            <input
                type="tel"
                class="form-control w-100 inputPhonei18n-raw"
                id="${inputPhonei18nID}"
                placeholder=""
                name="visitante_whatsapp"
                value=""
                style=""
                required            >
            <input
                type="hidden"
                class="inputPhonei18n-e164"
                id="${inputPhonei18nID}_e164"
                value="${initialNumber}"
                name="visitante_whatsapp_e164"
            >
            <input
                type="hidden"
                class="inputPhonei18n-ddi"
                id="${inputPhonei18nID}_ddi"
                name="visitante_whatsapp_ddi"
            >
            <input
                type="hidden"
                class="inputPhonei18n-country"
                id="${inputPhonei18nID}_country"
                value="${initialCountry}"
                name="visitante_whatsapp_country"
            >
            <input
                type="hidden"
                class="inputPhonei18n-update"
                id="${inputPhonei18nID}_update"
            >
            </div>
        `);

        const inputPhonei18nEl = document.querySelector(`#${inputPhonei18nID}`);

        const inputPhonei18n = window.intlTelInput(inputPhonei18nEl, {
            // utilsScript: "",
            nationalMode: true,
            formatOnDisplay: true,
            separateDialCode: true,
            initialCountry: initialCountry.length > 0 ? initialCountry : 'BR',
            preferredCountries: ['BR', 'US'],
            customPlaceholder: function(selectedCountryPlaceholder, selectedCountryData) {
                return `${selectedCountryPlaceholder}`.replace(/[0-9]/g, "0");
            },
        });

        const formatinputPhonei18n = (phoneNumber) => {
            if (phoneNumber === undefined) {
                phoneNumber = inputPhonei18n.getNumber();
            }
            inputPhonei18n.setNumber(phoneNumber);
            updateAuxInputs();
        };

        const updateAuxInputs = () => {
            $(`#${inputPhonei18nID}_e164`).val(inputPhonei18n.getNumber());
            var countryData = inputPhonei18n.getSelectedCountryData();
            $(`#${inputPhonei18nID}_ddi`).val(countryData.dialCode || '');
            $(`#${inputPhonei18nID}_country`).val(countryData.iso2 || '');
        };

        inputPhonei18nEl.addEventListener('change', () => { formatinputPhonei18n() });
        inputPhonei18nEl.addEventListener('keyup', () => { formatinputPhonei18n() });

        if (initialNumber.length > 0) {
            inputPhonei18n.promise.then(() => {
                formatinputPhonei18n(initialNumber);
            });
        }

        $(`#${inputPhonei18nID}`).bind('input', function() {
            if(! inputPhonei18n.isValidNumber() && $(this).val().length > 0) {
                this.setCustomValidity('Número de telefone inválido');
            } else {
                this.setCustomValidity('');
            }
        });

        $(`.visitante_whatsapp .inputPhonei18n-update`).on('change', function() {
            formatinputPhonei18n($(this).val());
        });
    } catch (error) {
        // console.error(error);
    }
    
});


--- SCRIPT 81 ---


class FacilZapEventos {
    constructor(idCliente) {
        this.idCliente = idCliente;
        this.lojaId = '3016';
        this.requisicoesRecentes = {};
        this.fbPixelAtivado = true;
        this.gAnalyticsAtivado = false;

        this.verPagina();
    }

    verPagina() {
        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('PageView'),
        };

        let parametrosGAnalytics = {};

        this.enviarEventoFbPixel('PageView', parametrosFbPixel);
        this.enviarEventoGAnalytics('page_view', parametrosGAnalytics);
    }

    verProduto(idProduto, nomeProduto, valorProduto = 0) {
        idProduto = parseInt(idProduto);
        valorProduto = parseFloat(valorProduto);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('ViewContent', idProduto),
            contents: [{
                id: idProduto,
                item_price: valorProduto,
                quantity: 1,
            }],
            content_type: "product",
            currency: "BRL",
            value: valorProduto,
        };

        let parametrosGAnalytics = {
            items: [{
                item_id: idProduto,
                item_name: nomeProduto,
                price: valorProduto,
                currency: 'BRL',
            }],
        };

        this.enviarEventoFbPixel('ViewContent', parametrosFbPixel);
        this.enviarEventoGAnalytics('view_item', parametrosGAnalytics);
    }

    curtirProduto(idProduto) {
        idProduto = parseInt(idProduto);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('AddToWishlist', idProduto),
            contents_ids: [idProduto],
            content_type: "product",
            currency: "BRL",
        };

        let parametrosGAnalytics = {
            items: [{
                item_id: idProduto,
            }],
        };

        this.enviarEventoFbPixel('AddToWishlist', parametrosFbPixel);
        this.enviarEventoGAnalytics('add_to_wishlist', parametrosGAnalytics);
    }

    adicionarAoCarrinho(idProduto, nomeProduto, valorProduto = 0) {
        idProduto = parseInt(idProduto);
        valorProduto = parseFloat(valorProduto);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('AddToCart', idProduto),
            contents: [
                {
                    id: idProduto,
                    item_price: valorProduto,
                    quantity: 1,
                }
            ],
            content_type: "product",
            currency: "BRL",
            value: valorProduto,
        };

        let parametrosGAnalytics = {
            items: [{
                item_id: idProduto,
                item_name: nomeProduto,
                price: valorProduto,
                quantity: 1,
                currency: 'BRL',
            }],
        };

        this.enviarEventoFbPixel('AddToCart', parametrosFbPixel);
        this.enviarEventoGAnalytics('add_to_cart', parametrosGAnalytics);
    }

    removerDoCarrinho(idProduto, nomeProduto, valorProduto = 0) {
        idProduto = parseInt(idProduto);
        valorProduto = parseFloat(valorProduto);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('RemoveFromCart', idProduto),
            content_ids: [idProduto],
            content_type: "product",
            currency: "BRL",
            value: valorProduto,
        };

        let parametrosGAnalytics = {
            items: [{
                item_id: idProduto,
                item_name: nomeProduto,
                price: valorProduto,
                currency: 'BRL',
            }],
        };

        this.enviarEventoFbPixel('RemoveFromCart', parametrosFbPixel);
        this.enviarEventoGAnalytics('remove_from_cart', parametrosGAnalytics);
    }

    busca(termoBusca) {
        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('Search'),
            search_string: termoBusca,
        };

        let parametrosGAnalytics = {
            search_term: termoBusca,
        };

        this.enviarEventoFbPixel('Search', parametrosFbPixel);
        this.enviarEventoGAnalytics('search', parametrosGAnalytics);
    }

    iniciarCheckout(valor = 0, itensCarrinho = []) {
        valor = parseFloat(valor);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('InitiateCheckout'),
            currency: "BRL",
            value: valor,
            content_type: "product",
            contents: this._mapearItemsCarrinhoFbPixel(itensCarrinho),
            num_items: this._obterQtdItensCarrinho(itensCarrinho),
        };

        let parametrosGAnalytics = {
            currency: 'BRL',
            items: itensCarrinho,
            value: valor,
        };

        this.enviarEventoFbPixel('InitiateCheckout', parametrosFbPixel);
        this.enviarEventoGAnalytics('begin_checkout', parametrosGAnalytics);
    }

    finalizarPedido(valor = 0, idPedido = 0, itensCarrinho = []) {
        valor = parseFloat(valor);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('Lead', idPedido),
            currency: "BRL",
            value: valor,
            content_type: "product",
            contents: this._mapearItemsCarrinhoFbPixel(itensCarrinho),
            num_items: this._obterQtdItensCarrinho(itensCarrinho),
        };

        let parametrosGAnalytics = {
            currency: 'BRL',
            items: itensCarrinho,
            transaction_id: idPedido,
            value: valor,
        };

        this.enviarEventoFbPixel('Lead', parametrosFbPixel);
        this.enviarEventoGAnalytics('purchase', parametrosGAnalytics);
    }

    iniciarPagamento(valor = 0, idPedido = 0) {
        valor = parseFloat(valor);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('AddPaymentInfo', idPedido),
            currency: "BRL",
            value: valor,
        };

        let parametrosGAnalytics = {
            currency: 'BRL',
            transaction_id: idPedido,
            value: valor,
        };

        this.enviarEventoFbPixel('AddPaymentInfo', parametrosFbPixel);
        this.enviarEventoGAnalytics('add_payment_info', parametrosGAnalytics);
    }

    cadastro(id) {
        id = parseInt(id);

        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('CompleteRegistration', id),
            content_ids: [id],
            content_type: "user",
            currency: "BRL",
            value: 0,
        };

        let parametrosGAnalytics = {
            user_id: id,
        };

        this.enviarEventoFbPixel('CompleteRegistration', parametrosFbPixel);
        this.enviarEventoGAnalytics('sign_up', parametrosGAnalytics);
    }

    inscricao() {
        let parametrosFbPixel = {
            eventID: this._gerarIdEvento('CompleteRegistration'),
        };

        let parametrosGAnalytics = {
        };

        this.enviarEventoFbPixel('CompleteRegistration', parametrosFbPixel);
        this.enviarEventoGAnalytics('sign_up', parametrosGAnalytics);
    }

    enviarEventoFbPixel(nomeEvento, parametros = {}) {
        if (this.fbPixelAtivado) {
            try {
                const localPixelEndpoint = 'https://calientelingerie.com.br/api/catalogo/enviar_pixel';

                const body = {
                    event_name: nomeEvento,
                    event_params: parametros,
                    url: window.location.href,
                };

                const fbc = document.cookie.split('; ').find(row => row.startsWith('_fbc='));
                if (fbc) {
                    body.fbc = fbc.split('=')[1];
                }

                const fbp = document.cookie.split('; ').find(row => row.startsWith('_fbp='));
                if (fbp) {
                    body.fbp = fbp.split('=')[1];
                }

                fetch(localPixelEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body)
                });
            } catch (error) {
                console.error('Erro ao enviar evento para o Facebook Pixel:', error);                
            }
            try {
                fbq('track', nomeEvento, parametros);
            } catch (error) {
                console.error('Erro ao enviar evento para o Facebook Pixel:', error);                
            }
        }
    }

    enviarEventoGAnalytics(nomeEvento, parametros = {}) {
        if (this.gAnalyticsAtivado) {
            try {
                // console.log(`Enviando evento para o Google Analytics: ${nomeEvento}`, parametros);
                gtag('event', nomeEvento, parametros);
            } catch (error) {
                console.error('Erro ao enviar evento para o Google Analytics:', error);
            }
        }
    }

    _mapearItemsCarrinhoFbPixel(itensCarrinho) {
        try {
            return itensCarrinho.map(item => ({
                id: item.item_id,
                item_price: parseFloat(item.price),
                quantity: parseInt(item.quantity || 1)
            }));
        } catch (error) {
            console.error('Erro ao mapear itens do carrinho para o Facebook Pixel:', error);
            return [];
        }
    }

    _obterQtdItensCarrinho(itensCarrinho) {
        try {
            return itensCarrinho.reduce((total, item) => total + (parseInt(item.quantity) || 1), 0);
        } catch (error) {
            console.error('Erro ao obter quantidade de itens do carrinho:', error);
            return 0;            
        }
    }

    _gerarIdEvento(nomeEvento, idItem = null) {
        if (! idItem) {
            idItem = `${Math.floor(Math.random() * 1000000)}`;
        }

        return `${this.lojaId}_${nomeEvento}_${idItem}_${Date.now()}`;
    }
}


--- SCRIPT 82 ---


    var facilZapEventos = new FacilZapEventos('');
    var visitanteLoginFinalizar = false;
    var solicitarLoginCarrinho = true;
    var clienteLogado = false;
    var visitanteLogado = false;
    var visitanteWhatsAppValidado = false;
    
    var usuarioLogado = false;
    if (clienteLogado || visitanteLogado) {
        usuarioLogado = true;
    }

    var linkInstagramLoja = `https://instagram.com/caliente_lingerie?igshid=MzRlODBiNWFlZA==`;

    var aviso_topo_max_top = 750;

    if ($(".aviso-topo").length) {
        if ($(window).width() >= 1200) {
            aviso_topo_max_top = 1000;
        }

        $('body').addClass('com-aviso-topo').addClass('aviso-visivel');
    } else {
        $('body').removeClass('com-aviso-topo').removeClass('aviso-visivel');
    }

    if (! $(".form-busca-mobile").length) {
        $('body').addClass('sem-busca');
    }

    $(window).scroll(function() {
        if ($(".aviso-topo").length) {
            if ($(window).scrollTop() >= aviso_topo_max_top) {
                $(".aviso-topo").addClass('oculto');
                $('body').removeClass('aviso-visivel').addClass('aviso-oculto');
            }

            if ($(window).scrollTop() < (aviso_topo_max_top - 50)) {
                $(".aviso-topo").removeClass('oculto');
                $('body').removeClass('aviso-oculto').addClass('aviso-visivel');
            }
        }
    });

    const lojaStories = new FZStories('https://calientelingerie.com.br/c/calientelingerie/17996842783', 'loja');

    

    $('#buscaModal').on('shown.bs.modal', function() {
        $('#busca_input_modal').focus();
    });

    $('#buscaModal').on('hidden.bs.modal', function() {
        $('#busca_input_modal').val('');
        $('#div-sugestoes-produtos').html(obterPlaceholderBusca());
    });

    function abrirBuscaModal() {
        $('#buscaModal').modal('show');
        $('#div-sugestoes-produtos').html(obterPlaceholderBusca());
    }

    function obterPlaceholderBusca() {
        var placeholder = '';

                    placeholder = `
            <div class="my-1 d-flex align-items-center justify-content-center">
                <i class="icone-ai bg-success mr-2"></i>
                <span>
                    A busca utiliza inteligência artificial para encontrar produtos mais relevantes. <br>
                    Você pode buscar por variações do produto, como cor, tamanho, modelo...
                </span>
            </div>
            `;
        
        return placeholder;
    }

    function obterSugestoesProdutos() {
        var busca = $('#busca_input_modal').val();

        if (busca == '') {
            $('#div-sugestoes-produtos').html(obterPlaceholderBusca());
            return;
        }

        facilZapEventos.busca(busca);

        $('#div-sugestoes-produtos').html(`<div class="text-center py-3"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></div>`);

        $.post("https://calientelingerie.com.br/c/calientelingerie/17996842783", {
                acao: 'sugestao_produto',
                busca: busca
            }, function(data) {
                let sugestoesHTML = data.slice(0, 5).map(formatarSugestoesProdutos).join('');

                sugestoesHTML += `
                <button type="submit" class="btn btn-light btn-block my-1" style="text-transform:unset">Ver todos os resultados <i class="fa fa-angle-double-right" aria-hidden="true"></i></button>
                `;

                $('#div-sugestoes-produtos').html(sugestoesHTML);
            }, "json");
    }

    function obterUrlProduto(produtoId) {
        return `https://calientelingerie.com.br/c/calientelingerie/produto/${produtoId}/17996842783`;
    }

    function formatarSugestoesProdutos(dados) {
        imagens = dados.imagens ?? [];
        imagemPrincipal = ``;
        if (Array.isArray(imagens) && imagens.length) {
            imagemPrincipal = `
                <div class='pr-2'>
                    <div style='width:80px;height:80px;background-image:url(${imagens[0]});background-repeat: no-repeat;background-size:cover'></div>
                </div>
            `;
        }

                var preco = new Intl.NumberFormat('pt-BR', {
                style: 'decimal',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
                useGrouping: false
            }).format(dados.preco);
        
        let html = `
        <a href="${obterUrlProduto(dados.id)}" onclick="$('#buscaModal').modal('hide'); window.abrirModalProdutoVue({id:${dados.id}}); return false;" class="text-dark">
            <div class='d-flex align-items-center py-1'>
                ${imagemPrincipal}
                <div>
                    <p class="f-14 mb-0">${dados.nome}</p>
                                        <p class="f-18 font-weight-bold mb-0">R$ ${preco}</p>
                                    </div>
            </div>
        </a>
        `;

        return html;
    }

    $("#busca_input_modal").on("keyup", debounce(function() {
        obterSugestoesProdutos();
    }, 600));

    function abrirStories(retorno) {
        if (! lojaStories.possuiStories(3016)) {
            if (retorno == 'home') {
                window.location.href = 'https://calientelingerie.com.br/c/calientelingerie/17996842783';
            }
            if (retorno == 'reputacao') {
                $('#reputacaoModal').modal('show');
            }
            return;
        }

        lojaStories.abrirStories(3016);
    }

     var cliente_logado = false; 
     var catalogoRestrito = false; 
    $(".login-visitante-btn").on("click", function() {
        const inputVisitanteWhatsapp = new window.inputPhonei18n('.visitante_whatsapp');

        visitante_whatsapp = inputVisitanteWhatsapp.getE164Number();
        visitante_nome = $("#visitante_nome").val();

        if (visitante_nome == undefined || visitante_nome.trim() == "") {
            $("#visitante_nome").focus();
            return false;
        }

        $.post("https://calientelingerie.com.br/c/calientelingerie/17996842783", {
            acao: 'visitante_whatsapp_login',
            visitante_whatsapp_e164: visitante_whatsapp,
            visitante_nome: visitante_nome,
        }, function(data) {
            if (data.sucesso == "1") {

                $("#visitanteLoginModal").modal("hide");

                showNotification2("Login realizado com sucesso!", "success");

                localStorage.setItem('login_visitante_nome', visitante_nome);
                localStorage.setItem('login_visitante_whatsapp', visitante_whatsapp);

                sessionStorage.setItem('finalizacao_pedido_tipo_login_visitante', 'whatsapp');
                sessionStorage.setItem('finalizacao_pedido_cliente_whatsapp_e164', visitante_whatsapp);
                sessionStorage.setItem('finalizacao_pedido_aproveitar_dados', 'confirmar');

                visitanteLogado = true;
                usuarioLogado = true;

                if (callbackModalLoginVisitante != undefined && typeof callbackModalLoginVisitante == 'function') {
                    callbackModalLoginVisitante(visitante_whatsapp);
                }

                if (retornoModalLoginVisitante == 'recarregar') {
                    setTimeout(function() {
                        window.location.href = window.location.href;
                    }, 1000);
                }

                if (retornoModalLoginVisitante == 'finalizar_pedido') {
                    $('#form-enviar-pedido-whats').submit();
                }

                if (retornoModalLoginVisitante == 'seguir') {
                    abrirModalSeguir();
                }

                if (retornoModalLoginVisitante == 'inicio') {
                    setTimeout(function() {
                        window.location.href = 'https://calientelingerie.com.br/c/calientelingerie/17996842783';
                    }, 1000);
                }

            } else {
                showNotification2("Houve um erro! Tente novamente mais tarde.", "error");
            }

        }, "json");
    });

    function abrirModalSeguir() {
        if (clienteLogado) {
            $('#pushModal').modal('show');
        } else if (visitanteLogado && ! visitanteWhatsAppValidado) {
            abrirModalValidacaoWhatsApp('seguir');
        } else {
            abrirModalLoginVisitante('seguir');
        }
    }

    
    function curtir_produto(produto_id) {

        if (cliente_logado == true) {

            $.post("https://calientelingerie.com.br/c/calientelingerie/17996842783", {
                acao: 'curtir_produto',
                produto_id: produto_id
            }, function(data) {


                if (data.sucesso == "1") {
                    $(".curtir_produto_" + produto_id + "").fadeOut("fast").promise().done(function() {
                        $(".curtir_produto_" + produto_id + " i").removeClass("fa-heart-o").addClass(
                            "fa-heart text-danger");
                        if (data.total_curtidas > 0) {
                            $(".curtir_produto_" + produto_id + " small").text(data.total_curtidas);
                        } else {
                            $(".curtir_produto_" + produto_id + " small").text("");
                        }
                        $(".curtir_produto_" + produto_id + "").fadeIn("fast");
                    });

                    $(".curtir_snap_produto_" + produto_id + "").fadeOut("fast").promise().done(function() {
                        $(".curtir_snap_produto_" + produto_id + " i").removeClass("fa-heart-o").addClass("fa-heart");
                        $(".curtir_snap_produto_" + produto_id + "").fadeIn("fast");
                    });

                    facilZapEventos.curtirProduto(produto_id);

                } else if (data.sucesso == "2") {

                    $(".curtir_produto_" + produto_id + "").fadeOut("fast").promise().done(function() {
                        $(".curtir_produto_" + produto_id + " i").removeClass("fa-heart").removeClass(
                            "text-danger").addClass("fa-heart-o");
                        if (data.total_curtidas > 0) {
                            $(".curtir_produto_" + produto_id + " small").text(data.total_curtidas);
                        } else {
                            $(".curtir_produto_" + produto_id + " small").text("");
                        }
                        $(".curtir_produto_" + produto_id + "").fadeIn("fast");
                    });
                    
                    $(".curtir_snap_produto_" + produto_id + "").fadeOut("fast").promise().done(function() {
                        $(".curtir_snap_produto_" + produto_id + " i").removeClass("fa-heart").addClass("fa-heart-o");
                        $(".curtir_snap_produto_" + produto_id + "").fadeIn("fast");
                    });


                } else {
                    showNotification2(data.erro, "error");
                }

            }, "json");

        } else {
            abrirModalLoginVisitante();
        }
    }

    
    
    function perguntas_produto(produtoId) {
        loadPageToModal(`https://calientelingerie.com.br/c/calientelingerie/perguntas/${produtoId}/17996842783`, "Comentários do Produto", "modal-lg", "Carregando...", 'perguntasProdutoModal', true);
    }

    
    

    function fecharnoticacaoPedidos() {
        $(".noticacaoPedidosContent").removeClass("animate-show").addClass("animate-hide").fadeOut('fast');
    }

    $(".noticacaoPedidosContainer").show();

    var notificacoes_pedidos_recentes = [
         
            `<span><strong>Alguém de Marinópolis - SP</strong> acabou de fazer um pedido de <strong>R$877,80</strong></span>`,
         
            `<span><strong>Alguém de Mutum - MG</strong> acabou de fazer um pedido de <strong>R$315,60</strong></span>`,
         
            `<span><strong>Alguém de Uruçuí - PI</strong> acabou de fazer um pedido de <strong>R$623,50</strong></span>`,
         
            `<span><strong>Alguém de Palmeira DOeste - SP</strong> acabou de fazer um pedido de <strong>R$136,50</strong></span>`,
         
            `<span><strong>Alguém de Iguaraçu - PR</strong> acabou de fazer um pedido de <strong>R$783,30</strong></span>`,
         
            `<span><strong>Alguém de Santos - SP</strong> acabou de fazer um pedido de <strong>R$307,50</strong></span>`,
         
            `<span><strong>Alguém de Planura - MG</strong> acabou de fazer um pedido de <strong>R$1.632,20</strong></span>`,
         
            `<span><strong>Alguém de Itinga - MG</strong> acabou de fazer um pedido de <strong>R$311,80</strong></span>`,
         
            `<span><strong>Alguém de Hortolândia - SP</strong> acabou de fazer um pedido de <strong>R$579,40</strong></span>`,
         
            `<span><strong>Alguém de Conceição das Alagoas - MG</strong> acabou de fazer um pedido de <strong>R$1.189,00</strong></span>`,
         
            `<span><strong>Alguém de Hortolândia - SP</strong> acabou de fazer um pedido de <strong>R$553,60</strong></span>`,
         
            `<span><strong>Alguém de Bragança Paulista - SP</strong> acabou de fazer um pedido de <strong>R$370,50</strong></span>`,
         
            `<span><strong>Alguém de Morro Agudo - SP</strong> acabou de fazer um pedido de <strong>R$383,60</strong></span>`,
         
            `<span><strong>Alguém de Carneirinho - MG</strong> acabou de fazer um pedido de <strong>R$844,60</strong></span>`,
         
            `<span><strong>Alguém de Tanabi - SP</strong> acabou de fazer um pedido de <strong>R$996,50</strong></span>`,
            ];

    var notificacoes_pedidos_recentes_i = 0;

    setTimeout(() => {

        $(".noticacaoPedidosText").html(notificacoes_pedidos_recentes[notificacoes_pedidos_recentes_i]);

        $(".noticacaoPedidosContent").addClass("animate-show");
        $(".noticacaoPedidosContent").fadeIn('fast');

        notificacoes_pedidos_recentes_i++;

        setTimeout(fecharnoticacaoPedidos, 5000);

        intervaloNotificacaoPedidosRecentes = setInterval(function() {

            if (notificacoes_pedidos_recentes[notificacoes_pedidos_recentes_i] != undefined) {


                $(".noticacaoPedidosText").html(notificacoes_pedidos_recentes[
                    notificacoes_pedidos_recentes_i]);

                $(".noticacaoPedidosContent").removeClass("animate-hide").addClass("animate-show");
                $(".noticacaoPedidosContent").fadeIn('fast');

                setTimeout(fecharnoticacaoPedidos, 5000);

                notificacoes_pedidos_recentes_i++;

            } else {

                clearInterval(intervaloNotificacaoPedidosRecentes);

            }

        }, 60000);

    }, 20000);


    
    $(function() {
        $('[data-toggle="popover"]').popover();

        
        lojaStories.adicionarLoja(3016, 'padrao');
        lojaStories.inicializar();

        updateStatusPushCatalogo();
    });

    var AudioContext = window.AudioContext || window.webkitAudioContext;
    var context = null; // Make it crossbrowser

    function unlockAudio() {
        // console.log("unlocking audio");

        context = new AudioContext(); // Make it crossbrowser

        // create empty buffer and play it
        var buffer = context.createBuffer(1, 1, 22050);
        var source = context.createBufferSource();
        source.buffer = buffer;
        source.connect(context.destination);

        // play the file. noteOn is the older version of start()
        source.start ? source.start(0) : source.noteOn(0);

        // by checking the play state after some time, we know if we're really unlocked
        setTimeout(function() {
          if((source.playbackState === source.PLAYING_STATE || source.playbackState === source.FINISHED_STATE)) {
            // Hide the unmute button if the context is unlocked.
            // console.log("audio unlocked");
            document.body.removeEventListener('click', unlockAudio)
            document.body.removeEventListener('touchstart', unlockAudio)
          }
        }, 0);
      }

    document.body.addEventListener('click', unlockAudio);
    document.body.addEventListener('touchstart', unlockAudio);

    let inputBuscaCategoriasState = 'busca';
    let inputBuscaCategoriasManualState = false;

    function exibirBuscaMobile(botaoCancelarBusca = true, onScroll = false) {
        if (inputBuscaCategoriasManualState && onScroll === true) {
            return;
        }

        if (inputBuscaCategoriasState == 'busca') {
            return;
        }
        inputBuscaCategoriasState = 'busca';

        $('#input_group_categorias_busca').fadeOut('fast').promise().done(() => {
            $('#categorias_select').hide();
            $('#btn_iniciar_busca').hide();
            $('#busca_input').show();
            $('#btn_enviar_busca').show();

            if (botaoCancelarBusca) {
                $('#btn_cancelar_busca').show();
            }

            $('#input_group_categorias_busca').fadeIn('fast');
        });

        if (onScroll !== true) {
            inputBuscaCategoriasManualState = !inputBuscaCategoriasManualState;
        }
    }

    function exibirMenuCategoriasMobile(botaoCancelarBusca = true, onScroll = false) {
        if (inputBuscaCategoriasManualState && onScroll === true) {
            return;
        }

        if (inputBuscaCategoriasState == 'categorias') {
            return;
        }
        inputBuscaCategoriasState = 'categorias';

        $('#input_group_categorias_busca').fadeOut('fast').promise().done(() => {
            $('#busca_input').hide();
            $('#btn_enviar_busca').hide();
            $('#categorias_select').show();
            $('#btn_iniciar_busca').show();

            if (botaoCancelarBusca) {
                $('#btn_cancelar_busca').hide();
            }
            $('#input_group_categorias_busca').fadeIn('fast');
        });

        if (onScroll !== true) {
            inputBuscaCategoriasManualState = !inputBuscaCategoriasManualState;
        }
    }

        $(window).scroll(function() {
        if ($("#categorias_div_slider").offset()) {
            if ($(window).width() < 1200) {
                var categorias_div_slider_limit_scroll = $("#categorias_div_slider").offset().top + 50;
                if ($(window).scrollTop() >= categorias_div_slider_limit_scroll) {
                    exibirMenuCategoriasMobile(true, true);
                } else {
                    exibirBuscaMobile(false, true);
                }
            }
        }
    });
    
    var retornoVerificacaoWhatsApp;

    function abrirModalValidacaoWhatsApp(retorno) {
                    if (retorno == 'seguir') {
                if (linkInstagramLoja != '') {
                    window.open(linkInstagramLoja, '_blank');
                    return;
                }
            }

            showNotification("Ops!", "No momento esta funcionalidade está desativada na loja.", "info");
            return;
        
        retornoVerificacaoWhatsApp = retorno;
        $('#validarWhatsAppVisitanteModal').modal('show');

        showLoadingOverlay('#validarWhatsAppVisitanteModal .modal-dialog');

        $.post("https://calientelingerie.com.br/api/clientes/enviar_verificacao_whatsapp_visitante")
            .done(function(data) {
                closeLoadingOverlay('#validarWhatsAppVisitanteModal .modal-dialog');
            })
            .fail(function(xhr, status, error) {
                closeLoadingOverlay('#validarWhatsAppVisitanteModal .modal-dialog');
                $('#validarWhatsAppVisitanteModal').modal('hide');
                const mensagemErro = xhr.responseJSON?.messages?.error || "Não foi possível enviar o código de verificação! Atualize a página e tente novamente.";
                showNotification("Ops!", mensagemErro, "error");
            });
    }

    function validarWhatsApp() {
        const codigo = $('#validarWhatsAppVisitanteModal #whatsapp_codigo_verificacao').inputmask('unmaskedvalue');

        if (codigo.length != 5) {
            showNotification("Ops!", "Código de verificação inválido!", "error");
            return;
        }

        showLoadingOverlay('#validarWhatsAppVisitanteModal .modal-dialog');

        $.post("https://calientelingerie.com.br/api/clientes/validar_verificacao_whatsapp_visitante", {
                codigo: codigo
            })
            .done(function(data) {
                visitanteWhatsAppValidado = true;
                clienteLogado = true;
                usuarioLogado = true;

                $('#validarWhatsAppVisitanteModal').modal('hide');

                closeLoadingOverlay('#validarWhatsAppVisitanteModal .modal-dialog');

                showNotification("Sucesso!", "WhatsApp validado com sucesso! Estamos redirecionando você...", "success");

                sessionStorage.setItem('finalizacao_pedido_aproveitar_dados', true);

                setTimeout(() => {
                    if (retornoVerificacaoWhatsApp == 'minha_conta') {
                        window.location.href = 'https://calientelingerie.com.br/c/calientelingerie/minha_conta/17996842783';
                    } else if (retornoVerificacaoWhatsApp == 'seguir') {
                        abrirModalSeguir();
                    } else {
                        window.location.href = window.location.href;
                    }
                }, 2000);
            })
            .fail(function(xhr, status, error) {
                closeLoadingOverlay('#validarWhatsAppVisitanteModal .modal-dialog');
                const mensagemErro = xhr.responseJSON?.messages?.error || "Não foi possível validar o código de verificação! Atualize a página e tente novamente.";
                showNotification("Ops!", mensagemErro, "error");
            });
    }

    $('.validar-whatsapp-btn').on('click', function() {
        validarWhatsApp();
    });

    

--- SCRIPT 83 ---


    if ($(".desktop-navbar").length) {
        var desktop_navbar_limit_scroll = $(".desktop-navbar").offset().top - 50;
    }

    $(window).scroll(function() {
        if ($(".desktop-navbar").length) {
            if ($(window).width() >= 1200) {
                if ($('.desktop-navbar').length) {
                    if ($(window).scrollTop() >= desktop_navbar_limit_scroll) {
                        $(".desktop-navbar").css("position", "fixed");
                        if ($('body').hasClass('aviso-visivel')) {
                            $(".desktop-navbar").css("top", "73px");
                        } else {
                            $(".desktop-navbar").css("top", "48px");
                        }
                        $(".desktop-navbar").css("z-index", "10000");
                    } else {
                        $(".desktop-navbar").css("position", "relative");
                        $(".desktop-navbar").css("top", "unset");
                        $(".desktop-navbar").css("z-index", "auto");
                    }
                }
            }
        }
    });


--- SCRIPT 84 ---


var PWAbeforeInstallPrompt = null;
var PWAbannerHidden = false;
window.addEventListener("beforeinstallprompt", PWAeventHandler, PWAerrorHandler);
window.addEventListener("appinstalled", PWAHideBanner);

function PWAeventHandler(event) {
    if ($('link[rel="manifest"]').length == 0 || PWAbannerHidden) {
        return;
    }

    const hideBannerUtil = localStorage.getItem('PWAHideBannerUtil_catalogo_Calientelingerie');

    if (hideBannerUtil && new Date().getTime() < hideBannerUtil) {
        PWAbannerHidden = true;
        return;
    }

    event.preventDefault();

    PWAbeforeInstallPrompt = event;
    PWAShowBanner();
}

function PWAShowBanner() {
    if (! PWAbeforeInstallPrompt) {
        return;
    }

    const manifestURL = $('link[rel="manifest"]').attr('href');

    const manifestContent = $.ajax({
        url: manifestURL,
        async: false
    }).responseText;

    const manifest = JSON.parse(manifestContent);
    
    const bannerHTML = `
        <div class="f-15 pos-fixed banner-pwa" style="display:none;">
            <div class="d-flex align-items-center" style="max-width: 500px; margin: 5px auto;">
                <div class="f-20">
                    <a href="javascript:void(0)" onclick="PWAHideBanner(true)" style="height:60px">
                        <i class="ti-close px-2 mr-0"></i>
                    </a>
                </div>
                <div class="">
                    <img src="${manifest.icons[0].src}" class="mr-2">
                </div>
                <div class="install-info">
                    <p class="font-weight-bold mb-0">${manifest.name}</p>
                    <p class="mb-0">Instale o app no seu dispositivo!</p>
                    <div class="btn-instalar-sm mt-1 text-right">
                        <button type="button" class="btn btn-dark py-2 mr-2" onclick="PWAinstalar()">Instalar</button>
                    </div>
                </div>
                <div class="ml-auto btn-instalar-lg">
                    <button type="button" class="btn btn-dark mr-2" onclick="PWAinstalar()">Instalar</button>
                </div>
            </div>
        </div>
    `;

    $('body').prepend(bannerHTML);
    $('.banner-pwa').fadeIn('fast');
}

function PWAHideBanner(remember) {
    PWAbannerHidden = true;
    PWAbeforeInstallPrompt = null;
    $('.banner-pwa').fadeOut('fast');

    if (remember) {
        const weekTime = 60 * 60 * 24 * 7 * 1000;
        localStorage.setItem('PWAHideBannerUtil_catalogo_Calientelingerie', new Date().getTime() + weekTime);
    }
}

function PWAerrorHandler(event) {
    console.log("error: " + event);
}

async function PWAinstalar() {
    if (! PWAbeforeInstallPrompt) {
        PWAHideBanner();
        return;
    }

    const result = await PWAbeforeInstallPrompt.prompt();
    PWAHideBanner();
}



--- SCRIPT 86 ---


    $(document).ready(function() {
        $(window).scroll(throttle(function() {
            if ($(this).scrollTop() > 300) {
                $('#backToTop').fadeIn();
            } else {
                $('#backToTop').fadeOut();
            }
        }, 100));

        $('#backToTop').click(function() {
            $('html, body').animate({
                scrollTop: 0
            }, 600).then(() => {
                $('#backToTop').fadeOut();
            });
            return false;
        });

        $('#backToTop').hover(
            function() {
                $(this).css('transform', 'scale(1.1)');
            },
            function() {
                $(this).css('transform', 'scale(1)');
            }
        );
    });
    